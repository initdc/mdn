{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"オンライン・オフラインイベント","mdn_url":"/ja/docs/conflicting/Web/API/Navigator/onLine","locale":"ja","native":"日本語","sidebarHTML":"","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>一部のブラウザーは、 <a href=\"https://www.whatwg.org/specs/web-apps/current-work/#offline\" class=\"external\" rel=\" noopener\">Online/Offline イベント</a>を <a href=\"https://www.whatwg.org/specs/web-apps/current-work/\" class=\"external\" rel=\" noopener\">WHATWG Web Applications 1.0 仕様書</a>に従って実装しています。</p>"}},{"type":"prose","value":{"id":"概要","title":"概要","isH3":true,"content":"<p>オフラインに対応した良いウェブアプリケーションを構築するためには、アプリケーションが実際にオフラインになったタイミングを知る必要があります。また、アプリケーションが「オンライン」の状態に復帰したタイミングも知る必要があります。要件を分解すると次のようになります。</p>\n<ol>\n  <li>サーバーとの再同期ができるように、ユーザーがオンラインに戻ったタイミングを知る必要があります。</li>\n  <li>サーバーへのリクエストを後回しにすることができるように、ユーザーがオフラインなったタイミングを知る必要があります。</li>\n</ol>\n<p>オンライン／オフラインイベントがこのプロセスを一般化するのに役立ちます。</p>\n<p>残念ながら、これらのイベントは完全には信頼できません。より高い信頼性が必要な場合や、 API がブラウザーに実装されていない場合は、サービスワーカーを使用したり <a href=\"https://www.html5rocks.com/en/mobile/workingoffthegrid.html#toc-xml-http-request\" class=\"external\" rel=\" noopener\">XMLHttpRequest からのレスポンス</a>を使用するなど、他の兆候を利用してオフラインであるかどうかを検出することができます。</p>"}},{"type":"prose","value":{"id":"api","title":"API","isH3":false,"content":""}},{"type":"prose","value":{"id":"navigator.online","title":"<code>navigator.onLine</code>","isH3":true,"content":"<p><a href=\"/ja/docs/Web/API/Navigator/onLine\"><code>navigator.onLine</code></a> は、 <code>true</code>/<code>false</code> の値を保持しているプロパティです (オンラインの場合は <code>true</code>、オフラインの場合は <code>false</code>)。</p>\n<p>このプロパティは、ユーザーが「オフラインモード」に切り替えたとき (Firefox の場合は、ファイル → オフライン作業) に更新されます。さらに、このプロパティは、ブラウザーがネットワークに接続できなくなったときに更新されます。仕様書によれば、次のようになっています。</p>\n<blockquote>\n  <p><code>navigator.onLine</code> 属性はユーザーがリンクを辿ったり、スクリプトが外部のページをリクエストしたりしたときにユーザーエージェントがネットワークで通信できない場合 (またはそのような試みが失敗した場合) は、必ず false を返す必要があります。</p>\n</blockquote>\n<p>Firefox 2 はこのプロパティをブラウザーのオフラインモードが切り替わる度に更新します。 <a href=\"/ja/docs/Mozilla/Firefox/Releases/41#miscellaneous\">Firefox 41</a> は、 Windows、 Linux、 OS X においてネットワークの接続状態が変化したときにも更新します。</p>\n<p>このプロパティは Firefox と Internet Explorer の古いバージョンにも存在しました。 (この仕様はこれらの先行的な実装に基づいています)。従って、今すぐこのプロパティを使い始めることができます。ネットワーク状態の自動判断は Firefox 2 にて実装されました。</p>","titleAsText":"navigator.onLine"}},{"type":"prose","value":{"id":"online_および_offline_イベント","title":"\"<code>online</code>\" および \"<code>offline</code>\" イベント","isH3":true,"content":"<p><a href=\"/ja/docs/Mozilla/Firefox/Releases/3\">Firefox 3</a> は 2 つの新しいイベントを導入しました。\"<a href=\"/en-US/docs/Web/API/Window/online_event\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">online (en-US)</a>\" and \"<a href=\"/en-US/docs/Web/API/Window/offline_event\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">offline (en-US)</a>\" です。これらの 2 つのイベントは、ブラウザーのオンラインおよびオフラインモードが切り替わるたびに、各ページの <code>&lt;body&gt;</code> に発行されます。加えて、このイベントは <code>document.body</code> から <code>document</code> へとバブリングし、 <code>window</code> までたどり着きます。これらのイベントはキャンセルできません (ユーザーのオンラインモードやオフラインモードへの移行を防ぐことはできません)。</p>\n<p><a href=\"/ja/docs/Mozilla/Firefox/Releases/41#miscellaneous\">Firefox 41</a> では、 Windows, Linux, OS X においてネットワークの接続状態が変化したことを OS が通知したときに、これらのイベントが発行されます。</p>\n<p>これらのイベントに対するリスナーは、いくつかのお馴染みの方法で登録することができます。</p>\n<ul>\n  <li><a href=\"/ja/docs/Web/API/EventTarget/addEventListener\"><code>addEventListener</code></a> を、 <code>window</code>, <code>document</code>, <code>document.body</code> に対して使用します。</li>\n  <li><code>document</code> または <code>document.body</code> の <code>.ononline</code> または <code>.onoffline</code> プロパティを JavaScript の <code>Function</code> オブジェクトに設定します。(<strong>注意:</strong> <code>window.ononline</code> または <code>window.onoffline</code> は互換性の理由で動作しません)</li>\n  <li>HTML マークアップで <code>&lt;body&gt;</code> タグの <code>ononline=\"...\"</code> または <code>onoffline=\"...\"</code> 属性を指定します。</li>\n</ul>","titleAsText":"\"online\" および \"offline\" イベント"}},{"type":"prose","value":{"id":"例","title":"例","isH3":false,"content":"<p>イベントが機能しているかどうかを確認するために、<a href=\"https://bugzilla.mozilla.org/attachment.cgi?id=220609\" class=\"external\" rel=\" noopener\">簡単なテストケース</a>を用意しました (イベントリスナーを document.body に代入しているため、 Chrome では動作しません)。</p>\n<p>こちらが JavaScript 部分です。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'load'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> status <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> log <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"log\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">updateOnlineStatus</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> condition <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>onLine <span class=\"token operator\">?</span> <span class=\"token string\">\"online\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"offline\"</span><span class=\"token punctuation\">;</span>\n\n    status<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> condition<span class=\"token punctuation\">;</span>\n    status<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> condition<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">insertAdjacentHTML</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beforeend\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Event: \"</span> <span class=\"token operator\">+</span> event<span class=\"token punctuation\">.</span>type <span class=\"token operator\">+</span> <span class=\"token string\">\"; Status: \"</span> <span class=\"token operator\">+</span> condition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span>  updateOnlineStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> updateOnlineStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>CSS 部分です。</p>\n<div class=\"code-example\"><pre class=\"brush: css notranslate\"><code><span class=\"token selector\">#status</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font</span><span class=\"token punctuation\">:</span> bold 1em sans-serif<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #FFF<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 0.5em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">#log</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 2.5em 0.5em 0.5em<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font</span><span class=\"token punctuation\">:</span> 1em sans-serif<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.online</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> green<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.offline</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>対応する HTML です。 XXX When mochitests for this are created, point to those instead and update this example -nickolay</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>status<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>log<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>This is a test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>実行例はこちらです。</p><iframe class=\"sample-code-frame\" title=\"例\" id=\"frame_example\" width=\"100%\" height=\"150\" src=\"https://yari-demos.prod.mdn.mozit.cloud/ja/docs/conflicting/Web/API/Navigator/onLine/_sample_.example.html\" loading=\"lazy\"></iframe>"}},{"type":"prose","value":{"id":"注","title":"注","isH3":false,"content":"<p>この API がブラウザに実装されていない場合は、サービスワーカーや <a href=\"https://www.html5rocks.com/en/mobile/workingoffthegrid.html#toc-xml-http-request\" class=\"external\" rel=\" noopener\">XMLHttpRequest からのレスポンス</a>を使用するなど、他の兆候を使用してオフラインであるかどうかを検出することができます。</p>"}},{"type":"prose","value":{"id":"参考文献","title":"参考文献","isH3":false,"content":"<ul>\n  <li><a href=\"https://www.whatwg.org/specs/web-apps/current-work/#offline\" class=\"external\" rel=\" noopener\">WHATWG Web Applications 1.0 仕様の「Online/Offline イベント」の節</a></li>\n  <li><a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=336359\" class=\"external\" rel=\" noopener\">Firefox に実装された online/offline イベントのバグ追跡</a>および<a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=336682\" class=\"external\" rel=\" noopener\">関連バグ</a></li>\n  <li><a href=\"https://bugzilla.mozilla.org/attachment.cgi?id=220609\" class=\"external\" rel=\" noopener\">簡単なテストケース</a></li>\n  <li><a href=\"http://ejohn.org/blog/offline-events/\" class=\"external\" rel=\" noopener\">Online/Offline イベントの解説</a></li>\n</ul>"}}],"toc":[{"text":"API","id":"api"},{"text":"例","id":"例"},{"text":"注","id":"注"},{"text":"参考文献","id":"参考文献"}],"summary":"一部のブラウザーは、 Online/Offline イベントを WHATWG Web Applications 1.0 仕様書に従って実装しています。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","source":{"folder":"ja/conflicting/web/api/navigator/online","github_url":"https://github.com/mdn/translated-content/blob/main/files/ja/conflicting/web/api/navigator/online/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"pageTitle":"オンライン・オフラインイベント | MDN","noIndexing":true}}