{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"ファイルの操作","mdn_url":"/ja/docs/Mozilla/Add-ons/WebExtensions/Working_with_files","locale":"ja","native":"日本語","sidebarHTML":"\n  <ol>\n    <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions\"><strong>ブラウザー拡張機能</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>始めましょう</summary>\n        <ol>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">拡張機能とは何か?</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">初めての拡張機能</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">2つめの拡張機能</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">拡張機能の中身</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Examples\">拡張機能の例</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/What_next_\">次にどうするのか？</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>概念</summary>\n        <ol>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">JavaScript API 群の利用</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">コンテンツスクリプト</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">マッチパターン</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">ファイルの操作</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">多言語対応</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Content Security Policy</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Native messaging</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome との非互換性</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>ユーザーインターフェイス</summary>\n        <ol>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface\">ユーザーインターフェイス</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">ブラウザーツールバーボタン</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">アドレスバーボタン</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">サイドバー</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">コンテキストメニュー項目</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">オプションページ</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">ページ拡張</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">通知</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Address bar suggestions</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">開発ツールパネル</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>逆引きリファレンス</summary>\n        <ol>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">HTTP リクエストへの介入</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">web ページの変更</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">外部コンテンツの挿入</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">ツールバーボタンの追加</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">設定画面の実装</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Tabs API 群の使い方</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Bookmark API 群の使い方</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Cookie API 群の使い方</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">contextual identities の使い方</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">クリップボードとのやりとり</a></li>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript API 群</summary>\n        <ol><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings\">browserSettings</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/browsingData\">browsingData</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/commands\">commands</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/events\">events</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/extension\">extension</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes\">extensionTypes</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/identity\">identity</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/management\">management</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notifications</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/omnibox\">omnibox</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/pageAction\">pageAction</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11\">pkcs11</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/privacy\">privacy</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction\">sidebarAction</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/theme\">theme</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/topSites\">topSites</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">序章</a></li>\n        </ol>\n      <ol><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">author</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides\">chrome_settings_overrides</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides\">chrome_url_overrides</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands\">commands</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page\">devtools_page</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito\">incognito</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">name</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox\">omnibox</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional_permissions</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\">page_action</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers\">protocol_handlers</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">short_name</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action\">sidebar_action</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme\">theme</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name\">version_name</a></li><li><a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/ja/docs/Mozilla/Add-ons/Contact_us\"><strong>コンタクト</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>チャンネル</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">ブログ</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">フォーラム</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>拡張機能にて完全な機能を提供するのにファイルを操作する必要があるかもしれません。この記事ではファイルを扱うための 5 つのメカニズムを見ていきます:</p>\n<ul>\n  <li>ユーザーが選択したファイルをダウンロードフォルダーにダウンロードする</li>\n  <li>ウェブページのファイルピッカーを使ってファイルを開く</li>\n  <li>ウェブページへのドラッグアンドドロップを使ってファイルを開く</li>\n  <li>idb-file-storage ライブラリーを使ってファイルや blob を IndexedDB に保管する</li>\n  <li>ユーザーのコンピューター上のネイティブアプリケーションにファイルを渡す</li>\n</ul>\n<p>それぞれのメカニズムに対し、各 API ドキュメンテーションやガイド、対応する API の使用法の例のリファレンスと一緒に、使い方を紹介します。</p>"}},{"type":"prose","value":{"id":"ダウンロード_api_を使ってファイルをダウンロード","title":"ダウンロード API を使ってファイルをダウンロード","isH3":false,"content":"<p>この仕組みでは、あなたのウェブサイト(や URL で決められたあらゆる場所)からユーザーのコンピューターにファイルを入手できます。主要なメソッドは <a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/downloads/download\"><code>downloads.download()</code></a> で、その簡単なフォームで URL を受け付けて、その URL からユーザーの既定のダウンロードフォルダーにファイルをダウンロードします:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>browser<span class=\"token punctuation\">.</span>downloads<span class=\"token punctuation\">.</span><span class=\"token function\">download</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://example.org/image.png\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>ユーザーが <code>saveAs</code> パラメーターで指定した場所にダウンロードさせることもできます。</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> Using <a href=\"/ja/docs/Web/API/URL/createObjectURL\">URL.createObjectURL()</a> you can also download files and blobs defined in your JavaScript, which can include local content retrieved from IndexedDB.</p>\n</div>\n<p>ダウンロード API はダウンロードをキャンセル、停止、再開、消去、削除することもできます; ダウンロードマネージャーでダウンロード済みのファイルを探します; コンピューターのファイルマネージャーでダウンロード済みのファイルを表示します; 関連付けられたアプリケーションでそのファイルを開きます。</p>\n<p>この API を使うには <a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">manifest.json</a> ファイルにて \"downloads\" <a href=\"/ja/docs/Web/API/Permissions#api_permissions\">API パーミッション</a>が必要です。</p>\n<p>\n  例: <a href=\"https://github.com/mdn/webextensions-examples/tree/master/latest-download\" class=\"external\" rel=\" noopener\">Latest download</a>\n  API リファレンス: <a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads API</a>\n</p>"}},{"type":"prose","value":{"id":"ファイルピッカーを使って拡張機能でファイルを開く","title":"ファイルピッカーを使って拡張機能でファイルを開く","isH3":false,"content":"<p>ユーザーのコンピューターからのファイルを扱いたい場合、1 つの選択はコンピューターのファイルブラウザーを使ってユーザーがファイル選択できるようにすることです。新しいページを作るか既存のページにコードを挿入して、ファイルピッカーをユーザーに提供するため HTML <code>input</code> 要素の <code>file</code> タイプを使います。ユーザーがファイルを選ぶと、ページに関連付けられたスクリプトにより、<a href=\"/ja/docs/Web/API/File\">DOM File API</a> を使ってウェブアプリケーションと同様な方法でファイルの中身にページからアクセスできます。</p>\n<p>\n  例: <a href=\"https://github.com/mdn/webextensions-examples/tree/master/imagify\" class=\"external\" rel=\" noopener\">Imagify</a>\n  ガイド: <a href=\"/ja/docs/Web/API/File_API/Using_files_from_web_applications\">Using files from web applications</a>\n  API リファレンス: <a href=\"/ja/docs/Web/HTML/Element/input/file\">HTML input element</a> | <a href=\"/ja/docs/Web/API/File\">DOM File API</a>\n</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> 選択したフォルダーの全ファイルにアクセスや処理したい場合、<code>&lt;input type=\"file\" webkitdirectory=\"true\"/&gt;</code> を使ってフォルダーを選択して、そこにある全ファイルを返すようにできます。</p>\n</div>"}},{"type":"prose","value":{"id":"ドラッグアンドドロップを使って拡張機能でファイルを開く","title":"ドラッグアンドドロップを使って拡張機能でファイルを開く","isH3":false,"content":"<p>Web Drag and Drop API では別のファイルピッカーがあります。このメソッドを使うには、UI にフィットする ‘drop zone’ を設置して、<a href=\"/en-US/docs/Web/API/HTMLElement/dragenter_event\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">dragenter (en-US)</a>, <a href=\"/en-US/docs/Web/API/HTMLElement/dragover_event\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">dragover (en-US)</a>, <a href=\"/ja/docs/conflicting/Web/API/HTMLElement/drop_event_21b7ebf04561093fe90276329e9bddff\">drop</a> イベントのリスナーを要素に追加します。ドロップイベントのハンドラーでは、<a href=\"/ja/docs/Web/API/DataTransfer/files\">DataTransfer.files</a> を使って dataTransfer プロパティから提供されたオブジェクトからユーザーにドロップされたあらゆるファイルに、コードからアクセスできます。すると <a href=\"/ja/docs/Web/API/File\">DOM File API</a> を使ってファイルにアクセス・操作することができます。</p>\n<p>\n  例: <a href=\"https://github.com/mdn/webextensions-examples/tree/master/imagify\" class=\"external\" rel=\" noopener\">Imagify</a>\n  ガイド: <a href=\"/ja/docs/Web/API/File_API/Using_files_from_web_applications\">Using files from web applications</a> | <a href=\"/en-US/docs/Web/API/HTML_Drag_and_Drop_API/File_drag_and_drop\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">File drag and drop (en-US)</a>\n  API リファレンス: <a href=\"/ja/docs/Web/API/File\">DOM File API</a>\n</p>"}},{"type":"prose","value":{"id":"indexeddb_ファイルストレージライブラリーを使ってローカルにファイル保存する","title":"IndexedDB ファイルストレージライブラリーを使ってローカルにファイル保存する","isH3":false,"content":"<p>拡張機能がローカルにファイル保存する必要がある場合、<a href=\"https://www.npmjs.com/package/idb-file-storage\" class=\"external\" rel=\" noopener\">idb-file-storage ライブラリー</a>は 完結な Promise ベースの<a href=\"/ja/docs/Web/API/IndexedDB_API\">IndexedDB API</a>ラッパーであり、ストレージやファイルや blob の取得を助けます。</p>\n<p>Firefox では、このライブラリーは非標準の IDBMutableFile API のラッパーとして Promise ベースの API も提供します (IDBMutableFile API を使うと、拡張機能は IndexedDB データベースファイルオブジェクトの作成と保存ができて、それによりメモリーにファイルを読み込むことなくファイルの中身を読み書きできる API が提供されます)</p>\n<p>このライブラリーのキーとなる機能は:</p>\n<ul>\n  <li>IDBFileStorage インスタンスを返す <a href=\"https://rpl.github.io/idb-file-storage/function/index.html#static-function-getFileStorage\" class=\"external\" rel=\" noopener\">getFileStorage</a>。名前付きストレージが存在しない場合には作成します。</li>\n  <li><a href=\"https://rpl.github.io/idb-file-storage/class/src/idb-file-storage.js~IDBFileStorage.html\" class=\"external\" rel=\" noopener\">IDBFileStorage</a>。これはファイルを保存したり取得するメソッドを提供します、例えば次のもの:\n    <ul>\n      <li>データベース内の(フィルターされた)ファイルの list</li>\n      <li>データベースにファイルや blob を追加する put</li>\n      <li>データベースからファイルや blob を取得する get</li>\n      <li>データベースからファイルや blob を削除する remove</li>\n    </ul>\n  </li>\n</ul>\n<p><a href=\"https://github.com/mdn/webextensions-examples/tree/master/store-collected-images/webextension-plain\" class=\"external\" rel=\" noopener\">Store Collected Images</a> の例ではこの機能の大半の使い方を示します。(IDBMutableFile は含まれていませんが、<a href=\"https://rpl.github.io/idb-file-storage/examples/\" class=\"external\" rel=\" noopener\">idb-file-storage examples</a> にて、ライブラリーの他の多くの例と一緒に見ることができます)。</p>\n<p>Store Collected Images の例では、画像コンテキストメニューを使ってユーザーが画像を追加できます。選択された画像はポップアップメニューに集められて、名前付きコレクションに保存されます。ツールバーボタンの(<a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\"><code>browserAction</code></a>) ナビゲートコレクションのページを開き、そこでユーザーは選択を狭められるフィルターオプションを使って、保存された画像を見たり消去したりできます。<a href=\"https://youtu.be/t6aVqMMe2Rc\" class=\"external\" rel=\" noopener\">この例を見てください</a>。</p>\n<p>/utils/ 内の <a href=\"https://github.com/mdn/webextensions-examples/blob/master/store-collected-images/webextension-plain/utils/image-store.js\" class=\"external\" rel=\" noopener\">image-store.js</a> を見てライブラリーの動作を理解できます:</p>"}},{"type":"prose","value":{"id":"store_を作成して画像を保存する","title":"store を作成して画像を保存する","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">saveCollectedBlobs</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">collectionName<span class=\"token punctuation\">,</span> collectedBlobs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> storedImages <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getFileStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"stored-images\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> item <span class=\"token keyword\">of</span> collectedBlobs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> storedImages<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>collectionName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token punctuation\">.</span>uuid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">.</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>saveCollectedBlobs</code> is called when the user clicks save in the popup and has provided a name for the image collection. First, <code>getFileStorage</code> creates, if it does not exist already, or retrieves the IndexedDB database “stored-images” to the object <code>storedImages</code>. <code>storedImages.put</code> then adds each collected image to the database, under the collection name, using the blob’s unique id (the file name). If the image being store has the same name as one already in the database, it is overwritten. If you want to avoid this, query the database first using <code>imagesStore.list()</code> with a filter for the file name, and, if the list returns a file, add a suitable suffix to the name of the new image to store a separate item.</p>"}},{"type":"prose","value":{"id":"保管された画像を表示用に取得する","title":"保管された画像を表示用に取得する","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadStoredImages</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">filter</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> imagesStore <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getFileStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"stored-images\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">let</span> listOptions <span class=\"token operator\">=</span> filter <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">includes</span><span class=\"token operator\">:</span> filter<span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">const</span> imagesList <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> imagesStore<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span>listOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">let</span> storedImages <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> storedName <span class=\"token keyword\">of</span> imagesList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> imagesStore<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>storedName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    storedImages<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>storedName<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">blobUrl</span><span class=\"token operator\">:</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token keyword\">return</span> storedImages<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>loadStoredImages</code> is called when the user clicks view or reload in the navigate collection page. <code>getFileStorage</code> opens the “stored-images” database, then <code>imagesStore.list</code> gets a filtered list of the stored images. This list is then used to retrieve images with <code>imagesStore.get</code> and build a list to return to the UI.</p>\n<p>Note the use of <a href=\"/ja/docs/Web/API/URL/createObjectURL\">URL.createObjectURL(blob)</a> to create a URL that references the image blob. This URL is then used in the UI (<a href=\"https://github.com/mdn/webextensions-examples/blob/master/store-collected-images/webextension-plain/navigate-collection.js\" class=\"external\" rel=\" noopener\">navigate-collection.js</a><a href=\"https://github.com/mdn/webextensions-examples/blob/master/store-collected-images/webextension-plain/navigate-collection.js\" class=\"external\" rel=\" noopener\">collection.js</a>) to display the image.</p>"}},{"type":"prose","value":{"id":"集まった画像を削除する","title":"集まった画像を削除する","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">removeStoredImages</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">storedImages</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> imagesStore <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getFileStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"stored-images\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> storedImage <span class=\"token keyword\">of</span> storedImages<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>storedImage<span class=\"token punctuation\">.</span>blobUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> imagesStore<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>storedImage<span class=\"token punctuation\">.</span>storedName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>removeStoredImages</code> is called when the user clicks delete in the navigate collection page. Again, <code>getFileStorage</code> opens the “stored-images” database then <code>imagesStore.remove</code> removes each image from the filtered list of images.</p>\n<p>Note the use of <a href=\"/ja/docs/Web/API/URL/revokeObjectURL\">URL.revokeObjectURL()</a> to explicitly revoke the blob URL. This enables the garbage collector to free the memory allocated to the URL. If this is not done, the memory will not get returned until the page on which it was created is closed. If the URL was created in an extension’s background page, this is not unloaded until the extension is disabled, uninstalled, or reloaded, so holding this memory unnecessarily could affect browser performance. If the URL is created in an extension’s page (new tab, popup, or sidebar) the memory is released when the page is closed, but it is still a good practice to revoke the URL when it is no longer needed.</p>\n<p>Once the blob URL has been revoked any attempt to load it will result in an error. 例えば、if the blob url was used as the <code>SRC</code> attribute of an <code>IMG</code> tag, the image will not load and will not be visible. It is therefore good practice to remove any revoked blob urls from generated HTML elements when the blob URL is revoked.</p>\n<p>\n  Example: <a href=\"https://github.com/mdn/webextensions-examples/tree/master/store-collected-images/webextension-plain\" class=\"external\" rel=\" noopener\">Store Collected Images</a>\n  API References: <a href=\"https://rpl.github.io/idb-file-storage/\" class=\"external\" rel=\" noopener\">idb-file-storage library</a>\n</p>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> Note: You can also use the full Web <a href=\"/ja/docs/Web/API/IndexedDB_API\">IndexedDB API</a> to store data from your extension. This can be useful where you need to store data that isn’t handled well by the simple key/value pairs offered by the DOM <a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/Storage\">Storage API</a>.</p>\n</div>"}},{"type":"prose","value":{"id":"ローカルアプリでファイルを処理する","title":"ローカルアプリでファイルを処理する","isH3":false,"content":"<p>Where you have a native app or want to deliver additional native features for file processing, use native messaging to pass a file to a native app for processing.</p>\n<p>You have two options:</p>\n<ul>\n  <li>Connection-based messaging. Here you trigger the process with runtime.connectNative(), which returns a <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/Port\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">runtime.Port (en-US)</a> object. You can then pass a JSON message to the native application using the postMessage() function of Port. Using the onMessage.addListener() function of Port you can listen for messages from the native application. The native application is opened if it is not running when runtime.connectNative() is called and the application remains running until the extension calls Port.disconnect() or the page that connected to it is closed.</li>\n  <li>Connectionless messaging. Here you use runtime.sendNativeMessage() to send a JSON message to a new, temporary instance of the native application. The browser closes the native application after receiving any message back from the native application.</li>\n</ul>\n<p>To add the file or blob you want the native application to process use <a href=\"/ja/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify\">JSON.stringify()</a>.</p>\n<p>To use this method the extension must request the \"nativeMessaging\" <a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a> in its manifest.json file. Reciprocally, the native application must grant permission for the extension by including its ID in the \"allowed_extensions\" field of the app manifest.</p>\n<p>\n  Example: <a href=\"https://github.com/mdn/webextensions-examples/tree/master/native-messaging\" class=\"external\" rel=\" noopener\">Native Messaging</a> (illustrates simple messaging only)\n  Guides: <a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Native messaging</a>\n  API references: <a href=\"/ja/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime API</a>\n</p>"}}],"toc":[{"text":"ダウンロード API を使ってファイルをダウンロード","id":"ダウンロード_api_を使ってファイルをダウンロード"},{"text":"ファイルピッカーを使って拡張機能でファイルを開く","id":"ファイルピッカーを使って拡張機能でファイルを開く"},{"text":"ドラッグアンドドロップを使って拡張機能でファイルを開く","id":"ドラッグアンドドロップを使って拡張機能でファイルを開く"},{"text":"IndexedDB ファイルストレージライブラリーを使ってローカルにファイル保存する","id":"indexeddb_ファイルストレージライブラリーを使ってローカルにファイル保存する"},{"text":"ローカルアプリでファイルを処理する","id":"ローカルアプリでファイルを処理する"}],"summary":"拡張機能にて完全な機能を提供するのにファイルを操作する必要があるかもしれません。この記事ではファイルを扱うための 5 つのメカニズムを見ていきます:","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Working with files","locale":"en-US","native":"English (US)"},{"title":"Travailler avec des fichiers","locale":"fr","native":"Français"}],"source":{"folder":"ja/mozilla/add-ons/webextensions/working_with_files","github_url":"https://github.com/mdn/translated-content/blob/main/files/ja/mozilla/add-ons/webextensions/working_with_files/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/ja/docs/Mozilla","title":"Mozilla"},{"uri":"/ja/docs/Mozilla/Add-ons","title":"アドオン"},{"uri":"/ja/docs/Mozilla/Add-ons/WebExtensions","title":"ブラウザー拡張機能"},{"uri":"/ja/docs/Mozilla/Add-ons/WebExtensions/Working_with_files","title":"ファイルの操作"}],"pageTitle":"ファイルの操作 - Mozilla | MDN","noIndexing":false}}