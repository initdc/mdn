<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>WebGL モデル ビュー 射影 - Web API | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><link rel="alternate" title="WebGL モデル ビュー 射影" href="https://developer.mozilla.org/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection" hreflang="ja"><link rel="alternate" title="WebGL model view projection" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/WebGL_model_view_projection" hreflang="zh"><link rel="alternate" title="WebGL model view projection" href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_model_view_projection" hreflang="en"><meta name="description" content="この記事では、WebGL プロジェクト内でデータを取得し、それを適切な空間に投影して画面に表示する方法について説明します。並進、拡縮、回転行列を使用した基本的な行列計算の知識があることを前提としています。3D シーンを構成するときに通常使用される中心的な 3 つの行列である、モデル、ビュー、射影行列について説明します。"><meta property="og:url" content="https://developer.mozilla.org/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection"><meta property="og:title" content="WebGL モデル ビュー 射影 - Web API | MDN"><meta property="og:description" content="この記事では、WebGL プロジェクト内でデータを取得し、それを適切な空間に投影して画面に表示する方法について説明します。並進、拡縮、回転行列を使用した基本的な行列計算の知識があることを前提としています。3D シーンを構成するときに通常使用される中心的な 3 つの行列である、モデル、ビュー、射影行列について説明します。"><meta property="og:locale" content="ja"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/ja/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/ja/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/ja/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/ja/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/ja/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/ja/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> 🌐</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> 🌐</a></li></ul></li></ul></nav><div class="header-search"><form action="/ja/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/ja/docs/Web"><span property="name">開発者向けのウェブ技術</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/ja/docs/Web/API"><span property="name">Web API</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/ja/docs/Web/API/WebGL_API"><span property="name">WebGL: ウェブの 2D および 3D グラフィック</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection"><span property="name">WebGL モデル ビュー 射影</span></a><meta property="position" content="4"></li></ol></nav><ul class="language-toggle"><li><a href="#select-language" class="language-icon"><span class="show-desktop">Change language</span></a></li><li><a class="view-in-english" href="/en-US/docs/Web/API/WebGL_API/WebGL_model_view_projection"><span class="show-desktop">View in</span> English</a></li></ul></div><div class="localized-content-note notecard inline neutral"><a href="/en-US/docs/MDN/Contribute/Localize#active_locales">このページはコミュニティーの尽力で英語から翻訳されました。MDN Web Docs コミュニティーについてもっと知り、仲間になるにはこちらから。</a></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#モデル、ビュー、射影行列">モデル、ビュー、射影行列</a></li><li><a href="#クリップ空間">クリップ空間</a></li><li><a href="#斉次座標">斉次座標</a></li><li><a href="#model_transform">Model transform</a></li><li><a href="#divide_by_w">Divide by W</a></li><li><a href="#simple_projection">Simple projection</a></li><li><a href="#the_viewing_frustum">The viewing frustum</a></li><li><a href="#perspective_projection_matrix">Perspective projection matrix</a></li><li><a href="#view_matrix">View matrix</a></li><li><a href="#see_also">See also</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="ja"><h1>WebGL モデル ビュー 射影</h1><div><p>この記事では、<a href="/ja/docs/Web/API/WebGL_API">WebGL</a> プロジェクト内でデータを取得し、それを適切な空間に投影して画面に表示する方法について説明します。並進、拡縮、回転行列を使用した基本的な行列計算の知識があることを前提としています。3D シーンを構成するときに通常使用される中心的な 3 つの行列である、モデル、ビュー、射影行列について説明します。</p>
<div class="notecard note" id="sect1">
  <p><strong>Note:</strong> This article is also available as an <a href="https://github.com/TatumCreative/mdn-model-view-projection" class="external" rel=" noopener">MDN content kit</a>. It also uses a collection of <a href="https://github.com/TatumCreative/mdn-webgl" class="external" rel=" noopener">utility functions</a> available under the <code>MDN</code> global object.</p>
</div></div><h2 id="モデル、ビュー、射影行列"><a href="#モデル、ビュー、射影行列" title="Permalink to モデル、ビュー、射影行列">モデル、ビュー、射影行列</a></h2><div><p>WebGL の空間内の点とポリゴンの個々の変換は、並進、拡縮、回転などの基本的な変換行列によって処理されます。 これらの行列は、複雑な 3D シーンの描画に役立つように、一緒に構成し、特別な方法でグループ化できます。これらの構成された行列は、最終的に元のモデルデータを<strong>クリップ空間</strong>と呼ばれる特別な座標空間に移動します。これは 2 ユニットの幅の立方体で、中心が (0,0,0) 、対角が (-1,-1,-1) から (1,1,1) になります。このクリップ空間は 2 次元平面に圧縮され、画像へラスタライズされます。</p>
<p>以下で説明する最初の行列は<strong>モデル行列</strong>です。これは、元のモデルデータを取得して 3 次元ワールド空間内で移動する方法を定義します。 <strong>射影行列</strong>は、ワールド空間座標をクリップ空間座標に変換するために使用されます。 一般的に使用される射影行列である<strong>透視投影射影行列</strong>は、3D 仮想世界の視聴者の代理として機能する一般的なカメラの<em>効果</em>を模倣するために使用されます。 <strong>ビュー行列</strong>は、変更されるカメラの位置をシミュレートし、シーン内のオブジェクトを移動して視聴者が現在何を見られるかを変更します。</p>
<p>以下のセクションでは、モデル、ビュー、射影行列の背景にある考え方と実装について詳説します。 これらの行列は、画面上でデータを移動するための根幹であり、個々のフレームワークやエンジンを超える概念です。</p></div><h2 id="クリップ空間"><a href="#クリップ空間" title="Permalink to クリップ空間">クリップ空間</a></h2><div><p>WebGL プログラムでは、通常、データは自分の座標系で GPU にアップロードされ、次に頂点シェーダーがそれらの点を<strong>クリップ空間</strong>と呼ばれる特別な座標系に変換します。クリップ空間の外側にあるデータは切り取られ、描画されません。ただし、三角形がこのスペースの境界を跨ぐ場合は、新しい三角形に分割され、クリップスペースにある新しい三角形の部分のみが残ります。</p>
<p>
  <img src="https://mdn.mozillademos.org/files/11371/clip-space-graph.svg" alt="A 3d graph showing clip space in WebGL." loading="lazy">
</p>
<p>上の図は、全ての点が収まる必要のあるクリップ空間を視覚化したものです。これは、各辺が 2 の立方体であり、片方の角が (-1,-1,-1) にあり、対角が (1,1,1) にあります。立方体の中心は点 (0,0,0) です。 クリップ空間に使用されるこの 8 立方メートルの座標系は、正規化デバイス座標（NDC）と呼ばれます。WebGL コードを調べて作業している間、その用語を時々耳にするかもしれません。</p>
<p>このセクションでは、データをクリップ空間座標系に直接配置する仕組みを説明します。 通常、任意の座標系にあるモデルデータが使用され、その後、行列を使用して変換され、モデル座標がクリップ空間座標系に変換されます。この例では、クリップ空間がどのように機能するかを最も簡単に説明する為、単純に (-1, -1, -1) から (1,1,1) までの範囲のモデル座標を使用します。以下のコードは、画面上に正方形を描く為に 2 つの三角形を作成します。正方形の Z 深度は、正方形が同じ空間を共有するときに何が上に描画されるかを決定します。小さい Z 値は大きい Z 値の上にレンダリングされます。</p></div><h3 id="webglbox_の例"><a href="#webglbox_の例" title="Permalink to WebGLBox の例">WebGLBox の例</a></h3><div><p>この例では、画面上に 2D ボックスを描画するカスタム <code>WebGLBox</code> オブジェクトを作成します。</p>
<div class="notecard note" id="sect2">
  <p><strong>Note:</strong> The code for each WebGLBox example is available in this <a href="https://github.com/TatumCreative/mdn-model-view-projection/tree/master/lessons" class="external" rel=" noopener">github repo</a> and is organized by section. In addition there is a JSFiddle link at the bottom of each section.</p>
</div>
<h4 id="webglbox_コンストラクタ">WebGLBox コンストラクタ</h4>
<p>コンストラクターは次のようになります。</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">WebGLBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup the canvas and WebGL context</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>gl <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gl<span class="token punctuation">;</span>

  <span class="token comment">// Setup a WebGL program, anything part of the MDN object is defined outside of this article</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>webglProgram <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">createWebGLProgramFromIds</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token string">'vertex-shader'</span><span class="token punctuation">,</span> <span class="token string">'fragment-shader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webglProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Save the attribute and uniform locations</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webglProgram<span class="token punctuation">,</span> <span class="token string">'position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webglProgram<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Tell WebGL to test the depth when drawing, so if a square is behind</span>
  <span class="token comment">// another square it won't be drawn</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="webglbox_描画">WebGLBox 描画</h4>
<p>次に、画面上にボックスを描画するメソッドを作成します。</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token class-name">WebGLBox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">settings</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Create some attribute data; these are the triangles that will end being</span>
  <span class="token comment">// drawn to the screen. There are two that form a square.</span>

  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>

    <span class="token comment">//Triangle 1</span>
    settings<span class="token punctuation">.</span>left<span class="token punctuation">,</span>  settings<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span>
    settings<span class="token punctuation">.</span>right<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span>
    settings<span class="token punctuation">.</span>left<span class="token punctuation">,</span>  settings<span class="token punctuation">.</span>top<span class="token punctuation">,</span>    settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span>

    <span class="token comment">//Triangle 2</span>
    settings<span class="token punctuation">.</span>left<span class="token punctuation">,</span>  settings<span class="token punctuation">.</span>top<span class="token punctuation">,</span>    settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span>
    settings<span class="token punctuation">.</span>right<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span>
    settings<span class="token punctuation">.</span>right<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>top<span class="token punctuation">,</span>    settings<span class="token punctuation">.</span>depth
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Use WebGL to draw this onto the screen.</span>

  <span class="token comment">// Performance Note: Creating a new array buffer for every draw call is slow.</span>
  <span class="token comment">// This function is for illustration purposes only.</span>

  <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gl<span class="token punctuation">;</span>

  <span class="token comment">// Create a buffer and bind the data</span>
  <span class="token keyword">var</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Setup the pointer to our attribute data (the triangles)</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>positionLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>positionLocation<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Setup the color uniform that will be shared across all triangles</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorLocation<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Draw the triangles to the screen</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>シェーダーは GLSL で記述されたコードの一部であり、データポイントを取得して最終的に画面に描画します。便宜上、これらのシェーダーは、カスタム関数 <code>MDN.createWebGLProgramFromIds()</code> を介してプログラムに取り込まれる要素 <a href="/ja/docs/Web/HTML/Element/script"><code>&lt;script&gt;</code></a> に格納されます。この関数は、これらのチュートリアル用に作成された <a href="https://github.com/TatumCreative/mdn-webgl" class="external" rel=" noopener">ユーティリティ関数群</a> の一部であり、ここでは詳しく説明しません。この関数は、いくつかの GLSL ソースコードを取得して WebGL プログラムにコンパイルする基本を処理します。関数は 3 つのパラメーターを取ります。プログラムをレンダリングするコンテキスト、頂点シェーダーを含む要素の ID <a href="/ja/docs/Web/HTML/Element/script"><code>&lt;script&gt;</code></a>、フラグメントシェーダーを含む要素の ID <a href="/ja/docs/Web/HTML/Element/script"><code>&lt;script&gt;</code></a> です。頂点シェーダーは頂点を配置し、フラグメントシェーダーは各ピクセルに色を付けます。</p>
<p>最初に、画面上で頂点を移動させる頂点シェーダーを見てみましょう。</p>
<div class="code-example"><pre class="brush: glsl notranslate"><code><span class="token comment">// The individual position vertex</span>
<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> position<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// the gl_Position is the final position in clip space after the vertex shader modifies it</span>
  gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>次に、データを実際にピクセルにラスタライズするために、フラグメントシェーダーはピクセルごとに全てを評価し、一つの色を設定します。GPU は、レンダリングする必要があるピクセルごとにシェーダー関数を呼び出します。シェーダーの仕事は、そのピクセルに使用する色を返すことです。</p>
<div class="code-example"><pre class="brush: glsl notranslate"><code><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> color<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl_FragColor <span class="token operator">=</span> color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>これらの設定が含まれているので、クリップ空間座標を使用して画面に直接描画します。</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebGLBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>最初に中央に赤いボックスを描きます。</p>
<div class="code-example"><pre class="brush: js notranslate"><code>box<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">top</span>    <span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>             <span class="token comment">// x</span>
  <span class="token literal-property property">bottom</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>            <span class="token comment">// x</span>
  <span class="token literal-property property">left</span>   <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>            <span class="token comment">// y</span>
  <span class="token literal-property property">right</span>  <span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>             <span class="token comment">// y</span>

  <span class="token literal-property property">depth</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>               <span class="token comment">// z</span>
  <span class="token literal-property property">color</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// red</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>次に、緑色のボックスを赤いボックスの上部に描画します。</p>
<div class="code-example"><pre class="brush: js notranslate"><code>box<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">top</span>    <span class="token operator">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>             <span class="token comment">// x</span>
  <span class="token literal-property property">bottom</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>               <span class="token comment">// x</span>
  <span class="token literal-property property">left</span>   <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.9</span><span class="token punctuation">,</span>            <span class="token comment">// y</span>
  <span class="token literal-property property">right</span>  <span class="token operator">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>             <span class="token comment">// y</span>

  <span class="token literal-property property">depth</span>  <span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>             <span class="token comment">// z</span>
  <span class="token literal-property property">color</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// green</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>最後に、クリッピングが実際に行われていることを示すために、このボックスは完全にクリップ空間の外側にあるため、描画されません。深さが -1.0 から 1.0 の範囲外です。</p>
<div class="code-example"><pre class="brush: js notranslate"><code>box<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">top</span>    <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>               <span class="token comment">// x</span>
  <span class="token literal-property property">bottom</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>              <span class="token comment">// x</span>
  <span class="token literal-property property">left</span>   <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>              <span class="token comment">// y</span>
  <span class="token literal-property property">right</span>  <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>               <span class="token comment">// y</span>

  <span class="token literal-property property">depth</span>  <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span>            <span class="token comment">// z</span>
  <span class="token literal-property property">color</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// blue</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 id="結果">結果</h4>
<p><a href="https://jsfiddle.net/mff99yu5" class="external" rel=" noopener">JSFiddle で表示</a></p>
<p>
  <img src="https://mdn.mozillademos.org/files/11373/part1.png" alt="The results of drawing to clip space using WebGL." loading="lazy">
</p>
<h4 id="演習">演習</h4>
<p>この時点で役立つ演習は、コードを変更してボックスをクリップ空間内で移動し、点がクリップ空間内でどのようにクリップされ、移動されるかを感じ取ることです。背景を持つボックス状のスマイルのような絵を描いてみてください。</p></div><h2 id="斉次座標"><a href="#斉次座標" title="Permalink to 斉次座標">斉次座標</a></h2><div><p>前のクリップ空間の頂点シェーダのメインラインは、このコードを含んでいました。</p>
<div class="code-example"><pre class="brush: js notranslate"><code>gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>変数 <code>position</code> は、 <code>draw()</code> メソッドで定義され、属性としてシェーダーに渡されました。これは 3 次元の点ですが、パイプラインを介して渡されることになる変数 <code>gl_Position</code> は実際には 4 次元です。すなわち、 <code>(x, y, z)</code> の代わりに <code>(x, y, z, w)</code> となっています。<code>z</code> の後には文字がないため、慣例により、この 4 番目の次元には <code>w</code> というラベルが付いています。 上記の例では、 <code>w</code> 座標は 1.0 に設定されています。</p>
<p>明らかな疑問は、「なぜ余分な次元があるのか？」です。この追加により、3D データを操作するための多くの優れた手法が可能になることが分かります。この追加された次元により、遠近法の概念が座標系に導入されます。それを配置すると、3D 座標を 2D 空間にマッピングできます。これにより、2 本の平行線が遠くに離れるときに交差するようになります。値 <code>w</code> は、座標の他のコンポーネントの除数として使用されるため、 <code>x</code>、<code>y</code>、<code>z</code>の真の値は、<code>x/w</code>、<code>y/w</code>、<code>z/w</code>として計算されます（そして、<code>w</code>も <code>w/w</code>で 1 になる）。</p>
<p>A three dimensional point is defined in a typical Cartesian coordinate system. The added fourth dimension changes this point into a <a title="homogeneous coordinate" href="https://ja.wikipedia.org/wiki/Homogeneous_coordinates" class="external" rel=" noopener">homogeneous coordinate</a>. It still represents a point in 3D space and it can easily be demonstrated how to construct this type of coordinate through a pair of simple functions.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">cartesianToHomogeneous</span><span class="token punctuation">(</span><span class="token parameter">point</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> x <span class="token operator">=</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> y <span class="token operator">=</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> z <span class="token operator">=</span> point<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">homogeneousToCartesian</span><span class="token punctuation">(</span><span class="token parameter">point</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> x <span class="token operator">=</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> y <span class="token operator">=</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> z <span class="token operator">=</span> point<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> w <span class="token operator">=</span> point<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token operator">/</span>w<span class="token punctuation">,</span> y<span class="token operator">/</span>w<span class="token punctuation">,</span> z<span class="token operator">/</span>w<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>As previously mentioned and shown in the functions above, the w component divides the x, y, and z components. When the w component is a non-zero real number then homogeneous coordinate easily translates back into a normal point in Cartesian space. Now what happens if the w component is zero? In JavaScript the value returned would be as follows.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">homogeneousToCartesian</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>This evaluates to: <code>[Infinity, Infinity, Infinity]</code>.</p>
<p>This homogeneous coordinate represents some point at infinity. This is a handy way to represent a ray shooting off from the origin in a specific direction. In addition to a ray, it could also be thought of as a representation of a directional vector. If this homogeneous coordinate is multiplied against a matrix with a translation then the translation is effectively stripped out.</p>
<p>When numbers are extremely large (or extremely small) on computers they begin to become less and less precise because there are only so many ones and zeros that are used to represent them. The more operations that are done on larger numbers, the more and more errors accumulate into the result. When dividing by w, this can effectively increase the precision of very large numbers by operating on two potentially smaller, less error-prone numbers.</p>
<p>The final benefit of using homogeneous coordinates is that they fit very nicely for multiplying against 4x4 matrices. A vertex must match at least one of the dimensions of a matrix in order to be multiplied against it. The 4x4 matrix can be used to encode a variety of useful transformations. In fact, the typical perspective projection matrix uses the division by the w component to achieve its transformation.</p>
<p>The clipping of points and polygons from clip space actually happens after the homogeneous coordinates have been transformed back into Cartesian coordinates (by dividing by w). This final space is known as <strong>normalized device coordinates</strong> or NDC.</p>
<p>To start playing with this idea the previous example can be modified to allow for the use of the <code>w</code> component.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">//Redefine the triangles to use the W component</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">//Triangle 1</span>
  settings<span class="token punctuation">.</span>left<span class="token punctuation">,</span>  settings<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>w<span class="token punctuation">,</span>
  settings<span class="token punctuation">.</span>right<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>w<span class="token punctuation">,</span>
  settings<span class="token punctuation">.</span>left<span class="token punctuation">,</span>  settings<span class="token punctuation">.</span>top<span class="token punctuation">,</span>    settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>w<span class="token punctuation">,</span>

  <span class="token comment">//Triangle 2</span>
  settings<span class="token punctuation">.</span>left<span class="token punctuation">,</span>  settings<span class="token punctuation">.</span>top<span class="token punctuation">,</span>    settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>w<span class="token punctuation">,</span>
  settings<span class="token punctuation">.</span>right<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>w<span class="token punctuation">,</span>
  settings<span class="token punctuation">.</span>right<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>top<span class="token punctuation">,</span>    settings<span class="token punctuation">.</span>depth<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>w
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Then the vertex shader uses the 4 dimensional point passed in.</p>
<div class="code-example"><pre class="brush: js notranslate"><code>attribute vec4 position<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl_Position <span class="token operator">=</span> position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>First, we draw a red box in the middle, but set W to 0.7. As the coordinates get divided by 0.7 they will all be enlarged.</p>
<div class="code-example"><pre class="brush: js notranslate"><code>box<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">top</span>    <span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>             <span class="token comment">// y</span>
  <span class="token literal-property property">bottom</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>            <span class="token comment">// y</span>
  <span class="token literal-property property">left</span>   <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>            <span class="token comment">// x</span>
  <span class="token literal-property property">right</span>  <span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>             <span class="token comment">// x</span>
  <span class="token literal-property property">w</span>      <span class="token operator">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>             <span class="token comment">// w - enlarge this box</span>

  <span class="token literal-property property">depth</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>               <span class="token comment">// z</span>
  <span class="token literal-property property">color</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// red</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Now, we draw a green box up top, but shrink it by setting the w component to 1.1</p>
<div class="code-example"><pre class="brush: js notranslate"><code>box<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">top</span>    <span class="token operator">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>             <span class="token comment">// y</span>
  <span class="token literal-property property">bottom</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>               <span class="token comment">// y</span>
  <span class="token literal-property property">left</span>   <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.9</span><span class="token punctuation">,</span>            <span class="token comment">// x</span>
  <span class="token literal-property property">right</span>  <span class="token operator">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>             <span class="token comment">// x</span>
  <span class="token literal-property property">w</span>      <span class="token operator">:</span> <span class="token number">1.1</span><span class="token punctuation">,</span>             <span class="token comment">// w - shrink this box</span>

  <span class="token literal-property property">depth</span>  <span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>             <span class="token comment">// z</span>
  <span class="token literal-property property">color</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// green</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>This last box doesn't get drawn because it's outside of clip space. The depth is outside of the -1.0 to 1.0 range.</p>
<div class="code-example"><pre class="brush: js notranslate"><code>box<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">top</span>    <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>               <span class="token comment">// y</span>
  <span class="token literal-property property">bottom</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>              <span class="token comment">// y</span>
  <span class="token literal-property property">left</span>   <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>              <span class="token comment">// x</span>
  <span class="token literal-property property">right</span>  <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>               <span class="token comment">// x</span>
  <span class="token literal-property property">w</span>      <span class="token operator">:</span> <span class="token number">1.5</span><span class="token punctuation">,</span>             <span class="token comment">// w - Bring this box into range</span>

  <span class="token literal-property property">depth</span>  <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span>             <span class="token comment">// z</span>
  <span class="token literal-property property">color</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// blue</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h3 id="the_results"><a href="#the_results" title="Permalink to The results">The results</a></h3><div><p><a href="https://jsfiddle.net/mff99yu" class="external" rel=" noopener">View on JSFiddle</a></p>
<p>
  <img src="https://mdn.mozillademos.org/files/11375/part2.png" alt="The results of using homogeneous coordinates to move the boxes around in WebGL." loading="lazy">
</p></div><h3 id="exercises"><a href="#exercises" title="Permalink to Exercises">Exercises</a></h3><div><ul>
  <li>Play around with these values to see how it affects what is rendered on the screen. Note how the previously clipped blue box is brought back into range by setting its w component.</li>
  <li>Try creating a new box that is outside of clip space and bring it back in by dividing by w.</li>
</ul></div><h2 id="model_transform"><a href="#model_transform" title="Permalink to Model transform">Model transform</a></h2><div><p>Placing points directly into clip space is of limited use. In real world applications, you don't have all your source coordinates already in clip space coordinates. So most of the time, you need to transform the model data and other coordinates into clip space. The humble cube is an easy example of how to do this. Cube data consists of vertex positions, the colors of the faces of the cube, and the order of the vertex positions that make up the individual polygons (in groups of 3 vertices to construct the triangles composing the cube's faces). The positions and colors are stored in GL buffers, sent to the shader as attributes, and then operated upon individually.</p>
<p>Finally a single model matrix is computed and set. This matrix represents the transformations to be performed on every point making up the model in order to move it into the correct space, and to perform any other needed transforms on each point in the model. This applies not just to each vertex, but to every single point on every surface of the model as well.</p>
<p>In this case, for every frame of the animation a series of scale, rotation, and translation matrices move the data into the desired spot in clip space. The cube is the size of clip space (-1,-1,-1) to (1,1,1) so it will need to be shrunk down in order to not fill the entirety of clip space. This matrix is sent directly to the shader, having been multiplied in JavaScript beforehand.</p>
<p>The following code sample defines a method on the <code>CubeDemo</code> object that will create the model matrix. It uses custom functions to create and multiply matrices as defined in the <a href="https://github.com/TatumCreative/mdn-webgl" class="external" rel=" noopener">MDN WebGL</a> shared code. The new function looks like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token class-name">CubeDemo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">computeModelMatrix</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">now</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Scale down by 50%</span>
  <span class="token keyword">var</span> scale <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">scaleMatrix</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Rotate a slight tilt</span>
  <span class="token keyword">var</span> rotateX <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">rotateXMatrix</span><span class="token punctuation">(</span>now <span class="token operator">*</span> <span class="token number">0.0003</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Rotate according to time</span>
  <span class="token keyword">var</span> rotateY <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">rotateYMatrix</span><span class="token punctuation">(</span>now <span class="token operator">*</span> <span class="token number">0.0005</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Move slightly down</span>
  <span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">translateMatrix</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Multiply together, make sure and read them in opposite order</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">multiplyArrayOfMatrices</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    position<span class="token punctuation">,</span> <span class="token comment">// step 4</span>
    rotateY<span class="token punctuation">,</span>  <span class="token comment">// step 3</span>
    rotateX<span class="token punctuation">,</span>  <span class="token comment">// step 2</span>
    scale     <span class="token comment">// step 1</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>In order to use this in the shader it must be set to a uniform location. The locations for the uniforms are saved in the <code>locations</code> object shown below:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span>locations<span class="token punctuation">.</span>model <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>webglProgram<span class="token punctuation">,</span> <span class="token string">'model'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>And finally the uniform is set to that location. This hands off the matrix to the GPU.</p>
<div class="code-example"><pre class="brush: js notranslate"><code>gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>locations<span class="token punctuation">.</span>model<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>In the shader, each position vertex is first transformed into a homogeneous coordinate (a <code>vec4</code> object), and then multiplied against the model matrix.</p>
<div class="code-example"><pre class="brush: glsl notranslate"><code>gl_Position <span class="token operator">=</span> model <span class="token operator">*</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect3">
  <p><strong>Note:</strong> In JavaScript, matrix multiplication requires a custom function, while in the shader it is built into the language with the simple * operator.</p>
</div></div><h3 id="the_results_2"><a href="#the_results_2" title="Permalink to The results">The results</a></h3><div><p><a href="https://jsfiddle.net/5jofzgsh" class="external" rel=" noopener">View on JSFiddle</a></p>
<p>
  <img src="https://mdn.mozillademos.org/files/11377/part3.png" alt="Using a model matrix" loading="lazy">
</p>
<p>At this point the w value of the transformed point is still 1.0. The cube still doesn't have any perspective. The next section will take this setup and modify the w values to provide some perspective.</p></div><h3 id="exercises_2"><a href="#exercises_2" title="Permalink to Exercises">Exercises</a></h3><div><ul>
  <li>Shrink down the box using the scale matrix and position it in different places within clip space.</li>
  <li>Try moving it outside of clip space.</li>
  <li>Resize the window and watch as the box skews out of shape.</li>
  <li>Add a <code>rotateZ</code> matrix.</li>
</ul></div><h2 id="divide_by_w"><a href="#divide_by_w" title="Permalink to Divide by W">Divide by W</a></h2><div><p>An easy way to start getting some perspective on our model of the cube is to take the Z coordinate and copy it over to the w coordinate. Normally when converting a cartesian point to homogeneous it becomes <code>(x,y,z,1)</code>, but we're going to set it to something like <code>(x,y,z,z)</code>. In reality we want to make sure that z is greater than 0 for points in view, so we'll modify it slightly by changing the value to <code>((1.0 + z) * scaleFactor)</code>. This will take a point that is normally in clip space (-1 to 1) and move it into a space more like (0 to 1) depending on what the scale factor is set to. The scale factor changes the final w value to be either higher or lower overall.</p>
<p>The shader code looks like this.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// First transform the point</span>
vec4 transformedPosition <span class="token operator">=</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// How much effect does the perspective have?</span>
float scaleFactor <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

<span class="token comment">// Set w by taking the z value which is typically ranged -1 to 1, then scale</span>
<span class="token comment">// it to be from 0 to some number, in this case 0-1.</span>
float w <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">+</span> transformedPosition<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">*</span> scaleFactor<span class="token punctuation">;</span>

<span class="token comment">// Save the new gl_Position with the custom w component</span>
gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>transformedPosition<span class="token punctuation">.</span>xyz<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h3 id="the_results_3"><a href="#the_results_3" title="Permalink to The results">The results</a></h3><div><p><a href="https://jsfiddle.net/vk9r8h2c" class="external" rel=" noopener">View on JSFiddle</a></p>
<p>
  <img src="https://mdn.mozillademos.org/files/11379/part4.png" alt="Filling the W component and creating some projection." loading="lazy">
</p>
<p>See that small dark blue triangle? That's an additional face added to our object because the rotation of our shape has caused that corner to extend outside clip space, thus causing the corner to be clipped away. See <a href="#perspective_projection_matrix">Perspective projection matrix</a> below for an introduction to how to use more complex matrices to help control and prevent clipping.</p></div><h3 id="exercise"><a href="#exercise" title="Permalink to Exercise">Exercise</a></h3><div><p>If that sounds a little abstract, open up the vertex shader and play around with the scale factor and watch how it shrinks vertices more towards the surface. Completely change the w component values for really trippy representations of space.</p>
<p>In the next section we'll take this step of copying Z into the w slot and turn it into a matrix.</p></div><h2 id="simple_projection"><a href="#simple_projection" title="Permalink to Simple projection">Simple projection</a></h2><div><p>The last step of filling in the w component can actually be accomplished with a simple matrix. Start with the identity matrix:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> identity <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">multiplyPoint</span><span class="token punctuation">(</span>identity<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&gt; [2, 3, 4, 1]</span>
</code></pre></div>
<p>Then move the last column's 1 up one space.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> copyZ <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">multiplyPoint</span><span class="token punctuation">(</span>copyZ<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&gt; [2, 3, 4, 4]</span>
</code></pre></div>
<p>However in the last example we performed <code>(z + 1) * scaleFactor</code>:</p>
<pre class="notranslate">var scaleFactor = 0.5;

var simpleProjection = [
  1, 0, 0, 0,
  0, 1, 0, 0,
  0, 0, 1, scaleFactor,
  0, 0, 0, scaleFactor,
];

MDN.multiplyPoint(simpleProjection, [2, 3, 4, 1]);
//&gt; [2, 3, 4, 2.5]
</pre>
<p>Breaking it out a little further we can see how this works:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> w <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> scaleFactor<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> scaleFactor<span class="token punctuation">)</span>
</code></pre></div>
<p>The last line could be simplified to:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>w <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> scaleFactor<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> scaleFactor<span class="token punctuation">)</span>
</code></pre></div>
<p>Then factoring out the scaleFactor, we get this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>w <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> scaleFactor
</code></pre></div>
<p>Which is exactly the same as the <code>(z + 1) * scaleFactor</code> that we used in the previous example.</p>
<p>In the box demo, an additional <code>computeSimpleProjectionMatrix()</code> method is added. This is called in the <code>draw()</code> method and has the scale factor passed to it. The result should be identical to the last example:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token class-name">CubeDemo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">computeSimpleProjectionMatrix</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">scaleFactor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>projection <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> scaleFactor<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> scaleFactor
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Although the result is identical, the important step here is in the vertex shader. Rather than modifying the vertex directly, it gets multiplied by an additional <strong><a href="#projection_matrix">projection matrix</a></strong>, which (as the name suggests) projects 3D points onto a 2D drawing surface:</p>
<div class="code-example"><pre class="brush: glsl notranslate"><code><span class="token comment">// Make sure to read the transformations in reverse order</span>
gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h3 id="the_results_4"><a href="#the_results_4" title="Permalink to The results">The results</a></h3><div><p><a href="https://jsfiddle.net/zwyLLcbw" class="external" rel=" noopener">View on JSFiddle</a></p>
<p>
  <img src="https://mdn.mozillademos.org/files/11381/part5.png" alt="A simple projection matrix" loading="lazy">
</p></div><h2 id="the_viewing_frustum"><a href="#the_viewing_frustum" title="Permalink to The viewing frustum">The viewing frustum</a></h2><div><p>Before we move on to covering how to compute a perspective projection matrix, we need to introduce the concept of the <strong><a title="viewing frustum" href="https://ja.wikipedia.org/wiki/Viewing_frustum" class="external" rel=" noopener">viewing frustum</a></strong> (also known as the <strong>view frustum</strong>). This is the region of space whose contents are visible to the user at the current time. It's the 3D region of space defined by the field of view and the distances specified as the nearest and farthest content that should be rendered.</p>
<p>While rendering, we need to determine which polygons need to be rendered in order to represent the scene. This is what the viewing frustum defines. But what's a frustum in the first place?</p>
<p>A <a title="frustum" href="https://ja.wikipedia.org/wiki/Frustum" class="external" rel=" noopener">frustum</a> is the 3D solid that results from taking any solid and slicing off two sections of it using two parallel planes. Consider our camera, which is viewing an area that starts immediately in front of its lens and extends off into the distance. The viewable area is a four-sided pyramid with its peak at the lens, its four sides corresponding to the extents of its peripheral vision range, and its base at the farthest distance it can see, like this:</p>
<p>
  <img src="https://mdn.mozillademos.org/files/17295/FullCameraFOV.svg" alt="A depiction of the entire viewing area of a camera. This area is a four-sided pyramid with its peak at the lens and its base at the world's maximum viewable distance." loading="lazy">
</p>
<p>If we simply used this to determine the polygons to be rendered each frame, our renderer would need to render every polygon within this pyramid, all the way off into infinity, including also polygons that are very close to the lens—likely too close to be useful (and certainly including things that are so close that a real human wouldn't be able to focus on them in the same setting).</p>
<p>So the first step in reducing the number of polygons we need to compute and render, we turn this pyramid into the viewing frustum. The two planes we'll use to chop away vertices in order to reduce the polygon count are the <strong>near clipping plane</strong> and the <strong>far clipping plane</strong>.</p>
<p>In WebXR, the near and far clipping planes are defined by specifying the distance from the lens to the closest point on a plane which is perpendicular to the viewing direction. Anything closer to the lens than the near clipping plane or farther from it than the far clipping plane is removed. This results in the viewing frustum, which looks like this:</p>
<p>
  <img src="https://mdn.mozillademos.org/files/17296/CameraViewFustum.svg" alt="A depiction of the camera's view frustum; the near and far planes have removed part of the volume, reducing the polygon count." loading="lazy">
</p>
<p>The set of objects to be rendered for each frame is essentially created by starting with the set of all objects in the scene. Then any objects which are <em>entirely</em> outside the viewing frustum are removed from the set. Next, objects which partially extrude outside the viewing frustum are clipped by dropping any polygons which are entirely outside the frustum, and by clipping the polygons which cross outside the frustrum so that they no longer exit it.</p>
<p>Once that's been done, we have the largest set of polygons which are entirely within the viewing frustum. This list is usually further reduced using processes like <a title="back-face culling" href="https://ja.wikipedia.org/wiki/Back-face_culling" class="external" rel=" noopener">back-face culling</a> (removing polygons whose back side is facing the camera) and occlusion culling using <a title="hidden-surface determination" href="https://ja.wikipedia.org/wiki/Hidden-surface_determination" class="external" rel=" noopener">hidden-surface determination</a> (removing polygons which can't be seen because they're entirely blocked by polygons that are closer to the lens).</p></div><h2 id="perspective_projection_matrix"><a href="#perspective_projection_matrix" title="Permalink to Perspective projection matrix">Perspective projection matrix</a></h2><div><p>Up to this point, we've built up our own 3D rendering setup, step by step. However the current code as we've built it has some issues. For one, it gets skewed whenever we resize our window. Another is that our simple projection doesn't handle a wide range of values for the scene data. Most scenes don't work in clip space. It would be helpful to define what distance is relevant to the scene so that precision isn't lost in converting the numbers. Finally it's very helpful to have a fine-tuned control over what points get placed inside and outside of clip space. In the previous examples the corners of the cube occasionally get clipped.</p>
<p>The <strong>perspective projection matrix</strong> is a type of projection matrix that accomplishes all of these requirements. The math also starts to get a bit more involved and won't be fully explained in these examples. In short, it combines dividing by w (as done with the previous examples) with some ingenious manipulations based on <a href="https://en.wikipedia.org/wiki/Similarity_%28geometry%29" class="external" rel=" noopener">similar triangles</a>. If you want to read a full explanation of the math behind it check out some of the following links:</p>
<ul>
  <li><a href="https://www.songho.ca/opengl/gl_projectionmatrix.html" class="external" rel=" noopener">OpenGL Projection Matrix</a></li>
  <li><a href="http://ogldev.atspace.co.uk/www/tutorial12/tutorial12.html" class="external" rel=" noopener">Perspective Projection</a></li>
  <li><a href="https://stackoverflow.com/questions/28286057/trying-to-understand-the-math-behind-the-perspective-matrix-in-webgl/28301213#28301213" class="external" rel=" noopener">Trying to understand the math behind the perspective projection matrix in WebGL</a></li>
</ul>
<p>One important thing to note about the perspective projection matrix used below is that it flips the z axis. In clip space the z+ goes away from the viewer, while with this matrix it comes towards the viewer.</p>
<p>The reason to flip the z axis is that the clip space coordinate system is a left-handed coordinate system (wherein the z-axis points away from the viewer and into the screen), while the convention in mathematics, physics and 3D modeling, as well as for the view/eye coordinate system in OpenGL, is to use a right-handed coordinate system (z-axis points out of the screen towards the viewer) . More on that in the relevant Wikipedia articles: <a href="https://en.wikipedia.org/wiki/Cartesian_coordinate_system#Orientation_and_handedness" class="external" rel=" noopener">Cartesian coordinate system</a>, <a href="https://en.wikipedia.org/wiki/Right-hand_rule" class="external" rel=" noopener">Right-hand rule</a>.</p>
<p>Let's take a look at a <code>perspectiveMatrix()</code> function, which computes the perspective projection matrix.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function-variable function">perspectiveMatrix</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fieldOfViewInRadians<span class="token punctuation">,</span> aspectRatio<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>fieldOfViewInRadians <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> rangeInv <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    f <span class="token operator">/</span> aspectRatio<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>                          <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>               f<span class="token punctuation">,</span>                          <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>               <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>near <span class="token operator">+</span> far<span class="token punctuation">)</span> <span class="token operator">*</span> rangeInv<span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>               <span class="token number">0</span><span class="token punctuation">,</span>  near <span class="token operator">*</span> far <span class="token operator">*</span> rangeInv <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>   <span class="token number">0</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The four parameters into this function are:</p>
<dl>
  <dt id="fieldofviewinradians"><code>fieldOfviewInRadians</code></dt>
  <dd>
    <p>An angle, given in radians, indicating how much of the scene is visible to the viewer at once. The larger the number is, the more is visible by the camera. The geometry at the edges becomes more and more distorted, equivalent to a wide angle lens. When the field of view is larger, the objects typically get smaller. When the field of view is smaller, then the camera can see less and less in the scene. The objects are distorted much less by perspective and objects seem much closer to the camera</p>
  </dd>
  <dt id="aspectratio"><code>aspectRatio</code></dt>
  <dd>
    <p>The scene's aspect ratio, which is equivalent to its width divided by its height. In these examples, that's the window's width divided by the window height. The introduction of this parameter finally solves the problem wherein the model gets warped as the canvas is resized and reshaped.</p>
  </dd>
  <dt id="nearclippingplanedistance"><code>nearClippingPlaneDistance</code></dt>
  <dd>
    <p>A positive number indicating the distance into the screen to a plane which is perpendicular to the floor, nearer than which everything gets clipped away. This is mapped to -1 in clip space, and should not be set to 0.</p>
  </dd>
  <dt id="farclippingplanedistance"><code>farClippingPlaneDistance</code></dt>
  <dd>
    <p>A positive number indicating the distance to the plane beyond which geometry is clipped away. This is mapped to 1 in clip space. This value should be kept reasonably close to the distance of the geometry in order to avoid precision errors creeping in while rendering.</p>
  </dd>
</dl>
<p>In the latest version of the box demo, the <code>computeSimpleProjectionMatrix()</code> method has been replaced with the <code>computePerspectiveMatrix()</code> method.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token class-name">CubeDemo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">computePerspectiveMatrix</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> fieldOfViewInRadians <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> aspectRatio <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">var</span> nearClippingPlaneDistance <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> farClippingPlaneDistance <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>projection <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">perspectiveMatrix</span><span class="token punctuation">(</span>
    fieldOfViewInRadians<span class="token punctuation">,</span>
    aspectRatio<span class="token punctuation">,</span>
    nearClippingPlaneDistance<span class="token punctuation">,</span>
    farClippingPlaneDistance
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The shader code is identical to the previous example:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Additionally (not shown), the position and scale matrices of the model have been changed to take it out of clip space and into the larger coordinate system.</p></div><h3 id="the_results_5"><a href="#the_results_5" title="Permalink to The results">The results</a></h3><div><p><a href="https://jsfiddle.net/Lzxw7e1q" class="external" rel=" noopener">View on JSFiddle</a></p>
<p>
  <img src="https://mdn.mozillademos.org/files/11383/part6.png" alt="A true perspective matrix" loading="lazy">
</p></div><h3 id="exercises_3"><a href="#exercises_3" title="Permalink to Exercises">Exercises</a></h3><div><ul>
  <li>Experiment with the parameters of the perspective projection matrix and the model matrix.</li>
  <li>Swap out the perspective projection matrix to use <a title="orthographic projection" href="https://ja.wikipedia.org/wiki/Orthographic_projection" class="external" rel=" noopener">orthographic projection</a>. In the MDN WebGL shared code you'll find the <code>MDN.orthographicMatrix()</code>. This can replace the <code>MDN.perspectiveMatrix()</code> function in <code>CubeDemo.prototype.computePerspectiveMatrix()</code>.</li>
</ul></div><h2 id="view_matrix"><a href="#view_matrix" title="Permalink to View matrix">View matrix</a></h2><div><p>While some graphics libraries have a virtual camera that can be positioned and pointed while composing a scene, OpenGL (and by extension WebGL) does not. This is where the <strong>view matrix</strong> comes in. Its job is to translate, rotate, and scale the objects in the scene so that they are located in the right place relative to the viewer given the viewer's position and orientation.</p></div><h3 id="simulating_a_camera"><a href="#simulating_a_camera" title="Permalink to Simulating a camera">Simulating a camera</a></h3><div><p>This makes use of one of the fundamental facets of Einstein's special relativity theory: the principle of reference frames and relative motion says that, from the perspective of a viewer, you can simulate changing the position and orientation of the viewer by applying the opposite change to the objects in the scene. Either way, the result appears to be identical to the viewer.</p>
<p>Consider a box sitting on a table and a camera resting on the table one meter away, pointed at the box, the front of which is pointed toward the camera. Then consider moving the camera away from the box until it's two meters away (by adding a meter to the camera's Z position), then sliding it 10 centimeters to the its left. The box recedes from the camera by that amount and slides to the right slightly, thereby appearing smaller to the camera and exposing a small amount of its left side to the camera.</p>
<p>Now let's reset the scene, placing the box back in its starting point, with the camera two meters from, and directly facing, the box. This time, however, the camera is locked down on the table and cannot be moved or turned. This is what working in WebGL is like. So how do we simulate moving the camera through space?</p>
<p>Instead of moving the camera backward and to the left, we apply the inverse transform to the box: we move the <em>box</em> backward one meter, and then 10 centimeters to its right. The result, from the perspective of each of the two objects, is identical.</p>
<p><strong>&lt;&lt;&lt; insert image(s) here &gt;&gt;&gt;</strong></p>
<p>The final step in all of this is to create the <strong>view matrix</strong>, which transforms the objects in the scene so they're positioned to simulate the camera's current location and orientation. Our code as it stands can move the cube around in world space and project everything to have perspective, but we still can't move the camera.</p>
<p>Imagine shooting a movie with a physical camera. You have the freedom to place the camera essentially anywhere you wish, and to aim the camera in whichever direction you choose. To simulate this in 3D graphics, we use a view matrix to simulate the position and rotation of that physical camera.</p>
<p>Unlike the model matrix, which directly transforms the model vertices, the view matrix moves an abstract camera around. In reality, the vertex shader is still only moving the models while the "camera" stays in place. In order for this to work out correctly, the inverse of the transform matrix must be used. The inverse matrix essentially reverses a transformation, so if we move the camera view forward, the inverse matrix causes the objects in the scene to move back.</p>
<p>The following <code>computeViewMatrix()</code> method animates the view matrix by moving it in and out, and left and right.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token class-name">CubeDemo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">computeViewMatrix</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">now</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> moveInAndOut <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>now <span class="token operator">*</span> <span class="token number">0.002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> moveLeftAndRight <span class="token operator">=</span> <span class="token number">15</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>now <span class="token operator">*</span> <span class="token number">0.0017</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Move the camera around</span>
  <span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">translateMatrix</span><span class="token punctuation">(</span>moveLeftAndRight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token operator">+</span> moveInAndOut <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Multiply together, make sure and read them in opposite order</span>
  <span class="token keyword">var</span> matrix <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">multiplyArrayOfMatrices</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// Exercise: rotate the camera view</span>
    position
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Inverse the operation for camera movements, because we are actually</span>
  <span class="token comment">// moving the geometry in the scene, not the camera itself.</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>view <span class="token operator">=</span> <span class="token constant">MDN</span><span class="token punctuation">.</span><span class="token function">invertMatrix</span><span class="token punctuation">(</span>matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The shader now uses three matrices.</p>
<div class="code-example"><pre class="brush: glsl notranslate"><code>gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>After this step, the GPU pipeline will clip the out of range vertices, and send the model down to the fragment shader for rasterization.</p></div><h3 id="the_results_6"><a href="#the_results_6" title="Permalink to The results">The results</a></h3><div><p><a href="https://jsfiddle.net/86fd797g" class="external" rel=" noopener">View on JSFiddle</a></p>
<p>
  <img src="https://mdn.mozillademos.org/files/11385/part7.png" alt="The view matrix" loading="lazy">
</p></div><h3 id="relating_the_coordinate_systems"><a href="#relating_the_coordinate_systems" title="Permalink to Relating the coordinate systems">Relating the coordinate systems</a></h3><div><p>At this point it would be beneficial to take a step back and look at and label the various coordinate systems we use. First off, the cube's vertices are defined in <strong>model space</strong>. To move the model around the scene. these vertices need to be converted into <strong>world space</strong> by applying the model matrix.</p>
<p>model space → model matrix → world space</p>
<p>The camera hasn't done anything yet, and the points need to be moved again. Currently they are in world space, but they need to be moved to <strong>view space</strong> (using the view matrix) in order to represent the camera placement.</p>
<p>world space → view matrix → view space</p>
<p>Finally a <strong>projection</strong> (in our case the perspective projection matrix) needs to be added in order to map the world coordinates into clip space coordinates.</p>
<p>view space → projection matrix → clip space</p></div><h3 id="exercise_2"><a href="#exercise_2" title="Permalink to Exercise">Exercise</a></h3><div><ul>
  <li>Move the camera around the scene.</li>
  <li>Add some rotation matrices to the view matrix to look around.</li>
  <li>Finally, track the mouse's position. Use 2 rotation matrices to have the camera look up and down based on where the user's mouse is on the screen.</li>
</ul></div><h2 id="see_also"><a href="#see_also" title="Permalink to See also">See also</a></h2><div><ul>
  <li><a href="/ja/docs/Web/API/WebGL_API">WebGL</a></li>
  <li><a title="3D projection" href="https://ja.wikipedia.org/wiki/3D_projection" class="external" rel=" noopener">3D projection</a></li>
</ul></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/translated-content/edit/main/files/ja/web/api/webgl_api/webgl_model_view_projection/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/blob/main/files/ja/web/api/webgl_api/webgl_model_view_projection/index.md" title="Folder: ja/web/api/webgl_api/webgl_model_view_projection (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fja%2Fdocs%2FWeb%2FAPI%2FWebGL_API%2FWebGL_model_view_projection%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60ja%2Fweb%2Fapi%2Fwebgl_api%2Fwebgl_model_view_projection%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fja%2Fdocs%2FWeb%2FAPI%2FWebGL_API%2FWebGL_model_view_projection%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fblob%2Fmain%2Ffiles%2Fja%2Fweb%2Fapi%2Fwebgl_api%2Fwebgl_model_view_projection%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fcommit%2F921c46a374ab0a9f4cc809af0370f8c412e54701%0A*+Document+last+modified%3A+2022-10-01T03%3A41%3A16.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22WebGL+%E3%83%A2%E3%83%87%E3%83%AB+%E3%83%93%E3%83%A5%E3%83%BC+%E5%B0%84%E5%BD%B1%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2Cl10n-ja" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-10-01T03:41:16.000Z">Oct 1, 2022</time>,<!-- --> <a href="/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection/contributors.txt">by MDN contributors</a></p><form class="language-menu"><fieldset id="select-language"><legend>Change your language</legend><label for="language-selector" class="visually-hidden">Select your preferred language</label> <select id="language-selector" name="language"><option selected="" value="ja">日本語</option><option value="en-US">English (US)</option><option value="zh-CN">中文 (简体)</option></select> <button type="submit" class="button minimal">Change language</button></fieldset></form></div></aside></main><nav id="sidebar-quicklinks" class="sidebar"><h4>Related Topics</h4><div>
 <ol>
  <li><a href="/ja/docs/Web/API/WebGL_API"><strong>WebGL API</strong></a></li>
  <li class="toggle">
    <details open="">
      <summary>WebGL tutorial</summary>
      <ol>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Getting_started_with_WebGL">Getting started with WebGL</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Adding_2D_content_to_a_WebGL_context">Adding 2D content to a WebGL context</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Using_shaders_to_apply_color_in_WebGL">Using shaders to apply color in WebGL</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Animating_objects_with_WebGL">Animating objects with WebGL</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Creating_3D_objects_using_WebGL">Creating 3D objects using WebGL</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL">Using textures in WebGL</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Lighting_in_WebGL">Lighting in WebGL</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Tutorial/Animating_textures_in_WebGL">Animating textures in WebGL</a></li>
      </ol>
    </details>
  </li>
  <li class="toggle">
    <details open="">
      <summary>Examples and articles</summary>
      <ol>
        <li><a href="/ja/docs/Web/API/WebGL_API/Matrix_math_for_the_web">Matrix math for the web</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection">WebGL model view projection</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/WebGL_best_practices">WebGL best practices</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Using_Extensions">Using WebGL extensions</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/Basic_2D_animation_example">A basic 2D WebGL animation example</a></li>
        <li><a href="/ja/docs/Web/API/WebGL_API/By_example">WebGL by example</a></li>
      </ol>
    </details>
  </li>
  <li class="toggle">
    <details open="">
      <summary>Interfaces</summary>
      <ol>
        <li><a href="/ja/docs/Web/API/WebGLRenderingContext"><code>WebGLRenderingContext</code></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGL2RenderingContext"><code>WebGL2RenderingContext</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLActiveInfo"><code>WebGLActiveInfo</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLBuffer"><code>WebGLBuffer</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLContextEvent"><code>WebGLContextEvent</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLFramebuffer"><code>WebGLFramebuffer</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLProgram"><code>WebGLProgram</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLQuery"><code>WebGLQuery</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLRenderbuffer"><code>WebGLRenderbuffer</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLSampler"><code>WebGLSampler</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLShader"><code>WebGLShader</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLShaderPrecisionFormat"><code>WebGLShaderPrecisionFormat</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLSync"><code>WebGLSync</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLTexture"><code>WebGLTexture</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLTransformFeedback"><code>WebGLTransformFeedback</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLUniformLocation"><code>WebGLUniformLocation</code> <small>(en-US)</small></a></li>
        <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/WebGLVertexArrayObject"><code>WebGLVertexArrayObject</code> <small>(en-US)</small></a></li>
      </ol>
    </details>
  </li>

  <li><strong><a href="/ja/docs/MDN">Documentation:</a></strong></li>
  <li class="toggle">
    <details>
      <summary>Contribute</summary>
      <ol>
        <li><a href="/ja/docs/MDN">The MDN project</a></li>
      </ol>
    </details>
  </li>
 </ol>
</div></nav></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/ja/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/ja/docs/Web">Web Technologies</a></li><li><a href="/ja/docs/Learn">Learn Web Development</a></li><li><a href="/ja/docs/MDN/About">About MDN</a></li><li><a href="/ja/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"WebGL モデル ビュー 射影","mdn_url":"/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection","locale":"ja","native":"日本語","sidebarHTML":"\n <ol>\n  <li><a href=\"/ja/docs/Web/API/WebGL_API\"><strong>WebGL API</strong></a></li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>WebGL tutorial</summary>\n      <ol>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Getting_started_with_WebGL\">Getting started with WebGL</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Adding_2D_content_to_a_WebGL_context\">Adding 2D content to a WebGL context</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Using_shaders_to_apply_color_in_WebGL\">Using shaders to apply color in WebGL</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Animating_objects_with_WebGL\">Animating objects with WebGL</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Creating_3D_objects_using_WebGL\">Creating 3D objects using WebGL</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL\">Using textures in WebGL</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Lighting_in_WebGL\">Lighting in WebGL</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Tutorial/Animating_textures_in_WebGL\">Animating textures in WebGL</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Examples and articles</summary>\n      <ol>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Matrix_math_for_the_web\">Matrix math for the web</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection\">WebGL model view projection</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/WebGL_best_practices\">WebGL best practices</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Using_Extensions\">Using WebGL extensions</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/Basic_2D_animation_example\">A basic 2D WebGL animation example</a></li>\n        <li><a href=\"/ja/docs/Web/API/WebGL_API/By_example\">WebGL by example</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Interfaces</summary>\n      <ol>\n        <li><a href=\"/ja/docs/Web/API/WebGLRenderingContext\"><code>WebGLRenderingContext</code></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGL2RenderingContext\"><code>WebGL2RenderingContext</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLActiveInfo\"><code>WebGLActiveInfo</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLBuffer\"><code>WebGLBuffer</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLContextEvent\"><code>WebGLContextEvent</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLFramebuffer\"><code>WebGLFramebuffer</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLProgram\"><code>WebGLProgram</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLQuery\"><code>WebGLQuery</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLRenderbuffer\"><code>WebGLRenderbuffer</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLSampler\"><code>WebGLSampler</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLShader\"><code>WebGLShader</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLShaderPrecisionFormat\"><code>WebGLShaderPrecisionFormat</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLSync\"><code>WebGLSync</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLTexture\"><code>WebGLTexture</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLTransformFeedback\"><code>WebGLTransformFeedback</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLUniformLocation\"><code>WebGLUniformLocation</code> <small>(en-US)</small></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/WebGLVertexArrayObject\"><code>WebGLVertexArrayObject</code> <small>(en-US)</small></a></li>\n      </ol>\n    </details>\n  </li>\n\n  <li><strong><a href=\"/ja/docs/MDN\">Documentation:</a></strong></li>\n  <li class=\"toggle\">\n    <details>\n      <summary>Contribute</summary>\n      <ol>\n        <li><a href=\"/ja/docs/MDN\">The MDN project</a></li>\n      </ol>\n    </details>\n  </li>\n </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>この記事では、<a href=\"/ja/docs/Web/API/WebGL_API\">WebGL</a> プロジェクト内でデータを取得し、それを適切な空間に投影して画面に表示する方法について説明します。並進、拡縮、回転行列を使用した基本的な行列計算の知識があることを前提としています。3D シーンを構成するときに通常使用される中心的な 3 つの行列である、モデル、ビュー、射影行列について説明します。</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> This article is also available as an <a href=\"https://github.com/TatumCreative/mdn-model-view-projection\" class=\"external\" rel=\" noopener\">MDN content kit</a>. It also uses a collection of <a href=\"https://github.com/TatumCreative/mdn-webgl\" class=\"external\" rel=\" noopener\">utility functions</a> available under the <code>MDN</code> global object.</p>\n</div>"}},{"type":"prose","value":{"id":"モデル、ビュー、射影行列","title":"モデル、ビュー、射影行列","isH3":false,"content":"<p>WebGL の空間内の点とポリゴンの個々の変換は、並進、拡縮、回転などの基本的な変換行列によって処理されます。 これらの行列は、複雑な 3D シーンの描画に役立つように、一緒に構成し、特別な方法でグループ化できます。これらの構成された行列は、最終的に元のモデルデータを<strong>クリップ空間</strong>と呼ばれる特別な座標空間に移動します。これは 2 ユニットの幅の立方体で、中心が (0,0,0) 、対角が (-1,-1,-1) から (1,1,1) になります。このクリップ空間は 2 次元平面に圧縮され、画像へラスタライズされます。</p>\n<p>以下で説明する最初の行列は<strong>モデル行列</strong>です。これは、元のモデルデータを取得して 3 次元ワールド空間内で移動する方法を定義します。 <strong>射影行列</strong>は、ワールド空間座標をクリップ空間座標に変換するために使用されます。 一般的に使用される射影行列である<strong>透視投影射影行列</strong>は、3D 仮想世界の視聴者の代理として機能する一般的なカメラの<em>効果</em>を模倣するために使用されます。 <strong>ビュー行列</strong>は、変更されるカメラの位置をシミュレートし、シーン内のオブジェクトを移動して視聴者が現在何を見られるかを変更します。</p>\n<p>以下のセクションでは、モデル、ビュー、射影行列の背景にある考え方と実装について詳説します。 これらの行列は、画面上でデータを移動するための根幹であり、個々のフレームワークやエンジンを超える概念です。</p>"}},{"type":"prose","value":{"id":"クリップ空間","title":"クリップ空間","isH3":false,"content":"<p>WebGL プログラムでは、通常、データは自分の座標系で GPU にアップロードされ、次に頂点シェーダーがそれらの点を<strong>クリップ空間</strong>と呼ばれる特別な座標系に変換します。クリップ空間の外側にあるデータは切り取られ、描画されません。ただし、三角形がこのスペースの境界を跨ぐ場合は、新しい三角形に分割され、クリップスペースにある新しい三角形の部分のみが残ります。</p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11371/clip-space-graph.svg\" alt=\"A 3d graph showing clip space in WebGL.\" loading=\"lazy\">\n</p>\n<p>上の図は、全ての点が収まる必要のあるクリップ空間を視覚化したものです。これは、各辺が 2 の立方体であり、片方の角が (-1,-1,-1) にあり、対角が (1,1,1) にあります。立方体の中心は点 (0,0,0) です。 クリップ空間に使用されるこの 8 立方メートルの座標系は、正規化デバイス座標（NDC）と呼ばれます。WebGL コードを調べて作業している間、その用語を時々耳にするかもしれません。</p>\n<p>このセクションでは、データをクリップ空間座標系に直接配置する仕組みを説明します。 通常、任意の座標系にあるモデルデータが使用され、その後、行列を使用して変換され、モデル座標がクリップ空間座標系に変換されます。この例では、クリップ空間がどのように機能するかを最も簡単に説明する為、単純に (-1, -1, -1) から (1,1,1) までの範囲のモデル座標を使用します。以下のコードは、画面上に正方形を描く為に 2 つの三角形を作成します。正方形の Z 深度は、正方形が同じ空間を共有するときに何が上に描画されるかを決定します。小さい Z 値は大きい Z 値の上にレンダリングされます。</p>"}},{"type":"prose","value":{"id":"webglbox_の例","title":"WebGLBox の例","isH3":true,"content":"<p>この例では、画面上に 2D ボックスを描画するカスタム <code>WebGLBox</code> オブジェクトを作成します。</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> The code for each WebGLBox example is available in this <a href=\"https://github.com/TatumCreative/mdn-model-view-projection/tree/master/lessons\" class=\"external\" rel=\" noopener\">github repo</a> and is organized by section. In addition there is a JSFiddle link at the bottom of each section.</p>\n</div>\n<h4 id=\"webglbox_コンストラクタ\">WebGLBox コンストラクタ</h4>\n<p>コンストラクターは次のようになります。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">WebGLBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Setup the canvas and WebGL context</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gl <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> gl <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gl<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Setup a WebGL program, anything part of the MDN object is defined outside of this article</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webglProgram <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">createWebGLProgramFromIds</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> <span class=\"token string\">'vertex-shader'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fragment-shader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">useProgram</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webglProgram<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Save the attribute and uniform locations</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>positionLocation <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribLocation</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webglProgram<span class=\"token punctuation\">,</span> <span class=\"token string\">'position'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>colorLocation <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">getUniformLocation</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webglProgram<span class=\"token punctuation\">,</span> <span class=\"token string\">'color'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Tell WebGL to test the depth when drawing, so if a square is behind</span>\n  <span class=\"token comment\">// another square it won't be drawn</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">enable</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">DEPTH_TEST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"webglbox_描画\">WebGLBox 描画</h4>\n<p>次に、画面上にボックスを描画するメソッドを作成します。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token class-name\">WebGLBox</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">draw</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">settings</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create some attribute data; these are the triangles that will end being</span>\n  <span class=\"token comment\">// drawn to the screen. There are two that form a square.</span>\n\n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n\n    <span class=\"token comment\">//Triangle 1</span>\n    settings<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span>  settings<span class=\"token punctuation\">.</span>bottom<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span>\n    settings<span class=\"token punctuation\">.</span>right<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>bottom<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span>\n    settings<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span>  settings<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">,</span>    settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">//Triangle 2</span>\n    settings<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span>  settings<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">,</span>    settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span>\n    settings<span class=\"token punctuation\">.</span>right<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>bottom<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span>\n    settings<span class=\"token punctuation\">.</span>right<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">,</span>    settings<span class=\"token punctuation\">.</span>depth\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Use WebGL to draw this onto the screen.</span>\n\n  <span class=\"token comment\">// Performance Note: Creating a new array buffer for every draw call is slow.</span>\n  <span class=\"token comment\">// This function is for illustration purposes only.</span>\n\n  <span class=\"token keyword\">var</span> gl <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gl<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Create a buffer and bind the data</span>\n  <span class=\"token keyword\">var</span> buffer <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">createBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">bindBuffer</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">ARRAY_BUFFER</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">bufferData</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">ARRAY_BUFFER</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">STATIC_DRAW</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Setup the pointer to our attribute data (the triangles)</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">enableVertexAttribArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>positionLocation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">vertexAttribPointer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>positionLocation<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">FLOAT</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Setup the color uniform that will be shared across all triangles</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">uniform4fv</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>colorLocation<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Draw the triangles to the screen</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">drawArrays</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">TRIANGLES</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>シェーダーは GLSL で記述されたコードの一部であり、データポイントを取得して最終的に画面に描画します。便宜上、これらのシェーダーは、カスタム関数 <code>MDN.createWebGLProgramFromIds()</code> を介してプログラムに取り込まれる要素 <a href=\"/ja/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a> に格納されます。この関数は、これらのチュートリアル用に作成された <a href=\"https://github.com/TatumCreative/mdn-webgl\" class=\"external\" rel=\" noopener\">ユーティリティ関数群</a> の一部であり、ここでは詳しく説明しません。この関数は、いくつかの GLSL ソースコードを取得して WebGL プログラムにコンパイルする基本を処理します。関数は 3 つのパラメーターを取ります。プログラムをレンダリングするコンテキスト、頂点シェーダーを含む要素の ID <a href=\"/ja/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a>、フラグメントシェーダーを含む要素の ID <a href=\"/ja/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a> です。頂点シェーダーは頂点を配置し、フラグメントシェーダーは各ピクセルに色を付けます。</p>\n<p>最初に、画面上で頂点を移動させる頂点シェーダーを見てみましょう。</p>\n<div class=\"code-example\"><pre class=\"brush: glsl notranslate\"><code><span class=\"token comment\">// The individual position vertex</span>\n<span class=\"token keyword\">attribute</span> <span class=\"token keyword\">vec3</span> position<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// the gl_Position is the final position in clip space after the vertex shader modifies it</span>\n  gl_Position <span class=\"token operator\">=</span> <span class=\"token keyword\">vec4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>次に、データを実際にピクセルにラスタライズするために、フラグメントシェーダーはピクセルごとに全てを評価し、一つの色を設定します。GPU は、レンダリングする必要があるピクセルごとにシェーダー関数を呼び出します。シェーダーの仕事は、そのピクセルに使用する色を返すことです。</p>\n<div class=\"code-example\"><pre class=\"brush: glsl notranslate\"><code><span class=\"token keyword\">precision</span> <span class=\"token keyword\">mediump</span> <span class=\"token keyword\">float</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">uniform</span> <span class=\"token keyword\">vec4</span> color<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  gl_FragColor <span class=\"token operator\">=</span> color<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>これらの設定が含まれているので、クリップ空間座標を使用して画面に直接描画します。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> box <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebGLBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>最初に中央に赤いボックスを描きます。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>box<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">top</span>    <span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">bottom</span> <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">left</span>   <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">right</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// y</span>\n\n  <span class=\"token literal-property property\">depth</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// z</span>\n  <span class=\"token literal-property property\">color</span>  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// red</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>次に、緑色のボックスを赤いボックスの上部に描画します。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>box<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">top</span>    <span class=\"token operator\">:</span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">bottom</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">left</span>   <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">right</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// y</span>\n\n  <span class=\"token literal-property property\">depth</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// z</span>\n  <span class=\"token literal-property property\">color</span>  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// green</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>最後に、クリッピングが実際に行われていることを示すために、このボックスは完全にクリップ空間の外側にあるため、描画されません。深さが -1.0 から 1.0 の範囲外です。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>box<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">top</span>    <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">bottom</span> <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>              <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">left</span>   <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>              <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">right</span>  <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// y</span>\n\n  <span class=\"token literal-property property\">depth</span>  <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1.5</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// z</span>\n  <span class=\"token literal-property property\">color</span>  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// blue</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"結果\">結果</h4>\n<p><a href=\"https://jsfiddle.net/mff99yu5\" class=\"external\" rel=\" noopener\">JSFiddle で表示</a></p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11373/part1.png\" alt=\"The results of drawing to clip space using WebGL.\" loading=\"lazy\">\n</p>\n<h4 id=\"演習\">演習</h4>\n<p>この時点で役立つ演習は、コードを変更してボックスをクリップ空間内で移動し、点がクリップ空間内でどのようにクリップされ、移動されるかを感じ取ることです。背景を持つボックス状のスマイルのような絵を描いてみてください。</p>"}},{"type":"prose","value":{"id":"斉次座標","title":"斉次座標","isH3":false,"content":"<p>前のクリップ空間の頂点シェーダのメインラインは、このコードを含んでいました。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>gl_Position <span class=\"token operator\">=</span> <span class=\"token function\">vec4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>変数 <code>position</code> は、 <code>draw()</code> メソッドで定義され、属性としてシェーダーに渡されました。これは 3 次元の点ですが、パイプラインを介して渡されることになる変数 <code>gl_Position</code> は実際には 4 次元です。すなわち、 <code>(x, y, z)</code> の代わりに <code>(x, y, z, w)</code> となっています。<code>z</code> の後には文字がないため、慣例により、この 4 番目の次元には <code>w</code> というラベルが付いています。 上記の例では、 <code>w</code> 座標は 1.0 に設定されています。</p>\n<p>明らかな疑問は、「なぜ余分な次元があるのか？」です。この追加により、3D データを操作するための多くの優れた手法が可能になることが分かります。この追加された次元により、遠近法の概念が座標系に導入されます。それを配置すると、3D 座標を 2D 空間にマッピングできます。これにより、2 本の平行線が遠くに離れるときに交差するようになります。値 <code>w</code> は、座標の他のコンポーネントの除数として使用されるため、 <code>x</code>、<code>y</code>、<code>z</code>の真の値は、<code>x/w</code>、<code>y/w</code>、<code>z/w</code>として計算されます（そして、<code>w</code>も <code>w/w</code>で 1 になる）。</p>\n<p>A three dimensional point is defined in a typical Cartesian coordinate system. The added fourth dimension changes this point into a <a title=\"homogeneous coordinate\" href=\"https://ja.wikipedia.org/wiki/Homogeneous_coordinates\" class=\"external\" rel=\" noopener\">homogeneous coordinate</a>. It still represents a point in 3D space and it can easily be demonstrated how to construct this type of coordinate through a pair of simple functions.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">cartesianToHomogeneous</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">point</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> point<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> point<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> z <span class=\"token operator\">=</span> point<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">homogeneousToCartesian</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">point</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> point<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> point<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> z <span class=\"token operator\">=</span> point<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> w <span class=\"token operator\">=</span> point<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>x<span class=\"token operator\">/</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">/</span>w<span class=\"token punctuation\">,</span> z<span class=\"token operator\">/</span>w<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>As previously mentioned and shown in the functions above, the w component divides the x, y, and z components. When the w component is a non-zero real number then homogeneous coordinate easily translates back into a normal point in Cartesian space. Now what happens if the w component is zero? In JavaScript the value returned would be as follows.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">homogeneousToCartesian</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This evaluates to: <code>[Infinity, Infinity, Infinity]</code>.</p>\n<p>This homogeneous coordinate represents some point at infinity. This is a handy way to represent a ray shooting off from the origin in a specific direction. In addition to a ray, it could also be thought of as a representation of a directional vector. If this homogeneous coordinate is multiplied against a matrix with a translation then the translation is effectively stripped out.</p>\n<p>When numbers are extremely large (or extremely small) on computers they begin to become less and less precise because there are only so many ones and zeros that are used to represent them. The more operations that are done on larger numbers, the more and more errors accumulate into the result. When dividing by w, this can effectively increase the precision of very large numbers by operating on two potentially smaller, less error-prone numbers.</p>\n<p>The final benefit of using homogeneous coordinates is that they fit very nicely for multiplying against 4x4 matrices. A vertex must match at least one of the dimensions of a matrix in order to be multiplied against it. The 4x4 matrix can be used to encode a variety of useful transformations. In fact, the typical perspective projection matrix uses the division by the w component to achieve its transformation.</p>\n<p>The clipping of points and polygons from clip space actually happens after the homogeneous coordinates have been transformed back into Cartesian coordinates (by dividing by w). This final space is known as <strong>normalized device coordinates</strong> or NDC.</p>\n<p>To start playing with this idea the previous example can be modified to allow for the use of the <code>w</code> component.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">//Redefine the triangles to use the W component</span>\n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token comment\">//Triangle 1</span>\n  settings<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span>  settings<span class=\"token punctuation\">.</span>bottom<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span>\n  settings<span class=\"token punctuation\">.</span>right<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>bottom<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span>\n  settings<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span>  settings<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">,</span>    settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">//Triangle 2</span>\n  settings<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span>  settings<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">,</span>    settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span>\n  settings<span class=\"token punctuation\">.</span>right<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>bottom<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span>\n  settings<span class=\"token punctuation\">.</span>right<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">,</span>    settings<span class=\"token punctuation\">.</span>depth<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">.</span>w\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Then the vertex shader uses the 4 dimensional point passed in.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>attribute vec4 position<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  gl_Position <span class=\"token operator\">=</span> position<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>First, we draw a red box in the middle, but set W to 0.7. As the coordinates get divided by 0.7 they will all be enlarged.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>box<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">top</span>    <span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">bottom</span> <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">left</span>   <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">right</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">w</span>      <span class=\"token operator\">:</span> <span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// w - enlarge this box</span>\n\n  <span class=\"token literal-property property\">depth</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// z</span>\n  <span class=\"token literal-property property\">color</span>  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// red</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Now, we draw a green box up top, but shrink it by setting the w component to 1.1</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>box<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">top</span>    <span class=\"token operator\">:</span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">bottom</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">left</span>   <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">right</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">w</span>      <span class=\"token operator\">:</span> <span class=\"token number\">1.1</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// w - shrink this box</span>\n\n  <span class=\"token literal-property property\">depth</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// z</span>\n  <span class=\"token literal-property property\">color</span>  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// green</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This last box doesn't get drawn because it's outside of clip space. The depth is outside of the -1.0 to 1.0 range.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>box<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">top</span>    <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">bottom</span> <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>              <span class=\"token comment\">// y</span>\n  <span class=\"token literal-property property\">left</span>   <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>              <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">right</span>  <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// x</span>\n  <span class=\"token literal-property property\">w</span>      <span class=\"token operator\">:</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// w - Bring this box into range</span>\n\n  <span class=\"token literal-property property\">depth</span>  <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1.5</span><span class=\"token punctuation\">,</span>             <span class=\"token comment\">// z</span>\n  <span class=\"token literal-property property\">color</span>  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// blue</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"the_results","title":"The results","isH3":true,"content":"<p><a href=\"https://jsfiddle.net/mff99yu\" class=\"external\" rel=\" noopener\">View on JSFiddle</a></p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11375/part2.png\" alt=\"The results of using homogeneous coordinates to move the boxes around in WebGL.\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"exercises","title":"Exercises","isH3":true,"content":"<ul>\n  <li>Play around with these values to see how it affects what is rendered on the screen. Note how the previously clipped blue box is brought back into range by setting its w component.</li>\n  <li>Try creating a new box that is outside of clip space and bring it back in by dividing by w.</li>\n</ul>"}},{"type":"prose","value":{"id":"model_transform","title":"Model transform","isH3":false,"content":"<p>Placing points directly into clip space is of limited use. In real world applications, you don't have all your source coordinates already in clip space coordinates. So most of the time, you need to transform the model data and other coordinates into clip space. The humble cube is an easy example of how to do this. Cube data consists of vertex positions, the colors of the faces of the cube, and the order of the vertex positions that make up the individual polygons (in groups of 3 vertices to construct the triangles composing the cube's faces). The positions and colors are stored in GL buffers, sent to the shader as attributes, and then operated upon individually.</p>\n<p>Finally a single model matrix is computed and set. This matrix represents the transformations to be performed on every point making up the model in order to move it into the correct space, and to perform any other needed transforms on each point in the model. This applies not just to each vertex, but to every single point on every surface of the model as well.</p>\n<p>In this case, for every frame of the animation a series of scale, rotation, and translation matrices move the data into the desired spot in clip space. The cube is the size of clip space (-1,-1,-1) to (1,1,1) so it will need to be shrunk down in order to not fill the entirety of clip space. This matrix is sent directly to the shader, having been multiplied in JavaScript beforehand.</p>\n<p>The following code sample defines a method on the <code>CubeDemo</code> object that will create the model matrix. It uses custom functions to create and multiply matrices as defined in the <a href=\"https://github.com/TatumCreative/mdn-webgl\" class=\"external\" rel=\" noopener\">MDN WebGL</a> shared code. The new function looks like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token class-name\">CubeDemo</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">computeModelMatrix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">now</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//Scale down by 50%</span>\n  <span class=\"token keyword\">var</span> scale <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">scaleMatrix</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Rotate a slight tilt</span>\n  <span class=\"token keyword\">var</span> rotateX <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">rotateXMatrix</span><span class=\"token punctuation\">(</span>now <span class=\"token operator\">*</span> <span class=\"token number\">0.0003</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Rotate according to time</span>\n  <span class=\"token keyword\">var</span> rotateY <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">rotateYMatrix</span><span class=\"token punctuation\">(</span>now <span class=\"token operator\">*</span> <span class=\"token number\">0.0005</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Move slightly down</span>\n  <span class=\"token keyword\">var</span> position <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">translateMatrix</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Multiply together, make sure and read them in opposite order</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>model <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">multiplyArrayOfMatrices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    position<span class=\"token punctuation\">,</span> <span class=\"token comment\">// step 4</span>\n    rotateY<span class=\"token punctuation\">,</span>  <span class=\"token comment\">// step 3</span>\n    rotateX<span class=\"token punctuation\">,</span>  <span class=\"token comment\">// step 2</span>\n    scale     <span class=\"token comment\">// step 1</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>In order to use this in the shader it must be set to a uniform location. The locations for the uniforms are saved in the <code>locations</code> object shown below:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>locations<span class=\"token punctuation\">.</span>model <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">getUniformLocation</span><span class=\"token punctuation\">(</span>webglProgram<span class=\"token punctuation\">,</span> <span class=\"token string\">'model'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And finally the uniform is set to that location. This hands off the matrix to the GPU.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>gl<span class=\"token punctuation\">.</span><span class=\"token function\">uniformMatrix4fv</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>locations<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>In the shader, each position vertex is first transformed into a homogeneous coordinate (a <code>vec4</code> object), and then multiplied against the model matrix.</p>\n<div class=\"code-example\"><pre class=\"brush: glsl notranslate\"><code>gl_Position <span class=\"token operator\">=</span> model <span class=\"token operator\">*</span> <span class=\"token keyword\">vec4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> In JavaScript, matrix multiplication requires a custom function, while in the shader it is built into the language with the simple * operator.</p>\n</div>"}},{"type":"prose","value":{"id":"the_results_2","title":"The results","isH3":true,"content":"<p><a href=\"https://jsfiddle.net/5jofzgsh\" class=\"external\" rel=\" noopener\">View on JSFiddle</a></p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11377/part3.png\" alt=\"Using a model matrix\" loading=\"lazy\">\n</p>\n<p>At this point the w value of the transformed point is still 1.0. The cube still doesn't have any perspective. The next section will take this setup and modify the w values to provide some perspective.</p>"}},{"type":"prose","value":{"id":"exercises_2","title":"Exercises","isH3":true,"content":"<ul>\n  <li>Shrink down the box using the scale matrix and position it in different places within clip space.</li>\n  <li>Try moving it outside of clip space.</li>\n  <li>Resize the window and watch as the box skews out of shape.</li>\n  <li>Add a <code>rotateZ</code> matrix.</li>\n</ul>"}},{"type":"prose","value":{"id":"divide_by_w","title":"Divide by W","isH3":false,"content":"<p>An easy way to start getting some perspective on our model of the cube is to take the Z coordinate and copy it over to the w coordinate. Normally when converting a cartesian point to homogeneous it becomes <code>(x,y,z,1)</code>, but we're going to set it to something like <code>(x,y,z,z)</code>. In reality we want to make sure that z is greater than 0 for points in view, so we'll modify it slightly by changing the value to <code>((1.0 + z) * scaleFactor)</code>. This will take a point that is normally in clip space (-1 to 1) and move it into a space more like (0 to 1) depending on what the scale factor is set to. The scale factor changes the final w value to be either higher or lower overall.</p>\n<p>The shader code looks like this.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// First transform the point</span>\nvec4 transformedPosition <span class=\"token operator\">=</span> model <span class=\"token operator\">*</span> <span class=\"token function\">vec4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// How much effect does the perspective have?</span>\nfloat scaleFactor <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Set w by taking the z value which is typically ranged -1 to 1, then scale</span>\n<span class=\"token comment\">// it to be from 0 to some number, in this case 0-1.</span>\nfloat w <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span> <span class=\"token operator\">+</span> transformedPosition<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> scaleFactor<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Save the new gl_Position with the custom w component</span>\ngl_Position <span class=\"token operator\">=</span> <span class=\"token function\">vec4</span><span class=\"token punctuation\">(</span>transformedPosition<span class=\"token punctuation\">.</span>xyz<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"the_results_3","title":"The results","isH3":true,"content":"<p><a href=\"https://jsfiddle.net/vk9r8h2c\" class=\"external\" rel=\" noopener\">View on JSFiddle</a></p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11379/part4.png\" alt=\"Filling the W component and creating some projection.\" loading=\"lazy\">\n</p>\n<p>See that small dark blue triangle? That's an additional face added to our object because the rotation of our shape has caused that corner to extend outside clip space, thus causing the corner to be clipped away. See <a href=\"#perspective_projection_matrix\">Perspective projection matrix</a> below for an introduction to how to use more complex matrices to help control and prevent clipping.</p>"}},{"type":"prose","value":{"id":"exercise","title":"Exercise","isH3":true,"content":"<p>If that sounds a little abstract, open up the vertex shader and play around with the scale factor and watch how it shrinks vertices more towards the surface. Completely change the w component values for really trippy representations of space.</p>\n<p>In the next section we'll take this step of copying Z into the w slot and turn it into a matrix.</p>"}},{"type":"prose","value":{"id":"simple_projection","title":"Simple projection","isH3":false,"content":"<p>The last step of filling in the w component can actually be accomplished with a simple matrix. Start with the identity matrix:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> identity <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">multiplyPoint</span><span class=\"token punctuation\">(</span>identity<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//&gt; [2, 3, 4, 1]</span>\n</code></pre></div>\n<p>Then move the last column's 1 up one space.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> copyZ <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">multiplyPoint</span><span class=\"token punctuation\">(</span>copyZ<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//&gt; [2, 3, 4, 4]</span>\n</code></pre></div>\n<p>However in the last example we performed <code>(z + 1) * scaleFactor</code>:</p>\n<pre class=\"notranslate\">var scaleFactor = 0.5;\n\nvar simpleProjection = [\n  1, 0, 0, 0,\n  0, 1, 0, 0,\n  0, 0, 1, scaleFactor,\n  0, 0, 0, scaleFactor,\n];\n\nMDN.multiplyPoint(simpleProjection, [2, 3, 4, 1]);\n//&gt; [2, 3, 4, 2.5]\n</pre>\n<p>Breaking it out a little further we can see how this works:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> z <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> w <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> scaleFactor<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">*</span> scaleFactor<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>The last line could be simplified to:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>w <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> scaleFactor<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">*</span> scaleFactor<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Then factoring out the scaleFactor, we get this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>w <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> scaleFactor\n</code></pre></div>\n<p>Which is exactly the same as the <code>(z + 1) * scaleFactor</code> that we used in the previous example.</p>\n<p>In the box demo, an additional <code>computeSimpleProjectionMatrix()</code> method is added. This is called in the <code>draw()</code> method and has the scale factor passed to it. The result should be identical to the last example:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token class-name\">CubeDemo</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">computeSimpleProjectionMatrix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">scaleFactor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>projection <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> scaleFactor<span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> scaleFactor\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Although the result is identical, the important step here is in the vertex shader. Rather than modifying the vertex directly, it gets multiplied by an additional <strong><a href=\"#projection_matrix\">projection matrix</a></strong>, which (as the name suggests) projects 3D points onto a 2D drawing surface:</p>\n<div class=\"code-example\"><pre class=\"brush: glsl notranslate\"><code><span class=\"token comment\">// Make sure to read the transformations in reverse order</span>\ngl_Position <span class=\"token operator\">=</span> projection <span class=\"token operator\">*</span> model <span class=\"token operator\">*</span> <span class=\"token keyword\">vec4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"the_results_4","title":"The results","isH3":true,"content":"<p><a href=\"https://jsfiddle.net/zwyLLcbw\" class=\"external\" rel=\" noopener\">View on JSFiddle</a></p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11381/part5.png\" alt=\"A simple projection matrix\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"the_viewing_frustum","title":"The viewing frustum","isH3":false,"content":"<p>Before we move on to covering how to compute a perspective projection matrix, we need to introduce the concept of the <strong><a title=\"viewing frustum\" href=\"https://ja.wikipedia.org/wiki/Viewing_frustum\" class=\"external\" rel=\" noopener\">viewing frustum</a></strong> (also known as the <strong>view frustum</strong>). This is the region of space whose contents are visible to the user at the current time. It's the 3D region of space defined by the field of view and the distances specified as the nearest and farthest content that should be rendered.</p>\n<p>While rendering, we need to determine which polygons need to be rendered in order to represent the scene. This is what the viewing frustum defines. But what's a frustum in the first place?</p>\n<p>A <a title=\"frustum\" href=\"https://ja.wikipedia.org/wiki/Frustum\" class=\"external\" rel=\" noopener\">frustum</a> is the 3D solid that results from taking any solid and slicing off two sections of it using two parallel planes. Consider our camera, which is viewing an area that starts immediately in front of its lens and extends off into the distance. The viewable area is a four-sided pyramid with its peak at the lens, its four sides corresponding to the extents of its peripheral vision range, and its base at the farthest distance it can see, like this:</p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/17295/FullCameraFOV.svg\" alt=\"A depiction of the entire viewing area of a camera. This area is a four-sided pyramid with its peak at the lens and its base at the world's maximum viewable distance.\" loading=\"lazy\">\n</p>\n<p>If we simply used this to determine the polygons to be rendered each frame, our renderer would need to render every polygon within this pyramid, all the way off into infinity, including also polygons that are very close to the lens—likely too close to be useful (and certainly including things that are so close that a real human wouldn't be able to focus on them in the same setting).</p>\n<p>So the first step in reducing the number of polygons we need to compute and render, we turn this pyramid into the viewing frustum. The two planes we'll use to chop away vertices in order to reduce the polygon count are the <strong>near clipping plane</strong> and the <strong>far clipping plane</strong>.</p>\n<p>In WebXR, the near and far clipping planes are defined by specifying the distance from the lens to the closest point on a plane which is perpendicular to the viewing direction. Anything closer to the lens than the near clipping plane or farther from it than the far clipping plane is removed. This results in the viewing frustum, which looks like this:</p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/17296/CameraViewFustum.svg\" alt=\"A depiction of the camera's view frustum; the near and far planes have removed part of the volume, reducing the polygon count.\" loading=\"lazy\">\n</p>\n<p>The set of objects to be rendered for each frame is essentially created by starting with the set of all objects in the scene. Then any objects which are <em>entirely</em> outside the viewing frustum are removed from the set. Next, objects which partially extrude outside the viewing frustum are clipped by dropping any polygons which are entirely outside the frustum, and by clipping the polygons which cross outside the frustrum so that they no longer exit it.</p>\n<p>Once that's been done, we have the largest set of polygons which are entirely within the viewing frustum. This list is usually further reduced using processes like <a title=\"back-face culling\" href=\"https://ja.wikipedia.org/wiki/Back-face_culling\" class=\"external\" rel=\" noopener\">back-face culling</a> (removing polygons whose back side is facing the camera) and occlusion culling using <a title=\"hidden-surface determination\" href=\"https://ja.wikipedia.org/wiki/Hidden-surface_determination\" class=\"external\" rel=\" noopener\">hidden-surface determination</a> (removing polygons which can't be seen because they're entirely blocked by polygons that are closer to the lens).</p>"}},{"type":"prose","value":{"id":"perspective_projection_matrix","title":"Perspective projection matrix","isH3":false,"content":"<p>Up to this point, we've built up our own 3D rendering setup, step by step. However the current code as we've built it has some issues. For one, it gets skewed whenever we resize our window. Another is that our simple projection doesn't handle a wide range of values for the scene data. Most scenes don't work in clip space. It would be helpful to define what distance is relevant to the scene so that precision isn't lost in converting the numbers. Finally it's very helpful to have a fine-tuned control over what points get placed inside and outside of clip space. In the previous examples the corners of the cube occasionally get clipped.</p>\n<p>The <strong>perspective projection matrix</strong> is a type of projection matrix that accomplishes all of these requirements. The math also starts to get a bit more involved and won't be fully explained in these examples. In short, it combines dividing by w (as done with the previous examples) with some ingenious manipulations based on <a href=\"https://en.wikipedia.org/wiki/Similarity_%28geometry%29\" class=\"external\" rel=\" noopener\">similar triangles</a>. If you want to read a full explanation of the math behind it check out some of the following links:</p>\n<ul>\n  <li><a href=\"https://www.songho.ca/opengl/gl_projectionmatrix.html\" class=\"external\" rel=\" noopener\">OpenGL Projection Matrix</a></li>\n  <li><a href=\"http://ogldev.atspace.co.uk/www/tutorial12/tutorial12.html\" class=\"external\" rel=\" noopener\">Perspective Projection</a></li>\n  <li><a href=\"https://stackoverflow.com/questions/28286057/trying-to-understand-the-math-behind-the-perspective-matrix-in-webgl/28301213#28301213\" class=\"external\" rel=\" noopener\">Trying to understand the math behind the perspective projection matrix in WebGL</a></li>\n</ul>\n<p>One important thing to note about the perspective projection matrix used below is that it flips the z axis. In clip space the z+ goes away from the viewer, while with this matrix it comes towards the viewer.</p>\n<p>The reason to flip the z axis is that the clip space coordinate system is a left-handed coordinate system (wherein the z-axis points away from the viewer and into the screen), while the convention in mathematics, physics and 3D modeling, as well as for the view/eye coordinate system in OpenGL, is to use a right-handed coordinate system (z-axis points out of the screen towards the viewer) . More on that in the relevant Wikipedia articles: <a href=\"https://en.wikipedia.org/wiki/Cartesian_coordinate_system#Orientation_and_handedness\" class=\"external\" rel=\" noopener\">Cartesian coordinate system</a>, <a href=\"https://en.wikipedia.org/wiki/Right-hand_rule\" class=\"external\" rel=\" noopener\">Right-hand rule</a>.</p>\n<p>Let's take a look at a <code>perspectiveMatrix()</code> function, which computes the perspective projection matrix.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">perspectiveMatrix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fieldOfViewInRadians<span class=\"token punctuation\">,</span> aspectRatio<span class=\"token punctuation\">,</span> near<span class=\"token punctuation\">,</span> far</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> f <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">tan</span><span class=\"token punctuation\">(</span>fieldOfViewInRadians <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> rangeInv <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>near <span class=\"token operator\">-</span> far<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n    f <span class=\"token operator\">/</span> aspectRatio<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>                          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               f<span class=\"token punctuation\">,</span>                          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>    <span class=\"token punctuation\">(</span>near <span class=\"token operator\">+</span> far<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> rangeInv<span class=\"token punctuation\">,</span>  <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>               <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>  near <span class=\"token operator\">*</span> far <span class=\"token operator\">*</span> rangeInv <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">0</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The four parameters into this function are:</p>\n<dl>\n  <dt id=\"fieldofviewinradians\"><code>fieldOfviewInRadians</code></dt>\n  <dd>\n    <p>An angle, given in radians, indicating how much of the scene is visible to the viewer at once. The larger the number is, the more is visible by the camera. The geometry at the edges becomes more and more distorted, equivalent to a wide angle lens. When the field of view is larger, the objects typically get smaller. When the field of view is smaller, then the camera can see less and less in the scene. The objects are distorted much less by perspective and objects seem much closer to the camera</p>\n  </dd>\n  <dt id=\"aspectratio\"><code>aspectRatio</code></dt>\n  <dd>\n    <p>The scene's aspect ratio, which is equivalent to its width divided by its height. In these examples, that's the window's width divided by the window height. The introduction of this parameter finally solves the problem wherein the model gets warped as the canvas is resized and reshaped.</p>\n  </dd>\n  <dt id=\"nearclippingplanedistance\"><code>nearClippingPlaneDistance</code></dt>\n  <dd>\n    <p>A positive number indicating the distance into the screen to a plane which is perpendicular to the floor, nearer than which everything gets clipped away. This is mapped to -1 in clip space, and should not be set to 0.</p>\n  </dd>\n  <dt id=\"farclippingplanedistance\"><code>farClippingPlaneDistance</code></dt>\n  <dd>\n    <p>A positive number indicating the distance to the plane beyond which geometry is clipped away. This is mapped to 1 in clip space. This value should be kept reasonably close to the distance of the geometry in order to avoid precision errors creeping in while rendering.</p>\n  </dd>\n</dl>\n<p>In the latest version of the box demo, the <code>computeSimpleProjectionMatrix()</code> method has been replaced with the <code>computePerspectiveMatrix()</code> method.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token class-name\">CubeDemo</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">computePerspectiveMatrix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> fieldOfViewInRadians <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> aspectRatio <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">/</span> window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> nearClippingPlaneDistance <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> farClippingPlaneDistance <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>projection <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">perspectiveMatrix</span><span class=\"token punctuation\">(</span>\n    fieldOfViewInRadians<span class=\"token punctuation\">,</span>\n    aspectRatio<span class=\"token punctuation\">,</span>\n    nearClippingPlaneDistance<span class=\"token punctuation\">,</span>\n    farClippingPlaneDistance\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The shader code is identical to the previous example:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>gl_Position <span class=\"token operator\">=</span> projection <span class=\"token operator\">*</span> model <span class=\"token operator\">*</span> <span class=\"token function\">vec4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Additionally (not shown), the position and scale matrices of the model have been changed to take it out of clip space and into the larger coordinate system.</p>"}},{"type":"prose","value":{"id":"the_results_5","title":"The results","isH3":true,"content":"<p><a href=\"https://jsfiddle.net/Lzxw7e1q\" class=\"external\" rel=\" noopener\">View on JSFiddle</a></p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11383/part6.png\" alt=\"A true perspective matrix\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"exercises_3","title":"Exercises","isH3":true,"content":"<ul>\n  <li>Experiment with the parameters of the perspective projection matrix and the model matrix.</li>\n  <li>Swap out the perspective projection matrix to use <a title=\"orthographic projection\" href=\"https://ja.wikipedia.org/wiki/Orthographic_projection\" class=\"external\" rel=\" noopener\">orthographic projection</a>. In the MDN WebGL shared code you'll find the <code>MDN.orthographicMatrix()</code>. This can replace the <code>MDN.perspectiveMatrix()</code> function in <code>CubeDemo.prototype.computePerspectiveMatrix()</code>.</li>\n</ul>"}},{"type":"prose","value":{"id":"view_matrix","title":"View matrix","isH3":false,"content":"<p>While some graphics libraries have a virtual camera that can be positioned and pointed while composing a scene, OpenGL (and by extension WebGL) does not. This is where the <strong>view matrix</strong> comes in. Its job is to translate, rotate, and scale the objects in the scene so that they are located in the right place relative to the viewer given the viewer's position and orientation.</p>"}},{"type":"prose","value":{"id":"simulating_a_camera","title":"Simulating a camera","isH3":true,"content":"<p>This makes use of one of the fundamental facets of Einstein's special relativity theory: the principle of reference frames and relative motion says that, from the perspective of a viewer, you can simulate changing the position and orientation of the viewer by applying the opposite change to the objects in the scene. Either way, the result appears to be identical to the viewer.</p>\n<p>Consider a box sitting on a table and a camera resting on the table one meter away, pointed at the box, the front of which is pointed toward the camera. Then consider moving the camera away from the box until it's two meters away (by adding a meter to the camera's Z position), then sliding it 10 centimeters to the its left. The box recedes from the camera by that amount and slides to the right slightly, thereby appearing smaller to the camera and exposing a small amount of its left side to the camera.</p>\n<p>Now let's reset the scene, placing the box back in its starting point, with the camera two meters from, and directly facing, the box. This time, however, the camera is locked down on the table and cannot be moved or turned. This is what working in WebGL is like. So how do we simulate moving the camera through space?</p>\n<p>Instead of moving the camera backward and to the left, we apply the inverse transform to the box: we move the <em>box</em> backward one meter, and then 10 centimeters to its right. The result, from the perspective of each of the two objects, is identical.</p>\n<p><strong>&lt;&lt;&lt; insert image(s) here &gt;&gt;&gt;</strong></p>\n<p>The final step in all of this is to create the <strong>view matrix</strong>, which transforms the objects in the scene so they're positioned to simulate the camera's current location and orientation. Our code as it stands can move the cube around in world space and project everything to have perspective, but we still can't move the camera.</p>\n<p>Imagine shooting a movie with a physical camera. You have the freedom to place the camera essentially anywhere you wish, and to aim the camera in whichever direction you choose. To simulate this in 3D graphics, we use a view matrix to simulate the position and rotation of that physical camera.</p>\n<p>Unlike the model matrix, which directly transforms the model vertices, the view matrix moves an abstract camera around. In reality, the vertex shader is still only moving the models while the \"camera\" stays in place. In order for this to work out correctly, the inverse of the transform matrix must be used. The inverse matrix essentially reverses a transformation, so if we move the camera view forward, the inverse matrix causes the objects in the scene to move back.</p>\n<p>The following <code>computeViewMatrix()</code> method animates the view matrix by moving it in and out, and left and right.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token class-name\">CubeDemo</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">computeViewMatrix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">now</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> moveInAndOut <span class=\"token operator\">=</span> <span class=\"token number\">20</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>now <span class=\"token operator\">*</span> <span class=\"token number\">0.002</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> moveLeftAndRight <span class=\"token operator\">=</span> <span class=\"token number\">15</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>now <span class=\"token operator\">*</span> <span class=\"token number\">0.0017</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Move the camera around</span>\n  <span class=\"token keyword\">var</span> position <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">translateMatrix</span><span class=\"token punctuation\">(</span>moveLeftAndRight<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span> <span class=\"token operator\">+</span> moveInAndOut <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Multiply together, make sure and read them in opposite order</span>\n  <span class=\"token keyword\">var</span> matrix <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">multiplyArrayOfMatrices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// Exercise: rotate the camera view</span>\n    position\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Inverse the operation for camera movements, because we are actually</span>\n  <span class=\"token comment\">// moving the geometry in the scene, not the camera itself.</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>view <span class=\"token operator\">=</span> <span class=\"token constant\">MDN</span><span class=\"token punctuation\">.</span><span class=\"token function\">invertMatrix</span><span class=\"token punctuation\">(</span>matrix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The shader now uses three matrices.</p>\n<div class=\"code-example\"><pre class=\"brush: glsl notranslate\"><code>gl_Position <span class=\"token operator\">=</span> projection <span class=\"token operator\">*</span> view <span class=\"token operator\">*</span> model <span class=\"token operator\">*</span> <span class=\"token keyword\">vec4</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>After this step, the GPU pipeline will clip the out of range vertices, and send the model down to the fragment shader for rasterization.</p>"}},{"type":"prose","value":{"id":"the_results_6","title":"The results","isH3":true,"content":"<p><a href=\"https://jsfiddle.net/86fd797g\" class=\"external\" rel=\" noopener\">View on JSFiddle</a></p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11385/part7.png\" alt=\"The view matrix\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"relating_the_coordinate_systems","title":"Relating the coordinate systems","isH3":true,"content":"<p>At this point it would be beneficial to take a step back and look at and label the various coordinate systems we use. First off, the cube's vertices are defined in <strong>model space</strong>. To move the model around the scene. these vertices need to be converted into <strong>world space</strong> by applying the model matrix.</p>\n<p>model space → model matrix → world space</p>\n<p>The camera hasn't done anything yet, and the points need to be moved again. Currently they are in world space, but they need to be moved to <strong>view space</strong> (using the view matrix) in order to represent the camera placement.</p>\n<p>world space → view matrix → view space</p>\n<p>Finally a <strong>projection</strong> (in our case the perspective projection matrix) needs to be added in order to map the world coordinates into clip space coordinates.</p>\n<p>view space → projection matrix → clip space</p>"}},{"type":"prose","value":{"id":"exercise_2","title":"Exercise","isH3":true,"content":"<ul>\n  <li>Move the camera around the scene.</li>\n  <li>Add some rotation matrices to the view matrix to look around.</li>\n  <li>Finally, track the mouse's position. Use 2 rotation matrices to have the camera look up and down based on where the user's mouse is on the screen.</li>\n</ul>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"/ja/docs/Web/API/WebGL_API\">WebGL</a></li>\n  <li><a title=\"3D projection\" href=\"https://ja.wikipedia.org/wiki/3D_projection\" class=\"external\" rel=\" noopener\">3D projection</a></li>\n</ul>"}}],"toc":[{"text":"モデル、ビュー、射影行列","id":"モデル、ビュー、射影行列"},{"text":"クリップ空間","id":"クリップ空間"},{"text":"斉次座標","id":"斉次座標"},{"text":"Model transform","id":"model_transform"},{"text":"Divide by W","id":"divide_by_w"},{"text":"Simple projection","id":"simple_projection"},{"text":"The viewing frustum","id":"the_viewing_frustum"},{"text":"Perspective projection matrix","id":"perspective_projection_matrix"},{"text":"View matrix","id":"view_matrix"},{"text":"See also","id":"see_also"}],"summary":"この記事では、WebGL プロジェクト内でデータを取得し、それを適切な空間に投影して画面に表示する方法について説明します。並進、拡縮、回転行列を使用した基本的な行列計算の知識があることを前提としています。3D シーンを構成するときに通常使用される中心的な 3 つの行列である、モデル、ビュー、射影行列について説明します。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"WebGL model view projection","locale":"en-US","native":"English (US)"},{"title":"WebGL model view projection","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"ja/web/api/webgl_api/webgl_model_view_projection","github_url":"https://github.com/mdn/translated-content/blob/main/files/ja/web/api/webgl_api/webgl_model_view_projection/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/ja/docs/Web","title":"開発者向けのウェブ技術"},{"uri":"/ja/docs/Web/API","title":"Web API"},{"uri":"/ja/docs/Web/API/WebGL_API","title":"WebGL: ウェブの 2D および 3D グラフィック"},{"uri":"/ja/docs/Web/API/WebGL_API/WebGL_model_view_projection","title":"WebGL モデル ビュー 射影"}],"pageTitle":"WebGL モデル ビュー 射影 - Web API | MDN","noIndexing":false}}</script></body></html>