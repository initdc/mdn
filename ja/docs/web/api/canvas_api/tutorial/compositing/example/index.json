{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"合成の例","mdn_url":"/ja/docs/Web/API/Canvas_API/Tutorial/Compositing/Example","locale":"ja","native":"日本語","sidebarHTML":"\n <ol>\n  <li><a href=\"/ja/docs/Web/API/Canvas_API\"><strong>Canvas API</strong></a></li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Canvas チュートリアル</summary>\n      <ol>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Basic_usage\">基本的な使用</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes\">図形の描画</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Applying_styles_and_colors\">スタイルと色の適用</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Drawing_text\">テキストの描画</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Using_images\">画像の使用</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Transformations\">変換</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Compositing\">合成とクリッピング</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Basic_animations\">基本的なアニメーション</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Advanced_animations\">高度なアニメーション</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas\">ピクセル操作</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas\">canvas の最適化</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Tutorial/Finale\">最後に</a></li>\n        </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>例</summary>\n      <ol>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/A_basic_ray-caster\">A basic raycaster</a></li>\n        <li><a href=\"/ja/docs/Web/API/Canvas_API/Manipulating_video_using_canvas\">canvas を用いた動画の操作</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>インターフェイス</summary>\n      <ol>\n        <li><a href=\"/ja/docs/Web/API/HTMLCanvasElement\"><code>HTMLCanvasElement</code></a></li>\n        <li><a href=\"/ja/docs/Web/API/CanvasRenderingContext2D\"><code>CanvasRenderingContext2D</code></a></li>\n        <li><a href=\"/ja/docs/Web/API/CanvasGradient\"><code>CanvasGradient</code></a></li>\n        <li><a href=\"/ja/docs/Web/API/CanvasPattern\"><code>CanvasPattern</code></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/ImageBitmap\"><code>ImageBitmap</code> <small>(en-US)</small></a></li>\n        <li><a href=\"/ja/docs/Web/API/ImageData\"><code>ImageData</code></a></li>\n        <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/TextMetrics\"><code>TextMetrics</code> <small>(en-US)</small></a></li>\n        <li><svg class=\"icon icon-experimental\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-experimental\"></use>\n</svg> <a href=\"/ja/docs/Web/API/Path2D\"><code>Path2D</code></a></li>\n      </ol>\n    </details>\n  </li>\n  <li><strong><a href=\"/ja/docs/MDN\">ドキュメント:</a></strong></li>\n  <li class=\"toggle\">\n    <details>\n      <summary>貢献</summary>\n      <ol>\n        <li><a href=\"/ja/docs/MDN\">MDN プロジェクト</a></li>\n      </ol>\n    </details>\n  </li>\n </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>このサンプルプログラムは、数々の<a href=\"/ja/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation\">合成操作</a>を紹介するものです。出力結果は次のようになります。</p><iframe class=\"sample-code-frame\" title=\"Compositing example sample\" id=\"frame_compositing_example\" width=\"100%\" height=\"7250\" src=\"https://yari-demos.prod.mdn.mozit.cloud/ja/docs/Web/API/Canvas_API/Tutorial/Compositing/Example/_sample_.compositing_example.html\" loading=\"lazy\"></iframe>"}},{"type":"prose","value":{"id":"compositing_example","title":"合成の例","isH3":false,"content":"<p>このコードでは、プログラムの残りの部分で使用されるグローバルな値を設定します。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> canvas1 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> canvas2 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> gco <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">'source-over'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'source-in'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'source-out'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'source-atop'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'destination-over'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'destination-in'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'destination-out'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'destination-atop'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'lighter'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'copy'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'xor'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'multiply'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'screen'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'overlay'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'darken'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'lighten'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color-dodge'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color-burn'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hard-light'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'soft-light'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'difference'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'exclusion'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hue'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'saturation'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'luminosity'</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> gcoText <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n<span class=\"token string\">'これが既定の設定です。新たな図形をすでにあるキャンバスの内容の上に描きます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形は、その図形と描画先キャンバスの内容が重なり合う部分のみが描かれます。それ以外の部分は透明になります。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形は、その図形と描画先キャンバスの内容と重なり合わない部分のみが描画されます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形は、その図形と描画先キャンバスの内容と重なり合う部分のみが描かれます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形は、描画先キャンバスの内容の背後に描かれます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'描画先キャンバスの内容は、新たな図形と重なり合う部分だけが残ります。それ以外の部分は透明になります。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'描画先キャンバスの内容は、新たな図形と重なり合わない部分だけが残ります。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'描画先キャンバスの内容は、新たな図形と重なり合う部分だけが残ります。新たな図形は、その背後に描かれます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形と描画先キャンバスの内容が重なる部分は、カラー値が加算されます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形だけが描かれます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形と描画先キャンバスの内容が重なり合う部分は透明になり、それ以外は通常通り描画されます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新たな図形のピクセルは、対応する描画先キャンバスのピクセルとカラー値が乗算されます。その結果、各ピクセルのカラーは暗くなります。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'ピクセルを反転し、乗算して、改めて反転します。その結果、各ピクセルのカラーは明るくなります（multiply の逆）。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'multiply と screen を組み合わせます。新たな図形のピクセルより対応する描画先キャンバスのピクセルが、それぞれ暗いときは暗くし、明るければ明るくします。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'両方のレイヤーの暗い方のピクセルを残します。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'両方のレイヤーの明るい方のピクセルを残します。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'下層のレイヤーを、上層のレイヤーの反転値で除算します。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'下層のレイヤーを上層のレイヤーで除算し、それを反転させたものを結果とします。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'multiply と screen を overlay のように組み合わせますが、上層と下層が逆になります。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'hard-light を柔らかくします。純粋な黒と白は、真っ黒や真っ白にはなりません。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'上層のレイヤーから下層のレイヤーを引くか、またはその逆を行い、常に正の値を取得します。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'difference と似ていますが、コントラストを弱めます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'下層の輝度と彩度を保ち、上層の色相に合わせます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'下層の輝度と色相を保ち、上層の彩度に合わせます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'下層の輝度を保ち、上等の色相と彩度に合わせます。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'下層の色相と彩度を保ち、上層の輝度に合わせます。'</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">320</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> height <span class=\"token operator\">=</span> <span class=\"token number\">340</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"メインプログラム","title":"メインプログラム","isH3":true,"content":"<p>ページが読み込まれるとき、このコードが実行されてセットアップを行い、例を実行します。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// lum in sRGB</span>\n    <span class=\"token keyword\">var</span> lum <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">r</span><span class=\"token operator\">:</span> <span class=\"token number\">0.33</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">g</span><span class=\"token operator\">:</span> <span class=\"token number\">0.33</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token number\">0.33</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// resize canvas</span>\n    canvas1<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token punctuation\">;</span>\n    canvas1<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token punctuation\">;</span>\n    canvas2<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token punctuation\">;</span>\n    canvas2<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">lightMix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">colorSphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">runComposite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>そして、このコード <code>runComposite()</code> が仕事の大部分を処理し、難しい部分は多くのユーティリティ関数に頼っています。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>background <span class=\"token operator\">=</span> <span class=\"token string\">\"url(\"</span><span class=\"token operator\">+</span>op_8x8<span class=\"token punctuation\">.</span>data<span class=\"token operator\">+</span><span class=\"token string\">\")\"</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>border <span class=\"token operator\">=</span> <span class=\"token string\">\"1px solid #000\"</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>margin <span class=\"token operator\">=</span> <span class=\"token string\">\"5px\"</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> canvas<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">runComposite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> dl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dl\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>dl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>gco<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> pop <span class=\"token operator\">=</span> gco<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> dt <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dt<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> pop<span class=\"token punctuation\">;</span>\n        dl<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> dd <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        p<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> gcoText<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> canvasToDrawOn <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> canvasToDrawFrom <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> canvasToDrawResult <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvasToDrawResult<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas1<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> pop<span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas2<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">\"source-over\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,0,0.8)\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"14px arial\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>pop<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvasToDrawOn<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas1<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,0,0.8)\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"14px arial\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'existing content'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvasToDrawFrom<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas2<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,0,0.8)\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"14px arial\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'new content'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>canvasToDrawOn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>canvasToDrawFrom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>canvasToDrawResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        dl<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>dd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"ユーティリティ関数","title":"ユーティリティ関数","isH3":true,"content":"<p>このプログラムは、多くのユーティリティ関数に依存しています。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">lightMix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvas2<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">\"lighter\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(255,0,0,1)\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,255,1)\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token number\">220</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,255,0,1)\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token number\">160</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#f00\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">colorSphere</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvas1<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">360</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> halfWidth <span class=\"token operator\">=</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> rotate <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">360</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// per degree</span>\n    <span class=\"token keyword\">var</span> offset <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// scrollbar offset</span>\n    <span class=\"token keyword\">var</span> oleft <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> otop <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> n <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">359</span><span class=\"token punctuation\">;</span> n <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> gradient <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">createLinearGradient</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop<span class=\"token punctuation\">,</span> oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> color <span class=\"token operator\">=</span> Color<span class=\"token punctuation\">.</span><span class=\"token constant\">HSV_RGB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token constant\">H</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">+</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">S</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">V</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        gradient<span class=\"token punctuation\">.</span><span class=\"token function\">addColorStop</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rgba(0,0,0,0)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        gradient<span class=\"token punctuation\">.</span><span class=\"token function\">addColorStop</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rgba(\"</span><span class=\"token operator\">+</span>color<span class=\"token punctuation\">.</span><span class=\"token constant\">R</span><span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>color<span class=\"token punctuation\">.</span><span class=\"token constant\">G</span><span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>color<span class=\"token punctuation\">.</span><span class=\"token constant\">B</span><span class=\"token operator\">+</span><span class=\"token string\">\",1)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        gradient<span class=\"token punctuation\">.</span><span class=\"token function\">addColorStop</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rgba(255,255,255,1)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">moveTo</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth <span class=\"token operator\">+</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> otop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> gradient<span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">translate</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">rotate</span><span class=\"token punctuation\">(</span>rotate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">translate</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#00f\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> ctx<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// HSV (1978) = H: Hue / S: Saturation / V: Value</span>\nColor <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nColor<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">HSV_RGB</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">o</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> <span class=\"token constant\">H</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token constant\">H</span> <span class=\"token operator\">/</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">S</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token constant\">S</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">V</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token constant\">V</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">R</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">G</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">D</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">S</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">H</span> <span class=\"token operator\">&gt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">H</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">H</span> <span class=\"token operator\">=</span> <span class=\"token number\">6</span> <span class=\"token operator\">*</span> <span class=\"token constant\">H</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">D</span> <span class=\"token operator\">=</span> <span class=\"token constant\">H</span> <span class=\"token operator\">-</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token constant\">H</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">A</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token constant\">S</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">S</span> <span class=\"token operator\">*</span> <span class=\"token constant\">D</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">C</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">S</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token constant\">D</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">V</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token constant\">H</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">R</span><span class=\"token operator\">:</span> <span class=\"token constant\">R</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">G</span><span class=\"token operator\">:</span> <span class=\"token constant\">G</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">B</span><span class=\"token operator\">:</span> <span class=\"token constant\">B</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">createInterlace</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">size<span class=\"token punctuation\">,</span> color1<span class=\"token punctuation\">,</span> color2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> proto <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> size <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> size <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color1<span class=\"token punctuation\">;</span> <span class=\"token comment\">// top-left</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color2<span class=\"token punctuation\">;</span> <span class=\"token comment\">// top-right</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color2<span class=\"token punctuation\">;</span> <span class=\"token comment\">// bottom-left</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color1<span class=\"token punctuation\">;</span> <span class=\"token comment\">// bottom-right</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> pattern <span class=\"token operator\">=</span> proto<span class=\"token punctuation\">.</span><span class=\"token function\">createPattern</span><span class=\"token punctuation\">(</span>proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">,</span> <span class=\"token string\">\"repeat\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pattern<span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> pattern<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> op_8x8 <span class=\"token operator\">=</span> <span class=\"token function\">createInterlace</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#eee\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}}],"toc":[{"text":"合成の例","id":"compositing_example"}],"summary":"このサンプルプログラムは、数々の合成操作を紹介するものです。出力結果は次のようになります。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Compositing example","locale":"en-US","native":"English (US)"},{"title":"Ejemplo de composición","locale":"es","native":"Español"},{"title":"Exemple de composition","locale":"fr","native":"Français"},{"title":"도형 합성 예제","locale":"ko","native":"한국어"},{"title":"Exemplo de Composição","locale":"pt-BR","native":"Português (do Brasil)"},{"title":"Compositing 示例","locale":"zh-CN","native":"中文 (简体)"},{"title":"Compositing example","locale":"zh-TW","native":"正體中文 (繁體)"}],"source":{"folder":"ja/web/api/canvas_api/tutorial/compositing/example","github_url":"https://github.com/mdn/translated-content/blob/main/files/ja/web/api/canvas_api/tutorial/compositing/example/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/ja/docs/Web","title":"開発者向けのウェブ技術"},{"uri":"/ja/docs/Web/API","title":"Web API"},{"uri":"/ja/docs/Web/API/Canvas_API","title":"キャンバス API"},{"uri":"/ja/docs/Web/API/Canvas_API/Tutorial","title":"Canvas チュートリアル"},{"uri":"/ja/docs/Web/API/Canvas_API/Tutorial/Compositing","title":"合成とクリッピング"},{"uri":"/ja/docs/Web/API/Canvas_API/Tutorial/Compositing/Example","title":"合成の例"}],"pageTitle":"合成の例 - Web API | MDN","noIndexing":false}}