{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Storage Access API の使用","mdn_url":"/ja/docs/Web/API/Storage_Access_API/Using","locale":"ja","native":"日本語","sidebarHTML":"<ol><li><strong><a href=\"/ja/docs/Web/API/Storage_Access_API\">Storage Access API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>ガイド</summary><ol><li><a href=\"/ja/docs/Web/API/Storage_Access_API/Using\">Using the Storage Access API</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>メソッド</summary><ol><li><a href=\"/ja/docs/Web/API/Document/hasStorageAccess\"><code>Document.hasStorageAccess()</code></a></li><li><a href=\"/ja/docs/Web/API/Document/requestStorageAccess\"><code>Document.requestStorageAccess()</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard experimental\" id=\"sect1\"><p><strong>Experimental:</strong> <strong>これは<a href=\"/ja/docs/MDN/Writing_guidelines/Experimental_deprecated_obsolete#experimental\">実験的な機能</a>です。</strong><br>本番で使用する前に<a href=\"#browser_compatibility\">ブラウザー互換性一覧表</a>をチェックしてください。</p></div>\n<p>埋め込まれたクロスオリジンの文書で <a href=\"/ja/docs/Web/API/Storage_Access_API\">Storage Access API</a> を使用して、ファーストパーティストレージにアクセスできるかどうかを確認し、そうでない場合はアクセスを要求する必要があります。 一般的なストレージアクセスのシナリオについて簡単に説明します。</p>"}},{"type":"prose","value":{"id":"使用上の注意","title":"使用上の注意","isH3":false,"content":"<p>Storage Access API は、ユーザーのブラウザーがすべてのサードパーティのクッキーをブロックするように設定されている場合にブロックされるストレージへのアクセスを埋め込まれたコンテンツが要求できるように設計されています。 埋め込まれたコンテンツはユーザーが使用しているストレージポリシーを認識しないため、ストレージからの読み取りまたは書き込みを試みる前に、常に埋め込まれたフレームにストレージアクセスがあるかどうかを確認するのが最善です。 これは、<a href=\"/ja/docs/Web/API/Document/cookie\"><code>Document.cookie</code></a> へのアクセスの場合に特に当てはまります。 サードパーティのクッキーがブロックされると、ブラウザーはしばしば空のクッキージャーを返すためです。</p>"}},{"type":"prose","value":{"id":"埋め込まれたクロスオリジン_iframe_でユーザーのクッキーにアクセスする","title":"埋め込まれたクロスオリジン iframe でユーザーのクッキーにアクセスする","isH3":false,"content":"<p>この例では、埋め込まれたクロスオリジン <a href=\"/ja/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code></a> が、サードパーティのクッキーをブロックするストレージアクセスポリシーの下でユーザーのクッキーにアクセスする方法を示します。</p>\n<p>まず、<code>&lt;iframe&gt;</code> がサンドボックス化されている場合、次のように、埋め込まれたウェブサイトは <code>allow-storage-access-by-user-activation</code> <a href=\"/ja/docs/Web/HTML/Element/iframe#attr-sandbox\">sandbox トークン</a>を追加して、ストレージアクセス要求が成功することを許可するとともに、<code>allow-scripts</code> と <code>allow-same-origin</code> を使用して API の呼び出しを許可し、クッキーを持つことができるオリジンで実行します。</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>iframe</span> <span class=\"token attr-name\">sandbox</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>allow-storage-access-by-user-activation\n                 allow-scripts\n                 allow-same-origin<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  ...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>iframe</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>次に、埋め込まれた文書内で実行されるコードに進みます。 現在ストレージにアクセスできるかどうかはわからないため、最初に <a href=\"/ja/docs/Web/API/Document/hasStorageAccess\"><code>Document.hasStorageAccess()</code></a> を呼び出す必要があります。 その呼び出しが <code>false</code> を返す場合、<a href=\"/ja/docs/Web/API/Document/requestStorageAccess\"><code>Document.requestStorageAccess()</code></a> を呼び出すことができます。 それが返した結果は、前の Promise 呼び出しにチェーンできます。 最後の <code>then</code> では、ファーストパーティストレージへのアクセスが可能になります。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>document<span class=\"token punctuation\">.</span><span class=\"token function\">hasStorageAccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">hasAccess</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasAccess<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">requestStorageAccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// これで、ファーストパーティストレージにアクセスできます！</span>\n\n  <span class=\"token comment\">// ファーストパーティのクッキージャーからいくつかのアイテムにアクセスしましょう</span>\n  document<span class=\"token punctuation\">.</span>cookie <span class=\"token operator\">=</span> <span class=\"token string\">\"foo=bar\"</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">// クッキーを設定</span>\n  localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"John\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// localStorage エントリにアクセス</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ストレージアクセスの取得エラー。</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>埋め込まれたコンテンツがタップやクリックなどのユーザージェスチャーを現在処理していない限り、アクセス要求は自動的に拒否されることに注意してください。 このコードは、例えば、次のようなユーザージェスチャーベースのイベントハンドラー内で実行する必要があります。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>btn<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ここでコードを実行します</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}}],"toc":[{"text":"使用上の注意","id":"使用上の注意"},{"text":"埋め込まれたクロスオリジン iframe でユーザーのクッキーにアクセスする","id":"埋め込まれたクロスオリジン_iframe_でユーザーのクッキーにアクセスする"}],"summary":"埋め込まれたクロスオリジンの文書で Storage Access API を使用して、ファーストパーティストレージにアクセスできるかどうかを確認し、そうでない場合はアクセスを要求する必要があります。 一般的なストレージアクセスのシナリオについて簡単に説明します。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Using the Storage Access API","locale":"en-US","native":"English (US)"}],"source":{"folder":"ja/web/api/storage_access_api/using","github_url":"https://github.com/mdn/translated-content/blob/main/files/ja/web/api/storage_access_api/using/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/ja/docs/Web","title":"開発者向けのウェブ技術"},{"uri":"/ja/docs/Web/API","title":"Web API"},{"uri":"/ja/docs/Web/API/Storage_Access_API","title":"Storage Access API"},{"uri":"/ja/docs/Web/API/Storage_Access_API/Using","title":"Storage Access API の使用"}],"pageTitle":"Storage Access API の使用 - Web API | MDN","noIndexing":false}}