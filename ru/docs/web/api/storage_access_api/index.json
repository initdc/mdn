{"doc":{"isMarkdown":false,"isTranslated":true,"isActive":true,"flaws":{},"title":"Storage Access API","mdn_url":"/ru/docs/Web/API/Storage_Access_API","locale":"ru","native":"Русский","sidebarHTML":"<ol><li><strong><a href=\"/ru/docs/Web/API/Storage_Access_API\">Storage Access API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Руководства</summary><ol><li><a href=\"/ru/docs/Web/API/Storage_Access_API/Using\">Using the Storage Access API</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Методы</summary><ol><li><a href=\"/ru/docs/Web/API/Document/hasStorageAccess\"><code>Document.hasStorageAccess()</code></a></li><li><a href=\"/ru/docs/Web/API/Document/requestStorageAccess\"><code>Document.requestStorageAccess()</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div id=\"sect1\"><div class=\"notecard experimental\" id=\"sect2\"><p><strong>Experimental:</strong> <strong>Это экспериментальная технология</strong><br>Так как спецификация этой технологии ещё не стабилизировалась, смотрите <a href=\"#browser_compatibility\">таблицу совместимости</a> по поводу использования в различных браузерах. Также заметьте, что синтаксис и поведение экспериментальной технологии может измениться в будущих версиях браузеров, вслед за изменениями спецификации.</p></div></div>\n\n<p>The Storage Access API provides a way for embedded, cross-origin content to gain unrestricted access to storage that it would normally only have access to in a first-party context (we refer to this as an origin’s <em>first-party</em> storage). The API provides methods that allow embedded resources to check whether they currently have access to their first-party storage, and to request access to their first-party storage from the user agent.</p>"}},{"type":"prose","value":{"id":"концепции_и_использование","title":"Концепции и использование","isH3":false,"content":"<p>Most browsers implement a number of storage access policies that restrict access to cookies and site data for embedded, cross-origin resources. These restrictions range from giving embedded resources under each top-level origin a unique storage space to outright blocking of storage access when resources are loaded in a third-party context.</p>\n\n<p>The semantics around third-party cookie blocking policies in particular differ from browser to browser, but the core functionality is similar: cross-origin resources embedded in a third-party context are not given access to the same cookies and site storage that they would have access to when loaded in a first-party context.</p>\n\n<p>These cookie blocking policies are known to break embedded cross-origin content that requires access to its first-party storage. As an example, federated logins often require access to authentication cookies stored in first-party storage, and will require the user to sign in on each site separately (or completely break) if those cookies are not available. In the case of breakage, site owners have often encouraged users to add their site as an exception or to disable the policy entirely. As a consequence, users who wish to continue to interact with embedded content are forced to greatly relax their blocking policy for resources loaded from all embedded origins and possibly across all websites.</p>\n\n<p>The Storage Access API is intended to solve this problem; embedded cross-origin content can request unrestricted access to its first-party storage on a site-by-site basis via the <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Document/requestStorageAccess\"><code>Document.requestStorageAccess()</code> <small>(en-US)</small></a> method, and check whether it already has access via the <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Document/hasStorageAccess\"><code>Document.hasStorageAccess()</code> <small>(en-US)</small></a> method.</p>\n\n<p>In addition, sandboxed <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code> <small>(en-US)</small></a>s cannot be granted storage access by default for security reasons. The API therefore also adds the <code>allow-storage-access-by-user-activation</code> <a href=\"/en-US/docs/Web/HTML/Element/iframe#attr-sandbox\">sandbox token</a>. The embedding website needs to add this to allow storage access requests to be successful, along with <code>allow-scripts</code> and <code>allow-same-origin</code> to allow it to call the API, and execute in an origin that can have cookies:</p>\n\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>iframe</span> <span class=\"token attr-name\">sandbox</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>allow-storage-access-by-user-activation\n                 allow-scripts\n                 allow-same-origin<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  ...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>iframe</span><span class=\"token punctuation\">&gt;</span></span></code></pre></div>\n\n<p>The API is designed to limit the potential storage exceptions to origins for which the user has shown an intent to interact. This is enforced through the following constraints:</p>\n\n<ul>\n <li>Access requests are automatically denied unless the embedded content is currently processing a user gesture such as a tap or click. This also prevents embedded content on the page from spamming the browser or user with excessive access requests.</li>\n <li>Origins that have never been interacted with as a first party do not have a notion of first-party storage. From the user’s perspective, they only have a third-party relationship with that origin. Access requests are automatically denied if the browser detects that the user hasn’t interacted with the embedded content in a first-party context recently (in Firefox, \"recently\" is \"within 30 days\").</li>\n</ul>\n\n<p>The browser may decide to involve the user in the decision of whether to grant an incoming storage access request. Specifics regarding the lifetime of a storage grant and the circumstances under which the browser may decide to inform the user are currently being worked through and will be announced once ready.</p>"}},{"type":"prose","value":{"id":"подсказки_для_пользователя","title":"Подсказки для пользователя","isH3":false,"content":"<p>When <code>requestStorageAccess()</code> is called by an embedded, cross-origin document, the user agent may choose to involve the user in the decision of whether to grant storage access to the requesting origin. Prompting heuristics currently vary across the two implementers of the Storage Access API — Safari shows prompts for all embedded tracking content that has not previously received storage access, while Firefox only prompts users after a tracking origin has requested storage access on more than a threshold number of sites. See <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Document/requestStorageAccess\"><code>Document.requestStorageAccess()</code> <small>(en-US)</small></a> for more details.</p>"}},{"type":"prose","value":{"id":"отличия_реализации_в_safari","title":"Отличия реализации в Safari","isH3":false,"content":"<p>Although the API surface is the same, websites using the Storage Access API should expect differences in the level and extent of storage access they receive between Firefox and Safari. This is caused by differences in the storage access policies implemented in the two browsers. Design properties unique to Firefox are summarized here:</p>\n\n<ul>\n <li>If the embedded origin <code>tracker.example</code> has already obtained first-party storage access on the top-level origin <code>foo.example</code>, and the user visits a page from <code>foo.example</code> embedding a page from <code>tracker.example</code> again in less than 30 days, the embedded origin will have storage access immediately when loading.</li>\n <li>If a page from top-level origin <code>foo.example</code> embeds more than one <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code> <small>(en-US)</small></a> from <code>tracker.example</code>, and one of those <code>&lt;iframe&gt;</code>s uses the Storage Access API in order to obtain storage access successfully, all other iframes from <code>tracker.example</code> on <code>foo.example</code> top-level origins will immediately gain storage access as well, without needing to call <code>requestStorageAccess()</code> separately.</li>\n <li>If an embedded page from <code>tracker.example</code> has previously successfully obtained storage access on top-level origin <code>foo.example</code>, all embedded subresources from <code>tracker.example</code> on <code>foo.example</code> (e.g. scripts, images, stylesheets, etc.) will load with access to their first-party storage, which means they may send Cookie headers and honor incoming <a href=\"/ru/docs/Web/HTTP/Headers/Set-Cookie\"><code>Set-Cookie</code></a> headers.</li>\n <li>In Firefox, when the promise returned from <code>requestStorageAccess()</code> is resolved, the embedded page will gain access to its entire first-party storage, not just cookies.  This includes access to APIs such as <a href=\"/en-US/docs/Web/API/Web_Storage_API\">Web Storage</a>, <a href=\"/en-US/docs/Web/API/IndexedDB_API\">IndexedDB</a>, <a href=\"/en-US/docs/Web/API/Cache\">DOM Cache</a>, and so on.</li>\n <li>In Firefox, the storage access grants are phased out after 30 calendar days passing, whereas in Safari the storage access grants are phased out after 30 days of browser usage passed without user interaction. This is currently a limitation of the Firefox implementation, which we may address in a future version.  In Safari, successful use of the storage access API resets this counter.</li>\n</ul>\n\n<p>Документация новой политики доступа к хранилищу Firefox по блокировки отслеживающих кук <a href=\"/en-US/docs/Mozilla/Firefox/Privacy/Storage_access_policy#Storage_access_grants\">детально описана</a> в разделе предоставления доступа к хранилищу.</p>"}},{"type":"prose","value":{"id":"методы_storage_access_api","title":"Методы Storage Access API","isH3":false,"content":"<p>API методы реализованы в интерфейсе <a href=\"/ru/docs/Web/API/Document\"><code>Document</code></a>:</p>\n\n<dl>\n <dt id=\"document.hasstorageaccess_en-us\"><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Document/hasStorageAccess\"><code>Document.hasStorageAccess()</code> <small>(en-US)</small></a></dt>\n <dd>Returns a <a href=\"/ru/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>Promise</code></a> that resolves with a boolean value indicating whether the document has access to its first-party storage.</dd>\n <dt id=\"document.requeststorageaccess_en-us\"><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Document/requestStorageAccess\"><code>Document.requestStorageAccess()</code> <small>(en-US)</small></a></dt>\n <dd>Returns a <a href=\"/ru/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>Promise</code></a> that resolves if the access to first-party storage was granted, and rejects if access was denied.</dd>\n</dl>\n\n<div class=\"note notecard\" id=\"sect3\">\n<p><strong>Note</strong>: User interaction propagates to the Promise returned by both of these methods, allowing the callers to take actions that require user interaction without requiring a second click from the user. For example, a caller could open a pop-up window from the resolved Promise without triggering Firefox’s pop-up blocker.</p>\n</div>"}},{"type":"prose","value":{"id":"расширение_<iframe>_sandbox","title":"Расширение &lt;iframe&gt; sandbox","isH3":false,"content":"<p><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code> <small>(en-US)</small></a> <code>sandbox</code> появился новый признак, <code>allow-storage-access-by-user-activation</code>, который позволяет изолированному <code>&lt;iframe&gt;</code> использовать Storage Access API для запроса доступа к хранилищу.</p>","titleAsText":"Расширение <iframe> sandbox"}},{"type":"prose","value":{"id":"спецификации","title":"Спецификации","isH3":false,"content":"<p>API на стадии обсуждения — стандартизация не начата. Сейчас вы можете ознакомиться с подробной спецификацией API в блоге Apple <a href=\"https://webkit.org/blog/8124/introducing-storage-access-api/\" class=\"external\" rel=\" noopener\">Introducing Storage Access API</a> и <a href=\"https://github.com/whatwg/html/issues/3338\" class=\"external\" rel=\" noopener\">WHATWG HTML issue 3338 — Proposal: Storage Access API</a>.</p>"}},{"type":"prose","value":{"id":"поддержка_браузерами","title":"Поддержка браузерами","isH3":false,"content":"<p></p>"}},{"type":"browser_compatibility","value":{"title":null,"id":null,"isH3":false,"query":"api.Document.hasStorageAccess","dataURL":"/ru/docs/Web/API/Storage_Access_API/bcd.json"}},{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p></p>\n\n<p></p>"}},{"type":"browser_compatibility","value":{"title":null,"id":null,"isH3":false,"query":"api.Document.requestStorageAccess","dataURL":"/ru/docs/Web/API/Storage_Access_API/bcd-2.json"}},{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p></p>"}},{"type":"prose","value":{"id":"смотрите_также","title":"Смотрите также","isH3":false,"content":"<p><a href=\"/en-US/docs/Web/API/Storage_Access_API/Using\">Использование Storage Access API</a></p>"}}],"toc":[{"text":"Концепции и использование","id":"концепции_и_использование"},{"text":"Подсказки для пользователя","id":"подсказки_для_пользователя"},{"text":"Отличия реализации в Safari","id":"отличия_реализации_в_safari"},{"text":"Методы Storage Access API","id":"методы_storage_access_api"},{"text":"Расширение &lt;iframe&gt; sandbox","id":"расширение_<iframe>_sandbox"},{"text":"Спецификации","id":"спецификации"},{"text":"Поддержка браузерами","id":"поддержка_браузерами"},{"text":"Смотрите также","id":"смотрите_также"}],"summary":"The Storage Access API provides a way for embedded, cross-origin content to gain unrestricted access to storage that it would normally only have access to in a first-party context (we refer to this as an origin’s first-party storage). The API provides methods that allow embedded resources to check whether they currently have access to their first-party storage, and to request access to their first-party storage from the user agent.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Storage Access API","locale":"en-US","native":"English (US)"},{"title":"Storage Access API","locale":"ja","native":"日本語"}],"source":{"folder":"ru/web/api/storage_access_api","github_url":"https://github.com/mdn/translated-content/blob/main/files/ru/web/api/storage_access_api/index.html","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.html"},"parents":[{"uri":"/ru/docs/Web","title":"Веб-технологии для разработчиков"},{"uri":"/ru/docs/Web/API","title":"Интерфейсы веб API"},{"uri":"/ru/docs/Web/API/Storage_Access_API","title":"Storage Access API"}],"pageTitle":"Storage Access API - Интерфейсы веб API | MDN","noIndexing":false}}