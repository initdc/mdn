{"doc":{"isMarkdown":false,"isTranslated":true,"isActive":true,"flaws":{},"title":"Используем Web Audio API","mdn_url":"/ru/docs/Web/API/Web_Audio_API/Using_Web_Audio_API","locale":"ru","native":"Русский","sidebarHTML":"","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"summary\" id=\"sect1\">\n<p><a href=\"/en-US/docs/Web/API/Web_Audio_API\">Web Audio API</a> обеспечивает простой, но мощный механизм реализации и управления аудио-контентом внутри web приложения. Это позволяет разрабатывать сложные аудио миксины, эффекты и т.д. В этой статье мы постараемся объяснить основы использования Web Audio API, посредством пары простых примеров.</p>\n</div>\n\n<div id=\"sect2\">\n<p>The Web Audio API does not replace the <a href=\"/en-US/docs/Web/HTML/Element/audio\">&lt;audio&gt;</a> media element, but rather complements it, just like <a href=\"/en-US/docs/Web/HTML/Element/canvas\">&lt;canvas&gt;</a> co-exists well alongside the <a href=\"/en-US/docs/Web/HTML/Element/img\">&lt;img&gt;</a> element. What you use to implement audio depends on your use case. If you just want to control playback of a simple audio track, &lt;audio&gt; is probably a better, quicker solution. If you want to carry out more complex audio processing, as well as playback, Web Audio API provides much more power and control.</p>\n\n<p>One very powerful thing about the Web Audio API is that it does not have any strict \"sound call limitations\". There is no ceiling of 32 or 64 sound calls at one time, for example. Depending on the power of your processor, you might be able to get a thousand or more sounds playing simultaneously without stuttering. This shows real progress, given that a few years ago mid to high range sound cards were able to handle only a fraction of this load.</p>\n</div>"}},{"type":"prose","value":{"id":"examples","title":"Examples","isH3":false,"content":"<p>To demonstrate usage of the Web Audio API, we created a number of examples which will be added to as time goes on. Please feel free to add to them and suggest improvements!</p>\n\n<p>First off, we created the <a href=\"https://github.com/mdn/voice-change-o-matic\" class=\"external\" rel=\" noopener\">Voice-change-O-matic</a>, a fun voice changer and sound visualisation web app, which allows you to choose different effects and visualisations. This could definitely be improved on with better quality effects, but it demonstrates the usage of multiple Web Audio API features together (<a href=\"https://mdn.github.io/voice-change-o-matic/\" class=\"external\" rel=\" noopener\">run the Voice-change-O-matic live</a>).</p>\n\n<p><img alt=\"A UI with a sound wave being shown, and options for choosing voice effects and visualizations.\" src=\"https://mdn.mozillademos.org/files/7921/voice-change-o-matic.png\" style=\"display: block; margin: 0px auto;\" loading=\"lazy\"></p>\n\n<p>Another example we've created on our quest to understand the Web Audio is the <a href=\"https://mdn.github.io/violent-theremin/\" class=\"external\" rel=\" noopener\">Violent Theremin</a>, a simple app allowing you to change the pitch and volume by moving your mouse pointer. It also provides a psychedelic lightshow (<a href=\"https://github.com/mdn/violent-theremin\" class=\"external\" rel=\" noopener\">see Violent Theremin source code</a>).</p>\n\n<p><img alt=\"A page full of rainbow colours, with two buttons labeled Clear screen and mute. \" src=\"https://mdn.mozillademos.org/files/7919/violent-theremin.png\" style=\"display: block; margin: 0px auto;\" loading=\"lazy\"></p>"}},{"type":"prose","value":{"id":"basic_concepts","title":"Basic concepts","isH3":false,"content":"<div class=\"note notecard\" id=\"sect3\">\n<p><strong>Note</strong>: most of the code snippets in this example are taken from the <a href=\"https://github.com/mdn/violent-theremin\" class=\"external\" rel=\" noopener\">Violent Theremin example</a>.</p>\n</div>\n\n<p>The Web Audio API involves handling audio operations inside an <strong>audio context</strong>, and has been designed to allow <strong>modular routing</strong>. Basic audio operations are performed with <strong>audio nodes</strong>, which are linked together to form an <strong>audio routing graph</strong>. Several sources — with different types of channel layouts — are supported even within a single context. This modular design provides the flexibility to create complex audio functions with dynamic effects.</p>\n\n<p>Audio nodes are linked via their inputs and outputs, forming a chain that starts with one or more sources, goes through one or more nodes, then ends up at a destination (although you don't have to provide a destination if you, say, just want to visualise some audio data). A simple, typical workflow for web audio would look something like this:</p>\n\n<ol>\n <li>Create audio context</li>\n <li>Inside the context, create sources — such as <code>&lt;audio&gt;</code>, oscillator, stream</li>\n <li>Create effects nodes, such as reverb, biquad filter, panner, compressor</li>\n <li>Choose final destination of audio, for example your system speakers</li>\n <li>Connect the sources up to the effects, and the effects to the destination</li>\n</ol>"}},{"type":"prose","value":{"id":"creating_an_audio_context","title":"Creating an audio context","isH3":true,"content":"<p>First, you will need to create an instance of <a href=\"/en-US/docs/Web/API/AudioContext\"><code>AudioContext</code></a> to build an audio graph upon. The simplest example of this would look like so:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> audioCtx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<div class=\"note notecard\" id=\"sect4\">\n<p><strong>Note</strong>: Multiple audio context instances are allowed on the same document, but are likely wasteful.</p>\n</div>\n\n<p>However, it is important to provide a prefixed version for Webkit/Blink browsers, and a non-prefixed version for Firefox (desktop/mobile/OS). Something like this would work:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> audioCtx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>AudioContext <span class=\"token operator\">||</span> window<span class=\"token punctuation\">.</span>webkitAudioContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<div class=\"note notecard\" id=\"sect5\">\n<p><strong>Note</strong>: Safari can break if you don't explcitly mention the <code style=\"line-height: 1.5; font-style: normal;\">window</code> object when creating a new context!</p>\n</div>"}},{"type":"prose","value":{"id":"creating_an_audio_source","title":"Creating an audio source","isH3":true,"content":"<p>Now we have an audio context, and we can use the methods of this context to do most everything else. The first thing we need is an audio source to play around with. Audio sources can come from a variety of places:</p>\n\n<ul>\n <li>Generated directly by JavaScript by an audio node such as an oscillator. An <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/OscillatorNode\"><code>OscillatorNode</code> <small>(en-US)</small></a> is created using the <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/BaseAudioContext/createOscillator\"><code>AudioContext.createOscillator</code> <small>(en-US)</small></a> method.</li>\n <li>Created from raw PCM data: the audio context has methods to decode supported audio formats; see <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/BaseAudioContext/createBuffer\"><code>AudioContext.createBuffer()</code> <small>(en-US)</small></a>, <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/BaseAudioContext/createBufferSource\"><code>AudioContext.createBufferSource()</code> <small>(en-US)</small></a>, and <a href=\"/ru/docs/Web/API/BaseAudioContext/decodeAudioData\"><code>AudioContext.decodeAudioData()</code></a>.</li>\n <li>Taken from HTML media elements such as <a href=\"/ru/docs/Web/HTML/Element/video\"><code>&lt;video&gt;</code></a> or <a href=\"/ru/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a>: see <a href=\"/ru/docs/Web/API/AudioContext/createMediaElementSource\"><code>AudioContext.createMediaElementSource()</code></a>.</li>\n <li>Taken directly from a <a href=\"/en-US/docs/Web/API/WebRTC_API\" title=\"/en-US/docs/WebRTC\">WebRTC</a> <a href=\"/ru/docs/Web/API/MediaStream\"><code>MediaStream</code></a> such as from a webcam or microphone. See <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/AudioContext/createMediaStreamSource\"><code>AudioContext.createMediaStreamSource()</code> <small>(en-US)</small></a>.</li>\n</ul>\n\n<p>For this particular example we'll just create an oscillator to provide a simple tone for our source, and a gain node to control sound volume:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>oscillator <span class=\"token operator\">=</span> audioCtx<span class=\"token punctuation\">.</span><span class=\"token function\">createOscillator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> gainNode <span class=\"token operator\">=</span> audioCtx<span class=\"token punctuation\">.</span><span class=\"token function\">createGain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<div class=\"note notecard\" id=\"sect6\">\n<p><strong>Note</strong>: To play a music file directly, you generally have to load the file using XHR, decode the file into a buffer, and then feed that buffer into a buffer source. See this <a href=\"https://github.com/mdn/voice-change-o-matic/blob/gh-pages/scripts/app.js#L48-L68\" class=\"external\" rel=\" noopener\">example from Voice-change-O-matic</a>.</p>\n</div>\n\n<div class=\"note notecard\" id=\"sect7\">\n<p><strong>Note</strong>: Scott Michaud has written a useful helper library for loading and decoding one or more audio samples, called <a href=\"https://github.com/ScottMichaud/AudioSampleLoader\" class=\"external\" rel=\" noopener\">AudioSampleLoader</a>. This can help simplify the XHR/buffering process described in the above note.</p>\n</div>"}},{"type":"prose","value":{"id":"linking_source_and_destination_together","title":"Linking source and destination together","isH3":true,"content":"<p>To actually output the tone through your speakers, you need to link them together. This is done by calling the <code>connect</code> method on the node you want to connect from, which is available on most node types. The node that you want to connect to is given as the argument of the <code>connect</code> method.</p>\n\n<p>The default output mechanism of your device (usually your device speakers) is accessed using <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/BaseAudioContext/destination\"><code>AudioContext.destination</code> <small>(en-US)</small></a>. To connect the oscillator, gain node and destination together, we would use the following:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>oscillator<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>gainNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngainNode<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>In a more complex example (such as the <a href=\"https://mdn.github.io/voice-change-o-matic/\" class=\"external\" rel=\" noopener\">Voice-change-O-matic</a>), you can chain together as many nodes as you want. For example:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>source <span class=\"token operator\">=</span> audioCtx<span class=\"token punctuation\">.</span><span class=\"token function\">createMediaStreamSource</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsource<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>analyser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nanalyser<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>distortion<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndistortion<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>biquadFilter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbiquadFilter<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>convolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconvolver<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>gainNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngainNode<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>This would create an audio graph like this:</p>\n\n<p><img alt=\"\" src=\"https://mdn.mozillademos.org/files/7949/voice-change-o-matic-graph.png\" style=\"display: block; margin: 0px auto;\" loading=\"lazy\">You can also link multiple nodes to one node, for example if you wanted to mix multiple audio sources together, passing them all through a single effect node, like a gain node.</p>\n\n<div class=\"note notecard\" id=\"sect8\">\n<p><strong>Note</strong>: From Firefox 32 onwards, the integrated Firefox Developer Tools include a <a href=\"https://firefox-source-docs.mozilla.org/devtools-user/web_audio_editor/index.html\" class=\"external\" rel=\" noopener\">Web Audio Editor</a>, which is very useful for debugging web audio graphs.</p>\n</div>"}},{"type":"prose","value":{"id":"playing_our_sound_and_setting_a_pitch","title":"Playing our sound and setting a pitch","isH3":true,"content":"<p>Now that the audio graph is set up, we can set property values and invoke methods on our audio nodes to adjust the effect they have on the sound. In this simple example we can set a specific pitch in hertz for our oscillator, set it to a specific type, and tell our sound to play like so:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>oscillator<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'sine'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// sine wave — other values are 'square', 'sawtooth', 'triangle' and 'custom'</span>\noscillator<span class=\"token punctuation\">.</span>frequency<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">2500</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// value in hertz</span>\noscillator<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>In our Violent Theremin example we actually specify a max gain and frequency value:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> <span class=\"token constant\">WIDTH</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> <span class=\"token constant\">HEIGHT</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> maxFreq <span class=\"token operator\">=</span> <span class=\"token number\">6000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> maxVol <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> initialFreq <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> initialVol <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// set options for the oscillator</span>\n\noscillator<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'sine'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// sine wave — other values are 'square', 'sawtooth', 'triangle' and 'custom'</span>\noscillator<span class=\"token punctuation\">.</span>frequency<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> initialFreq<span class=\"token punctuation\">;</span> <span class=\"token comment\">// value in hertz</span>\noscillator<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ngainNode<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> initialVol<span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>Then we set a new value of frequency and pitch every time the mouse cursor is moved, based on the current mouse X and Y value as a percetage of the maximum frequency and gain:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Mouse pointer coordinates</span>\n\n<span class=\"token keyword\">var</span> CurX<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> CurY<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Get new mouse pointer coordinates when mouse is moved</span>\n<span class=\"token comment\">// then set new gain and putch values</span>\n\ndocument<span class=\"token punctuation\">.</span>onmousemove <span class=\"token operator\">=</span> updatePage<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">updatePage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    CurX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>Event<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> e<span class=\"token punctuation\">.</span>pageX <span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>clientX <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>scrollLeft <span class=\"token operator\">?</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>scrollLeft <span class=\"token operator\">:</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>scrollLeft<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    CurY <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>Event<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> e<span class=\"token punctuation\">.</span>pageY <span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>clientY <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>scrollTop <span class=\"token operator\">?</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>scrollTop <span class=\"token operator\">:</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>scrollTop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    oscillator<span class=\"token punctuation\">.</span>frequency<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>CurX<span class=\"token operator\">/</span><span class=\"token constant\">WIDTH</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> maxFreq<span class=\"token punctuation\">;</span>\n    gainNode<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>CurY<span class=\"token operator\">/</span><span class=\"token constant\">HEIGHT</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> maxVol<span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">canvasDraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"a_simple_canvas_visualization","title":"A simple canvas visualization","isH3":true,"content":"<p>A <code>canvasDraw()</code> function is also invoked after each mouse movement, this draws a little cluster of circles where the mouse pointer currently is, the size and colour of which are based on the frequency/gain values.</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">number1<span class=\"token punctuation\">,</span>number2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> randomNo <span class=\"token operator\">=</span> number1 <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>number2 <span class=\"token operator\">-</span> number1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> randomNo<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token constant\">WIDTH</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token constant\">HEIGHT</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> canvasCtx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">canvasDraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  rX <span class=\"token operator\">=</span> CurX<span class=\"token punctuation\">;</span>\n  rY <span class=\"token operator\">=</span> CurY<span class=\"token punctuation\">;</span>\n  rC <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>gainNode<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">.</span>value<span class=\"token operator\">/</span>maxVol<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  canvasCtx<span class=\"token punctuation\">.</span>globalAlpha <span class=\"token operator\">=</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;=</span><span class=\"token number\">15</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">=</span>i<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    canvasCtx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    canvasCtx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgb('</span> <span class=\"token operator\">+</span> <span class=\"token number\">100</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">','</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>gainNode<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">.</span>value<span class=\"token operator\">/</span>maxVol<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">','</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>oscillator<span class=\"token punctuation\">.</span>frequency<span class=\"token punctuation\">.</span>value<span class=\"token operator\">/</span>maxFreq<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">')'</span><span class=\"token punctuation\">;</span>\n    canvasCtx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span>rX<span class=\"token operator\">+</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>rY<span class=\"token operator\">+</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>rC<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">/</span><span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">/</span><span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">360</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    canvasCtx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    canvasCtx<span class=\"token punctuation\">.</span><span class=\"token function\">closePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>"}},{"type":"prose","value":{"id":"muting_the_theremin","title":"Muting the theremin","isH3":true,"content":"<p>When the Mute button is pressed, the function seen below is invoked, which disconnects the gain node from the destination node, effectively breaking the graph up so no sound can be produced. Pressing it again reverses the effect.</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> mute <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.mute'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmute<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>mute<span class=\"token punctuation\">.</span>id <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    gainNode<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    mute<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token string\">\"activated\"</span><span class=\"token punctuation\">;</span>\n    mute<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">\"Unmute\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    gainNode<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    mute<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    mute<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">\"Mute\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"other_node_options","title":"Other node options","isH3":false,"content":"<p>There are many other nodes you can create using the Web Audio API, and the good news is that, in general, they work in the same way as what we have already seen: you create a node, connect it to the other nodes in the graph, and then manipulate that node's properties and methods to affect the sound source in the way you want.</p>\n\n<p>We won't go through all of the available effects and so on; you can find details of how to use each one in the different interface reference pages of the <a href=\"/ru/docs/Web/API/Web_Audio_API\"><code>Web_Audio_API</code></a> reference. For now we'll just go through a couple of options.</p>"}},{"type":"prose","value":{"id":"wave_shaper_nodes","title":"Wave shaper nodes","isH3":true,"content":"<p>You can create a wave shaper node using the <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/BaseAudioContext/createWaveShaper\"><code>AudioContext.createWaveShaper</code> <small>(en-US)</small></a> method:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> distortion <span class=\"token operator\">=</span> audioCtx<span class=\"token punctuation\">.</span><span class=\"token function\">createWaveShaper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>This object must then be fed a mathmatically defined wave shape, which is applied to the base sound wave to create a distortion effect. These waves are not that easy to figure out, and the best way to start is to just search the Web for algorithms. For example, we found this on <a href=\"https://stackoverflow.com/questions/22312841/waveshaper-node-in-webaudio-how-to-emulate-distortion\" class=\"external\" rel=\" noopener\">Stack Overflow</a>:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">makeDistortionCurve</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">amount</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> k <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> amount <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span> <span class=\"token operator\">?</span> amount <span class=\"token operator\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n    n_samples <span class=\"token operator\">=</span> <span class=\"token number\">44100</span><span class=\"token punctuation\">,</span>\n    curve <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span>n_samples<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    deg <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">,</span>\n    i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    x<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n_samples<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    x <span class=\"token operator\">=</span> i <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token operator\">/</span> n_samples <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    curve<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> k <span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> x <span class=\"token operator\">*</span> <span class=\"token number\">20</span> <span class=\"token operator\">*</span> deg <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">+</span> k <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> curve<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>In the Voice-change-O-matic demo, we connect the <code>distortion</code> node up to the audio graph, then apply this to the distortion node when needed:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>source<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>analyser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nanalyser<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>distortion<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndistortion<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>biquadFilter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\n\ndistortion<span class=\"token punctuation\">.</span>curve <span class=\"token operator\">=</span> <span class=\"token function\">makeDistortionCurve</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"biquad_filter","title":"Biquad filter","isH3":true,"content":"<p>The biquad filter has a number of options available inside it, and is created using the <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/BaseAudioContext/createBiquadFilter\"><code>AudioContext.createBiquadFilter</code> <small>(en-US)</small></a> method:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> biquadFilter <span class=\"token operator\">=</span> audioCtx<span class=\"token punctuation\">.</span><span class=\"token function\">createBiquadFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>The particular option used in the Voice-change-o-matic demo is a lowshelf filter, which basically provides a bass boost to the sound:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>biquadFilter<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">\"lowshelf\"</span><span class=\"token punctuation\">;</span>\nbiquadFilter<span class=\"token punctuation\">.</span>frequency<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\nbiquadFilter<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>Here we specify the type of filter, a frequency value, and a gain value. In the case of a lowshelf filter, all frequencies below the specified frequency have their gain increased by 25 decibels.</p>"}},{"type":"prose","value":{"id":"other_things_inside_web_audio_api","title":"Other things inside Web Audio API","isH3":false,"content":"<p>The Web Audio API can do many other things other than audio visualization and spatializations (e.g. panning sound). We will cover other options in further articles, as this one has become long enough already!</p>"}}],"toc":[{"text":"Examples","id":"examples"},{"text":"Basic concepts","id":"basic_concepts"},{"text":"Other node options","id":"other_node_options"},{"text":"Other things inside Web Audio API","id":"other_things_inside_web_audio_api"}],"summary":"\nWeb Audio API обеспечивает простой, но мощный механизм реализации и управления аудио-контентом внутри web приложения. Это позволяет разрабатывать сложные аудио миксины, эффекты и т.д. В этой статье мы постараемся объяснить основы использования Web Audio API, посредством пары простых примеров.\n","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Using the Web Audio API","locale":"en-US","native":"English (US)"},{"title":"Utiliser la Web Audio API","locale":"fr","native":"Français"},{"title":"Web Audio API の使用","locale":"ja","native":"日本語"},{"title":"Web Audio API 사용하기","locale":"ko","native":"한국어"},{"title":"Web Audio API 的运用","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"ru/web/api/web_audio_api/using_web_audio_api","github_url":"https://github.com/mdn/translated-content/blob/main/files/ru/web/api/web_audio_api/using_web_audio_api/index.html","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.html"},"parents":[{"uri":"/ru/docs/Web","title":"Веб-технологии для разработчиков"},{"uri":"/ru/docs/Web/API","title":"Интерфейсы веб API"},{"uri":"/ru/docs/Web/API/Web_Audio_API","title":"Web Audio API"},{"uri":"/ru/docs/Web/API/Web_Audio_API/Using_Web_Audio_API","title":"Используем Web Audio API"}],"pageTitle":"Используем Web Audio API - Интерфейсы веб API | MDN","noIndexing":false}}