{"doc":{"isMarkdown":false,"isTranslated":true,"isActive":true,"flaws":{},"title":"Модификация веб страницы","mdn_url":"/ru/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page","locale":"ru","native":"Русский","sidebarHTML":"\n  <ol>\n    <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions\"><strong>Browser extensions</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Getting started</summary>\n        <ol>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">What are extensions?</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Your first extension</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Your second extension</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomy of an extension</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Examples\">Example extensions</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/What_next_\">What next?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Using the JavaScript APIs</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Match patterns</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Working with files</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalization</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Content Security Policy</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Native messaging</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome incompatibilities</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>User interface</summary>\n        <ol>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface\">User Interface</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Toolbar button</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Address bar button</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Sidebars</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Context menu items</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Options page</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Extension pages</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Address bar suggestions</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Developer tools panels</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>How to</summary>\n        <ol>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercept HTTP requests</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modify a web page</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insert external content</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Add a button to the toolbar</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Implement a settings page</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Work with the Tabs API</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Work with the Bookmarks API</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Work with the Cookies API</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Work with contextual identities</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introduction</a></li>\n        </ol>\n      <ol><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">ключ background</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">ключ icons</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">ключ manifest_version</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">ключ name</a></li><li><a href=\"/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">ключ version</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/ru/docs/Mozilla/Add-ons/Contact_us\"><strong>Contact us</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Channels</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons blog</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons forum</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p> </p>\n\n<div id=\"sect1\"></div>\n\n<p>Одним из наиболее распространённых вариантов использования расширений является внесение изменение в веб-страницу. К примеру, расширение может изменить стиль, применённый к странице, скрыть существующие или вставить на страницу дополнительные DOM-узлы.</p>\n\n<p>Существует два способа сделать это используя WebExtensions API:</p>\n\n<ul>\n <li><strong>Декларативно</strong>: объявить шаблон, которому соответствует набор URL-адресов, и загрузить набор скриптов на страницы, которые попадают в под этот шаблон.</li>\n <li><strong>Программно</strong>: используя JavaScript API, загрузить скрипт на страницу, из определённой вкладки.</li>\n</ul>\n\n<p>В любом случае, эти скрипты называются <em>контентными скриптами</em>, и отличаются от других скриптов, которые составляют расширение:</p>\n\n<ul>\n <li>Они получают доступ к малому подмножеству WebExtension API.</li>\n <li>Они получают прямой доступ к странице, на которой были загружены.</li>\n <li>Они взаимодействуют с остальными скриптами расширения, используя API сообщений.</li>\n</ul>\n\n<p>В этой статье мы рассмотрим оба способа загрузки скрипта.</p>"}},{"type":"prose","value":{"id":"модификация_страниц_подпадающих_под_url-шаблон","title":"Модификация страниц, подпадающих под URL-шаблон","isH3":false,"content":"<p>Прежде всего создадим новую директорию, назовём её \"modify-page\". В этой директории, создадим файл \"manifest.json\", со следующим содержимым:</p>\n\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"modify-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"matches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://developer.mozilla.org/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"page-eater.js\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n\n<p>Ключ <code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></code> - это как мы загружаем скрипты на страницы, соответствующие URL-шаблону. В нашем случае, <code>content_scripts</code> говорит браузеру загрузить скрипт \"page-eater.js\" на все страницы, начинающиеся с <a href=\"/\">https://developer.mozilla.org/</a>.</p>\n\n<div class=\"note notecard\" id=\"sect2\">\n<p>Поскольку свойство <code>\"js\"</code> ключа <code>content_scripts</code> это массив, вы можете использовать его, для внедрения более одного скрипта. Если вы сделаете это, страницы получат набор, как если бы эти скрипты были загружены самой страницей, они будут загружены в той же очерёдности, в которой они расположены в массиве.</p>\n</div>\n\n<div class=\"note notecard\" id=\"sect3\">\n<p>Ключ <code>content_scripts</code> также имеет свойство  <code>\"css\"</code>, которое вы можете использовать для вставки CSS-таблиц.</p>\n</div>\n\n<p>Далее, создадим файл \"page-eater.js\", внутри директории \"modify-page\":</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> header <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nheader<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"Эта страница была съедена\"</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Теперь <a href=\"/en-US/Add-ons/WebExtensions/Temporary_Installation_in_Firefox\">установим расширение</a>, и перейдём на страницу <a href=\"/\">https://developer.mozilla.org/</a>:</p>\n\n<p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/lxf2Tkg6U1M\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" loading=\"lazy\"></iframe></p>\n\n<div class=\"note notecard\" id=\"sect4\">\n<p>Обратите внимание, несмотря на то, что в указанном видео, на странице <a href=\"https://addons.mozilla.org/en-US/firefox/\" class=\"external\" rel=\" noopener\">addons.mozilla.org</a> всё работает нормально, на текущий момент, для этого сайта, контентные скрипты заблокированы.</p>\n</div>"}},{"type":"prose","value":{"id":"программная_модификация_страницы","title":"Программная модификация страницы","isH3":false,"content":"<p>Что, если вы всё ещё хотите \"съедать\" страницы, но лишь в тех случаях, когда пользователь попросил об этом? Давайте обновим этот пример таким образом, чтобы мы внедряли контентный скрипт, когда пользователь выбирает соответствующий пункт контентного меню.</p>\n\n<p>Для начала обновим \"manifest.json\":</p>\n\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"modify-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"activeTab\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"contextMenus\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n\n<p>Мы удалили ключ <code>content_scripts</code> и добавили два новых:</p>\n\n<ul>\n <li><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions (разрешения)</a></code>: для внедрения скрипта, нам нужны разрешения для страниц, которые мы модифицируем.  <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab_permission\">Разрешение <code>activeTab</code></a> это способ получить доступ к текущей вкладки. Нам также нужно разрешение <code>contextMenus</code>, чтобы добавлять в контекстное меню новые элементы.</li>\n <li><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background (фоновый)</a></code>: мы используем этот ключ, для загрузки постоянного <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#background_scripts\">\"фонового скрипта\"</a>, с именем \"background.js\", в котором мы настроим контекстное меню и внедрим контентный скрипт.</li>\n</ul>\n\n<p>Давайте создадим этот файл. Создадим новый файл \"background.js\" в директории \"modify-page\" и поместим в него следующий код:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>browser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Съесть эту страницу\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nbrowser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">info<span class=\"token punctuation\">,</span> tab</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>menuItemId <span class=\"token operator\">==</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">file</span><span class=\"token operator\">:</span> <span class=\"token string\">\"page-eater.js\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>В этом скрипте мы создаём <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/menus/create\">элемент контекстного меню</a>, передавая ему определённый идентификатор и заголовок (текст будет отображаться в элементе контекстного меню). Затем мы настраиваем обработчик событий таким образом, чтобы когда пользователь выбирает пункт контекстного меню, осуществлялась проверка, наш ли это элемент <code>eat-page</code>. Если это так - внедряем скрипт \"page-eater.js\" в текущую вкладку, используя <code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript\">tabs.executeScript()</a></code> API. Это API опционально принимает идентификатор вкладки, в качестве аргумента. Мы опустили его, это означает, что скрипт будет внедряться в текущую активную вкладку.</p>\n\n<p>На данном этапе расширение должно иметь следующий вид:</p>\n\n<pre class=\"line-numbers  language-html notranslate\"><code class=\"language-html\">modify-page/\n    background.js\n    manifest.json\n    page-eater.js</code></pre>\n\n<p>Теперь <a href=\"/en-US/Add-ons/WebExtensions/Temporary_Installation_in_Firefox#Reloading_a_temporary_add-on\">перезагрузим расширение</a>, откроем страницу (на этот раз любую) активируем контекстное меню и выберем \"Съесть эту страницу\":</p>\n\n<p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/zX4Bcv8VctA\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" loading=\"lazy\"></iframe></p>\n\n<div class=\"note notecard\" id=\"sect5\">\n<p>Обратите внимание, несмотря на то, что в указанном видео, на странице <a href=\"https://addons.mozilla.org/en-US/firefox/\" class=\"external\" rel=\" noopener\">addons.mozilla.org</a> всё работает нормально, на текущий момент, для этого сайта, контентные скрипты заблокированы.</p>\n</div>"}},{"type":"prose","value":{"id":"обмен_сообщениями","title":"Обмен сообщениями","isH3":false,"content":"<p>Контентные и фоновые скрипты не могут на прямую взаимодействовать друг с другом. Не смотря на это они могут взаимодействовать с помощью обмена сообщениями. Для этого один конец создаёт обработчик сообщений, а другой - может посылать сообщения. В следующей таблице представлены API-интерфейсы, задействованные с каждой стороны:</p>\n\n<table class=\" fullwidth-table standard-table\">\n <thead>\n  <tr>\n   <th scope=\"row\"></th>\n   <th scope=\"col\">В контентном скрипте</th>\n   <th scope=\"col\">В фоновом скрипте</th>\n  </tr>\n  <tr>\n   <th scope=\"row\">Отправка сообщения</th>\n   <td><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime#sendmessage()\">browser.runtime.sendMessage()</a></code></td>\n   <td><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/Tabs/sendMessage\">browser.tabs.sendMessage()</a></code></td>\n  </tr>\n  <tr>\n   <th scope=\"row\">Получение сообщения</th>\n   <td><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\">browser.runtime.onMessage</a></code></td>\n   <td><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime#onmessage\">browser.runtime.onMessage</a></code></td>\n  </tr>\n </thead>\n</table>\n\n<p>Давайте обновим наш пример, чтобы посмотреть, как послать сообщение из фонового скрипта.</p>\n\n<p>Изменим \"background.js\" :</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>browser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Съесть эту страницу\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">messageTab</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tabs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">replacement</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Message from the extension!\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">info<span class=\"token punctuation\">,</span> tab</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>menuItemId <span class=\"token operator\">==</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">file</span><span class=\"token operator\">:</span> <span class=\"token string\">\"page-eater.js\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> querying <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">active</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">currentWindow</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    querying<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>messageTab<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>Теперь, после внедрения \"page-eater.js\", мы используем <code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query\">tabs.query()</a></code>, чтобы получить текущую открытую вкладку и используем <code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage\">tabs.sendMessage()</a></code>, для отправки сообщения контентному скрипту, загруженному на этой вкладке. Сообщение несёт полезную нагрузку <code>{replacement: \"Message from the extension!\"}</code>.</p>\n\n<p>Далее, обновим \"page-eater.js\":</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">eatPage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> sender<span class=\"token punctuation\">,</span> sendResponse</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> header <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  header<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>replacement<span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>eatPage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n\n<p>Теперь, вместо простого \"поедания страницы\", контентный скрипт ждёт сообщение, используя <code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\">runtime.onMessage</a></code>. Когда сообщение получено, контентный скрипт выполняет в точности такой же код, как и а примере ранее, за исключением того, что заменяющий текст берётся из <code>request.replacement</code>.</p>\n\n<p>Если мы хотим отправить сообщение наоборот, из контентного скрипта в фоновый, настройка будет обратной данному примеру, за исключением того, что мы будем использовать <code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage\">runtime.sendMessage()</a></code> в контентном скрипте.</p>\n\n<div class=\"note notecard\" id=\"sect6\">\n<p>Все эти примеры внедряют JavaScript; вы можете программно внедрять стилевые таблицы CSS используя функцию <code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/insertCSS\">tabs.insertCSS()</a></code>.</p>\n</div>"}},{"type":"prose","value":{"id":"узнать_больше","title":"Узнать больше","isH3":false,"content":"<ul>\n <li>Руководство по <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n <li>Ключ манифеста<code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></code></li>\n <li>Ключ манифеста<code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></code></li>\n <li><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript\">tabs.executeScript()</a></code></li>\n <li><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/insertCSS\">tabs.insertCSS()</a></code></li>\n <li><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage\">tabs.sendMessage()</a></code></li>\n <li><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage\">runtime.sendMessage()</a></code></li>\n <li><code><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\">runtime.onMessage</a></code></li>\n <li>Примеры использования <code>content_scripts</code>:\n  <ul>\n   <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/borderify\" class=\"external\" rel=\" noopener\">borderify</a></li>\n   <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/notify-link-clicks-i18n\" class=\"external\" rel=\" noopener\">notify-link-clicks-i18n</a></li>\n   <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/page-to-extension-messaging\" class=\"external\" rel=\" noopener\">page-to-extension-messaging</a></li>\n  </ul>\n </li>\n <li>Примеры использования <code>tabs.executeScript()</code>:\n  <ul>\n   <li><a class=\"external external-icon\" href=\"https://github.com/mdn/webextensions-examples/tree/master/beastify\" rel=\" noopener\">beastify</a></li>\n   <li><a class=\"external external-icon\" href=\"https://github.com/mdn/webextensions-examples/tree/master/context-menu-demo\" rel=\" noopener\">context-menu-demo</a></li>\n  </ul>\n </li>\n</ul>"}}],"toc":[{"text":"Модификация страниц, подпадающих под URL-шаблон","id":"модификация_страниц_подпадающих_под_url-шаблон"},{"text":"Программная модификация страницы","id":"программная_модификация_страницы"},{"text":"Обмен сообщениями","id":"обмен_сообщениями"},{"text":"Узнать больше","id":"узнать_больше"}],"summary":"Одним из наиболее распространённых вариантов использования расширений является внесение изменение в веб-страницу. К примеру, расширение может изменить стиль, применённый к странице, скрыть существующие или вставить на страницу дополнительные DOM-узлы.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Modify a web page","locale":"en-US","native":"English (US)"},{"title":"Modify a web page","locale":"es","native":"Español"},{"title":"Modifier une page web","locale":"fr","native":"Français"},{"title":"ウェブページを変更する","locale":"ja","native":"日本語"},{"title":"修改 web 页面","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"ru/mozilla/add-ons/webextensions/modify_a_web_page","github_url":"https://github.com/mdn/translated-content/blob/main/files/ru/mozilla/add-ons/webextensions/modify_a_web_page/index.html","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.html"},"parents":[{"uri":"/ru/docs/Mozilla","title":"Mozilla"},{"uri":"/ru/docs/Mozilla/Add-ons","title":"Дополнения"},{"uri":"/ru/docs/Mozilla/Add-ons/WebExtensions","title":"Расширения браузера"},{"uri":"/ru/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page","title":"Модификация веб страницы"}],"pageTitle":"Модификация веб страницы - Mozilla | MDN","noIndexing":false}}