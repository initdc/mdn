{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Compiler un nouveau module C/C++ en WebAssembly","mdn_url":"/fr/docs/WebAssembly/C_to_wasm","locale":"fr","native":"Français","sidebarHTML":"\n\n<ol>\n  <li data-default-state=\"open\"><a href=\"/fr/docs/WebAssembly\"><strong>WebAssembly home page</strong></a>\n  </li><li class=\"toggle\">\n    <details open=\"\">\n      <summary>Tutorials</summary>\n      <ol>\n        <li><a href=\"/fr/docs/WebAssembly/Concepts\">WebAssembly concepts</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/C_to_wasm\">Compiling from C/C++ to WebAssembly</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/Rust_to_wasm\">Compiling from Rust to WebAssembly</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/Using_the_JavaScript_API\">Using the WebAssembly JavaScript API</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/Understanding_the_text_format\">Understanding WebAssembly text format</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/Text_format_to_wasm\">Converting WebAssembly text format to wasm</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/Loading_and_running\">Loading and running WebAssembly code</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/Caching_modules\">Caching compiled WebAssembly modules</a></li>\n        <li><a href=\"/fr/docs/WebAssembly/Exported_functions\">Exported WebAssembly functions</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Object reference</summary>\n      <ol>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface\"><code>WebAssembly</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/Module\"><code>WebAssembly.Module</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/Global\"><code>WebAssembly.Global</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/Instance\"><code>WebAssembly.Instance</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/Memory\"><code>WebAssembly.Memory</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/Table\"><code>WebAssembly.Table</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/CompileError\"><code>WebAssembly.CompileError</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/LinkError\"><code>WebAssembly.LinkError</code></a></li>\n        <li><a href=\"/fr/docs/WebAssembly/JavaScript_interface/RuntimeError\"><code>WebAssembly.RuntimeError</code></a></li>\n      </ol>\n    </details>\n  </li>\n</ol>\n\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Quand vous avez écrit un module de code dans un langage comme le C/C++, vous pouvez ensuite le compiler en WebAssembly en utilisant un outil comme <a href=\"/fr/docs/Mozilla/Projects/Emscripten\" class=\"page-not-created\" title=\"This is a link to an unwritten page\">Emscripten</a>. Regardons comment cela fonctionne.</p>"}},{"type":"prose","value":{"id":"mise_en_place_de_lenvironnement_emscripten","title":"Mise en place de l'environnement Emscripten","isH3":false,"content":"<p>D'abord, mettons en place l'environnement requis pour le développement.</p>"}},{"type":"prose","value":{"id":"prérequis","title":"Prérequis","isH3":true,"content":"<p>Recuperer le SDK de Emscripten en utilisant les instructions suivantes: <a href=\"https://kripken.github.io/emscripten-site/docs/getting_started/downloads.html\" class=\"external\" rel=\" noopener\">https://kripken.github.io/emscripten-site/docs/getting_started/downloads.html</a></p>"}},{"type":"prose","value":{"id":"compiler_un_exemple","title":"Compiler un exemple","isH3":false,"content":"<p>Une fois l'environnement mis en place, regardons comment l'utiliser pour compiler un exemple en C via Emscripten. Il existe un certain nombre d'options disponibles quand on compile avec Emscripten, mais nous allons couvrir seulement les deux principaux scénarios:</p>\n<ul>\n  <li>Compiler vers du wasm et créer du HTML pour exécuter notre code plus toute la \"glue\" Javascript nécessaire à l'exécution du wasm dans l'environnement Web.</li>\n  <li>Compiler vers du wasm et juste créer le Javascript.</li>\n</ul>\n<p>Nous verrons les deux par la suite.</p>"}},{"type":"prose","value":{"id":"créer_le_document_html_et_la_glue_javascript","title":"Créer le document HTML et la \"glue\" JavaScript","isH3":true,"content":"<p>C'est le cas le plus simple que nous allons voir, pour lequel vous utiliserez Emscripten pour générer tout ce dont vous avez besoin pour exécuter votre code en WebAssembly dans le navigateur.</p>\n<ol>\n  <li>D'abord nous avons besoin d'un exemple à compiler. Prenez une copie du simple programme C suivant et sauvez-le dans un fichier nommé <code>hello.c</code> dans un nouveau répertoire de votre disque dur:\n    <div class=\"code-example\"><pre class=\"brush: cpp notranslate\"><code><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n  </li>\n  <li>Maintenant, en utilisant la fenêtre terminal qui vous a servi pour entrer dans l'environnement du compilateur Emscripten, naviguez jusqu'au répertoire dans lequel se trouve votre fichier <code>hello.c</code> et exécutez la commande suivante :\n    <div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>emcc hello.c -s <span class=\"token assign-left variable\">WASM</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> -o hello.html\n</code></pre></div>\n  </li>\n</ol>\n<p>Les options passées avec la commande sont les suivantes :</p>\n<ul>\n  <li><code>-s WASM=1</code> — Spécifie que nous voulons du wasm en sortie. Si nous ne spécifions pas cela, Emscripten générera juste en sortie du <a href=\"http://asmjs.org/\" class=\"external\" rel=\" noopener\">asm.js</a> comme il le fait par défaut.</li>\n  <li><code>-o hello.html</code> — Spécifie que nous voulons qu'Emscripten génère une page HTML (dont le nom de fichier est spécifié), le module wasm et le code \"glue\" en JavaScript pour une execution dans un contexte web.</li>\n</ul>\n<p>À ce stade votre dossier source devrait contenir :</p>\n<ul>\n  <li>Un fichier de code binaire wasm (<code>hello.wasm</code>)</li>\n  <li>Un fichier JavaScript contenant du code \"glue\" à traduire entre les fonctions natives C, et Java/wasm (<code>hello.js</code>)</li>\n  <li>Un fichier HTML pour charger, compiler et instancier votre code wasm, et l'afficher dans votre navigateur (<code>hello.html</code>)</li>\n</ul>"}},{"type":"prose","value":{"id":"exécuter_votre_exemple","title":"Exécuter votre exemple","isH3":true,"content":"<p>Maintenant, tout ce qui vous reste à faire est de charger le fichier <code>hello.html</code> dans un navigateur qui supporte WebAssembly. Il est activé par défaut dans Firefox 52+, Chrome 57+ et dans la derniere version d'Opera (vous pouvez aussi executer du code wasm dans Firefox 47+ en activant le flag <code>javascript.options.wasm</code> dans <em>about:config</em>, ou dans Chrome (51+) et Opera (38+) en allant dans <em>chrome://flags</em> and en activant le flag <em>Experimental WebAssembly</em>.)</p>\n<p>Si tout a fonctionné comme prévu, vous devriez voir la sortie \"Hello World\" dans la console Emscripten apparaissant dans la page web et dans la console Javascript de votre navigateur. Bravo, vous venez de compiler un programme C en WebAssembly puis d'executer ce programme dans votre navigateur!</p>"}},{"type":"prose","value":{"id":"utiliser_un_template_html_personnalisé","title":"Utiliser un template HTML personnalisé","isH3":true,"content":"<p>Vous souhaiterez parfois utiliser un template HTML personnalisé. Voyons comment faire :</p>\n<ol>\n  <li>Tout d'abord, sauvegarder le code C suivant dans un fichier nommé <code>hello2.c</code>, au sein d'un nouveau dossier (vide) :\n    <div class=\"code-example\"><pre class=\"brush: cpp notranslate\"><code><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n  </li>\n  <li>Cherchez le fichier <code>shell_minimal.html</code> dans le dépôt emsdk. Copiez-le dans un sous-dossier nommé <code>html_template</code> dans votre précédent nouveau dossier.</li>\n  <li>Naviguez maintenant jusqu'au nouveau dossier (toujours dans votre terminal disposant de l'environnement Emscripten), et exécutez la commande suivante :\n    <div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>emcc -o hello2.html hello2.c -O3 -s <span class=\"token assign-left variable\">WASM</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> --shell-file html_template/shell_minimal.html\n</code></pre></div>Les options que nous avons donné sont un peu différentes cette fois :\n    <ul>\n      <li>Nous avons spécifié <code>-o hello2.html</code>, ce qui signifie que le compilateur va générer du code JavaScript \"glue\" ainsi qu'un <code>.html</code>.</li>\n      <li>Nous avons également spécifié <code>--shell-file html_template/shell_minimal.html</code> — cela fournit le chemin vers le template HTML que vous souhaitez utiliser pour créer le HTML qui vous permettra d'exécuter l'exemple.</li>\n    </ul>\n  </li>\n  <li>Maintenant, lançons l'exemple. La commande ci-dessus aura généré hello2.html, qui aura à peu près le même contenu que le template avec un peu de code \"glue\" pour charger le code wasm généré, l'exéuter, etc. Ouvrez-le dans votre navigateur et vous verrez quasiment la même chose qu'avec notre dernier exemple.</li>\n</ol>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note :</strong> Vous pouvez spécifier, comme sortie, juste le fichier JavaScript \"glue\" au lieu de la sortie HTML en specifiant un fichier .js au lieu d'un fichier HTML dans le flag<code>-o</code> . Par exemple: <code>emcc -o hello2.js hello2.c -O3 -s WASM=1</code>. Vous pouevz ensuite votre propre fichier HTML à partir de rien bien que ce soit une approche plus compliquée. Il est généralement plus simple d'utiliser le template HTML fournit.</p>\n  <p>Emscripten necessite une grande variété de code Javascript \"glue\" pour gérer les allocations memoire, les fuites memoires et bien d'autres problèmes.</p>\n</div>"}},{"type":"prose","value":{"id":"appeler_une_fonction_personnalisée_définie_en_c","title":"Appeler une fonction personnalisée définie en C","isH3":true,"content":"<p>Si vous avez une fonction définie dans votre code C et que vous souhaitez l'appeler de Javascript, vous pouvez le faire en utilisant la fonction Emscripten <code>ccall()</code> et la déclaration <code>EMSCRIPTEN_KEEPALIVE</code> (qui ajoute vos fonctions dans la liste des fonctions exportées) . Voir <a href=\"https://kripken.github.io/emscripten-site/docs/getting_started/FAQ.html#why-do-functions-in-my-c-c-source-code-vanish-when-i-compile-to-javascript-and-or-i-get-no-functions-to-process\" class=\"external\" rel=\" noopener\">Why do functions in my C/C++ source code vanish when I compile to JavaScript, and/or I get No functions to process?</a>. Regardons comment cela fonctionne.</p>\n<ol>\n  <li>Pour démarrer, sauvegardez le code suivante dans un fichier nommé <code>hello3.c</code> dans un nouveau répertoire:\n    <div class=\"code-example\"><pre class=\"brush: cpp notranslate\"><code><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;emscripten/emscripten.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">__cplusplus</span></span>\n<span class=\"token keyword\">extern</span> <span class=\"token string\">\"C\"</span> <span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\n<span class=\"token keyword\">void</span> EMSCRIPTEN_KEEPALIVE <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyFunction Called\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">__cplusplus</span></span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n</code></pre></div>By default, Emscripten-generated code always just calls the <code>main()</code> function, and other functions are eliminated as dead code. Putting <code>EMSCRIPTEN_KEEPALIVE</code> before a function name stops this from happening. You also need to import the <code>emscripten.h</code> library to use <code>EMSCRIPTEN_KEEPALIVE</code>.\n    <div class=\"notecard note\" id=\"sect2\">\n      <p><strong>Note :</strong> We are including the <code>#ifdef</code> blocks so that if you are trying to include this in C++ code, the example will still work. Due to C versus C++ name mangling rules, this would otherwise break, but here we are setting it so that it treats it as an external C function if you are using C++.</p>\n    </div>\n  </li>\n  <li>Now add <code>html_template/shell_minimal.html</code> into this new directory too, just for convenience (you'd obviously put this in a central place in your real dev environment).</li>\n  <li>Now let's run the compilation step again. From inside your latest directory (and while inside your Emscripten compiler environment terminal window), compile your C code with the following command. (Note that we need to compile with NO_EXIT_RUNTIME, which is necessary as otherwise when main() exits the runtime would be shut down - necessary for proper C emulation, e.g., atexits are called - and it wouldn't be valid to call compiled code.)\n    <div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>emcc -o hello3.html hello3.c -O3 -s <span class=\"token assign-left variable\">WASM</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> --shell-file html_template/shell_minimal.html -s <span class=\"token assign-left variable\">NO_EXIT_RUNTIME</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>  -s <span class=\"token assign-left variable\">EXTRA_EXPORTED_RUNTIME_METHODS</span><span class=\"token operator\">=</span><span class=\"token string\">'[\"ccall\"]'</span>\n</code></pre></div>\n  </li>\n  <li>If you load the example in your browser again, you'll see the same thing as before!</li>\n  <li>Now we need to run our new <code>myFunction()</code> function from JavaScript. First of all, let's add a <a href=\"/fr/docs/Web/HTML/Element/Button\"><code>&lt;button&gt;</code></a> as shown below, just above the first opening <code>&lt;script type='text/javascript'&gt;</code> tag.\n    <div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mybutton<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Run myFunction<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n  </li>\n  <li>Now add the following code inside the last <a href=\"/fr/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a> element (just above the closing <code>&lt;/script&gt;</code> tag):\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.mybutton'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'check console'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> Module<span class=\"token punctuation\">.</span><span class=\"token function\">ccall</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myFunction'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// name of C function</span>\n                             <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// return type</span>\n                             <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// argument types</span>\n                             <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// arguments</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n  </li>\n</ol>\n<p>This illustrates how <code>ccall()</code> is used to call the exported function.</p>"}},{"type":"prose","value":{"id":"voir_aussi","title":"Voir aussi","isH3":false,"content":"<ul>\n  <li><a href=\"http://emscripten.org/\" class=\"external\" rel=\" noopener\">emscripten.org</a> — pour en apprendre plus sur Emscripten et sa large palette d'options</li>\n  <li><a href=\"https://kripken.github.io/emscripten-site/docs/porting/connecting_cpp_and_javascript/Interacting-with-code.html#calling-compiled-c-functions-from-javascript-using-ccall-cwrap\" class=\"external\" rel=\" noopener\">Appeler des fonctions C compilées depuis JavaScript grâce à ccall/cwrap</a></li>\n  <li><a href=\"https://kripken.github.io/emscripten-site/docs/getting_started/FAQ.html#why-do-functions-in-my-c-c-source-code-vanish-when-i-compile-to-javascript-and-or-i-get-no-functions-to-process\" class=\"external\" rel=\" noopener\">Pourquoi les fonctions dans mon code source C/C++ disparaissent quand je le compile dans JavaScript, et/ou je reçois une erreur \"No functions to process\" ?</a></li>\n  <li><a href=\"https://research.mozilla.org/webassembly/\" class=\"external\" rel=\" noopener\">WebAssembly sur Mozilla Research</a></li>\n</ul>"}}],"toc":[{"text":"Mise en place de l'environnement Emscripten","id":"mise_en_place_de_lenvironnement_emscripten"},{"text":"Compiler un exemple","id":"compiler_un_exemple"},{"text":"Voir aussi","id":"voir_aussi"}],"summary":"Quand vous avez écrit un module de code dans un langage comme le C/C++, vous pouvez ensuite le compiler en WebAssembly en utilisant un outil comme Emscripten. Regardons comment cela fonctionne.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Compiling a New C/C++ Module to WebAssembly","locale":"en-US","native":"English (US)"},{"title":"C/C++ から WebAssembly へのコンパイル","locale":"ja","native":"日本語"},{"title":"C/C++ 모듈을 웹어셈블리로 컴파일하기","locale":"ko","native":"한국어"},{"title":"Компиляция кода C/C++ в WebAssembly","locale":"ru","native":"Русский"},{"title":"编译 C/C++ 为 WebAssembly","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"fr/webassembly/c_to_wasm","github_url":"https://github.com/mdn/translated-content/blob/main/files/fr/webassembly/c_to_wasm/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/fr/docs/WebAssembly","title":"WebAssembly"},{"uri":"/fr/docs/WebAssembly/C_to_wasm","title":"Compiler un nouveau module C/C++ en WebAssembly"}],"pageTitle":"Compiler un nouveau module C/C++ en WebAssembly - WebAssembly | MDN","noIndexing":false}}