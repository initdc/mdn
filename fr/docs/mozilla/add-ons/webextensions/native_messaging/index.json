{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Native messaging","mdn_url":"/fr/docs/Mozilla/Add-ons/WebExtensions/Native_messaging","locale":"fr","native":"Français","sidebarHTML":"\n  <ol>\n    <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions\"><strong>WebExtensions</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Démarrage</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">Que sont les WebExtensions ?</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Votre première WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Votre deuxième WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomie d'une WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Examples\">Exemples de WebExtensions</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/What_next_\">Que faire ensuite ?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Utilisation des API JavaScript</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Scripts de contenu</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Motifs de correspondance (Match patterns)</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Travailler avec les fichiers</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalisation</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Politique de sécurité du contenu</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Message natifs</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Incompatibilités avec Chrome</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Interface Utilisateur</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface\">Introduction</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Bouton de la barre d'outils</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Bouton de la barre d'adresse</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Barres latérales</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Éléments du menu contextuel</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Page d'options</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Pages pour l'extension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Suggestions de la barre d'adresse</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Panneaux d'outils de développement</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Mode d'emploi</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercepter les requêtes HTTP</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modifier une page web</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insérer un contenu externe</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Ajouter un bouton à la barre d'outils</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Mettre en place une page de paramètres</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Travailler avec l'API Tabs</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Travailler avec l'API Bookmarks</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Travailler avec l'API Cookies</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Travailler avec des identités contextuelles</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interagir avec le presse-papier</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Les API JavaScript</summary>\n        <ol><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings\">browserSettings</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browsingData\">browsingData</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/commands\">commands</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/devtools\">devtools</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/dns\">dns</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/events\">events</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/extension\">extension</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes\">extensionTypes</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/identity\">identity</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/management\">management</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notifications</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/omnibox\">omnibox</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/pageAction\">pageAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11\">pkcs11</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/privacy\">privacy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction\">sidebarAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/theme\">theme</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/topSites\">topSites</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/userScripts\">userScripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Clés de manifeste</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introduction</a></li>\n        </ol>\n      <ol><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">author</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides\">chrome_settings_overrides</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides\">chrome_url_overrides</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands\">commands</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page\">devtools_page</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/dictionaries\">dictionaries</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/externally_connectable\">externally_connectable</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito\">incognito</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/offline_enabled\">offline_enabled</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox\">omnibox</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional_permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_page\">options_page</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\">page_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers\">protocol_handlers</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">short_name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action\">sidebar_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/storage\">storage</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme\">theme</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme_experiment\">theme expérimentation</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/user_scripts\">user_scripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name\">version_name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/fr/docs/Mozilla/Add-ons/Contact_us\"><strong>Nous contacter</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Canaux de discussions</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Blog extensions</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Forum extensions</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Native messaging permet à une extension d'échanger des messages avec une application native installée sur l'ordinateur de l'utilisateur. Ceci permet que des applications natives puissent fournir un service à des extensions sans avoir besoin d'être atteignables via internet. Un exemple typique est le gestionnaire de mots de passe : l'application native s'occupe du stockage et du chiffrement des mots de passe et communique avec l'extension afin de remplir les formulaires web. Native messaging permet aussi aux extensions d'accéder à des ressources qui ne sont pas accessibles via les API WebExtension, par exemple le matériel hardware particulier.</p>\n<p>L'application native n'est pas installée ou gérée par le navigateur : elle est installée à l'aide du système d'installation du système d'exploitation sous‐jacent. En plus de l'application native elle‐même, vous devrez fournir un fichier JSON appelé «&nbsp;manifest hôte&nbsp;» (host manifest) ou «&nbsp;manifest d'application&nbsp;» (app manifest) et l'installer dans un emplacement défini sur l'ordinateur de l'utilisateur. Le fichier manifest de l'application décrit comment le navigateur peut se connecter à l'application native.</p>\n<p>L'extension doit demander l'<a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">autorisation</a> «&nbsp;nativeMessaging&nbsp;» dans son fichier manifest.json. À l'inverse, l'application native doit accorder l'autorisation à l'extension en incluant son ID dans le champ «&nbsp;allowed_extensions&nbsp;» (extensions autorisées) du manifest de l'application.</p>\n<p>Par la suite, l'extension pourra échanger des messages en JSON avec l'application native en utilisant une série de fonctions de l'API <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime\"><code>runtime</code></a>. Du côté de l'application native, les messages seront reçus en utilisant l'entrée standard (stdin, standard input) et envoyés en utilisant la sortie standard (stdout, standard output).</p>\n<p>\n  <img src=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging/native-messaging.png\" alt=\"\" width=\"1344\" height=\"1096\" loading=\"lazy\">\n</p>\n<p>Le support de native messaging dans les extensions est généralement compatible avec Chrome, avec deux grandes différences :</p>\n<ul>\n  <li>La liste <code>allowed_extensions</code> du manifest de l'application est un tableau d'ID d'applications, tandis que Chrome liste <code>allowed_origins</code>, sous la forme d'un tableau d'URL \"chrome-extension\".</li>\n  <li>Le manifeste de l'application est stocké dans un emplacement différent <a href=\"https://developer.chrome.com/extensions/nativeMessaging#native-messaging-host-location\" class=\"external\" rel=\" noopener\">comparé à Chrome</a>.</li>\n</ul>\n<p>Il y a un exemple complet (en anglais) dans le répertoire « <a href=\"https://github.com/mdn/webextensions-examples/tree/master/native-messaging\" class=\"external\" rel=\" noopener\">native‐messaging</a> » du dépôt «&nbsp;webextensions‐examples&nbsp;» sur GitHub. La plus grande partie du code de cet article est repris de cet exemple.</p>"}},{"type":"prose","value":{"id":"mise_en_œuvre","title":"Mise en œuvre","isH3":false,"content":""}},{"type":"prose","value":{"id":"le_manifest_de_lextension_extension_manifest","title":"Le manifest de l'extension (Extension manifest)","isH3":true,"content":"<p>Si vous souhaitez que votre extension puisse communiquer avec une application native, alors :</p>\n<ul>\n  <li>Vous devez ajouter la <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a> dans son fichier <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">manifest.json</a>.</li>\n  <li>Vous devriez probablement spécifier explicitement l'id de votre add‐on, en utilisant la clé de manifest des <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">applications</a> ( Parce que le manifest de l'application identifiera le jeu d'extensions qui sont autorisées à se connecter à celle-ci via la liste de leur ID).</li>\n</ul>\n<p>Voici un exemple de fichier «&nbsp;manifest.json&nbsp;» :</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Native messaging example extension\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Native messaging example\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"48\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/message.svg\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"browser_specific_settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"gecko\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ping_pong@example.org\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"strict_min_version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"50.0\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"browser_action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"default_icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/message.svg\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"nativeMessaging\"</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"le_manifest_de_lapplication_app_manifest","title":"Le manifest de l'application (App manifest)","isH3":true,"content":"<p>Le manifest de l'application décrit au navigateur la manière avec laquelle il peut se connecter à l'application native.</p>\n<p>Le fichier manifest de l'application doit être installé avec l'application native. C'est-à-dire que le navigateur lit et valide les fichiers de manifeste des applications mais ne les installe ni ne les gère. Ainsi, le modèle de sécurité pour savoir quand et comment ces fichiers sont installés et mis à jour ressemble beaucoup plus à celui des applications natives que celui des extensions utilisant les API WebExtension.</p>\n<p>Pour plus de détails sur la syntaxe et l'emplacement du manifeste des applications natives, voir <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Native_manifests\">manifest natifs</a>.</p>\n<p>Par exemple, voici un manifeste pour l'application native \"ping_pong\" :</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Example host for native messaging\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/path/to/native-messaging/app/ping_pong.py\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"stdio\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"allowed_extensions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"ping_pong@example.org\"</span> <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Ceci autorise l'application dont l'ID est « ping_pong@example.org » à se connecter, en passant le nom « ping_pong » comme paramètre à la fonction de l'API <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime\"><code>runtime</code></a> concernée. L'application, elle‐même se trouve dans le fichier « /path/to/native‐messaging/app/ping_pong.py ».</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note :</strong> Pour Windows dans l'exemple ci‐dessus, l'application native est un script Python. Il peut être compliqué d'amener Windows à faire fonctionner correctement des scripts Python, une méthode alternative est de fournir un fichier .bat, et de l'indiquer dans le manifest :</p>\n  <div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Example host for native messaging\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"c:\\\\path\\\\to\\\\native-messaging\\\\app\\\\ping_pong_win.bat\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"stdio\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"allowed_extensions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"ping_pong@example.org\"</span> <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n  <p>Le fichier batch invoquera alors le script Python :</p>\n  <div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>@echo off\n\npython -u <span class=\"token string\">\"c:<span class=\"token entity\" title=\"\\\\\">\\\\</span>path<span class=\"token entity\" title=\"\\\\\">\\\\</span>to<span class=\"token entity\" title=\"\\\\\">\\\\</span>native-messaging<span class=\"token entity\" title=\"\\\\\">\\\\</span>app<span class=\"token entity\" title=\"\\\\\">\\\\</span>ping_pong.py\"</span>\n</code></pre></div>\n</div>"}},{"type":"prose","value":{"id":"opérations_déchange_des_messages","title":"Opérations d'échange des messages","isH3":false,"content":"<p>Ayant appliqué la configuration de ci‐dessus, une extension peut échanger des messages JSON avec une application native.</p>"}},{"type":"prose","value":{"id":"du_côté_de_lextension","title":"Du côté de l'extension","isH3":true,"content":"<p>La messagerie native ne peut pas être utilisée directement dans les scripts de contenu ; vous devrez le <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#communicating_with_background_scripts\">faire indirect via des scripts d'arrière plan</a>.</p>\n<p>Il y a deux modèles à utiliser ici : la messagerie basée sur la connexion et la messagerie sans connexion.</p>\n<h4 id=\"messagerie_basée_sur_une_connexion\">Messagerie basée sur une connexion</h4>\n<p>Avec cette manière de faire, vous appelez la fonction <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime/connectNative\"><code>runtime.connectNative()</code></a>, en lui passant comme paramètre le nom de l'application (la valeur de la propriété \"name\" du manifest de l'application). Ceci lance l'application si elle n'est pas encore démarrée et renverra un objet <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime/Port\"><code>runtime.Port</code></a> à l'extension.</p>\n<p>L'application native passe deux arguments lorsqu'elle démarre :</p>\n<ul>\n  <li>le chemin complet du manifest de l'application</li>\n  <li>(nouveau dans Firefox 55) l'ID (tel qu'indiqué dans la clé du manifest.json de <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a>) of the add-on that started it.</li>\n</ul>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note :</strong> Chrome gère différemment les arguments passés :</p>\n  <ul>\n    <li>Sous Linux et Mac, Chrome passe un argument, l'origine de l'extension qui l'a lancé sous la forme : <code>chrome-extension://[extensionID]</code>. Ceci permet à l'application d'identifier l'extension.</li>\n    <li>Sous Windows, Chrome passe deux arguments : le premier est l'origine de l'extension, et le second est une poignée à la fenêtre native Chrome qui a lancé l'application.</li>\n  </ul>\n</div>\n<p>L'aplication continue de fonctionner jusqu'à ce que l'extension invoque <code>Port.disconnect()</code> ou jusqu'à ce que la page connectée soit fermée.</p>\n<p>Pour envoyer des messages en utilisant <code>Port</code>, utilisez sa fonction <code>postMessage()</code>, en passant le message JSON à envoyer. Pour écouter les messages en utilisant <code>Port</code>, ajouter un écouteur (<em>listener</em>) en utilisant sa fonction <code>onMessage.addListener()</code>.</p>\n<p>Voici un exemple de script « <em>background</em> » qui établit une connection avec l'application «&nbsp;ping_pong », qui écoute à l'attente de messages de celle‐ci et qui lui envoie un message « ping&nbsp;» à chaque fois que l'utilisateur clique sur l'action du navigateur (<em>browser action</em>) :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/*\nOn startup, connect to the \"ping_pong\" app.\n*/</span>\n<span class=\"token keyword\">var</span> port <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">connectNative</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\nListen for messages from the app.\n*/</span>\nport<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Received: \"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\nOn a click on the browser action, send the app a message.\n*/</span>\nbrowser<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sending:  ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  port<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"messagerie_sans_connexion\">Messagerie sans connexion</h4>\n<p>Avec cette manière de faire, vous invoquez la fonction <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendNativeMessage\"><code>runtime.sendNativeMessage()</code></a>, en lui passant comme arguments :</p>\n<ul>\n  <li>le nom de l'application,</li>\n  <li>le message JSON à envoyer,</li>\n  <li>et optionnellement un callback.</li>\n</ul>\n<p>Une nouvelle instance de l'application sera créée pour chaque message. L'application native passe deux arguments lorsqu'elle démarre :</p>\n<ul>\n  <li>le chemin complet du manifest de l'application</li>\n  <li>(nouveau dans Firefox 55), l'ID (tel qu'indiqué dans la clé du manifest.json de <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a>) de l'add‐on qui l'a démarré.</li>\n</ul>\n<p>Le premier message envoyé par l'application est traité comme une réponse à l'invocation de la fonction <code>sendNativeMessage()</code>, et sera passé dans le callback.</p>\n<p>Voici l'exemple précédent réécrit en utilisant <code>runtime.sendNativeMessage()</code>:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">onResponse</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Received \"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/*\nOn a click on the browser action, send the app a message.\n*/</span>\nbrowser<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sending:  ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> sending <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">sendNativeMessage</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sending<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>onResponse<span class=\"token punctuation\">,</span> onError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"du_côté_de_lapplication","title":"Du côté de l'application","isH3":true,"content":"<p>Du côté de l'application, vous utilisez l'entrée standard (standard input) pour recevoir les messages, et la sortie standard (standard output) pour les envoyer.</p>\n<p>Chaque message est sérialisé sous forme de JSON, est encodé en UTF‐8 et est précédé d'une valeur 32 bits qui contient la longueur du message dans l'ordre des octets natifs.</p>\n<p>La taille maximum d'un seul message envoyé par l'application est de 1MB. La taille maximum d'un message envoyé vers l'application est de 4GB.</p>\n<p>Voici un exemple écrit en Python. Il écoute les messages de l'extension. Notez que le fichier doit être exécutable sous Linux. Si le message est \"ping\", il répond par un message \"pong\". C'est la version Python 2 :</p>\n<div class=\"code-example\"><pre class=\"brush: python notranslate\"><code><span class=\"token comment\">#!/usr/bin/python -u</span>\n\n<span class=\"token comment\"># Note that running python with the `-u` flag is required on Windows,</span>\n<span class=\"token comment\"># in order to ensure that stdin and stdout are opened in binary, rather</span>\n<span class=\"token comment\"># than text, mode.</span>\n\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> struct\n\n\n<span class=\"token comment\"># Read a message from stdin and decode it.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    raw_length <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> raw_length<span class=\"token punctuation\">:</span>\n        sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    message_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>unpack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> raw_length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    message <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span>message_length<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># Encode a message for transmission, given its content.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">encode_message</span><span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    encoded_content <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span>\n    encoded_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">:</span> encoded_length<span class=\"token punctuation\">,</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">:</span> encoded_content<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\"># Send an encoded message to stdout.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">send_message</span><span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>flush<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    message <span class=\"token operator\">=</span> get_message<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> message <span class=\"token operator\">==</span> <span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">:</span>\n        send_message<span class=\"token punctuation\">(</span>encode_message<span class=\"token punctuation\">(</span><span class=\"token string\">\"pong\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>En Python 3, les données binaires reçues doivent être décodées en une chaîne. Le contenu à renvoyer à l'addon doit être encodé en données binaires à l'aide d'une structure :</p>\n<div class=\"code-example\"><pre class=\"brush: python notranslate\"><code><span class=\"token comment\">#!/usr/bin/python -u</span>\n\n<span class=\"token comment\"># Note that running python with the `-u` flag is required on Windows,</span>\n<span class=\"token comment\"># in order to ensure that stdin and stdout are opened in binary, rather</span>\n<span class=\"token comment\"># than text, mode.</span>\n\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> struct\n\n\n<span class=\"token comment\"># Read a message from stdin and decode it.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    raw_length <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> raw_length<span class=\"token punctuation\">:</span>\n        sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    message_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>unpack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> raw_length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    message <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span>message_length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># Encode a message for transmission, given its content.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">encode_message</span><span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    encoded_content <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span>\n    encoded_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># use struct.pack(\"10s\", bytes), to pack a string of the length of 10 characters</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">:</span> encoded_length<span class=\"token punctuation\">,</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">:</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\"s\"</span><span class=\"token punctuation\">,</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\"># Send an encoded message to stdout.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">send_message</span><span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>flush<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    message <span class=\"token operator\">=</span> get_message<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> message <span class=\"token operator\">==</span> <span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">:</span>\n        send_message<span class=\"token punctuation\">(</span>encode_message<span class=\"token punctuation\">(</span><span class=\"token string\">\"pong\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"fermeture_de_lapplication_native","title":"Fermeture de l'application native","isH3":false,"content":"<p>Si vous vous êtes connecté à l'application native en utilisant <code>runtime.connectNative()</code>, alors elle continuera de fonctionner jusqu'à ce que l'extension appelle <code>Port.disconnect()</code> ou que la page qui s'y est connectée soit fermée. Si vous avez démarré l'application native en utilisant <code>runtime.sendNativeMessage()</code>, alors elle sera fermée après qu'elle aura reçu le message et envoyé une réponse.</p>\n<p>Pour fermer l'application native :</p>\n<ul>\n  <li>Sur les système d'exploitation *.nix comme Linux ou OS X, le navigateur envoie un SIGTERM à l'application native, puis un SIGKILL après que l'application ait eût l'occasion de finir de manière normale. Ces signaux sont propagés à tout sous‐processus sauf pour ceux qui se trouvent dans de nouveaux groupes de processus.</li>\n  <li>Sous windows, le navigateur met le processus de l'application native dans un <a href=\"https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms684161(v=vs.85).aspx\" class=\"external\" rel=\" noopener\">Job object</a> et tue le processus. Si l'application native lance un autre processus et désire qu'il reste ouvert après que l'application native elle même soit fermée alors l'application native doit démarrer un autre processus avec le paramètre <a href=\"https://msdn.microsoft.com/fr/library/windows/desktop/ms684863(v=vs.85).aspx\" class=\"external\" rel=\" noopener\"><code>CREATE_BREAKAWAY_FROM_JOB</code></a>.</li>\n</ul>"}},{"type":"prose","value":{"id":"dépannage","title":"Dépannage","isH3":false,"content":"<p>Si quelque chose se passe mal, vérifier dans la <a href=\"https://extensionworkshop.com/documentation/develop/debugging/#viewing_log_output\" class=\"external\" rel=\" noopener\">console du navigateur</a>. Si l'application native renvoit quelque‐chose vers stderr (strandard error), le navigateur le renverra vers la console du navigateur. Donc si vous avez réussi à lancer l'application native, vous verrez toutes les messages d'erreurs qu'elle émet.</p>\n<p>Si vous n'avez pas réussi à démarrer l'application, vous devriez voir un message d'erreur vous donnant un indice sur le problème.</p>\n<pre class=\"notranslate\">\"No such native application &lt;name&gt;\"\n</pre>\n<ul>\n  <li>Vérifiez que le nom passé comme argument à la fonction <code>runtime.connectNative()</code> correspond au nom dans le manifest de l'application</li>\n  <li>OS X / Linux : vérifiez que le nom du fichier de manifest de l'application est &lt;name&gt;.json.</li>\n  <li>Windows : vérifiez que la clé de registre est dans l'endroit correcte, et que son nom correspond au «&nbsp;name&nbsp;» dans le manifest de l'application.</li>\n  <li>Windows : vérifiez que le chemin donné dans la clé de registre pointe vers le manifest de l'application.\n    <pre class=\"notranslate\">\"Error: Invalid application &lt;name&gt;\"\n</pre>\n  </li>\n  <li>Vérifier que le nom de l'application ne contient pas de caractères invalides.\n    <pre class=\"notranslate\">\"'python' is not recognized as an internal or external command, ...\"\n</pre>\n  </li>\n  <li>Windows : Si votre application est un script écrit en Python, vérifiez que Python est installé et que vous avez un chemin définit pour lui.\n    <pre class=\"notranslate\">\"File at path &lt;path&gt; does not exist, or is not executable\"\n</pre>\n  </li>\n  <li>Si vous voyez ce message, alors le fichier de manifest de l'application a été trouvé.</li>\n  <li>Vérifier que le «&nbsp;chemin&nbsp;» dans le manifest de l'application est correct.</li>\n  <li>Windows : vérifiez que vous avez «&nbsp;échappé&nbsp;» les séparateurs du chemin (\"c:\\\\path\\\\to\\\\file\").</li>\n  <li>Vérifiez que l'application se trouve bien à l'endroit indiqué par la propriété «&nbsp;path&nbsp;» dans le manifest de l'application.</li>\n  <li>Vérifiez que l'application est exécutable.\n    <pre class=\"notranslate\">\"This extension does not have permission to use native application &lt;name&gt;\"\n</pre>\n  </li>\n  <li>Vérifier que le tableau «&nbsp;allowed_extensions&nbsp;» dans le manifest de l'application contient l'ID de l'add‐on.\n    <pre class=\"notranslate\">\"TypeError: browser.runtime.connectNative is not a function\"\n</pre>\n  </li>\n  <li>Vérifiez que l'extension à la permission « nativeMessaging »\n    <pre class=\"notranslate\">\"[object Object] NativeMessaging.jsm:218\"\n</pre>\n  </li>\n  <li>Il y a eu un problème lors du démarrage de l'application.</li>\n</ul>"}},{"type":"prose","value":{"id":"incompatibilités_avec_chrome","title":"Incompatibilités avec Chrome","isH3":false,"content":"<p>Il existe un certain nombre de différences entre les navigateurs qui affectent la messagerie native dans les extensions web, notamment les arguments transmis à l'app native, l'emplacement du fichier manifeste, etc. Ces différences sont abordées dans <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities#native_messaging\">Incompatibilités Chrome &gt; Messagerie native</a>.</p>"}}],"toc":[{"text":"Mise en œuvre","id":"mise_en_œuvre"},{"text":"Opérations d'échange des messages","id":"opérations_déchange_des_messages"},{"text":"Fermeture de l'application native","id":"fermeture_de_lapplication_native"},{"text":"Dépannage","id":"dépannage"},{"text":"Incompatibilités avec Chrome","id":"incompatibilités_avec_chrome"}],"summary":"Native messaging permet à une extension d'échanger des messages avec une application native installée sur l'ordinateur de l'utilisateur. Ceci permet que des applications natives puissent fournir un service à des extensions sans avoir besoin d'être atteignables via internet. Un exemple typique est le gestionnaire de mots de passe : l'application native s'occupe du stockage et du chiffrement des mots de passe et communique avec l'extension afin de remplir les formulaires web. Native messaging permet aussi aux extensions d'accéder à des ressources qui ne sont pas accessibles via les API WebExtension, par exemple le matériel hardware particulier.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Native messaging","locale":"en-US","native":"English (US)"},{"title":"ネイティブメッセージング","locale":"ja","native":"日本語"},{"title":"与本地应用通信","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"fr/mozilla/add-ons/webextensions/native_messaging","github_url":"https://github.com/mdn/translated-content/blob/main/files/fr/mozilla/add-ons/webextensions/native_messaging/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/fr/docs/Mozilla","title":"Mozilla"},{"uri":"/fr/docs/Mozilla/Add-ons","title":"Modules"},{"uri":"/fr/docs/Mozilla/Add-ons/WebExtensions","title":"WebExtensions"},{"uri":"/fr/docs/Mozilla/Add-ons/WebExtensions/Native_messaging","title":"Native messaging"}],"pageTitle":"Native messaging - Mozilla | MDN","noIndexing":false}}