{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Partage d'objets avec des scripts de page","mdn_url":"/fr/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts","locale":"fr","native":"Français","sidebarHTML":"\n  <ol>\n    <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions\"><strong>WebExtensions</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Démarrage</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">Que sont les WebExtensions ?</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Votre première WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Votre deuxième WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomie d'une WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Examples\">Exemples de WebExtensions</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/What_next_\">Que faire ensuite ?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Utilisation des API JavaScript</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Scripts de contenu</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Motifs de correspondance (Match patterns)</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Travailler avec les fichiers</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalisation</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Politique de sécurité du contenu</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Message natifs</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Incompatibilités avec Chrome</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Interface Utilisateur</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface\">Introduction</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Bouton de la barre d'outils</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Bouton de la barre d'adresse</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Barres latérales</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Éléments du menu contextuel</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Page d'options</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Pages pour l'extension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Suggestions de la barre d'adresse</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Panneaux d'outils de développement</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Mode d'emploi</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercepter les requêtes HTTP</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modifier une page web</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insérer un contenu externe</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Ajouter un bouton à la barre d'outils</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Mettre en place une page de paramètres</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Travailler avec l'API Tabs</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Travailler avec l'API Bookmarks</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Travailler avec l'API Cookies</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Travailler avec des identités contextuelles</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interagir avec le presse-papier</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Les API JavaScript</summary>\n        <ol><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings\">browserSettings</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browsingData\">browsingData</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/commands\">commands</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/devtools\">devtools</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/dns\">dns</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/events\">events</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/extension\">extension</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes\">extensionTypes</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/identity\">identity</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/management\">management</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notifications</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/omnibox\">omnibox</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/pageAction\">pageAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11\">pkcs11</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/privacy\">privacy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction\">sidebarAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/theme\">theme</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/topSites\">topSites</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/userScripts\">userScripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Clés de manifeste</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introduction</a></li>\n        </ol>\n      <ol><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">author</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides\">chrome_settings_overrides</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides\">chrome_url_overrides</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands\">commands</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page\">devtools_page</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/dictionaries\">dictionaries</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/externally_connectable\">externally_connectable</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito\">incognito</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/offline_enabled\">offline_enabled</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox\">omnibox</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional_permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_page\">options_page</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\">page_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers\">protocol_handlers</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">short_name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action\">sidebar_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/storage\">storage</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme\">theme</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme_experiment\">theme expérimentation</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/user_scripts\">user_scripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name\">version_name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/fr/docs/Mozilla/Add-ons/Contact_us\"><strong>Nous contacter</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Canaux de discussions</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Blog extensions</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Forum extensions</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note :</strong> Les techniques décrites dans cette section sont uniquement disponibles dans Firefox, et seulement à partir de Firefox 49</p>\n</div>\n<div class=\"notecard warning\" id=\"sect2\">\n  <p><strong>Attention :</strong> En tant que développeur d'extensions, vous devez considérer que les scripts s'exécutant sur des pages Web arbitraires sont des codes hostiles dont le but est de voler les informations personnelles de l'utilisateur, d'endommager leur ordinateur ou de les attaquer d'une autre manière.</p>\n  <p>L'isolation entre les scripts de contenu et les scripts chargés par les pages Web a pour but de rendre plus difficile la tâche des pages Web hostiles.</p>\n  <p>Puisque les techniques décrites dans cette section décompose cet isolement, elles sont intrinsèquement dangereuses et devraient être utilisées avec beaucoup de soin.</p>\n</div>\n<p>Comme les <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#dom_access\">notes du guide de scripts de contenu</a>, les scripts de contenu ne voient pas les modifications apportées au DOM par des scripts chargés par des pages Web.Cela signifie que, par exemple, si une page Web charge une bibliothèque comme jQuery, les scripts de contenu ne pourront pas l'utiliser et devront charger leur propre copie. À l'inverse, les scripts chargés par les pages Web ne peuvent pas voir les modifications apportées par les scripts de contenu.</p>\n<p>Cependant, Firefox fournit des API qui permettent aux scripts de contenu de :</p>\n<ul>\n  <li>accéder aux objets JavaScript créés par les scripts de page</li>\n  <li>exposer leurs propres objets JavaScript aux scripts de pages.</li>\n</ul>"}},{"type":"prose","value":{"id":"vision_xray_dans_firefox","title":"Vision Xray dans Firefox","isH3":false,"content":"<p>Dans Firefox, une partie de l'isolation entre les scripts de contenu et les scripts de pages est implémentée en utilisant une fonction appelée \"Vision Xray\". Lorsqu'un script dans une portée plus privilégiée accède à un objet défini dans une portée moins privilégiée, il ne voit que la \"version native\" de l'objet. Toutes les propriétés <a href=\"/fr/docs/Glossary/Expando\">expando</a> sont invisibles et si des propriétés de l'objet ont été redéfinies, il voit l'implémentation d'origine et non la version redéfinie.</p>\n<p>Le but de cette fonctionnalité est de rendre le script moins privilégié plus difficile à confondre le script plus privilégié en redéfinissant les propriétés natives des objets.</p>\n<p>Par exemple, lorsqu'un script de contenu accède à la <a href=\"/fr/docs/Web/API/Window\">fenêtre</a> de la page, il ne voit aucune propriété ajoutée au script de la page, et si le script de la page a redéfini les propriétés de la fenêtre, le script de contenu verra la version originale .</p>\n<p>Pour l'histoire complète sur la vision Xray, voir les articles sur <a href=\"en-US/docs/Mozilla/Tech/Xray_vision\">Vision Xray</a> et la <a href=\"en-US/docs/Mozilla/Gecko/Script_security\">securité des Scripts</a>.</p>"}},{"type":"prose","value":{"id":"accès_aux_objets_de_script_de_page_à_partir_de_scripts_de_contenu","title":"Accès aux objets de script de page à partir de scripts de contenu","isH3":false,"content":"<p>Dans Firefox, les objets DOM dans les scripts de contenu obtiennent une propriété supplémentaire <code>wrappedJSObject</code>. C'est une version \"déballée\" de l'objet, qui inclut toutes les modifications apportées à cet objet par les scripts de page.</p>\n<p>Prenons un exemple simple. Supposons qu'une page Web charge un script:</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>Le script ajoute une propriété expando à la <code>fenêtre</code> globale :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// main.js</span>\n\n<span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> <span class=\"token string\">\"I'm defined in a page script!\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>La vision Xray signifie que si un script de contenu tente d'accéder à <code>foo</code>, il sera indéfini:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span>\n</code></pre></div>\n<p>Dans Firefox, les scripts de contenu peuvent utiliser <code>window.wrappedJSObject</code> pour voir la propriété expando :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"I'm defined in a page script!\"</span>\n</code></pre></div>\n<p>Notez qu'une fois que vous faites cela, vous ne pouvez plus compter sur les propriétés ou les fonctions de cet objet qui sont, ou font, ce que vous attendez. N'importe lequel d'entre eux, même les setters et les getters, aurait pu être redéfini par un code non fiable.</p>\n<p>Notez également que le déballage est transitif: lorsque vous utilisez <code>wrappedJSObject</code>, toutes les propriétés de l'objet déplié sont elles-mêmes dépliées (et donc peu fiables). C'est donc une bonne pratique, une fois que vous avez l'objet dont vous avez besoin, de le réemballer, ce que vous pouvez faire comme ceci:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">XPCNativeWrapper</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>voir le document <a href=\"/fr/Tech/Xray_vision\" class=\"page-not-created\" title=\"This is a link to an unwritten page\">vision Xray</a> pour plus de détails à ce sujet.</p>"}},{"type":"prose","value":{"id":"partage_dobjets_de_script_de_contenu_avec_des_scripts_de_page","title":"Partage d'objets de script de contenu avec des scripts de page","isH3":false,"content":"<p>Firefox fournit également des API permettant aux scripts de contenu de rendre les objets disponibles pour les scripts de page. Il y a plusieurs approches ici:</p>\n<ul>\n  <li><a href=\"#exportfunction\"><code>exportFunction()</code></a>: exporte une fonction vers des scripts de page</li>\n  <li><a href=\"#cloneinto\"><code>cloneInto()</code></a>: exporte un objet vers des scripts de page.</li>\n  <li>constructeurs du contexte de la page</li>\n</ul>"}},{"type":"prose","value":{"id":"exportfunction","title":"exportFunction","isH3":true,"content":"<p>Étant donné une fonction définie dans le script de contenu, <code>exportFunction()</code> l'exporte vers la portée du script de page, afin que le script de page puisse l'appeler.</p>\n<p>Par exemple, considérons une extension qui a un script d'arrière-plan comme ceci :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/*\nExecute content script in the active tab.\n*/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">loadContentScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">file</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/content_scripts/export.js\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/*\nAdd loadContentScript() as a listener to clicks\non the browser action.\n*/</span>\nbrowser<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>loadContentScript<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\nShow a notification when we get messages from\nthe content script.\n*/</span>\nbrowser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  browser<span class=\"token punctuation\">.</span>notifications<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"basic\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Message from the page\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> message<span class=\"token punctuation\">.</span>content\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Cela fait deux choses :</p>\n<ul>\n  <li>exécuter un script de contenu dans l'onglet en cours, lorsque l'utilisateur clique sur une action du navigateur</li>\n  <li>écouter les messages du script de contenu et afficher une <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notification</a> lorsque le message arrive.</li>\n</ul>\n<p>Le script de contenu ressemble à ceci :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/*\nDefine a function in the content script's scope, then export it\ninto the page script's scope.\n*/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Function call: \"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">exportFunction</span><span class=\"token punctuation\">(</span>notify<span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">defineAs</span><span class=\"token operator\">:</span><span class=\"token string\">'notify'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Cela définit une fonction <code>notify()</code>, qui envoie simplement son argument au script d'arrière-plan. Il exporte ensuite la fonction vers la portée du script de page. Maintenant, le script de la page peut appeler cette fonction:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Message from the page script!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Pour l'histoire complète, voir <a href=\"/fr/Tech/XPCOM/Language_Bindings/Components.utils.exportFunction\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>Components.utils.exportFunction</code></a>.</p>"}},{"type":"prose","value":{"id":"cloneinto","title":"cloneInto","isH3":true,"content":"<p>Étant donné un objet défini dans le script de contenu, cela crée un clone de l'objet dans la portée du script de page, rendant ainsi le clone accessible aux scripts de page. Par défaut, cela utilise <a href=\"/fr/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\">l'agorithme clone structuré</a> pour cloner l'objet, ce qui signifie que les fonctions de l'objet ne sont pas incluses dans le clone. Pour inclure des fonctions, passez l'option <code>cloneFunctions</code>.</p>\n<p>Par exemple, voici un script de contenu qui définit un objet contenant une fonction, puis le clone dans la portée du script de page :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/*\nCreate an object that contains functions in\nthe content script's scope, then clone it\ninto the page script's scope.\n\nBecause the object contains functions,\nthe cloneInto call must include\nthe `cloneFunctions` option.\n*/</span>\n<span class=\"token keyword\">var</span> messenger <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">notify</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Object method call: \"</span> <span class=\"token operator\">+</span> message\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nwindow<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span>messenger <span class=\"token operator\">=</span> <span class=\"token function\">cloneInto</span><span class=\"token punctuation\">(</span>\n  messenger<span class=\"token punctuation\">,</span>\n  window<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">cloneFunctions</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Maintenant les scripts de page vont voir une nouvelle propriété sur la fenêtre, <code>messenger</code>, qui a une fonction <code>notify()</code>:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span>messenger<span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Message from the page script!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Pour l'histoire complète, voir <a href=\"/fr/Tech/XPCOM/Language_Bindings/Components.utils.cloneInto\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>Components.utils.cloneInto</code></a>.</p>"}},{"type":"prose","value":{"id":"constructeurs_du_contexte_de_la_page","title":"Constructeurs du contexte de la page","isH3":true,"content":"<p>Sur l'objet fenêtre de xrayed, des constructeurs immaculés pour certains objets javascript intégrés tels que <code>Object</code>, <code>Function</code> ou <code>Proxy</code> et différentes classe DOM sont disponibles. <code>XMLHttpRequest</code> ne se comporte pas de cette manière, voir la section <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#xhr_and_fetch\">XHR and fetch</a> pour plus de détails. Ils créeront des instances appartenant à la hiérarchie d'objets de la page global, puis retourneront un wrapper xray.</p>\n<p>Puisque les objets créés de cette manière appartiennent déjà à la page et que le script de contenu ne les renvoie pas à la page, il ne nécessitera pas de clonage ou d'exportation supplémentaire.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/* javascript built-ins */</span>\n\n<span class=\"token keyword\">const</span> objA <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> objB <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">window<span class=\"token punctuation\">.</span>Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n  objA <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span>                        <span class=\"token comment\">// true</span>\n  objB <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span>                        <span class=\"token comment\">// false</span>\n  objA <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">window<span class=\"token punctuation\">.</span>Object</span><span class=\"token punctuation\">,</span>                 <span class=\"token comment\">// false</span>\n  objB <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">window<span class=\"token punctuation\">.</span>Object</span><span class=\"token punctuation\">,</span>                 <span class=\"token comment\">// true</span>\n  <span class=\"token string\">'wrappedJSObject'</span> <span class=\"token keyword\">in</span> objB                      <span class=\"token comment\">// true; xrayed</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nobjA<span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">;</span>\nobjB<span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">;</span>                                <span class=\"token comment\">// xray wrappers for plain javascript objects pass through property assignments</span>\nobjB<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> <span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">// unwrapping before assignment does not rely on this special behavior</span>\n\nwindow<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span>objA <span class=\"token operator\">=</span> objA<span class=\"token punctuation\">;</span>\nwindow<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span>objB <span class=\"token operator\">=</span> objB<span class=\"token punctuation\">;</span>              <span class=\"token comment\">// automatically unwraps when passed to page context</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  console.log(objA instanceof Object);           // false\n  console.log(objB instanceof Object);           // true\n\n  console.log(objA.foo);                         // undefined\n  objA.baz = \"baz\";                              // Error: permission denied\n\n  console.log(objB.foo, objB.bar);               // \"foo\", \"bar\"\n  objB.baz = \"baz\";\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* other APIs */</span>\n\n<span class=\"token keyword\">const</span> ev <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Event</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n  ev <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Event</span><span class=\"token punctuation\">,</span>                           <span class=\"token comment\">// true</span>\n  ev <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">window<span class=\"token punctuation\">.</span>Event</span><span class=\"token punctuation\">,</span>                    <span class=\"token comment\">// true; Event constructor is actually inherited from the xrayed window</span>\n  <span class=\"token string\">'wrappedJSObject'</span> <span class=\"token keyword\">in</span> ev                        <span class=\"token comment\">// true; is an xrayed object</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nev<span class=\"token punctuation\">.</span>propA <span class=\"token operator\">=</span> <span class=\"token string\">\"propA\"</span>                                <span class=\"token comment\">// xray wrappers for native objects do not pass through assignments</span>\nev<span class=\"token punctuation\">.</span>propB <span class=\"token operator\">=</span> <span class=\"token string\">\"wrapper\"</span><span class=\"token punctuation\">;</span>                             <span class=\"token comment\">// define property on xray wrapper</span>\nev<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span>propB <span class=\"token operator\">=</span> <span class=\"token string\">\"unwrapped\"</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// define same property on page object</span>\nReflect<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>ev<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">,</span>        <span class=\"token comment\">// privileged reflection can operate on less privileged objects</span>\n  <span class=\"token string\">'propC'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token literal-property property\">get</span><span class=\"token operator\">:</span> <span class=\"token function\">exportFunction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>             <span class=\"token comment\">// getters must be exported like regular functions</span>\n       <span class=\"token keyword\">return</span> <span class=\"token string\">'propC'</span><span class=\"token punctuation\">;</span>\n     <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  document.addEventListener(\"click\", (e) =&gt; {\n    console.log(e instanceof Event, e.propA, e.propB, e.propC);\n  });\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>ev<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true, undefined, \"unwrapped\", \"propC\"</span>\n</code></pre></div>"}}],"toc":[{"text":"Vision Xray dans Firefox","id":"vision_xray_dans_firefox"},{"text":"Accès aux objets de script de page à partir de scripts de contenu","id":"accès_aux_objets_de_script_de_page_à_partir_de_scripts_de_contenu"},{"text":"Partage d'objets de script de contenu avec des scripts de page","id":"partage_dobjets_de_script_de_contenu_avec_des_scripts_de_page"}],"summary":"Comme les notes du guide de scripts de contenu, les scripts de contenu ne voient pas les modifications apportées au DOM par des scripts chargés par des pages Web.Cela signifie que, par exemple, si une page Web charge une bibliothèque comme jQuery, les scripts de contenu ne pourront pas l'utiliser et devront charger leur propre copie. À l'inverse, les scripts chargés par les pages Web ne peuvent pas voir les modifications apportées par les scripts de contenu.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Sharing objects with page scripts","locale":"en-US","native":"English (US)"}],"source":{"folder":"fr/mozilla/add-ons/webextensions/sharing_objects_with_page_scripts","github_url":"https://github.com/mdn/translated-content/blob/main/files/fr/mozilla/add-ons/webextensions/sharing_objects_with_page_scripts/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/fr/docs/Mozilla","title":"Mozilla"},{"uri":"/fr/docs/Mozilla/Add-ons","title":"Modules"},{"uri":"/fr/docs/Mozilla/Add-ons/WebExtensions","title":"WebExtensions"},{"uri":"/fr/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts","title":"Partage d'objets avec des scripts de page"}],"pageTitle":"Partage d'objets avec des scripts de page - Mozilla | MDN","noIndexing":false}}