{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Intercepter les requêtes HTTP","mdn_url":"/fr/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests","locale":"fr","native":"Français","sidebarHTML":"\n  <ol>\n    <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions\"><strong>WebExtensions</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Démarrage</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">Que sont les WebExtensions ?</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Votre première WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Votre deuxième WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomie d'une WebExtension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Examples\">Exemples de WebExtensions</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/What_next_\">Que faire ensuite ?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Utilisation des API JavaScript</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Scripts de contenu</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Motifs de correspondance (Match patterns)</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Travailler avec les fichiers</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalisation</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Politique de sécurité du contenu</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Message natifs</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Incompatibilités avec Chrome</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Interface Utilisateur</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface\">Introduction</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Bouton de la barre d'outils</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Bouton de la barre d'adresse</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Barres latérales</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Éléments du menu contextuel</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Page d'options</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Pages pour l'extension</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Suggestions de la barre d'adresse</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Panneaux d'outils de développement</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Mode d'emploi</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercepter les requêtes HTTP</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modifier une page web</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insérer un contenu externe</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Ajouter un bouton à la barre d'outils</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Mettre en place une page de paramètres</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Travailler avec l'API Tabs</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Travailler avec l'API Bookmarks</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Travailler avec l'API Cookies</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Travailler avec des identités contextuelles</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interagir avec le presse-papier</a></li>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Les API JavaScript</summary>\n        <ol><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings\">browserSettings</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/browsingData\">browsingData</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/commands\">commands</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/devtools\">devtools</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/dns\">dns</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/events\">events</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/extension\">extension</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes\">extensionTypes</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/identity\">identity</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/management\">management</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notifications</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/omnibox\">omnibox</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/pageAction\">pageAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11\">pkcs11</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/privacy\">privacy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction\">sidebarAction</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/theme\">theme</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/topSites\">topSites</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/userScripts\">userScripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Clés de manifeste</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introduction</a></li>\n        </ol>\n      <ol><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">author</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides\">chrome_settings_overrides</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides\">chrome_url_overrides</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands\">commands</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page\">devtools_page</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/dictionaries\">dictionaries</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/externally_connectable\">externally_connectable</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito\">incognito</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/offline_enabled\">offline_enabled</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox\">omnibox</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional_permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_page\">options_page</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\">page_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers\">protocol_handlers</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">short_name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action\">sidebar_action</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/storage\">storage</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme\">theme</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme_experiment\">theme expérimentation</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/user_scripts\">user_scripts</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name\">version_name</a></li><li><a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/fr/docs/Mozilla/Add-ons/Contact_us\"><strong>Nous contacter</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Canaux de discussions</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Blog extensions</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Forum extensions</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Afin d'intercepter les requêtes HTTP, on pourra utiliser l'API <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\"><code>webRequest</code></a>. Cette API permet d'ajouter des gestionnaires d'évènements pour traiter les différentes étapes d'une requête HTTP.</p>\n<p>Avec ces gestionnaires d'évènements, on peut&nbsp;:</p>\n<ul>\n  <li>Accéder aux en-têtes et aux corps des requêtes et des réponses</li>\n  <li>Annuler et rediriger les requêtes</li>\n  <li>Modifier les en-têtes de requête et de réponse</li>\n</ul>\n<p>Dans cet article, nous verrons trois utilisations du module <code>webRequest</code>&nbsp;:</p>\n<ul>\n  <li>Journaliser les URL des requêtes lorsqu'elles sont émises</li>\n  <li>Rediriger les requêtes</li>\n  <li>Modifier les en-têtes de requête</li>\n</ul>"}},{"type":"prose","value":{"id":"journaliser_les_url_des_requêtes","title":"Journaliser les URL des requêtes","isH3":false,"content":"<p>Pour voir comment utiliser <code>webRequest</code> afin de journaliser les requêtes, créez un nouveau répertoire intitulé <code>requests</code>. Dans ce répertoire, créez un fichier nommé <code>manifest.json</code> et éditez-le afin qu'il contienne ce qui suit&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Demo pour webRequests\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webRequest-demo\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"webRequest\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"&lt;all_urls&gt;\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Ensuite, créez <code>background.js</code> et ajoutez-y ceci&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">logURL</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">requestDetails</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Chargement de : \"</span> <span class=\"token operator\">+</span> requestDetails<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>webRequest<span class=\"token punctuation\">.</span>onBeforeRequest<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>\n  logURL<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">urls</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;all_urls&gt;\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  On utilise ici <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/onBeforeRequest\"><code>onBeforeRequest</code></a> pour appeler la fonction <code>logURL()</code> juste avant que la requête soit émise. La fonction <code>logURL()</code> récupère l'URL de la requête à partir de l'objet représentant l'évènement et l'affiche dans la console du navigateur.\n  Le <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">motif de correspondance</a> <code>{urls: [\"&lt;all_urls&gt;\"]}</code> indique qu'on souhaite intercepter les requêtes HTTP pour toutes les URL.\n</p>\n<p>Pour tester cette extension&nbsp;:</p>\n<ul>\n  <li><a href=\"https://extensionworkshop.com/documentation/develop/temporary-installation-in-firefox/\" class=\"external\" rel=\" noopener\">Installez l'extension</a></li>\n  <li>Ouvrez <a href=\"https://firefox-source-docs.mozilla.org/devtools-user/browser_console/\" class=\"external\" rel=\" noopener\">la console du navigateur</a> (vous pouvez utiliser le raccourci clavier <kbd>Ctrl</kbd>+<kbd>Maj</kbd>+<kbd>J</kbd>)</li>\n  <li>\n    Activez l'option <em>Afficher les messages de contenu</em> dans le menu&nbsp;:\n    \n    <img src=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests/browser_console_show_content_messages.png\" alt=\"Menu de la console du navigateur avec l'option Afficher les messages de contenu\" width=\"456\" height=\"340\" loading=\"lazy\">\n  </li>\n  <li>Ouvrez différentes pages web</li>\n</ul>\n<p>\n  Dans la console, vous pourrez voir les URL des ressources pour lesquelles le navigateur émet des requêtes.\n  Dans la capture d'écran qui suit, on voit les URL des requêtes qui ont lieu lors du chargement d'une page Wikipédia&nbsp;:\n</p>\n<p>\n  <img src=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests/browser_console_url_from_extension.png\" alt=\"Menu de la console du navigateur : URL affichées depuis une extension\" width=\"795\" height=\"480\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"rediriger_les_requêtes","title":"Rediriger les requêtes","isH3":false,"content":"<p>Nous allons ici utiliser <code>webRequest</code> pour rediriger des requêtes HTTP. Pour commencer, remplacer le contenu du fichier <code>manifest.json</code> avec ceci&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Demo pour webRequests\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webRequest-demo\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"webRequest\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"webRequestBlocking\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"https://developer.mozilla.org/\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Voici les modifications apportées&nbsp;:</p>\n<ul>\n  <li>La permission <code>webRequestBlocking</code> <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\"><code>permission</code></a> est ajoutée. Elle est nécessaire lorsqu'une extension souhaite modifier une requête.</li>\n  <li>On remplace la permission <code>&lt;all_urls&gt;</code> avec <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#les_permissions_dh%C3%B4te\">une permission d'hôte individuelle</a>. C'est une bonne pratique pour minimiser les permissions nécessaires.</li>\n</ul>\n<p>Ensuite, remplacez le contenu de <code>background.js</code> avec&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> pattern <span class=\"token operator\">=</span> <span class=\"token string\">\"https://developer.mozilla.org/*\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> targetUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension/frog.jpg\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">requestDetails</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Redirection : \"</span> <span class=\"token operator\">+</span> requestDetails<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestDetails<span class=\"token punctuation\">.</span>url <span class=\"token operator\">===</span> targetUrl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">redirectUrl</span><span class=\"token operator\">:</span> targetUrl\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>webRequest<span class=\"token punctuation\">.</span>onBeforeRequest<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>\n  redirect<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">urls</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>pattern<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">types</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span><span class=\"token string\">\"blocking\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Là encore, on utilise le gestionnaire d'évènement <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/onBeforeRequest\"><code>onBeforeRequest</code></a> pour exécuter une fonction juste avant que la requête soit émise. Cette fonction remplace <code>redirectUrl</code> avec l'URL cible indiquée dans la fonction. Ici, il s'agit d'une image de grenouille tirée <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">de notre deuxième tutoriel sur les extensions</a>.</p>\n<p>Cette fois, toutes les requêtes ne sont pas interceptées. L'option <code>{urls:[pattern], types:[\"image\"]}</code> indique qu'on intercepte uniquement les requêtes pour&nbsp;:</p>\n<ul>\n  <li>Les URL sous <code>https://developer.mozilla.org/</code></li>\n  <li><em>Et</em> qui sont des images.</li>\n</ul>\n<p>Voir <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/RequestFilter\"><code>webRequest.RequestFilter</code></a> pour plus d'informations.</p>\n<p>On notera également le passage de l'option <code>\"blocking\"</code>. Celle-ci doit être passée à chaque fois qu'on modifie une requête. Avec cette option, le gestionnaire d'évènement bloque la requête réseau et le navigateur attend que le gestionnaire ait fini son exécution avant de continuer. Voir la documentation sur <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/onBeforeRequest\"><code>onBeforeRequest</code></a> pour plus de détails sur <code>\"blocking\"</code>.</p>\n<p>Pour tester cette extension, ouvrez une page de MDN qui contient des images (par exemple, <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/user_interface\">celle qui liste les éléments d'interface utilisateur d'une extension</a>), <a href=\"https://extensionworkshop.com/documentation/develop/temporary-installation-in-firefox/#reloading_a_temporary_add-on\" class=\"external\" rel=\" noopener\">rechargez l'extension</a>, puis rechargez la page MDN. Vous devriez voir quelque chose comme&nbsp;:</p>\n<p>\n  <img src=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests/beastify_by_redirect.png\" alt=\"Les images sur la page ont été remplacées par une image de grenouille\" width=\"1944\" height=\"1410\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"modifier_les_en-têtes_de_requêtes","title":"Modifier les en-têtes de requêtes","isH3":false,"content":"<p>\n  Dans ce dernier exemple, nous allons utiliser <code>webRequest</code> afin de modifier les en-têtes de requêtes.\n  Dans cet exemple, on change l'en-tête <a href=\"/en-US/docs/Web/HTTP/Headers/User-Agent\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">User-Agent (en-US)</a> afin que le navigateur s'identifie comme Opera 12, uniquement lorsqu'on visite les pages situées sous <code>http://useragentstring.com/</code>.\n</p>\n<p>Modifiez le fichier <code>manifest.json</code> afin d'inclure <code>http://useragentstring.com/</code> comme ceci&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Demo pour webRequests\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webRequest-demo\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"webRequest\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"webRequestBlocking\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"http://useragentstring.com/\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Remplacez le code de <code>background.js</code> avec ce qui suit&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> targetPage <span class=\"token operator\">=</span> <span class=\"token string\">\"http://useragentstring.com/*\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> ua <span class=\"token operator\">=</span> <span class=\"token string\">\"Opera/9.80 (X11; Linux i686; Ubuntu/14.10) Presto/2.12.388 Version/12.16\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">rewriteUserAgentHeader</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span>requestHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">header</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"user-agent\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      header<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> ua<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">requestHeaders</span><span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>requestHeaders<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>webRequest<span class=\"token punctuation\">.</span>onBeforeSendHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>\n  rewriteUserAgentHeader<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">urls</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>targetPage<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span><span class=\"token string\">\"blocking\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"requestHeaders\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>On utilise le gestionnaire d'évènement <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/onBeforeSendHeaders\"><code>onBeforeSendHeaders</code></a> pour exécuter une fonction juste avant que les en-têtes de requêtes soient envoyés.</p>\n<p>Ce gestionnaire est uniquement appelé pour les requêtes dont les URL correspondent au <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">motif</a> <code>targetPage</code>. On notera que <code>\"blocking\"</code> est toujours présent comme option. On voit également l'option <code>\"requestHeaders\"</code>, qui indique que le gestionnaire d'évènement fournira un tableau d'en-têtes de requête à envoyer. Voir <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/onBeforeSendHeaders\"><code>webRequest.onBeforeSendHeaders</code></a> pour plus d'informations sur ces options.</p>\n<p>La fonction exécutée recherche l'en-tête <code>User-Agent</code> dans le tableau des en-têtes de requêtes fournis et remplace sa valeur avec celle de la variable <code>ua</code> puis renvoie le tableau ainsi modifié. Ce sont les en-têtes de ce tableau modifié qui sont envoyés au serveur.</p>\n<p>Pour tester cette extension, ouvrez la page <a href=\"http://useragentstring.com/\" class=\"external\" rel=\" noopener\">http://useragentstring.com</a> et vérifiez que votre navigateur est identifié comme Firefox. Ensuite, rechargez l'extension puis la page <a href=\"http://useragentstring.com/\" class=\"external\" rel=\" noopener\">useragentstring.com</a>, et vous pourrez voir que votre navigateur est désormais identifié comme Opera.</p>\n<p>\n  <img src=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests/modified_request_header.png\" alt=\"useragentstring.com affichant les détails de la chaîne d'agent utilisateur modifiée\" width=\"1920\" height=\"1080\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"voir_aussi","title":"Voir aussi","isH3":false,"content":"<p>Pour en savoir plus sur tout ce qu'il est possible de réaliser avec l'API <code>webRequest</code>, vous pouvez consulter <a href=\"/fr/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">la documentation de référence sur <code>webRequest</code></a>.</p>"}}],"toc":[{"text":"Journaliser les URL des requêtes","id":"journaliser_les_url_des_requêtes"},{"text":"Rediriger les requêtes","id":"rediriger_les_requêtes"},{"text":"Modifier les en-têtes de requêtes","id":"modifier_les_en-têtes_de_requêtes"},{"text":"Voir aussi","id":"voir_aussi"}],"summary":"Afin d'intercepter les requêtes HTTP, on pourra utiliser l'API webRequest. Cette API permet d'ajouter des gestionnaires d'évènements pour traiter les différentes étapes d'une requête HTTP.","popularity":0.0002,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Intercept HTTP requests","locale":"en-US","native":"English (US)"},{"title":"Interceptar peticiones HTTP","locale":"es","native":"Español"},{"title":"HTTP リクエストへの介入","locale":"ja","native":"日本語"},{"title":"Interceptando requisições HTTP","locale":"pt-BR","native":"Português (do Brasil)"},{"title":"Intercept HTTP requests","locale":"ru","native":"Русский"},{"title":"拦截 HTTP 请求","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"fr/mozilla/add-ons/webextensions/intercept_http_requests","github_url":"https://github.com/mdn/translated-content/blob/main/files/fr/mozilla/add-ons/webextensions/intercept_http_requests/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/fr/docs/Mozilla","title":"Mozilla"},{"uri":"/fr/docs/Mozilla/Add-ons","title":"Modules"},{"uri":"/fr/docs/Mozilla/Add-ons/WebExtensions","title":"WebExtensions"},{"uri":"/fr/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests","title":"Intercepter les requêtes HTTP"}],"pageTitle":"Intercepter les requêtes HTTP - Mozilla | MDN","noIndexing":false}}