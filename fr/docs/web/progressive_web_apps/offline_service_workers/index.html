<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers - Applications web progressives | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><link rel="alternate" title="Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers" href="https://developer.mozilla.org/fr/docs/Web/Progressive_web_apps/Offline_Service_workers" hreflang="fr"><link rel="alternate" title="ÈÄöËøá Service workers ËÆ© PWA Á¶ªÁ∫øÂ∑•‰Ωú" href="https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps/Offline_Service_workers" hreflang="zh"><link rel="alternate" title="Service workerÎ•º ÏÇ¨Ïö©Ìï¥ PWAÎ•º Ïò§ÌîÑÎùºÏù∏ÏóêÏÑú ÎèôÏûëÌïòÍ≤å ÎßåÎì§Í∏∞" href="https://developer.mozilla.org/ko/docs/Web/Progressive_web_apps/Offline_Service_workers" hreflang="ko"><link rel="alternate" title="„Çµ„Éº„Éì„Çπ„ÉØ„Éº„Ç´„Éº„Åß PWA „Çí„Ç™„Éï„É©„Ç§„É≥„ÅßÂãï‰Ωú„Åï„Åõ„Çã" href="https://developer.mozilla.org/ja/docs/Web/Progressive_web_apps/Offline_Service_workers" hreflang="ja"><link rel="alternate" title="Hacer que las PWAs trabajen desconectadas con servicio workers" href="https://developer.mozilla.org/es/docs/Web/Progressive_web_apps/Offline_Service_workers" hreflang="es"><link rel="alternate" title="Making PWAs work offline with Service workers" href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Offline_Service_workers" hreflang="en"><meta name="description" content="Maintenant que nous avons vu √† quoi ressemble l'architecture de js13kPWA et que nous avons configur√© et ex√©cut√© la structure de base, voyons comment sont impl√©ment√©es les fonctionnalit√©s en mode d√©connect√© mettant en oeuvre Service Worker. Dans cet article, nous examinerons comment cela est utilis√© dans notre exemple js13kPWA (voir √©galement le code source). Nous examinerons comment ajouter la fonctionnalit√© mode d√©connect√©."><meta property="og:url" content="https://developer.mozilla.org/fr/docs/Web/Progressive_web_apps/Offline_Service_workers"><meta property="og:title" content="Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers - Applications web progressives | MDN"><meta property="og:description" content="Maintenant que nous avons vu √† quoi ressemble l'architecture de js13kPWA et que nous avons configur√© et ex√©cut√© la structure de base, voyons comment sont impl√©ment√©es les fonctionnalit√©s en mode d√©connect√© mettant en oeuvre Service Worker. Dans cet article, nous examinerons comment cela est utilis√© dans notre exemple js13kPWA (voir √©galement le code source). Nous examinerons comment ajouter la fonctionnalit√© mode d√©connect√©."><meta property="og:locale" content="fr"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/fr/docs/Web/Progressive_web_apps/Offline_Service_workers"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/fr/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/fr/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/fr/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/fr/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/fr/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> üåê</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> üåê</a></li></ul></li></ul></nav><div class="header-search"><form action="/fr/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/fr/docs/Web"><span property="name">Technologies web pour d√©veloppeurs</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/fr/docs/Web/Progressive_web_apps"><span property="name">Applications web progressives</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/fr/docs/Web/Progressive_web_apps/Offline_Service_workers"><span property="name">Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers</span></a><meta property="position" content="3"></li></ol></nav><ul class="language-toggle"><li><a href="#select-language" class="language-icon"><span class="show-desktop">Change language</span></a></li><li><a class="view-in-english" href="/en-US/docs/Web/Progressive_web_apps/Offline_Service_workers"><span class="show-desktop">View in</span> English</a></li></ul></div><div class="localized-content-note notecard inline neutral"><a href="/en-US/docs/MDN/Contribute/Localize#active_locales">Cette page a √©t√© traduite √† partir de l'anglais par la communaut√©. Vous pouvez √©galement contribuer en rejoignant la communaut√© francophone sur MDN Web Docs.</a></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#les_service_workers_expliqu√©s">Les Service workers expliqu√©s</a></li><li><a href="#mode_offline_first">Mode "offline first"</a></li><li><a href="#progressive_dans_pwa">"Progressive" dans PWA</a></li><li><a href="#service_workers_dans_lapp_js13kpwa">Service workers dans l'app js13kPWA</a></li><li><a href="#mises_√†_jour">Mises √† jour</a></li><li><a href="#vider_le_cache">Vider le cache</a></li><li><a href="#autres_cas_dusage">Autres cas d'usage</a></li><li><a href="#r√©sum√©">R√©sum√©</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="fr"><h1>Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers</h1><div><ul class="prev-next">
    <li><a class="button minimal only-in-en-us" href="/en-US/docs/Web/Progressive_web_apps/App_structure" title="Currently only available in English (US)"> Pr√©c√©dent  (en-US)</a></li>
    <li><a class="button minimal" href="/fr/docs/Web/Progressive_web_apps"> Aper√ßu&nbsp;: Progressive</a></li>
    <li><a class="button minimal only-in-en-us" href="/en-US/docs/Web/Progressive_web_apps/Installable_PWAs" title="Currently only available in English (US)"> Suivant   (en-US)</a></li>
</ul>
<p>Maintenant que nous avons vu √† quoi ressemble l'architecture de js13kPWA et que nous avons configur√© et ex√©cut√© la structure de base, voyons comment sont impl√©ment√©es les fonctionnalit√©s en mode d√©connect√© mettant en oeuvre Service Worker. Dans cet article, nous examinerons comment cela est utilis√© dans notre <a href="https://mdn.github.io/pwa-examples/js13kpwa/" class="external" rel=" noopener">exemple js13kPWA</a> (<a href="https://github.com/mdn/pwa-examples/tree/master/js13kpwa" class="external" rel=" noopener">voir √©galement le code source</a>). Nous examinerons comment ajouter la fonctionnalit√© mode d√©connect√©.</p></div><h2 id="les_service_workers_expliqu√©s"><a href="#les_service_workers_expliqu√©s" title="Permalink to Les Service workers expliqu√©s">Les Service workers expliqu√©s</a></h2><div><p>Les Service Workers sont des proxy virtuels entre le navigateur et le r√©seau. Ils permettent enfin de r√©gler les probl√®mes auxquels les d√©veloppeurs front-end se d√©battent depuis des ann√©es ‚Äî et plus particuli√®rement comment mettre proprement en cache les composants d'un site web et les rendre disponibles quand l'appareil de l'utilisateur est hors connexion.</p>
<p>Ils s'ex√©cutent dans un processus s√©par√© de celui du code JavaScript principal de notre page et n'ont aucun acc√®s √† la structure DOM. Cela introduit une approche diff√©rente de celle de la programmation web traditionnelle ‚Äî l'API est non bloquante et peut √©mettre et recevoir de la communication entre diff√©rents contextes. Vous pouvez donner √† un Service Worker quelque chose √† faire et recevoir le r√©sultat quand il est pr√™t en utilisant une approche bas√©e sur les <a href="/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>.</p>
<p>Ils peuvent faire beaucoup plus que "simplement" offrir des capacit√©s en mode d√©connect√©, comme g√©rer des notifications, ex√©cuter des calculs intensifs dans des processus s√©par√©s, etc. Les Service Workers sont assez puissants car ils peuvent prendre le contr√¥le de requ√™tes r√©seau, les modifier, fournir des r√©ponses personnalis√©es r√©cup√©r√©es du cache ou g√©n√©rer compl√®tement des r√©ponses.</p></div><h3 id="s√©curit√©"><a href="#s√©curit√©" title="Permalink to S√©curit√©">S√©curit√©</a></h3><div><p>Puisqu'ils sont si puissants, les Service Workers ne peuvent √™tre ex√©cut√©s que dans des contextes s√©curis√©s (c'est-√†-dire HTTPS). Si vous voulez tester avant de pousser votre code en production, vous pouvez toujours tester sur le localhost ou configurer les pages GitHub ‚Äî les deux prennent en charge le HTTPS.</p></div><h2 id="mode_offline_first"><a href="#mode_offline_first" title="Permalink to Mode &quot;offline first&quot;">Mode "offline first"</a></h2><div><p>Le mod√®le "offline first ‚Äî ou "cache first" ‚Äî est la strat√©gie la plus populaire pour d√©livrer du contenu √† un utilisateur. Si une ressource est en cache et disponible hors ligne, on la sert avant de tenter de la t√©l√©charger depuis le serveur. Si elle n'est pas d√©j√† en cache, on la t√©l√©charge et on la met en cache pour une utilisation future.</p></div><h2 id="progressive_dans_pwa"><a href="#progressive_dans_pwa" title="Permalink to &quot;Progressive&quot; dans PWA">"Progressive" dans PWA</a></h2><div><p>Lorsqu'implement√©s proprement en tant qu'am√©lioration progressive, les service workers peuvent profiter aux utilisateurs qui ont des navigateurs modernes qui impl√©mentent l'API en offrant une prise en charge du mode d√©connect√©, mais ne casseront rien pour ceux qui utilisent des navigateurs plus anciens.</p></div><h2 id="service_workers_dans_lapp_js13kpwa"><a href="#service_workers_dans_lapp_js13kpwa" title="Permalink to Service workers dans l'app js13kPWA">Service workers dans l'app js13kPWA</a></h2><div><p>Assez de th√©orie ‚Äî voyons un peu de code source !</p></div><h3 id="enregistrer_le_service_worker"><a href="#enregistrer_le_service_worker" title="Permalink to Enregistrer le Service Worker">Enregistrer le Service Worker</a></h3><div><p>Commen√ßons par regarder le code qui enregistre un nouveau Service Worker, dans le fichier app.js:</p>
<p><strong>NOTE</strong> : Nous utilisons la syntaxe des <strong>fonctions fl√®ch√©es</strong> pour l'impl√©mentation du Service Worker</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./pwa-examples/js13kpwa/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Si l'API service worker est prise en charge dans le navigateur, il est enregistr√© pour le site en utilisant la m√©thode <a href="/fr/docs/Web/API/ServiceWorkerContainer/register"><code>ServiceWorkerContainer.register()</code></a>. Son contenu se trouve dans le fichier sw.js et peut √™tre ex√©cut√© une fois que l'enregistrement a r√©ussi. C'est la seule partie de code du Service Worker qui se trouve dans le fichier app.js. Tout le reste sp√©cifique au Service Worker se trouve dans le fichier sw.js .</p></div><h3 id="le_cycle_de_vie_dun_service_worker"><a href="#le_cycle_de_vie_dun_service_worker" title="Permalink to Le cycle de vie d'un Service Worker">Le cycle de vie d'un Service Worker</a></h3><div><p>Une fois que l'enregistrement a √©t√© r√©alis√©, le fichier sw.js est automatiquement t√©l√©charg√©, puis install√©, et finalement activ√©.</p>
<h4 id="installation">Installation</h4>
<p>L'API nous permet d'ajouter des intercepteurs d'√©v√©nements ou <em>event listeners</em> pour les √©v√©nements clef qui nous int√©ressent ‚Äî le premier est l'√©v√©nement <code>install</code>:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Service Worker] Installation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Dans le listener <code>install</code>, nous pouvons initialiser le cache et y ajouter des fichiers pour une utilisation hors connexion. Notre app js13kPWA fait exactement √ßa.</p>
<p>D'abord, une variable pour enregistrer le nom du cache est cr√©√©e, les fichiers de l'app shell sont list√©s dans un tableau.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> cacheName <span class="token operator">=</span> <span class="token string">'js13kPWA-v1'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> appShellFiles <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'/pwa-examples/js13kpwa/'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/index.html'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/app.js'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/style.css'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/fonts/graduate.eot'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/fonts/graduate.ttf'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/fonts/graduate.woff'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/favicon.ico'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/img/js13kgames.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/img/bg.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-32.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-64.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-96.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-128.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-168.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-192.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-256.png'</span><span class="token punctuation">,</span>
  <span class="token string">'/pwa-examples/js13kpwa/icons/icon-512.png'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Ensuite, les liens vers les images √† charger en m√™me temps que le contenu du fichier data/games.js sont g√©n√©r√©s dans un second tableau. Puis les deux tableaux sont fusionn√©s en utilisant la fonction <a href="/fr/docs/Web/JavaScript/Reference/Global_Objects/Array/concat"><code>Array.prototype.concat()</code></a>.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> gamesImages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>games<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gamesImages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'data/img/'</span><span class="token operator">+</span>games<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>slug<span class="token operator">+</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> contentToCache <span class="token operator">=</span> appShellFiles<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>gamesImages<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Ensuite, nous pouvons g√©rer l'√©v√©nement <code>install</code> lui-m√™me:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Service Worker] Installation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Service Worker] Mise en cache globale: app shell et contenu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contentToCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Deux choses ici n√©cessitent une explication : ce que <a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/ExtendableEvent/waitUntil"><code>ExtendableEvent.waitUntil</code> <small>(en-US)</small></a> fait et ce qu'est l'objet <a href="/fr/docs/Web/API/caches" title="caches"><code>caches</code></a>.</p>
<p>Le service worker ne s'installe pas tant que le code de <code>waitUntil</code> n'est pas ex√©cut√©. Il renvoie une promesse ‚Äî Cette approche est n√©cessaire car l'installation peut prendre du temps, donc nous devons attendre qu'elle soit termin√©e.</p>
<p><code>caches</code> est un objet <a href="/fr/docs/Web/API/CacheStorage"><code>CacheStorage</code></a> sp√©cial accessible dans la port√©e du Service Worker et qui permet d'enregistrer les donn√©es ‚Äî l'enregistrement dans le <a href="/fr/docs/Web/API/Web_Storage_API">web storage</a> ne fonctionnera pas, parce que le web storage fonctionne de fa√ßon synchrone. Avec les Service Workers, nous utilisons l'API Cache √† la place. Ici, nous ouvrons un cache sous un nom donn√©, puis nous lui ajoutons tous les fichiers que notre app utilise, de telle sorte qu'ils soient disponibles la prochaine fois qu'il sera charg√© (identifi√© par l'URL de la requ√™te).</p>
<p>Vous avez remarqu√© que nous n'avons pas mis en cache le fichier <code>game.js</code>. Ce fichier contient les donn√©es utilis√©es pour afficher les jeux. En r√©alit√©, ces donn√©es seront appel√©es depuis le endpoint d'une API ou depuis une base de donn√©es.Mettre en cache ces donn√©es signifierait qu'elles ne seraient mises √† jour que p√©riodiquement quand il y' a une connexion au r√©seau. Nous n'irons pas plus loin sur ce sujet, pour en savoir plus&nbsp;: <a href="/en-US/docs/Web/API/Web_Periodic_Background_Synchronization_API" class="only-in-en-us" title="Currently only available in English (US)">Web_Periodic_Background_Synchronization_API (en-US)</a> .</p>
<h4 id="activation">Activation</h4>
<p>Il y a √©galement un √©v√©nement <code>activate</code> qui est utilis√© de la m√™me fa√ßon que <code>install</code>. Cet √©v√©nement est habituellement utilis√© pour supprimer tout fichier qui n'est plus n√©cessaire et nettoyer derri√®re l'app en g√©n√©ral. Nous n'avons pas besoin de faire √ßa dans notre app, donc nous l'omettrons.</p></div><h3 id="r√©pondre_aux_requ√™tes"><a href="#r√©pondre_aux_requ√™tes" title="Permalink to R√©pondre aux requ√™tes">R√©pondre aux requ√™tes</a></h3><div><p>Nous avons √©galement un √©v√©nement <code>fetch</code> √† notre disposition et qui est d√©clench√© √† chaque fois qu'une requ√™te HTTP est √©mise par notre app. Ceci est tr√®s utile car √ßa nous permet d'intercepter des requ√™tes et d'y r√©pondre de fa√ßon personnalis√©e. Voic un exemple d'utilisation simpliste:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Service Worker] Ressource r√©cup√©r√©e '</span><span class="token operator">+</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>La r√©ponse peut √™tre ce que nous voulons: le fichier demand√©, sa copie mise en cache ou un bout de code JavaScript qui fera quelque chose de particulier ‚Äî les possibilit√©s sont infinies.</p>
<p>Dans notre app d'exemple, nous servons le contenu √† partir du cache plut√¥t qu'√† partir du r√©seau tant que la ressource se trouve effectivement dans le cache. Nous faisons ceci que l'app soit en mode connect√© ou d√©connect√©. Si le fichier n'est pas dans le cache, l'app commence par l'y ajouter avant de le servir:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Service Worker] R√©cup√©ration de la ressource: '</span><span class="token operator">+</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> r <span class="token operator">||</span> <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Service Worker] Mise en cache de la nouvelle ressource: '</span><span class="token operator">+</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Ici, nous r√©pondons √† l'√©v√©nement <code>fetch</code> gr√¢ce √† une fonction qui essaie de trouver la ressource dans le cache et de renvoyer la r√©ponse si elle y est. Si elle n'y est pas, nous utilisons une autre requ√™te de r√©cup√©ration pour aller la chercher via le r√©seau, puis enregistrer la r√©ponse dans le cache de telle sorte qu'elle y soit disponible la prochaine fois qu'elle sera demand√©e.</p>
<p>La m√©thode <a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/FetchEvent/respondWith"><code>FetchEvent.respondWith</code> <small>(en-US)</small></a> prend le contr√¥le ‚Äî c'est la partie qui agit en tant que serveur proxy entre l'application et le r√©seau. Ceci nous permet de r√©pondre √† chacune des requ√™tes avec la r√©ponse que nous voulons: celle pr√©par√©e par le Service Worker, celle r√©cup√©r√©e dans le cache, modifi√©e si n√©cessaire.</p>
<p>√ßa y est ! Notre application met en cache ses ressources lors de l'installation et les sert en les r√©cup√©rant dans le cache, si bien qu'elle fonctionne m√™me si l'utilisateur n'a pas de connexion. Elle met √©galement en cache les contenus d√®s qu'il y en a de nouveaux d'ajout√©s.</p></div><h2 id="mises_√†_jour"><a href="#mises_√†_jour" title="Permalink to Mises √† jour">Mises √† jour</a></h2><div><p>Il reste un point √† couvrir: comment mettre √† jour un Service Worker quand une nouvelle version de l'application contenant de nouveaux √©l√©ments est disponible ? Le num√©ro de version dans le nom du cache est la clef de l'√©nigme:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> cacheName <span class="token operator">=</span> <span class="token string">'js13kPWA-v1'</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Quand ceci est mis √† jour en v2, nous pouvons alors ajouter tous nos fichiers (en incluant nos nouveaux fichiers) dans un nouveau cache:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>contentToCache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/pwa-examples/js13kpwa/icons/icon-32.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'js13kPWA-v2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>contentToCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Un nouveau service worker est install√© en arri√®re plan et le pr√©c√©dent (v1) fonctionne correctement jusqu'√† ce que plus aucune page ne l'utilise ‚Äî le nouveau Service Worker est alors activ√© et prend √† son compte la gestion de la page √† la place de l'ancien.</p></div><h2 id="vider_le_cache"><a href="#vider_le_cache" title="Permalink to Vider le cache">Vider le cache</a></h2><div><p>Vous vous rappelez l'√©v√©nement <code>activate</code> que nous avons √©lud√© ? Il peut √™tre utilis√© pour vider l'ancien cache dont nous n'avons d√©sormais plus besoin:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keyList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keyList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Ceci nous assure que nous avons seulement les fichiers dont nous avons besoin dans le cache, de telle sorte que nous ne laissions pas de d√©chets derri√®re nous; l'<a href="/fr/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria">espace de cache disponible dans le navigateur est limit√©</a>, c'est donc une bonne id√©e de nettoyer derri√®re nous.</p></div><h2 id="autres_cas_dusage"><a href="#autres_cas_dusage" title="Permalink to Autres cas d'usage">Autres cas d'usage</a></h2><div><p>Servir des fichiers depuis le cache n'est pas la seule fonctionnalit√© que le Service Worker offre. Si vous avez des calculs co√ªteux √† faire, vous pouvez en d√©charger le processus principal et les ex√©cuter dans le worker, puis recevoir les r√©sultats d√®s qu'ils sont disponibles. En g√©rant astucieusement les performances, vous pouvez pr√©-charger des ressources qui ne sont acutellement pas n√©cessaires, mais qui pourront l'√™tre dans un futur proche, si bien que l'application sera plus rapide quand vous aurez effectivement besoin de ces ressources.</p></div><h2 id="r√©sum√©"><a href="#r√©sum√©" title="Permalink to R√©sum√©">R√©sum√©</a></h2><div><p>Dans cet article, nous avons rapidement abord√© la fa√ßon de faire fonctionner notre PWA en mode d√©connect√© gr√¢ce aux service workers. Consultez la documentation si vous voulez en apprendre davantage sur les concepts qui sont derri√®re l'<a href="/fr/docs/Web/API/Service_Worker_API">API Service Worker</a> et comment l'exploiter au mieux.</p>
<p>Les Service Workers sont √©galement utilis√©s pour g√©rer les <a href="/fr/docs/Web/API/Push_API">push notifications</a> ‚Äî ceci sera expliqu√© dans un prochain article.</p><ul class="prev-next">
    <li><a class="button minimal only-in-en-us" href="/en-US/docs/Web/Progressive_web_apps/App_structure" title="Currently only available in English (US)"> Pr√©c√©dent  (en-US)</a></li>
    <li><a class="button minimal" href="/fr/docs/Web/Progressive_web_apps"> Aper√ßu&nbsp;: Progressive</a></li>
    <li><a class="button minimal only-in-en-us" href="/en-US/docs/Web/Progressive_web_apps/Installable_PWAs" title="Currently only available in English (US)"> Suivant   (en-US)</a></li>
</ul></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/translated-content/edit/main/files/fr/web/progressive_web_apps/offline_service_workers/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/blob/main/files/fr/web/progressive_web_apps/offline_service_workers/index.md" title="Folder: fr/web/progressive_web_apps/offline_service_workers (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Ffr%2Fdocs%2FWeb%2FProgressive_web_apps%2FOffline_Service_workers%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60fr%2Fweb%2Fprogressive_web_apps%2Foffline_service_workers%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Ffr%2Fdocs%2FWeb%2FProgressive_web_apps%2FOffline_Service_workers%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fblob%2Fmain%2Ffiles%2Ffr%2Fweb%2Fprogressive_web_apps%2Foffline_service_workers%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fcommit%2F921c46a374ab0a9f4cc809af0370f8c412e54701%0A*+Document+last+modified%3A+2022-10-01T03%3A41%3A16.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22Faire+fonctionner+les+PWAs+en+mode+d%C3%A9connect%C3%A9+gr%C3%A2c%E2%80%A6%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2Cl10n-fr" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-10-01T03:41:16.000Z">Oct 1, 2022</time>,<!-- --> <a href="/fr/docs/Web/Progressive_web_apps/Offline_Service_workers/contributors.txt">by MDN contributors</a></p><form class="language-menu"><fieldset id="select-language"><legend>Change your language</legend><label for="language-selector" class="visually-hidden">Select your preferred language</label> <select id="language-selector" name="language"><option selected="" value="fr">Fran√ßais</option><option value="en-US">English (US)</option><option value="es">Espa√±ol</option><option value="ja">Êó•Êú¨Ë™û</option><option value="ko">ÌïúÍµ≠Ïñ¥</option><option value="zh-CN">‰∏≠Êñá (ÁÆÄ‰Ωì)</option></select> <button type="submit" class="button minimal">Change language</button></fieldset></form></div></aside></main><nav id="sidebar-quicklinks" class="sidebar"><h4>Related Topics</h4><div>
<ol></ol>
</div></nav></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/fr/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/fr/docs/Web">Web Technologies</a></li><li><a href="/fr/docs/Learn">Learn Web Development</a></li><li><a href="/fr/docs/MDN/About">About MDN</a></li><li><a href="/fr/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">¬© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers","mdn_url":"/fr/docs/Web/Progressive_web_apps/Offline_Service_workers","locale":"fr","native":"Fran√ßais","sidebarHTML":"\n<ol></ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<ul class=\"prev-next\">\n    <li><a class=\"button minimal only-in-en-us\" href=\"/en-US/docs/Web/Progressive_web_apps/App_structure\" title=\"Currently only available in English (US)\"> Pr√©c√©dent  (en-US)</a></li>\n    <li><a class=\"button minimal\" href=\"/fr/docs/Web/Progressive_web_apps\"> Aper√ßu&nbsp;: Progressive</a></li>\n    <li><a class=\"button minimal only-in-en-us\" href=\"/en-US/docs/Web/Progressive_web_apps/Installable_PWAs\" title=\"Currently only available in English (US)\"> Suivant   (en-US)</a></li>\n</ul>\n<p>Maintenant que nous avons vu √† quoi ressemble l'architecture de js13kPWA et que nous avons configur√© et ex√©cut√© la structure de base, voyons comment sont impl√©ment√©es les fonctionnalit√©s en mode d√©connect√© mettant en oeuvre Service Worker. Dans cet article, nous examinerons comment cela est utilis√© dans notre <a href=\"https://mdn.github.io/pwa-examples/js13kpwa/\" class=\"external\" rel=\" noopener\">exemple js13kPWA</a> (<a href=\"https://github.com/mdn/pwa-examples/tree/master/js13kpwa\" class=\"external\" rel=\" noopener\">voir √©galement le code source</a>). Nous examinerons comment ajouter la fonctionnalit√© mode d√©connect√©.</p>"}},{"type":"prose","value":{"id":"les_service_workers_expliqu√©s","title":"Les Service workers expliqu√©s","isH3":false,"content":"<p>Les Service Workers sont des proxy virtuels entre le navigateur et le r√©seau. Ils permettent enfin de r√©gler les probl√®mes auxquels les d√©veloppeurs front-end se d√©battent depuis des ann√©es ‚Äî et plus particuli√®rement comment mettre proprement en cache les composants d'un site web et les rendre disponibles quand l'appareil de l'utilisateur est hors connexion.</p>\n<p>Ils s'ex√©cutent dans un processus s√©par√© de celui du code JavaScript principal de notre page et n'ont aucun acc√®s √† la structure DOM. Cela introduit une approche diff√©rente de celle de la programmation web traditionnelle ‚Äî l'API est non bloquante et peut √©mettre et recevoir de la communication entre diff√©rents contextes. Vous pouvez donner √† un Service Worker quelque chose √† faire et recevoir le r√©sultat quand il est pr√™t en utilisant une approche bas√©e sur les <a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise\">Promise</a>.</p>\n<p>Ils peuvent faire beaucoup plus que \"simplement\" offrir des capacit√©s en mode d√©connect√©, comme g√©rer des notifications, ex√©cuter des calculs intensifs dans des processus s√©par√©s, etc. Les Service Workers sont assez puissants car ils peuvent prendre le contr√¥le de requ√™tes r√©seau, les modifier, fournir des r√©ponses personnalis√©es r√©cup√©r√©es du cache ou g√©n√©rer compl√®tement des r√©ponses.</p>"}},{"type":"prose","value":{"id":"s√©curit√©","title":"S√©curit√©","isH3":true,"content":"<p>Puisqu'ils sont si puissants, les Service Workers ne peuvent √™tre ex√©cut√©s que dans des contextes s√©curis√©s (c'est-√†-dire HTTPS). Si vous voulez tester avant de pousser votre code en production, vous pouvez toujours tester sur le localhost ou configurer les pages GitHub ‚Äî les deux prennent en charge le HTTPS.</p>"}},{"type":"prose","value":{"id":"mode_offline_first","title":"Mode \"offline first\"","isH3":false,"content":"<p>Le mod√®le \"offline first ‚Äî ou \"cache first\" ‚Äî est la strat√©gie la plus populaire pour d√©livrer du contenu √† un utilisateur. Si une ressource est en cache et disponible hors ligne, on la sert avant de tenter de la t√©l√©charger depuis le serveur. Si elle n'est pas d√©j√† en cache, on la t√©l√©charge et on la met en cache pour une utilisation future.</p>"}},{"type":"prose","value":{"id":"progressive_dans_pwa","title":"\"Progressive\" dans PWA","isH3":false,"content":"<p>Lorsqu'implement√©s proprement en tant qu'am√©lioration progressive, les service workers peuvent profiter aux utilisateurs qui ont des navigateurs modernes qui impl√©mentent l'API en offrant une prise en charge du mode d√©connect√©, mais ne casseront rien pour ceux qui utilisent des navigateurs plus anciens.</p>"}},{"type":"prose","value":{"id":"service_workers_dans_lapp_js13kpwa","title":"Service workers dans l'app js13kPWA","isH3":false,"content":"<p>Assez de th√©orie ‚Äî voyons un peu de code source !</p>"}},{"type":"prose","value":{"id":"enregistrer_le_service_worker","title":"Enregistrer le Service Worker","isH3":true,"content":"<p>Commen√ßons par regarder le code qui enregistre un nouveau Service Worker, dans le fichier app.js:</p>\n<p><strong>NOTE</strong> : Nous utilisons la syntaxe des <strong>fonctions fl√®ch√©es</strong> pour l'impl√©mentation du Service Worker</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pwa-examples/js13kpwa/sw.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Si l'API service worker est prise en charge dans le navigateur, il est enregistr√© pour le site en utilisant la m√©thode <a href=\"/fr/docs/Web/API/ServiceWorkerContainer/register\"><code>ServiceWorkerContainer.register()</code></a>. Son contenu se trouve dans le fichier sw.js et peut √™tre ex√©cut√© une fois que l'enregistrement a r√©ussi. C'est la seule partie de code du Service Worker qui se trouve dans le fichier app.js. Tout le reste sp√©cifique au Service Worker se trouve dans le fichier sw.js .</p>"}},{"type":"prose","value":{"id":"le_cycle_de_vie_dun_service_worker","title":"Le cycle de vie d'un Service Worker","isH3":true,"content":"<p>Une fois que l'enregistrement a √©t√© r√©alis√©, le fichier sw.js est automatiquement t√©l√©charg√©, puis install√©, et finalement activ√©.</p>\n<h4 id=\"installation\">Installation</h4>\n<p>L'API nous permet d'ajouter des intercepteurs d'√©v√©nements ou <em>event listeners</em> pour les √©v√©nements clef qui nous int√©ressent ‚Äî le premier est l'√©v√©nement <code>install</code>:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] Installation'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Dans le listener <code>install</code>, nous pouvons initialiser le cache et y ajouter des fichiers pour une utilisation hors connexion. Notre app js13kPWA fait exactement √ßa.</p>\n<p>D'abord, une variable pour enregistrer le nom du cache est cr√©√©e, les fichiers de l'app shell sont list√©s dans un tableau.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> cacheName <span class=\"token operator\">=</span> <span class=\"token string\">'js13kPWA-v1'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> appShellFiles <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/index.html'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/app.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/style.css'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/fonts/graduate.eot'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/fonts/graduate.ttf'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/fonts/graduate.woff'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/favicon.ico'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/img/js13kgames.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/img/bg.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-32.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-64.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-96.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-128.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-168.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-192.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-256.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-512.png'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Ensuite, les liens vers les images √† charger en m√™me temps que le contenu du fichier data/games.js sont g√©n√©r√©s dans un second tableau. Puis les deux tableaux sont fusionn√©s en utilisant la fonction <a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Array/concat\"><code>Array.prototype.concat()</code></a>.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> gamesImages <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>games<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  gamesImages<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data/img/'</span><span class=\"token operator\">+</span>games<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>slug<span class=\"token operator\">+</span><span class=\"token string\">'.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> contentToCache <span class=\"token operator\">=</span> appShellFiles<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>gamesImages<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Ensuite, nous pouvons g√©rer l'√©v√©nement <code>install</code> lui-m√™me:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] Installation'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] Mise en cache globale: app shell et contenu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>contentToCache<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Deux choses ici n√©cessitent une explication : ce que <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/ExtendableEvent/waitUntil\"><code>ExtendableEvent.waitUntil</code> <small>(en-US)</small></a> fait et ce qu'est l'objet <a href=\"/fr/docs/Web/API/caches\" title=\"caches\"><code>caches</code></a>.</p>\n<p>Le service worker ne s'installe pas tant que le code de <code>waitUntil</code> n'est pas ex√©cut√©. Il renvoie une promesse ‚Äî Cette approche est n√©cessaire car l'installation peut prendre du temps, donc nous devons attendre qu'elle soit termin√©e.</p>\n<p><code>caches</code> est un objet <a href=\"/fr/docs/Web/API/CacheStorage\"><code>CacheStorage</code></a> sp√©cial accessible dans la port√©e du Service Worker et qui permet d'enregistrer les donn√©es ‚Äî l'enregistrement dans le <a href=\"/fr/docs/Web/API/Web_Storage_API\">web storage</a> ne fonctionnera pas, parce que le web storage fonctionne de fa√ßon synchrone. Avec les Service Workers, nous utilisons l'API Cache √† la place. Ici, nous ouvrons un cache sous un nom donn√©, puis nous lui ajoutons tous les fichiers que notre app utilise, de telle sorte qu'ils soient disponibles la prochaine fois qu'il sera charg√© (identifi√© par l'URL de la requ√™te).</p>\n<p>Vous avez remarqu√© que nous n'avons pas mis en cache le fichier <code>game.js</code>. Ce fichier contient les donn√©es utilis√©es pour afficher les jeux. En r√©alit√©, ces donn√©es seront appel√©es depuis le endpoint d'une API ou depuis une base de donn√©es.Mettre en cache ces donn√©es signifierait qu'elles ne seraient mises √† jour que p√©riodiquement quand il y' a une connexion au r√©seau. Nous n'irons pas plus loin sur ce sujet, pour en savoir plus&nbsp;: <a href=\"/en-US/docs/Web/API/Web_Periodic_Background_Synchronization_API\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">Web_Periodic_Background_Synchronization_API (en-US)</a> .</p>\n<h4 id=\"activation\">Activation</h4>\n<p>Il y a √©galement un √©v√©nement <code>activate</code> qui est utilis√© de la m√™me fa√ßon que <code>install</code>. Cet √©v√©nement est habituellement utilis√© pour supprimer tout fichier qui n'est plus n√©cessaire et nettoyer derri√®re l'app en g√©n√©ral. Nous n'avons pas besoin de faire √ßa dans notre app, donc nous l'omettrons.</p>"}},{"type":"prose","value":{"id":"r√©pondre_aux_requ√™tes","title":"R√©pondre aux requ√™tes","isH3":true,"content":"<p>Nous avons √©galement un √©v√©nement <code>fetch</code> √† notre disposition et qui est d√©clench√© √† chaque fois qu'une requ√™te HTTP est √©mise par notre app. Ceci est tr√®s utile car √ßa nous permet d'intercepter des requ√™tes et d'y r√©pondre de fa√ßon personnalis√©e. Voic un exemple d'utilisation simpliste:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] Ressource r√©cup√©r√©e '</span><span class=\"token operator\">+</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>La r√©ponse peut √™tre ce que nous voulons: le fichier demand√©, sa copie mise en cache ou un bout de code JavaScript qui fera quelque chose de particulier ‚Äî les possibilit√©s sont infinies.</p>\n<p>Dans notre app d'exemple, nous servons le contenu √† partir du cache plut√¥t qu'√† partir du r√©seau tant que la ressource se trouve effectivement dans le cache. Nous faisons ceci que l'app soit en mode connect√© ou d√©connect√©. Si le fichier n'est pas dans le cache, l'app commence par l'y ajouter avant de le servir:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] R√©cup√©ration de la ressource: '</span><span class=\"token operator\">+</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> r <span class=\"token operator\">||</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] Mise en cache de la nouvelle ressource: '</span><span class=\"token operator\">+</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Ici, nous r√©pondons √† l'√©v√©nement <code>fetch</code> gr√¢ce √† une fonction qui essaie de trouver la ressource dans le cache et de renvoyer la r√©ponse si elle y est. Si elle n'y est pas, nous utilisons une autre requ√™te de r√©cup√©ration pour aller la chercher via le r√©seau, puis enregistrer la r√©ponse dans le cache de telle sorte qu'elle y soit disponible la prochaine fois qu'elle sera demand√©e.</p>\n<p>La m√©thode <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/FetchEvent/respondWith\"><code>FetchEvent.respondWith</code> <small>(en-US)</small></a> prend le contr√¥le ‚Äî c'est la partie qui agit en tant que serveur proxy entre l'application et le r√©seau. Ceci nous permet de r√©pondre √† chacune des requ√™tes avec la r√©ponse que nous voulons: celle pr√©par√©e par le Service Worker, celle r√©cup√©r√©e dans le cache, modifi√©e si n√©cessaire.</p>\n<p>√ßa y est ! Notre application met en cache ses ressources lors de l'installation et les sert en les r√©cup√©rant dans le cache, si bien qu'elle fonctionne m√™me si l'utilisateur n'a pas de connexion. Elle met √©galement en cache les contenus d√®s qu'il y en a de nouveaux d'ajout√©s.</p>"}},{"type":"prose","value":{"id":"mises_√†_jour","title":"Mises √† jour","isH3":false,"content":"<p>Il reste un point √† couvrir: comment mettre √† jour un Service Worker quand une nouvelle version de l'application contenant de nouveaux √©l√©ments est disponible ? Le num√©ro de version dans le nom du cache est la clef de l'√©nigme:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> cacheName <span class=\"token operator\">=</span> <span class=\"token string\">'js13kPWA-v1'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Quand ceci est mis √† jour en v2, nous pouvons alors ajouter tous nos fichiers (en incluant nos nouveaux fichiers) dans un nouveau cache:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>contentToCache<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-32.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js13kPWA-v2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>contentToCache<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Un nouveau service worker est install√© en arri√®re plan et le pr√©c√©dent (v1) fonctionne correctement jusqu'√† ce que plus aucune page ne l'utilise ‚Äî le nouveau Service Worker est alors activ√© et prend √† son compte la gestion de la page √† la place de l'ancien.</p>"}},{"type":"prose","value":{"id":"vider_le_cache","title":"Vider le cache","isH3":false,"content":"<p>Vous vous rappelez l'√©v√©nement <code>activate</code> que nous avons √©lud√© ? Il peut √™tre utilis√© pour vider l'ancien cache dont nous n'avons d√©sormais plus besoin:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'activate'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">keyList</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>keyList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Ceci nous assure que nous avons seulement les fichiers dont nous avons besoin dans le cache, de telle sorte que nous ne laissions pas de d√©chets derri√®re nous; l'<a href=\"/fr/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria\">espace de cache disponible dans le navigateur est limit√©</a>, c'est donc une bonne id√©e de nettoyer derri√®re nous.</p>"}},{"type":"prose","value":{"id":"autres_cas_dusage","title":"Autres cas d'usage","isH3":false,"content":"<p>Servir des fichiers depuis le cache n'est pas la seule fonctionnalit√© que le Service Worker offre. Si vous avez des calculs co√ªteux √† faire, vous pouvez en d√©charger le processus principal et les ex√©cuter dans le worker, puis recevoir les r√©sultats d√®s qu'ils sont disponibles. En g√©rant astucieusement les performances, vous pouvez pr√©-charger des ressources qui ne sont acutellement pas n√©cessaires, mais qui pourront l'√™tre dans un futur proche, si bien que l'application sera plus rapide quand vous aurez effectivement besoin de ces ressources.</p>"}},{"type":"prose","value":{"id":"r√©sum√©","title":"R√©sum√©","isH3":false,"content":"<p>Dans cet article, nous avons rapidement abord√© la fa√ßon de faire fonctionner notre PWA en mode d√©connect√© gr√¢ce aux service workers. Consultez la documentation si vous voulez en apprendre davantage sur les concepts qui sont derri√®re l'<a href=\"/fr/docs/Web/API/Service_Worker_API\">API Service Worker</a> et comment l'exploiter au mieux.</p>\n<p>Les Service Workers sont √©galement utilis√©s pour g√©rer les <a href=\"/fr/docs/Web/API/Push_API\">push notifications</a> ‚Äî ceci sera expliqu√© dans un prochain article.</p><ul class=\"prev-next\">\n    <li><a class=\"button minimal only-in-en-us\" href=\"/en-US/docs/Web/Progressive_web_apps/App_structure\" title=\"Currently only available in English (US)\"> Pr√©c√©dent  (en-US)</a></li>\n    <li><a class=\"button minimal\" href=\"/fr/docs/Web/Progressive_web_apps\"> Aper√ßu&nbsp;: Progressive</a></li>\n    <li><a class=\"button minimal only-in-en-us\" href=\"/en-US/docs/Web/Progressive_web_apps/Installable_PWAs\" title=\"Currently only available in English (US)\"> Suivant   (en-US)</a></li>\n</ul>"}}],"toc":[{"text":"Les Service workers expliqu√©s","id":"les_service_workers_expliqu√©s"},{"text":"Mode \"offline first\"","id":"mode_offline_first"},{"text":"\"Progressive\" dans PWA","id":"progressive_dans_pwa"},{"text":"Service workers dans l'app js13kPWA","id":"service_workers_dans_lapp_js13kpwa"},{"text":"Mises √† jour","id":"mises_√†_jour"},{"text":"Vider le cache","id":"vider_le_cache"},{"text":"Autres cas d'usage","id":"autres_cas_dusage"},{"text":"R√©sum√©","id":"r√©sum√©"}],"summary":"Maintenant que nous avons vu √† quoi ressemble l'architecture de js13kPWA et que nous avons configur√© et ex√©cut√© la structure de base, voyons comment sont impl√©ment√©es les fonctionnalit√©s en mode d√©connect√© mettant en oeuvre Service Worker. Dans cet article, nous examinerons comment cela est utilis√© dans notre exemple js13kPWA (voir √©galement le code source). Nous examinerons comment ajouter la fonctionnalit√© mode d√©connect√©.","popularity":0.0003,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Making PWAs work offline with Service workers","locale":"en-US","native":"English (US)"},{"title":"Hacer que las PWAs trabajen desconectadas con servicio workers","locale":"es","native":"Espa√±ol"},{"title":"„Çµ„Éº„Éì„Çπ„ÉØ„Éº„Ç´„Éº„Åß PWA „Çí„Ç™„Éï„É©„Ç§„É≥„ÅßÂãï‰Ωú„Åï„Åõ„Çã","locale":"ja","native":"Êó•Êú¨Ë™û"},{"title":"Service workerÎ•º ÏÇ¨Ïö©Ìï¥ PWAÎ•º Ïò§ÌîÑÎùºÏù∏ÏóêÏÑú ÎèôÏûëÌïòÍ≤å ÎßåÎì§Í∏∞","locale":"ko","native":"ÌïúÍµ≠Ïñ¥"},{"title":"ÈÄöËøá Service workers ËÆ© PWA Á¶ªÁ∫øÂ∑•‰Ωú","locale":"zh-CN","native":"‰∏≠Êñá (ÁÆÄ‰Ωì)"}],"source":{"folder":"fr/web/progressive_web_apps/offline_service_workers","github_url":"https://github.com/mdn/translated-content/blob/main/files/fr/web/progressive_web_apps/offline_service_workers/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/fr/docs/Web","title":"Technologies web pour d√©veloppeurs"},{"uri":"/fr/docs/Web/Progressive_web_apps","title":"Applications web progressives"},{"uri":"/fr/docs/Web/Progressive_web_apps/Offline_Service_workers","title":"Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers"}],"pageTitle":"Faire fonctionner les PWAs en mode d√©connect√© gr√¢ce aux Service workers - Applications web progressives | MDN","noIndexing":false}}</script></body></html>