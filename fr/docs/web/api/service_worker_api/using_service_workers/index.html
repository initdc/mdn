<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>Utiliser les Service Workers - R√©f√©rence Web API | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><link rel="alternate" title="Utiliser les Service Workers" href="https://developer.mozilla.org/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="fr"><link rel="alternate" title="‰ΩøÁî® Service Workers" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="zh"><link rel="alternate" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Service Worker" href="https://developer.mozilla.org/ru/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="ru"><link rel="alternate" title="Usando Service Workers" href="https://developer.mozilla.org/pt-BR/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="pt"><link rel="alternate" title="Using Service Workers" href="https://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="ko"><link rel="alternate" title="„Çµ„Éº„Éì„Çπ„ÉØ„Éº„Ç´„Éº„ÅÆ‰ΩøÁî®" href="https://developer.mozilla.org/ja/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="ja"><link rel="alternate" title="Usar Service Workers" href="https://developer.mozilla.org/es/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="es"><link rel="alternate" title="Using Service Workers" href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers" hreflang="en"><meta name="description" content="Cet article fournit des informations pour bien d√©buter avec les service workers, en pr√©sentant une architecture de base, l'inscription d'un service worker, l'installation et l'activation d'un processus pour un nouveau service worker, la mise √† jour d'un service worker, le contr√¥le du cache et la personnalisation des r√©ponses, le tout dans le contexte d'une application de base disponible en mode d√©connect√©."><meta property="og:url" content="https://developer.mozilla.org/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers"><meta property="og:title" content="Utiliser les Service Workers - R√©f√©rence Web API | MDN"><meta property="og:description" content="Cet article fournit des informations pour bien d√©buter avec les service workers, en pr√©sentant une architecture de base, l'inscription d'un service worker, l'installation et l'activation d'un processus pour un nouveau service worker, la mise √† jour d'un service worker, le contr√¥le du cache et la personnalisation des r√©ponses, le tout dans le contexte d'une application de base disponible en mode d√©connect√©."><meta property="og:locale" content="fr"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/fr/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/fr/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/fr/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/fr/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/fr/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/fr/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> üåê</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> üåê</a></li></ul></li></ul></nav><div class="header-search"><form action="/fr/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/fr/docs/Web"><span property="name">Technologies web pour d√©veloppeurs</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/fr/docs/Web/API"><span property="name">R√©f√©rence Web API</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/fr/docs/Web/API/Service_Worker_API"><span property="name">Service Worker API</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers"><span property="name">Utiliser les Service Workers</span></a><meta property="position" content="4"></li></ol></nav><ul class="language-toggle"><li><a href="#select-language" class="language-icon"><span class="show-desktop">Change language</span></a></li><li><a class="view-in-english" href="/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers"><span class="show-desktop">View in</span> English</a></li></ul></div><div class="localized-content-note notecard inline neutral"><a href="/en-US/docs/MDN/Contribute/Localize#active_locales">Cette page a √©t√© traduite √† partir de l'anglais par la communaut√©. Vous pouvez √©galement contribuer en rejoignant la communaut√© francophone sur MDN Web Docs.</a></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#le_pr√©ambule_aux_service_workers">Le pr√©ambule aux Service Workers</a></li><li><a href="#pr√©paratifs_aux_service_workers">Pr√©paratifs aux Service Workers</a></li><li><a href="#architecture_de_base">Architecture de base</a></li><li><a href="#d√©mo_de_service_workers">D√©mo de service workers</a></li><li><a href="#introduction_aux_service_workers">Introduction aux service workers</a></li><li><a href="#r√©cup√©rer_des_requ√™tes_en_erreur">R√©cup√©rer des requ√™tes en erreur</a></li><li><a href="#suggestion_dam√©lioration_dun_mod√®le_de_code">Suggestion d'am√©lioration d'un mod√®le de code</a></li><li><a href="#mettre_√†_jour_le_service_worker">Mettre √† jour le service worker</a></li><li><a href="#outils_de_d√©veloppement">Outils de d√©veloppement</a></li><li><a href="#voir_aussi">Voir aussi</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="fr"><h1>Utiliser les Service Workers</h1><div><div class="notecard experimental" id="sect1"><p><strong>Experimental:</strong> <strong>Cette fonction est exp√©rimentale</strong><br>Puisque cette fonction est toujours en d√©veloppement dans certains navigateurs, veuillez consulter le <a href="#browser_compatibility">tableau de compatibilit√©</a> pour les pr√©fixes √† utiliser selon les navigateurs.<br>Il convient de noter qu'une fonctionnalit√© exp√©rimentale peut voir sa syntaxe ou son comportement modifi√© dans le futur en fonction des √©volutions de la sp√©cification.</p></div>
<p>Cet article fournit des informations pour bien d√©buter avec les service workers, en pr√©sentant une architecture de base, l'inscription d'un service worker, l'installation et l'activation d'un processus pour un nouveau service worker, la mise √† jour d'un service worker, le contr√¥le du cache et la personnalisation des r√©ponses, le tout dans le contexte d'une application de base disponible en mode d√©connect√©.</p></div><h2 id="le_pr√©ambule_aux_service_workers"><a href="#le_pr√©ambule_aux_service_workers" title="Permalink to Le pr√©ambule aux Service Workers">Le pr√©ambule aux Service Workers</a></h2><div><p>La perte de connexion est un probl√®me majeur auquel sont confront√©s les utilisateurs du web depuis des ann√©es. La meilleure application web au monde produirait un bien mauvais effet si vous ne pouviez pas la t√©l√©charger. Il y a eu de nombreuses tentatives pour mettre en place des technologies susceptibles de r√©soudre ce probl√®me, comme le montre notre page <a href="/fr/docs/Web/Apps/Build/Hors-ligne">Offline</a>, et certains probl√®mes ont √©t√© r√©solus. Mais le probl√®me principal reste l'absence d'un m√©canisme de contr√¥le global pour la mise en cache des ressources et la personnalisation des requ√™tes r√©seau.</p>
<p>La premi√®re tentative‚Äî AppCache ‚Äî semblait √™tre une bonne id√©e parce qu'elle permettait de sp√©cifier les ressources √† mettre en cache de mani√®re tr√®s simple. Cependant, elle faisait beaucoup de suppositions sur la mani√®re de le mettre en place et √©chouait implacablement si votre application ne se pliait pas exactement √† ces suppositions. Lisez <a href="https://alistapart.com/article/application-cache-is-a-douchebag" class="external" rel=" noopener">Application Cache is a Douchebag</a> de Jake Archibald pour plus de d√©tails.</p>
<div class="notecard note" id="sect2">
  <p><strong>Note :</strong> √† partir de Firefox 44, lorsque <a href="/fr/docs/Web/HTML/Utiliser_Application_Cache" class="page-not-created" title="This is a link to an unwritten page">AppCache</a> est utilis√© pour fournir un support d√©connect√© √† une page, un message d'avertissement est alors affich√© dans la console pour signaler aux d√©veloppeurs d'utiliser plut√¥t les <a href="/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers" aria-current="page">Service workers</a> (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1204581" class="external" rel=" noopener">bug&nbsp;1204581</a>.)</p>
</div>
<p>Les service workers devraient finalement r√©soudre ces probl√®mes. La syntaxe du service Worker est plus complexe que celle de l'AppCache, mais en contrepartie vous pouvez utiliser JavaScript pour contr√¥ler les comportements induits par votre cache local avec une granularit√© beaucoup plus fine, vous permettant ainsi d'adresser ce probl√®me et beaucoup d'autres. Avec l'aide d'un Service Worker, vous pouvez facilement configurer une application pour d'abord utiliser des ressources mises en cache, fournissant ainsi une premi√®re exp√©rience par d√©faut m√™me en mode d√©connect√©, avant de r√©cup√©rer davantage de donn√©es depuis le r√©seau (principe connu g√©n√©ralement sous le nom de <a href="http://offlinefirst.org/" class="external" rel=" noopener">Offline First</a>). Cette fa√ßon de faire est d√©j√† disponible avec les applications natives, ce qui est l'une des raisons principales de la pr√©f√©rence accord√©e √† ces applications plut√¥t qu'aux applications web.</p></div><h2 id="pr√©paratifs_aux_service_workers"><a href="#pr√©paratifs_aux_service_workers" title="Permalink to Pr√©paratifs aux Service Workers">Pr√©paratifs aux Service Workers</a></h2><div><p>De nombreuses fonctionnalit√©s des service workers sont d√©sormais disponibles par d√©faut dans les plus r√©centes versions des navigateurs qui les supportent. Cependant, si vous constatez que le code de la d√©mo ne fonctionne pas dans votre version actuelle, vous pourriez avoir besoin d'activer une configuration :</p>
<ul>
  <li><strong>Firefox Nightly</strong> : rendez-vous sur <code>about:config</code> et configurer <code>dom.serviceWorkers.enabled</code> √† true; red√©marrer le navigateur.</li>
  <li><strong>Chrome Canary</strong> : rendez-vous sur <code>chrome://flags</code> et activer <code>experimental-web-platform-features</code>; red√©marrer le navigateur (√† noter que certaines fonctionnalit√©s sont d√©sormais activ√©es par d√©faut dans Chrome.)</li>
  <li><strong>Opera</strong> : rendez-vous sur <code>opera://flags</code> et activer <code>Support for ServiceWorker</code>; red√©marrer le navigateur.</li>
</ul>
<p>Vous aurez aussi besoin de servir votre code via HTTPS ‚Äî les Service Workers sont contraints √† s'ex√©cuter au travers d'HTTPS pour des raisons de s√©curit√©. GitHub est donc un bon endroit pour h√©berger des exp√©rimentations, puisqu'il supporte HTTPS. Et pour faciliter le d√©veloppement en local, le <strong>localhost</strong> est consid√©r√© comme une origine s√©curis√©e.</p></div><h2 id="architecture_de_base"><a href="#architecture_de_base" title="Permalink to Architecture de base">Architecture de base</a></h2><div><p>Avec les service workers, les √©tapes suivantes sont g√©n√©ralement observ√©es pour une configuration simple :</p>
<ol>
  <li>L'URL du service worker URL est r√©cup√©r√©e et enregistr√©e via <a href="/fr/docs/Web/API/ServiceWorkerContainer/register"><code>serviceWorkerContainer.register()</code></a>.</li>
  <li>En cas de succ√®s, le service worker est ex√©cut√© dans un <a href="/fr/docs/Web/API/ServiceWorkerGlobalScope"><code>ServiceWorkerGlobalScope</code></a>; c'est en gros une sorte de contexte de worker sp√©cial, fonctionnant hors du fil d'ex√©cution du script principal, sans acc√®s au DOM.</li>
  <li>Le service worker est d√©sormais pr√™t √† traiter des √©v√©nements.</li>
  <li>Une tentative d'installation du worker a lieu lorsque les pages contr√¥l√©es par le service worker sont acc√©d√©es par la suite. Un √©v√©nement install est toujours le premier envoy√© √† un service worker (√ßa peut √™tre le point de d√©part pour proc√©der au remplissage d'une base IndexedDB, et √† la mise en cache de ressources du site). C'est tout √† fait le m√™me type de proc√©dure que l'installation d'une application native ou Firefox OS ‚Äî en mettant l'ensemble √† disposition pour un usage d√©connect√©.</li>
  <li>Lorsque le gestionnaire <code>oninstall</code> se termine, on consid√®re que le service worker est install√©.</li>
  <li>L'√©tape suivante est l'activation. Lorsque le service worker est install√©, il re√ßoit alors un √©v√©nement activate. L'utilit√© premi√®re de <code>onactivate</code> est de nettoyer les ressources utilis√©es dans les versions pr√©c√©dentes du script du Service Worker.</li>
  <li>Le Service Worker contr√¥le d√©sormais les pages, mais seulement celles ouvertes apr√®s que le <code>register()</code> ait r√©ussi. Ainsi un document √† sa cr√©ation s'accompagne ou non d'un Service Worker et conserve cet √©tat tout au long de sa dur√©e de vie. Ainsi les documents devront √™tre recharg√©s pour r√©ellement √™tre contr√¥l√©s.</li>
</ol>
<p>
  <img src="/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers/sw-lifecycle.png" alt="" width="579" height="867" loading="lazy">
</p></div><h3 id="promesses"><a href="#promesses" title="Permalink to Promesses">Promesses</a></h3><div><p><a href="/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">Les Promesses</a> sont un puissant m√©canisme pour ex√©cuter des op√©rations asynchrones, dont le succ√®s de l'une d√©pend du succ√®s de l'autre. Ce m√©canisme est au coeur du fonctionnement des service workers.</p>
<p>Les promesses peuvent effectuer bien des choses, mais pour le moment il suffit de savoir que si une promesse est retourn√©e, on peut lui attacher un <code>.then()</code> et inclure des fonctions de rappel en cas de succ√®s, d'√©chec, etc., ou bien un <code>.catch()</code> et inclure une fonction de rappel en cas d'√©chec.</p>
<p>Comparons la structure d'une fonction classique de rappel synchrone √† la promesse asynchrone √©quivalente.</p>
<h4 id="sync">sync</h4>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="async">async</h4>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Dans le premier exemple, on doit attendre que l'ex√©cution de <code>myFunction()</code> retourne <code>value</code> avant de poursuivre l'ex√©cution de tout autre code. Dans le second exemple, <code>myFunction()</code> retourne une promesse pour <code>value</code>, ainsi le reste du code peut continuer √† s'ex√©cuter. Lorsque la promesse est r√©solue, le code √† l'int√©rieur de <code>then</code> s'ex√©cutera, de mani√®re asynchrone.</p>
<p>Qu'en est-il sur un exemple concret ‚Äî qu'en est-il si, lors d'un chargement dynamique d'images, on veut √™tre s√ªre qu'elles soient bien charg√©es avant de les afficher ? C'est une d√©marche standard √† adopter, mais parfois probl√©matique. On peut utiliser <code>.onload</code> pour n'afficher l'image qu'apr√®s qu'elle soit charg√©e, mais qu'en est-il des √©v√©nements qui d√©marrent avant qu'on ne commence √† les √©couter ? On pourrait essayer un contournement en utilisant <code>.complete</code>, mais ce n'est toujours pas infaillible, et que faire en cas d'images multiples ? Et, ummm, tout cela reste synchrone, et bloque donc le fil d'ex√©cution principal.</p>
<p>Alternativement, on pourrait faire notre propre promesse pour g√©rer ce genre de cas. (Voir l'exemple du <a href="https://github.com/mdn/promises-test" class="external" rel=" noopener">test de promesses</a> pour le code source, ou <a href="https://mdn.github.io/promises-test/" class="external" rel=" noopener">le voir fonctionner en direct</a>.)</p>
<div class="notecard note" id="sect3">
  <p><strong>Note :</strong> la mise en place d'un v√©ritable service worker utiliserait la mise en cache et onfetch plut√¥t que l'API obsol√®te XMLHttpRequest. Ces fonctionnalit√©s ne sont pas utilis√©es ici afin de se concentrer sur la compr√©hension des promesses.</p>
</div>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">imgLoad</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Image didn\'t load successfully; error code:'</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'There was a network error.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>On retourne une nouvelle promesse en utilisant le constructeur <code>Promise()</code>, qui prend en argument une fonction de rappel avec les param√®tres <code>resolve</code> et <code>reject</code>. Quelque part dans la fonction, on a besoin de d√©finir √† quoi correspond pour la promesse d'√™tre r√©solue avec succ√®s ou bien d'√™tre rejet√©e ‚Äî dans ce cas, retourner un statut 200 OK status ou pas ‚Äî et donc appeler <code>resolve</code> en cas de succ√®s, ou <code>reject</code> en cas d'√©chec. Le reste du contenu de cette fonction correspond √† une utilisation plut√¥t classique d'XHR, et n'appelle pas de commentaires particuliers pour le moment.</p>
<p>Lorsqu'on appelle la fonction <code>imgLoad()</code>, on l'appelle avec l'url de l'image √† charger, comme on pourrait s'en douter, mais le reste du code est un peu diff√©rent :</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">imgLoad</span><span class="token punctuation">(</span><span class="token string">'myLittleVader.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> imageURL <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  myImage<span class="token punctuation">.</span>src <span class="token operator">=</span> imageURL<span class="token punctuation">;</span>
  body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>myImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>A la fin de l'appel de la fonction, on ajoute la m√©thode <code>then()</code> de la promesse, qui contient deux fonctions ‚Äî la premi√®re est ex√©cut√©e lorsque la promesse est r√©solue avec succ√®s, et la seconde est appel√©e lorsque la promesse est rejet√©e. Dans le cas d'une r√©solution, on affiche l'image dans : <code>myImage</code> et on l'ajoute au <code>body</code> (son argument est la valeur <code>request.response</code> contenue dans la m√©thode <code>resolve</code> de la promesse); en cas de rejet, on retourne une erreur dans la console.</p>
<p>Le tout se d√©roule de mani√®re asynchrone.</p>
<div class="notecard note" id="sect4">
  <p>
    <strong>Note :</strong> il est possible d'assembler des appels de promesse, par exemple:
    <code>myPromise().then(success, failure).then(success).catch(failure);</code>
  </p>
</div>
<div class="notecard note" id="sect5">
  <p><strong>Note :</strong> pour en savoir plus sur les promesses, consulter l'excellent article de Jake Archibald <a href="https://www.html5rocks.com/en/tutorials/es6/promises/" class="external" rel=" noopener">JavaScript Promises: there and back again</a>.</p>
</div></div><h2 id="d√©mo_de_service_workers"><a href="#d√©mo_de_service_workers" title="Permalink to D√©mo de service workers">D√©mo de service workers</a></h2><div><p>Pour illustrer quelques principes de base de l'enregistrement et de l'installation d'un service worker, voici une simple d√©mo appel√©e <a href="https://github.com/mdn/sw-test" class="external" rel=" noopener">sw-test</a>, qui pr√©sente juste une galerie d'images Star wars Lego. Elle utilise une fonction pilot√©e par une promesse pour lire les donn√©es d'une image √† partir d'un objet JSON et charger les images en utilisant Ajax, avant d'afficher les images en bas de page. Les choses restent statiques et simples pour le moment. Elle enregistre aussi, installe et active un service worker, et lorsque la sp√©cification est davantage support√©e par les navigateurs, elle met en cache tous les fichiers requis pour un fonctionnement d√©connect√© !</p>
<p>
  <img src="/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers/demo-screenshot.png" alt="" width="480" height="410" loading="lazy">
</p>
<p>Vous pouvez consulter le <a href="https://github.com/mdn/sw-test/" class="external" rel=" noopener">code source sur GitHub</a>, et <a href="https://mdn.github.io/sw-test/" class="external" rel=" noopener">voir l'exemple en direct</a>. Le bout de code qui sera appel√© est la promesse (voir <a href="https://github.com/mdn/sw-test/blob/gh-pages/app.js#L17-L42" class="external" rel=" noopener">app.js lines 17-42</a>), qui est une version modifi√©e du code pr√©sent√© ci-dessus, dans la <a href="https://github.com/mdn/promises-test" class="external" rel=" noopener">d√©mo du test de promesses</a>. Il en diff√®re de la fa√ßon suivante :</p>
<ol>
  <li>Dans l'original, on consid√®re l'URL d'une image √† charger. Dans cette version, on passe un fragment JSON contenant toutes les donn√©es d'une seule image (voir √† quoi il ressemble dans <a href="https://github.com/mdn/sw-test/blob/gh-pages/image-list.js" class="external" rel=" noopener">image-list.js</a>). C'est parce que toutes les donn√©es pour que chaque promesse soit r√©solue doivent √™tre pass√©es avec la promesse, que c'est asynchrone. Si l'on passe juste l'url, et si l'on essaie alors d'acc√©der aux autres √©l√©ments dans le JSON s√©par√©ment lorsqu'on it√®re plus tard avec la boucle <code>for()</code>, cela ne marchera pas, puisque la promesse ne se r√©solvera pas en m√™me temps que les it√©rations sont faites (c'est un m√©canisme synchrone.)</li>
  <li>La promesse est r√©solue en r√©alit√© avec un tableau, puisqu'on veut rendre le blob de l'image charg√©e disponible √† la fonction de r√©solution plus tard dans le code, mais aussi le nom de l'image, les cr√©dits et le texte alternatif (voir <a href="https://github.com/mdn/sw-test/blob/gh-pages/app.js#L26-L29" class="external" rel=" noopener">app.js lines 26-29</a>). Les promesses se r√©solvent seulement avec un seul argument, aussi si l'on souhaite la r√©soudre avec des valeurs multiples, on a besoin d'utiliser un tableau ou un objet.</li>
  <li>Pour acc√©der aux valeurs de la promesse r√©solue, on acc√®de alors √† cette fonction comme on peut s'y attendre (voir <a href="https://github.com/mdn/sw-test/blob/gh-pages/app.js#L55-L59" class="external" rel=" noopener">app.js lines 55-59</a>.) Cela peut sembler un peu √©trange au premier abord, mais c'est la mani√®re dont les promesses fonctionnent.</li>
</ol></div><h2 id="introduction_aux_service_workers"><a href="#introduction_aux_service_workers" title="Permalink to Introduction aux service workers">Introduction aux service workers</a></h2><div><p>Maintenant, c'est au tour des service workers !</p></div><h3 id="enregistrer_un_worker"><a href="#enregistrer_un_worker" title="Permalink to Enregistrer un worker">Enregistrer un worker</a></h3><div><p>Le premier bloc de code dans le fichier JavaScript de l'application ‚Äî <code>app.js</code> ‚Äî se pr√©sente comme suit. C'est le point d'entr√©e pour utiliser des service workers.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw-test/sw.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token string">'/sw-test/'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// registration worked</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Registration succeeded. Scope is '</span> <span class="token operator">+</span> reg<span class="token punctuation">.</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// registration failed</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Registration failed with '</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<ol>
  <li>Le bloc ext√©rieur effectue un test de d√©tection de fonctionnalit√© pour s'assurer que les service workers sont support√©s avant d'essayer d'en enregistrer un.</li>
  <li>Ensuite, la fonction <a href="/fr/docs/Web/API/ServiceWorkerContainer/register"><code>ServiceWorkerContainer.register()</code></a> est utilis√©e pour enregistrer le service worker de ce site, qui est juste un fichier JavaScript pr√©sent au sein de notre application (√† noter qu'il s'agit de l'URL relative du fichier par rapport √† l'origine, et non seulement le fichier JS qui le r√©f√©rence.)</li>
  <li>Le param√®tre <code>scope</code> est optionnel, et peut √™tre utilis√© pour sp√©cifier le sous-ensemble du contenu qui doit √™tre soumis au contr√¥le du service worker. Dans ce cas, on a sp√©cifi√© '<code>/sw-test/'</code>, ce qui signifie tous les contenus pr√©sents sous l'origine de l'application. S'il n'est pas pr√©cis√©, il correspondra de toute fa√ßon par d√©faut √† cette valeur; il a √©t√© explicitement sp√©cifi√© ici √† titre d'illustration.</li>
  <li>La fonction <code>.then()</code> de la promesse est utilis√©e pour cha√Æner un traitement en cas de succ√®s √† la structure de la promesse. Lorsque la promesse est r√©solue avec succ√®s, le code qu'elle contient est ex√©cut√©.</li>
  <li>Finalement, une fonction <code>.catch()</code> est cha√Æn√©e √† la fin, qui s'ex√©cutera si la promesse est rejet√©e.</li>
</ol>
<p>A ce stade un service worker est enregistr√©, qui s'ex√©cute dans le contexte d'un worker, et n'a donc aucun acc√®s au DOM. Le code s'ex√©cute ainsi dans le service worker, ext√©rieurement aux pages normales dont il contr√¥le le chargement.</p>
<p>Un seul service worker peut contr√¥ler de nombreuses pages. Chaque fois qu'une page au sein du scope est charg√©e, le service worker est install√© et op√®re sur la page. Attention, il faut faire un usage prudent des variables globales dans le script du service worker : chaque page ne dispose pas de son propre et unique worker.</p>
<div class="notecard note" id="sect6">
  <p><strong>Note :</strong> un service worker fonctionne comme un serveur proxy, permettant de modifier les requ√™tes et les r√©ponses, de les remplacer par des √©l√©ments de son propre cache, et bien plus.</p>
</div>
<div class="notecard note" id="sect7">
  <p><strong>Note :</strong> une chose importante √† savoir au sujet des service workers est que si la d√©tection de fonctionnalit√© est utilis√©e comme ci-dessus, les navigateurs qui ne supportent pas les service workers peuvent simplement utiliser l'application de la mani√®re normalement attendue. De plus, si vous utilisez AppCache et SW sur une page, les navigateurs qui ne supportent pas SW mais supportent AppCache l'utiliseront, et les navigateurs qui supportent les deux ignoreront AppCache au profit de SW.</p>
</div>
<h4 id="pourquoi_mon_service_worker_√©choue_√†_senregistrer_">Pourquoi mon service worker √©choue √† s'enregistrer ?</h4>
<p>Ce pourrait √™tre pour les raisons suivantes :</p>
<ol>
  <li>L'application ne fonctionne pas au travers d'HTTPS</li>
  <li>Le chemin du fichier du service worker file est syntaxiquement incorrect ‚Äî il a besoin d'√™tre exprim√© relativement √† l'origine, et non pas par rapport au r√©pertoire racine. Dans l'exemple, le worker a comme emplacement <code>https://mdn.github.io/sw-test/sw.js</code>, et la racine de l'application est <code>https://mdn.github.io/sw-test/</code>. Mais la syntaxe du chemin s'√©crit <code>/sw-test/sw.js</code>, <code>et non /sw.js</code>.</li>
  <li>Le service worker consid√©r√© se trouve sur une origine diff√©rente de celle de l'application. Ce qui n'est pas permis.</li>
</ol></div><h3 id="installer_et_activer_remplir_le_cache"><a href="#installer_et_activer_remplir_le_cache" title="Permalink to Installer et activer : remplir le cache">Installer et activer : remplir le cache</a></h3><div><p>Apr√®s l'enregistrement du service worker, le navigateur tente d'installer puis d'activer le service worker sur la page ou le site.</p>
<p>L'√©v√©nement install est d√©clench√© lorsqu'une installation se termine avec succ√®s. L'√©v√©nement install est g√©n√©ralement utilis√© pour remplir le cache local du navigateur avec les ressources n√©cessaires pour faire fonctionner l'application en mode d√©connect√©. A cet effet, la toute nouvelle API de stockage est utilis√©e ‚Äî <a href="/fr/docs/Web/API/Cache"><code>cache</code></a> ‚Äî un espace global au niveau du service worker qui permet de stocker les ressources fournies par les r√©ponses, et index√©es par leurs requ√™tes. Cette API fonctionne d'une mani√®re similaire au cache standard du navigateur, mais le cache demeure sp√©cifique au domaine. Il persiste jusqu'√† ce qu'il en soit d√©cid√© autrement ‚Äî de nouveau, le contr√¥le reste total.</p>
<div class="notecard note" id="sect8">
  <p><strong>Note :</strong> L'API Cache n'est pas support√©e par tous les navigateurs. Pour l'utiliser √† l'heure actuelle, on peut envisager un polyfill comme celui fournit par la <a href="https://github.com/Polymer/topeka/blob/master/sw.js" class="external" rel=" noopener">d√©mo Topeka de Google</a>, ou peut-√™tre stocker les ressources dans <a href="/fr/docs/Web/API/IndexedDB_API">IndexedDB</a>.</p>
</div>
<p>Commen√ßons cette section par l'examen d'un exemple de code ‚Äî c'est le <a href="https://github.com/mdn/sw-test/blob/gh-pages/sw.js#L1-L18" class="external" rel=" noopener">premier bloc pr√©sent dans le service worker</a>:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'v1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string">'/sw-test/'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/index.html'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/style.css'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/app.js'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/image-list.js'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/star-wars-logo.jpg'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/gallery/'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/gallery/bountyHunters.jpg'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/gallery/myLittleVader.jpg'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/gallery/snowTroopers.jpg'</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<ol>
  <li>Un √©couteur d'√©v√©nement <code>install</code> est d'abord ajout√© au service worker (d'o√π le <code>this</code>), puis une m√©thode <a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/ExtendableEvent/waitUntil"><code>ExtendableEvent.waitUntil()</code> <small>(en-US)</small></a> est cha√Æn√©e √† l'√©v√©nement ‚Äî cela garantit que le Service Worker ne s'installera pas tant que le code √† l'int√©rieur de <code>waitUntil()</code> n'a pas √©t√© ex√©cut√© avec succ√®s.</li>
  <li>A l'int√©rieur de <code>waitUntil()</code> la m√©thode <a href="/fr/docs/Web/API/CacheStorage/open"><code>caches.open()</code></a> est utilis√©e pour cr√©er un nouveau cache appel√© <code>v1</code>, ce qui constitue la version 1 du cache de ressources de notre site. Cette fonction retourne une promesse lorsque le cache est cr√©√©; une fois r√©solue, est appel√©e une fonction qui appelle elle-m√™me <code>addAll()</code> sur le cache cr√©√©, avec pour param√®tre un tableau d'URLs relatives √† l'origine correspondant aux ressources √† mettre en cache.</li>
  <li>Si la promesse est rejet√©e, l'installation √©choue, et le worker ne fait rien de plus. Le code peut √™tre alors corrig√© et l'op√©ration retent√©e la prochaine fois que l'enregistrement survient.</li>
  <li>Apr√®s une installation couronn√©e de succ√®s, le service worker est activ√©. Cela ne fait pas une grande diff√©rence la premi√®re fois que le service worker est install√©/activ√©, mais cela fait plus sens lorsque le service worker est mis √† jour (voir la section <a href="#mettre_%C3%A0_jour_le_service_worker">Mettre √† jour le service worker</a> plus bas).</li>
</ol>
<div class="notecard note" id="sect9">
  <p><strong>Note :</strong> <a href="/fr/docs/Web/API/Web_Storage_API">localStorage</a> fonctionne de la m√™me fa√ßon que le cache du service worker, mais de mani√®re synchrone, et il n'est donc pas autoris√© dans les service workers.</p>
</div>
<div class="notecard note" id="sect10">
  <p><strong>Note :</strong> <a href="/fr/docs/Web/API/IndexedDB_API">IndexedDB</a> peut √™tre utilis√© dans un service worker pour le stockage des donn√©s si n√©cessaire.</p>
</div></div><h3 id="r√©ponses_personnalis√©es_aux_requ√™tes"><a href="#r√©ponses_personnalis√©es_aux_requ√™tes" title="Permalink to R√©ponses personnalis√©es aux requ√™tes">R√©ponses personnalis√©es aux requ√™tes</a></h3><div><p>Une fois que les ressources du site sont mises en cache, les service workers doivent savoir quoi faire de ce contenu en cache. L'√©v√©nement <code>fetch</code> permet de g√©rer cela facilement.</p>
<p>Un √©v√©nement <code>fetch</code> se d√©clenche √† chaque fois qu'une ressource contr√¥l√©e par un service worker est retourn√©e, ce qui inclut les documents √† l'int√©rieur du contour sp√©cifi√©, et toute ressource r√©f√©renc√©e dans ces documents (par exemple <code>si index.html</code> effectue une requ√™te vers un autre domaine pour l'insertion d'une image, cela se fait encore au travers de son service worker.)</p>
<p>On peut attacher un √©couteur de l'√©v√©nement <code>fetch</code> au service worker, puis appeler la m√©thode <code>respondWith()</code> sur l'√©v√©nement pour d√©tourner les r√©ponses HTTP et les mettre √† jour en leur jetant un sort particulier.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    <span class="token comment">// la magie op√®re ici</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>On peut d√©j√† simplement r√©pondre avec la ressource en cache dont l'url correspond √† celle de la requ√™te r√©seau, dans chaque cas :</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><code>caches.match(event.request)</code> permet de mettre en correspondance chaque ressource demand√©e sur le r√©seau avec la ressource √©quivalente en cache, si elle se trouve √™tre disponible. La comparaison est effectu√©e via l'url et diverses en-t√™tes, comme habituellement avec des requ√™tes HTTP normales.</p>
<p>Voici quelques autres options disponibles pour que la magie op√®re (voir la <a href="/fr/docs/Web/API/Fetch_API">documentation de l'API Fetch</a> pour plus d'informations sur les objets <a href="/fr/docs/Web/API/Request"><code>Request</code></a> et <a href="/fr/docs/Web/API/Response"><code>Response</code></a>).</p>
<ol>
  <li>Le constructeur <code><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/Response/Response"><code>Response()</code> <small>(en-US)</small></a></code> permet de cr√©er une r√©ponse personnalis√©e. Dans cet exemple, une cha√Æne de caract√®res est simplement retourn√©e :
    <div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Hello from your friendly neighbourhood service worker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
  </li>
  <li>La <code>Response</code> plus complexe ci-dessous montre qu'il est possible de passer optionnellement un ensemble d'en-t√™tes avec la r√©ponse, √©mulant ainsi des en-t√™tes de r√©ponse HTTP standards. Ici, on signale au navigateur quel est le type de contenu de notre r√©ponse artificielle :
    <div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'&lt;p&gt;Hello from your friendly neighbourhood service worker!&lt;/p&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div>
  </li>
  <li>Si une correspondance n'est pas trouv√©e en cache, on peut indiquer simplement au navigateur d'effectuer (<a href="/fr/docs/Web/API/fetch" title="fetch"><code>fetch</code></a>) la requ√™te r√©seau par d√©faut pour cette ressource, afin de r√©cup√©rer cette nouvelle ressource sur le r√©seau si disponible :
    <div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
</code></pre></div>
  </li>
  <li>Si une correspondance n'est pas trouv√©e en cache et que le r√©seau n'est pas disponible, on peut alors faire correspondre la requ√™te avec une page de rechange par d√©faut en guise de r√©ponse en utilisant <a href="/fr/docs/Web/API/CacheStorage/match" title="match()"><code>match()</code></a>, comme suit :
    <div class="code-example"><pre class="brush: js notranslate"><code>caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/fallback.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
  </li>
  <li>On peut r√©cup√©rer beaucoup d'informations √† propos de chaque requ√™te en interrogeant les param√®tres de l'objet <a href="/fr/docs/Web/API/Request"><code>Request</code></a> retourn√© par <a href="/fr/docs/Web/API/FetchEvent"><code>FetchEvent</code></a> :
    <div class="code-example"><pre class="brush: js notranslate"><code>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url
event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>method
event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers
event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
</code></pre></div>
  </li>
</ol></div><h2 id="r√©cup√©rer_des_requ√™tes_en_erreur"><a href="#r√©cup√©rer_des_requ√™tes_en_erreur" title="Permalink to R√©cup√©rer des requ√™tes en erreur">R√©cup√©rer des requ√™tes en erreur</a></h2><div><p>On vient de voir que <code>caches.match(event.request)</code> est important lorsqu'il y a correspondance avec le cache du service worker, mais qu'en est-il des cas o√π rien ne correspond ? Si aucune sorte de gestionnaire d'erreur n'est fourni, la promesse est rejet√©e et une erreur r√©seau est retourn√©e lorsqu'aucune correspondance n'est trouv√©e.</p>
<p>Heureusement, la structure des service workers qui repose sur les promesses rend triviale la gestion des alternatives √† une situation de succ√®s. On pourrait faire ceci :</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Si la promesse est rejet√©e, la fonction <code>catch()</code> retourne √† la place la requ√™te r√©seau par d√©faut, ce qui signifie que si le r√©seau est disponible la ressource sera charg√©e √† partir du serveur.</p>
<p>Plus malin encore, on pourrait non seulement r√©cup√©rer la ressource √† partir du serveur, mais aussi la sauvegarder dans le cache afin que les requ√™tes ult√©rieures pour cette ressource puissent √™tre disponibles aussi en mode d√©connect√©. Cela signifierait que toute image suppl√©mentaire ajout√©e √† la galerie Star Wars pourrait √™tre r√©cup√©r√©e par l'application et mise en cache. Le code suivant illustre ce m√©canisme :</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'v1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Ici on retourne la requ√™te r√©seau par d√©faut au moyen de <code>return fetch(event.request)</code>, qui retourne lui-m√™me une promesse. Lorsque cette promesse est r√©solue, on ex√©cute une fonction qui sollicite le cache en utilisant <code>caches.open('v1')</code>; une promesse est de nouveau retourn√©e. Lorsque cette promesse est r√©solue, <code>cache.put()</code> est utilis√©e pour ajouter la ressource au cache. La ressource est r√©cup√©r√©e √† partir de <code>event.request</code>, et la r√©ponse est alors clon√©e avec <code>response.clone()</code> et ajout√©e au cache. Le clone est plac√© dans le cache, et la r√©ponse originale est retourn√©e au navigateur et d√©livr√©e √† la page qui la requiert.</p>
<p>Pourquoi un clone ? Il se trouve que les flux de requ√™te et de r√©ponse peuvent seulement √™tre lus une fois. Afin de retourner la r√©ponse au navigateur et de la mettre en cache, elle doit √™tre clon√©e. Aussi, l'original est retourn√© au navigateur tandis que le clone est envoy√© dans le cache. Ils sont chacun lus une seule fois.</p>
<p>Le dernier probl√®me qui demeure alors est l'√©chec de la requ√™te au cas o√π elle n'a aucune correspondance dans le cache et que le r√©seau n'est pas disponible. Fournir un document de rechange par d√©faut permet quoiqu'il arrive, √† l'utilisateur de r√©cup√©rer quelque chose :</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'v1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/sw-test/gallery/myLittleVader.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Une image de rechange a √©t√© choisie parce que les seules mises √† jour susceptibles d'√©chouer sont les nouvelles images, puisque tous les autres √©l√©ments d√©pendent de l'installation comme vu pr√©c√©demment dans la description de l'√©couteur de l'√©v√©nement <code>install</code>.</p></div><h2 id="suggestion_dam√©lioration_dun_mod√®le_de_code"><a href="#suggestion_dam√©lioration_dun_mod√®le_de_code" title="Permalink to Suggestion d'am√©lioration d'un mod√®le de code">Suggestion d'am√©lioration d'un mod√®le de code</a></h2><div><p>Ce code utilise un cha√Ænage de promesses plus standard et retourne la r√©ponse au document sans avoir √† attendre que <code>caches.open()</code> soit r√©solue :</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> response<span class="token punctuation">;</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>functio
    response <span class="token operator">=</span> r<span class="token punctuation">;</span>
    cac
    c
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/sw-test/gallery/myLittleVader.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h2 id="mettre_√†_jour_le_service_worker"><a href="#mettre_√†_jour_le_service_worker" title="Permalink to Mettre √† jour le service worker">Mettre √† jour le service worker</a></h2><div><p>Si le service worker a √©t√© pr√©c√©demment install√©, et qu'une nouvelle version du worker est disponible au chargement ou au rafra√Æchissement de la page, la nouvelle version est install√©e en arri√®re-plan, mais pas encore activ√©e. Elle ne sera activ√©e que lorsqu'il n'y aura plus aucune page charg√©e qui utilise encore l'ancien service worker. D√®s lors qu'il n'y a plus de telles pages encore charg√©es, le nouveau service worker est activ√©.</p>
<p>On souhaite mettre √† jour l'√©couteur d'√©v√©nement <code>install</code> dans le nouveau service worker de la fa√ßon suivante (√† noter le nouveau num√©ro de version) :</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'v2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string">'/sw-test/'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/index.html'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/style.css'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/app.js'</span><span class="token punctuation">,</span>
        <span class="token string">'/sw-test/image-list.js'</span><span class="token punctuation">,</span>

             ‚Ä¶

              <span class="token comment">// include other new resources for the new version...</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Tandis que la mise √† jour se produit, la version pr√©c√©dente est encore en charge de r√©cup√©rer des ressources. La nouvelle version est install√©e en arri√®re-plan. Le nouveau cache se nomme v2, et ainsi ne perturbe en rien le pr√©c√©dent cache nomm√© v1.</p>
<p>Lorsque plus aucune page n'utilise la version actuelle, le nouveau worker est activ√© et prend en charge les requ√™tes.</p></div><h3 id="supprimer_les_anciens_caches"><a href="#supprimer_les_anciens_caches" title="Permalink to Supprimer les anciens caches">Supprimer les anciens caches</a></h3><div><p>Il existe un √©v√©nement <code>activate</code>. Il est g√©n√©ralement utilis√© pour faire un travail qui aurait interrompu le fonctionnement d'une version pr√©c√©dente alors qu'elle √©tait encore en cours d'utilisation, comme par exemple se d√©barrasser des anciens caches. Il est aussi utile pour supprimer des donn√©es qui ne sont plus n√©cessaires afin d'√©viter de surcharger l'espace disque ‚Äî chaque navigateur dispose d'une limite physique quant √† la capacit√© de stockage en cache dont le service worker peut b√©n√©ficier. Le navigateur g√®re au mieux l'espace disque, mais il peut supprimer le stockage du Cache pour une origine. Le navigateur supprimera g√©n√©ralement toutes les donn√©es d'une origine ou bien aucune.</p>
<p>Les promesses pass√©es √† <code>waitUntil()</code> bloqueront les autres √©v√©nements jusqu'√† r√©alisation compl√®te, ainsi on a l'assurance que l'op√©ration de nettoyage aura √©t√© men√©e √† terme au moment o√π surviendra le premier √©v√©nement <code>fetch</code> du nouveau cache.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cacheWhitelist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">keyList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keyList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheWhitelist<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h2 id="outils_de_d√©veloppement"><a href="#outils_de_d√©veloppement" title="Permalink to Outils de d√©veloppement">Outils de d√©veloppement</a></h2><div><p>Chrome dispose de <code>chrome://inspect/#service-workers</code>, qui montre l'activit√© du service worker courant et le stockage sur l'appareil, et <code>chrome://serviceworker-internals</code>, qui offre plus de d√©tails et permet de d√©marrer/arr√™ter/d√©boguer le processus du worker. A l'avenir, des modes d√©grad√©/d√©connect√© seront ajout√©s pour simuler des connexions mauvaises ou inexistantes, ce qui sera une bonne chose.</p>
<p>Firefox a aussi commenc√© √† implanter quelques outils utiles concernant les service workers :</p>
<ul>
  <li>Consulter about:serviceworkers pour voir quels SWs sont enregistr√©s et les mettre √† jour ou les supprimer.</li>
  <li>Lors de tests, il est possible de contourner la restriction HTTPS en cochant l'option "Activer les Service Workers via HTTP (lorsque la bo√Æte √† outils est ouverte)" dans les options des outils de d√©veloppement de Firefox (la roue dent√©e dans le menu.)</li>
</ul></div><h2 id="voir_aussi"><a href="#voir_aussi" title="Permalink to Voir aussi">Voir aussi</a></h2><div><ul>
  <li><a href="https://jakearchibald.github.io/isserviceworkerready/" class="external" rel=" noopener">Is ServiceWorker ready?</a></li>
  <li><a href="/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a></li>
  <li><a href="/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" class="only-in-en-us" title="Currently only available in English (US)">Using web workers (en-US)</a></li>
</ul></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/translated-content/edit/main/files/fr/web/api/service_worker_api/using_service_workers/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/blob/main/files/fr/web/api/service_worker_api/using_service_workers/index.md" title="Folder: fr/web/api/service_worker_api/using_service_workers (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Ffr%2Fdocs%2FWeb%2FAPI%2FService_Worker_API%2FUsing_Service_Workers%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60fr%2Fweb%2Fapi%2Fservice_worker_api%2Fusing_service_workers%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Ffr%2Fdocs%2FWeb%2FAPI%2FService_Worker_API%2FUsing_Service_Workers%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fblob%2Fmain%2Ffiles%2Ffr%2Fweb%2Fapi%2Fservice_worker_api%2Fusing_service_workers%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fcommit%2F921c46a374ab0a9f4cc809af0370f8c412e54701%0A*+Document+last+modified%3A+2022-10-01T03%3A41%3A16.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22Utiliser+les+Service+Workers%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2Cl10n-fr" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-10-01T03:41:16.000Z">Oct 1, 2022</time>,<!-- --> <a href="/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers/contributors.txt">by MDN contributors</a></p><form class="language-menu"><fieldset id="select-language"><legend>Change your language</legend><label for="language-selector" class="visually-hidden">Select your preferred language</label> <select id="language-selector" name="language"><option selected="" value="fr">Fran√ßais</option><option value="en-US">English (US)</option><option value="es">Espa√±ol</option><option value="ja">Êó•Êú¨Ë™û</option><option value="ko">ÌïúÍµ≠Ïñ¥</option><option value="pt-BR">Portugu√™s (do&nbsp;Brasil)</option><option value="ru">–†—É—Å—Å–∫–∏–π</option><option value="zh-CN">‰∏≠Êñá (ÁÆÄ‰Ωì)</option></select> <button type="submit" class="button minimal">Change language</button></fieldset></form></div></aside></main><nav id="sidebar-quicklinks" class="sidebar"><h4>Related Topics</h4><div>
 <ol>
  <li><a href="/fr/docs/Web/API/Service_Worker_API"><strong>Service Worker API</strong></a></li>
  <li class="toggle">
    <details open="">
        <summary>Service Worker guides</summary>
        <ol>
          <li><a href="/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers">Using Service Workers</a></li>
        </ol>
    </details>
  </li>
  <li class="toggle">
    <details open="">
        <summary>Interfaces</summary>
        <ol>
          <li><a href="/fr/docs/Web/API/Cache"><code>Cache</code></a></li>
          <li><a href="/fr/docs/Web/API/CacheStorage"><code>CacheStorage</code></a></li>
          <li><a href="/fr/docs/Web/API/Client"><code>Client</code></a></li>
          <li><a href="/fr/docs/Web/API/Clients"><code>Clients</code></a></li>
          <li><a href="/fr/docs/Web/API/ExtendableEvent"><code>ExtendableEvent</code></a></li>
          <li><a href="/fr/docs/Web/API/FetchEvent"><code>FetchEvent</code></a></li>
          <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/InstallEvent"><code>InstallEvent</code> <small>(en-US)</small></a></li>
          <li><a href="/fr/docs/Web/API/Navigator/serviceWorker"><code>Navigator.serviceWorker</code></a></li>
          <li><a href="/fr/docs/Web/API/NotificationEvent"><code>NotificationEvent</code></a></li>
          <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/PeriodicSyncEvent"><code>PeriodicSyncEvent</code> <small>(en-US)</small></a></li>
          <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/PeriodicSyncManager"><code>PeriodicSyncManager</code> <small>(en-US)</small></a></li>
          <li><a class="page-not-created" title="Cette documentation n'a pas encore √©t√© r√©dig√©e, vous pouvez aider en contribuant&nbsp;!"><code>PeriodicSyncRegistration</code></a></li>
          <li><a href="/fr/docs/Web/API/ServiceWorker"><code>ServiceWorker</code></a></li>
          <li><a href="/fr/docs/Web/API/ServiceWorkerContainer"><code>ServiceWorkerContainer</code></a></li>
          <li><a href="/fr/docs/Web/API/ServiceWorkerGlobalScope"><code>ServiceWorkerGlobalScope</code></a></li>
          <li><a href="/fr/docs/Web/API/ServiceWorkerRegistration"><code>ServiceWorkerRegistration</code></a></li>
          <li><a class="only-in-en-us" title="Currently only available in English (US)" href="/en-US/docs/Web/API/SyncEvent"><code>SyncEvent</code> <small>(en-US)</small></a></li>
          <li><a href="/fr/docs/Web/API/SyncManager"><code>SyncManager</code></a></li>
          <li><a class="page-not-created" title="Cette documentation n'a pas encore √©t√© r√©dig√©e, vous pouvez aider en contribuant&nbsp;!"><code>SyncRegistration</code></a></li>
          <li><a href="/fr/docs/Web/API/WindowClient"><code>WindowClient</code></a></li>
        </ol>
    </details>
  </li>
  <li class="toggle">
    <details open="">
        <summary>Related APIs</summary>
        <ol>
          <li><a href="/fr/docs/Web/API/Channel_Messaging_API">Channel Messaging API</a></li>
          <li><a href="/fr/docs/Web/API/Notifications_API">Notifications API</a></li>
          <li><a href="/fr/docs/Web/API/Push_API">Push API</a></li>
          <li><a href="/fr/docs/Web/API/Web_Workers_API">Web Workers API</a></li>
        </ol>
    </details>
  </li>
  <li><strong><a href="/fr/docs/MDN">Documentation:</a></strong></li>
  <li class="toggle">
    <details>
        <summary>Contribute</summary>
        <ol>
          <li><a href="/fr/docs/MDN">The MDN project</a></li>
        </ol>
    </details>
  </li>
 </ol>
</div></nav></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/fr/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/fr/docs/Web">Web Technologies</a></li><li><a href="/fr/docs/Learn">Learn Web Development</a></li><li><a href="/fr/docs/MDN/About">About MDN</a></li><li><a href="/fr/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">¬© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Utiliser les Service Workers","mdn_url":"/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers","locale":"fr","native":"Fran√ßais","sidebarHTML":"\n <ol>\n  <li><a href=\"/fr/docs/Web/API/Service_Worker_API\"><strong>Service Worker API</strong></a></li>\n  <li class=\"toggle\">\n    <details open=\"\">\n        <summary>Service Worker guides</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers\">Using Service Workers</a></li>\n        </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n        <summary>Interfaces</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Web/API/Cache\"><code>Cache</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/CacheStorage\"><code>CacheStorage</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/Client\"><code>Client</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/Clients\"><code>Clients</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/ExtendableEvent\"><code>ExtendableEvent</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/FetchEvent\"><code>FetchEvent</code></a></li>\n          <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/InstallEvent\"><code>InstallEvent</code> <small>(en-US)</small></a></li>\n          <li><a href=\"/fr/docs/Web/API/Navigator/serviceWorker\"><code>Navigator.serviceWorker</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/NotificationEvent\"><code>NotificationEvent</code></a></li>\n          <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PeriodicSyncEvent\"><code>PeriodicSyncEvent</code> <small>(en-US)</small></a></li>\n          <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PeriodicSyncManager\"><code>PeriodicSyncManager</code> <small>(en-US)</small></a></li>\n          <li><a class=\"page-not-created\" title=\"Cette documentation n'a pas encore √©t√© r√©dig√©e, vous pouvez aider en contribuant&nbsp;!\"><code>PeriodicSyncRegistration</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/ServiceWorker\"><code>ServiceWorker</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/ServiceWorkerContainer\"><code>ServiceWorkerContainer</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/ServiceWorkerGlobalScope\"><code>ServiceWorkerGlobalScope</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/ServiceWorkerRegistration\"><code>ServiceWorkerRegistration</code></a></li>\n          <li><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/SyncEvent\"><code>SyncEvent</code> <small>(en-US)</small></a></li>\n          <li><a href=\"/fr/docs/Web/API/SyncManager\"><code>SyncManager</code></a></li>\n          <li><a class=\"page-not-created\" title=\"Cette documentation n'a pas encore √©t√© r√©dig√©e, vous pouvez aider en contribuant&nbsp;!\"><code>SyncRegistration</code></a></li>\n          <li><a href=\"/fr/docs/Web/API/WindowClient\"><code>WindowClient</code></a></li>\n        </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n        <summary>Related APIs</summary>\n        <ol>\n          <li><a href=\"/fr/docs/Web/API/Channel_Messaging_API\">Channel Messaging API</a></li>\n          <li><a href=\"/fr/docs/Web/API/Notifications_API\">Notifications API</a></li>\n          <li><a href=\"/fr/docs/Web/API/Push_API\">Push API</a></li>\n          <li><a href=\"/fr/docs/Web/API/Web_Workers_API\">Web Workers API</a></li>\n        </ol>\n    </details>\n  </li>\n  <li><strong><a href=\"/fr/docs/MDN\">Documentation:</a></strong></li>\n  <li class=\"toggle\">\n    <details>\n        <summary>Contribute</summary>\n        <ol>\n          <li><a href=\"/fr/docs/MDN\">The MDN project</a></li>\n        </ol>\n    </details>\n  </li>\n </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard experimental\" id=\"sect1\"><p><strong>Experimental:</strong> <strong>Cette fonction est exp√©rimentale</strong><br>Puisque cette fonction est toujours en d√©veloppement dans certains navigateurs, veuillez consulter le <a href=\"#browser_compatibility\">tableau de compatibilit√©</a> pour les pr√©fixes √† utiliser selon les navigateurs.<br>Il convient de noter qu'une fonctionnalit√© exp√©rimentale peut voir sa syntaxe ou son comportement modifi√© dans le futur en fonction des √©volutions de la sp√©cification.</p></div>\n<p>Cet article fournit des informations pour bien d√©buter avec les service workers, en pr√©sentant une architecture de base, l'inscription d'un service worker, l'installation et l'activation d'un processus pour un nouveau service worker, la mise √† jour d'un service worker, le contr√¥le du cache et la personnalisation des r√©ponses, le tout dans le contexte d'une application de base disponible en mode d√©connect√©.</p>"}},{"type":"prose","value":{"id":"le_pr√©ambule_aux_service_workers","title":"Le pr√©ambule aux Service Workers","isH3":false,"content":"<p>La perte de connexion est un probl√®me majeur auquel sont confront√©s les utilisateurs du web depuis des ann√©es. La meilleure application web au monde produirait un bien mauvais effet si vous ne pouviez pas la t√©l√©charger. Il y a eu de nombreuses tentatives pour mettre en place des technologies susceptibles de r√©soudre ce probl√®me, comme le montre notre page <a href=\"/fr/docs/Web/Apps/Build/Hors-ligne\">Offline</a>, et certains probl√®mes ont √©t√© r√©solus. Mais le probl√®me principal reste l'absence d'un m√©canisme de contr√¥le global pour la mise en cache des ressources et la personnalisation des requ√™tes r√©seau.</p>\n<p>La premi√®re tentative‚Äî AppCache ‚Äî semblait √™tre une bonne id√©e parce qu'elle permettait de sp√©cifier les ressources √† mettre en cache de mani√®re tr√®s simple. Cependant, elle faisait beaucoup de suppositions sur la mani√®re de le mettre en place et √©chouait implacablement si votre application ne se pliait pas exactement √† ces suppositions. Lisez <a href=\"https://alistapart.com/article/application-cache-is-a-douchebag\" class=\"external\" rel=\" noopener\">Application Cache is a Douchebag</a> de Jake Archibald pour plus de d√©tails.</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note :</strong> √† partir de Firefox 44, lorsque <a href=\"/fr/docs/Web/HTML/Utiliser_Application_Cache\" class=\"page-not-created\" title=\"This is a link to an unwritten page\">AppCache</a> est utilis√© pour fournir un support d√©connect√© √† une page, un message d'avertissement est alors affich√© dans la console pour signaler aux d√©veloppeurs d'utiliser plut√¥t les <a href=\"/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers\" aria-current=\"page\">Service workers</a> (<a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1204581\" class=\"external\" rel=\" noopener\">bug&nbsp;1204581</a>.)</p>\n</div>\n<p>Les service workers devraient finalement r√©soudre ces probl√®mes. La syntaxe du service Worker est plus complexe que celle de l'AppCache, mais en contrepartie vous pouvez utiliser JavaScript pour contr√¥ler les comportements induits par votre cache local avec une granularit√© beaucoup plus fine, vous permettant ainsi d'adresser ce probl√®me et beaucoup d'autres. Avec l'aide d'un Service Worker, vous pouvez facilement configurer une application pour d'abord utiliser des ressources mises en cache, fournissant ainsi une premi√®re exp√©rience par d√©faut m√™me en mode d√©connect√©, avant de r√©cup√©rer davantage de donn√©es depuis le r√©seau (principe connu g√©n√©ralement sous le nom de <a href=\"http://offlinefirst.org/\" class=\"external\" rel=\" noopener\">Offline First</a>). Cette fa√ßon de faire est d√©j√† disponible avec les applications natives, ce qui est l'une des raisons principales de la pr√©f√©rence accord√©e √† ces applications plut√¥t qu'aux applications web.</p>"}},{"type":"prose","value":{"id":"pr√©paratifs_aux_service_workers","title":"Pr√©paratifs aux Service Workers","isH3":false,"content":"<p>De nombreuses fonctionnalit√©s des service workers sont d√©sormais disponibles par d√©faut dans les plus r√©centes versions des navigateurs qui les supportent. Cependant, si vous constatez que le code de la d√©mo ne fonctionne pas dans votre version actuelle, vous pourriez avoir besoin d'activer une configuration :</p>\n<ul>\n  <li><strong>Firefox Nightly</strong> : rendez-vous sur <code>about:config</code> et configurer <code>dom.serviceWorkers.enabled</code> √† true; red√©marrer le navigateur.</li>\n  <li><strong>Chrome Canary</strong> : rendez-vous sur <code>chrome://flags</code> et activer <code>experimental-web-platform-features</code>; red√©marrer le navigateur (√† noter que certaines fonctionnalit√©s sont d√©sormais activ√©es par d√©faut dans Chrome.)</li>\n  <li><strong>Opera</strong> : rendez-vous sur <code>opera://flags</code> et activer <code>Support for ServiceWorker</code>; red√©marrer le navigateur.</li>\n</ul>\n<p>Vous aurez aussi besoin de servir votre code via HTTPS ‚Äî les Service Workers sont contraints √† s'ex√©cuter au travers d'HTTPS pour des raisons de s√©curit√©. GitHub est donc un bon endroit pour h√©berger des exp√©rimentations, puisqu'il supporte HTTPS. Et pour faciliter le d√©veloppement en local, le <strong>localhost</strong> est consid√©r√© comme une origine s√©curis√©e.</p>"}},{"type":"prose","value":{"id":"architecture_de_base","title":"Architecture de base","isH3":false,"content":"<p>Avec les service workers, les √©tapes suivantes sont g√©n√©ralement observ√©es pour une configuration simple :</p>\n<ol>\n  <li>L'URL du service worker URL est r√©cup√©r√©e et enregistr√©e via <a href=\"/fr/docs/Web/API/ServiceWorkerContainer/register\"><code>serviceWorkerContainer.register()</code></a>.</li>\n  <li>En cas de succ√®s, le service worker est ex√©cut√© dans un <a href=\"/fr/docs/Web/API/ServiceWorkerGlobalScope\"><code>ServiceWorkerGlobalScope</code></a>; c'est en gros une sorte de contexte de worker sp√©cial, fonctionnant hors du fil d'ex√©cution du script principal, sans acc√®s au DOM.</li>\n  <li>Le service worker est d√©sormais pr√™t √† traiter des √©v√©nements.</li>\n  <li>Une tentative d'installation du worker a lieu lorsque les pages contr√¥l√©es par le service worker sont acc√©d√©es par la suite. Un √©v√©nement install est toujours le premier envoy√© √† un service worker (√ßa peut √™tre le point de d√©part pour proc√©der au remplissage d'une base IndexedDB, et √† la mise en cache de ressources du site). C'est tout √† fait le m√™me type de proc√©dure que l'installation d'une application native ou Firefox OS ‚Äî en mettant l'ensemble √† disposition pour un usage d√©connect√©.</li>\n  <li>Lorsque le gestionnaire <code>oninstall</code> se termine, on consid√®re que le service worker est install√©.</li>\n  <li>L'√©tape suivante est l'activation. Lorsque le service worker est install√©, il re√ßoit alors un √©v√©nement activate. L'utilit√© premi√®re de <code>onactivate</code> est de nettoyer les ressources utilis√©es dans les versions pr√©c√©dentes du script du Service Worker.</li>\n  <li>Le Service Worker contr√¥le d√©sormais les pages, mais seulement celles ouvertes apr√®s que le <code>register()</code> ait r√©ussi. Ainsi un document √† sa cr√©ation s'accompagne ou non d'un Service Worker et conserve cet √©tat tout au long de sa dur√©e de vie. Ainsi les documents devront √™tre recharg√©s pour r√©ellement √™tre contr√¥l√©s.</li>\n</ol>\n<p>\n  <img src=\"/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers/sw-lifecycle.png\" alt=\"\" width=\"579\" height=\"867\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"promesses","title":"Promesses","isH3":true,"content":"<p><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise\">Les Promesses</a> sont un puissant m√©canisme pour ex√©cuter des op√©rations asynchrones, dont le succ√®s de l'une d√©pend du succ√®s de l'autre. Ce m√©canisme est au coeur du fonctionnement des service workers.</p>\n<p>Les promesses peuvent effectuer bien des choses, mais pour le moment il suffit de savoir que si une promesse est retourn√©e, on peut lui attacher un <code>.then()</code> et inclure des fonctions de rappel en cas de succ√®s, d'√©chec, etc., ou bien un <code>.catch()</code> et inclure une fonction de rappel en cas d'√©chec.</p>\n<p>Comparons la structure d'une fonction classique de rappel synchrone √† la promesse asynchrone √©quivalente.</p>\n<h4 id=\"sync\">sync</h4>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> value <span class=\"token operator\">=</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"async\">async</h4>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Dans le premier exemple, on doit attendre que l'ex√©cution de <code>myFunction()</code> retourne <code>value</code> avant de poursuivre l'ex√©cution de tout autre code. Dans le second exemple, <code>myFunction()</code> retourne une promesse pour <code>value</code>, ainsi le reste du code peut continuer √† s'ex√©cuter. Lorsque la promesse est r√©solue, le code √† l'int√©rieur de <code>then</code> s'ex√©cutera, de mani√®re asynchrone.</p>\n<p>Qu'en est-il sur un exemple concret ‚Äî qu'en est-il si, lors d'un chargement dynamique d'images, on veut √™tre s√ªre qu'elles soient bien charg√©es avant de les afficher ? C'est une d√©marche standard √† adopter, mais parfois probl√©matique. On peut utiliser <code>.onload</code> pour n'afficher l'image qu'apr√®s qu'elle soit charg√©e, mais qu'en est-il des √©v√©nements qui d√©marrent avant qu'on ne commence √† les √©couter ? On pourrait essayer un contournement en utilisant <code>.complete</code>, mais ce n'est toujours pas infaillible, et que faire en cas d'images multiples ? Et, ummm, tout cela reste synchrone, et bloque donc le fil d'ex√©cution principal.</p>\n<p>Alternativement, on pourrait faire notre propre promesse pour g√©rer ce genre de cas. (Voir l'exemple du <a href=\"https://github.com/mdn/promises-test\" class=\"external\" rel=\" noopener\">test de promesses</a> pour le code source, ou <a href=\"https://mdn.github.io/promises-test/\" class=\"external\" rel=\" noopener\">le voir fonctionner en direct</a>.)</p>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note :</strong> la mise en place d'un v√©ritable service worker utiliserait la mise en cache et onfetch plut√¥t que l'API obsol√®te XMLHttpRequest. Ces fonctionnalit√©s ne sont pas utilis√©es ici afin de se concentrer sur la compr√©hension des promesses.</p>\n</div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">imgLoad</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    request<span class=\"token punctuation\">.</span>responseType <span class=\"token operator\">=</span> <span class=\"token string\">'blob'</span><span class=\"token punctuation\">;</span>\n\n    request<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>status <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Image didn\\'t load successfully; error code:'</span> <span class=\"token operator\">+</span> request<span class=\"token punctuation\">.</span>statusText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    request<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'There was a network error.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>On retourne une nouvelle promesse en utilisant le constructeur <code>Promise()</code>, qui prend en argument une fonction de rappel avec les param√®tres <code>resolve</code> et <code>reject</code>. Quelque part dans la fonction, on a besoin de d√©finir √† quoi correspond pour la promesse d'√™tre r√©solue avec succ√®s ou bien d'√™tre rejet√©e ‚Äî dans ce cas, retourner un statut 200 OK status ou pas ‚Äî et donc appeler <code>resolve</code> en cas de succ√®s, ou <code>reject</code> en cas d'√©chec. Le reste du contenu de cette fonction correspond √† une utilisation plut√¥t classique d'XHR, et n'appelle pas de commentaires particuliers pour le moment.</p>\n<p>Lorsqu'on appelle la fonction <code>imgLoad()</code>, on l'appelle avec l'url de l'image √† charger, comme on pourrait s'en douter, mais le reste du code est un peu diff√©rent :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> body <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> myImage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">imgLoad</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myLittleVader.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> imageURL <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  myImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> imageURL<span class=\"token punctuation\">;</span>\n  body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>myImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">Error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>A la fin de l'appel de la fonction, on ajoute la m√©thode <code>then()</code> de la promesse, qui contient deux fonctions ‚Äî la premi√®re est ex√©cut√©e lorsque la promesse est r√©solue avec succ√®s, et la seconde est appel√©e lorsque la promesse est rejet√©e. Dans le cas d'une r√©solution, on affiche l'image dans : <code>myImage</code> et on l'ajoute au <code>body</code> (son argument est la valeur <code>request.response</code> contenue dans la m√©thode <code>resolve</code> de la promesse); en cas de rejet, on retourne une erreur dans la console.</p>\n<p>Le tout se d√©roule de mani√®re asynchrone.</p>\n<div class=\"notecard note\" id=\"sect4\">\n  <p>\n    <strong>Note :</strong> il est possible d'assembler des appels de promesse, par exemple:\n    <code>myPromise().then(success, failure).then(success).catch(failure);</code>\n  </p>\n</div>\n<div class=\"notecard note\" id=\"sect5\">\n  <p><strong>Note :</strong> pour en savoir plus sur les promesses, consulter l'excellent article de Jake Archibald <a href=\"https://www.html5rocks.com/en/tutorials/es6/promises/\" class=\"external\" rel=\" noopener\">JavaScript Promises: there and back again</a>.</p>\n</div>"}},{"type":"prose","value":{"id":"d√©mo_de_service_workers","title":"D√©mo de service workers","isH3":false,"content":"<p>Pour illustrer quelques principes de base de l'enregistrement et de l'installation d'un service worker, voici une simple d√©mo appel√©e <a href=\"https://github.com/mdn/sw-test\" class=\"external\" rel=\" noopener\">sw-test</a>, qui pr√©sente juste une galerie d'images Star wars Lego. Elle utilise une fonction pilot√©e par une promesse pour lire les donn√©es d'une image √† partir d'un objet JSON et charger les images en utilisant Ajax, avant d'afficher les images en bas de page. Les choses restent statiques et simples pour le moment. Elle enregistre aussi, installe et active un service worker, et lorsque la sp√©cification est davantage support√©e par les navigateurs, elle met en cache tous les fichiers requis pour un fonctionnement d√©connect√© !</p>\n<p>\n  <img src=\"/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers/demo-screenshot.png\" alt=\"\" width=\"480\" height=\"410\" loading=\"lazy\">\n</p>\n<p>Vous pouvez consulter le <a href=\"https://github.com/mdn/sw-test/\" class=\"external\" rel=\" noopener\">code source sur GitHub</a>, et <a href=\"https://mdn.github.io/sw-test/\" class=\"external\" rel=\" noopener\">voir l'exemple en direct</a>. Le bout de code qui sera appel√© est la promesse (voir <a href=\"https://github.com/mdn/sw-test/blob/gh-pages/app.js#L17-L42\" class=\"external\" rel=\" noopener\">app.js lines 17-42</a>), qui est une version modifi√©e du code pr√©sent√© ci-dessus, dans la <a href=\"https://github.com/mdn/promises-test\" class=\"external\" rel=\" noopener\">d√©mo du test de promesses</a>. Il en diff√®re de la fa√ßon suivante :</p>\n<ol>\n  <li>Dans l'original, on consid√®re l'URL d'une image √† charger. Dans cette version, on passe un fragment JSON contenant toutes les donn√©es d'une seule image (voir √† quoi il ressemble dans <a href=\"https://github.com/mdn/sw-test/blob/gh-pages/image-list.js\" class=\"external\" rel=\" noopener\">image-list.js</a>). C'est parce que toutes les donn√©es pour que chaque promesse soit r√©solue doivent √™tre pass√©es avec la promesse, que c'est asynchrone. Si l'on passe juste l'url, et si l'on essaie alors d'acc√©der aux autres √©l√©ments dans le JSON s√©par√©ment lorsqu'on it√®re plus tard avec la boucle <code>for()</code>, cela ne marchera pas, puisque la promesse ne se r√©solvera pas en m√™me temps que les it√©rations sont faites (c'est un m√©canisme synchrone.)</li>\n  <li>La promesse est r√©solue en r√©alit√© avec un tableau, puisqu'on veut rendre le blob de l'image charg√©e disponible √† la fonction de r√©solution plus tard dans le code, mais aussi le nom de l'image, les cr√©dits et le texte alternatif (voir <a href=\"https://github.com/mdn/sw-test/blob/gh-pages/app.js#L26-L29\" class=\"external\" rel=\" noopener\">app.js lines 26-29</a>). Les promesses se r√©solvent seulement avec un seul argument, aussi si l'on souhaite la r√©soudre avec des valeurs multiples, on a besoin d'utiliser un tableau ou un objet.</li>\n  <li>Pour acc√©der aux valeurs de la promesse r√©solue, on acc√®de alors √† cette fonction comme on peut s'y attendre (voir <a href=\"https://github.com/mdn/sw-test/blob/gh-pages/app.js#L55-L59\" class=\"external\" rel=\" noopener\">app.js lines 55-59</a>.) Cela peut sembler un peu √©trange au premier abord, mais c'est la mani√®re dont les promesses fonctionnent.</li>\n</ol>"}},{"type":"prose","value":{"id":"introduction_aux_service_workers","title":"Introduction aux service workers","isH3":false,"content":"<p>Maintenant, c'est au tour des service workers !</p>"}},{"type":"prose","value":{"id":"enregistrer_un_worker","title":"Enregistrer un worker","isH3":true,"content":"<p>Le premier bloc de code dans le fichier JavaScript de l'application ‚Äî <code>app.js</code> ‚Äî se pr√©sente comme suit. C'est le point d'entr√©e pour utiliser des service workers.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/sw-test/sw.js'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">scope</span><span class=\"token operator\">:</span> <span class=\"token string\">'/sw-test/'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// registration worked</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Registration succeeded. Scope is '</span> <span class=\"token operator\">+</span> reg<span class=\"token punctuation\">.</span>scope<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// registration failed</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Registration failed with '</span> <span class=\"token operator\">+</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ol>\n  <li>Le bloc ext√©rieur effectue un test de d√©tection de fonctionnalit√© pour s'assurer que les service workers sont support√©s avant d'essayer d'en enregistrer un.</li>\n  <li>Ensuite, la fonction <a href=\"/fr/docs/Web/API/ServiceWorkerContainer/register\"><code>ServiceWorkerContainer.register()</code></a> est utilis√©e pour enregistrer le service worker de ce site, qui est juste un fichier JavaScript pr√©sent au sein de notre application (√† noter qu'il s'agit de l'URL relative du fichier par rapport √† l'origine, et non seulement le fichier JS qui le r√©f√©rence.)</li>\n  <li>Le param√®tre <code>scope</code> est optionnel, et peut √™tre utilis√© pour sp√©cifier le sous-ensemble du contenu qui doit √™tre soumis au contr√¥le du service worker. Dans ce cas, on a sp√©cifi√© '<code>/sw-test/'</code>, ce qui signifie tous les contenus pr√©sents sous l'origine de l'application. S'il n'est pas pr√©cis√©, il correspondra de toute fa√ßon par d√©faut √† cette valeur; il a √©t√© explicitement sp√©cifi√© ici √† titre d'illustration.</li>\n  <li>La fonction <code>.then()</code> de la promesse est utilis√©e pour cha√Æner un traitement en cas de succ√®s √† la structure de la promesse. Lorsque la promesse est r√©solue avec succ√®s, le code qu'elle contient est ex√©cut√©.</li>\n  <li>Finalement, une fonction <code>.catch()</code> est cha√Æn√©e √† la fin, qui s'ex√©cutera si la promesse est rejet√©e.</li>\n</ol>\n<p>A ce stade un service worker est enregistr√©, qui s'ex√©cute dans le contexte d'un worker, et n'a donc aucun acc√®s au DOM. Le code s'ex√©cute ainsi dans le service worker, ext√©rieurement aux pages normales dont il contr√¥le le chargement.</p>\n<p>Un seul service worker peut contr√¥ler de nombreuses pages. Chaque fois qu'une page au sein du scope est charg√©e, le service worker est install√© et op√®re sur la page. Attention, il faut faire un usage prudent des variables globales dans le script du service worker : chaque page ne dispose pas de son propre et unique worker.</p>\n<div class=\"notecard note\" id=\"sect6\">\n  <p><strong>Note :</strong> un service worker fonctionne comme un serveur proxy, permettant de modifier les requ√™tes et les r√©ponses, de les remplacer par des √©l√©ments de son propre cache, et bien plus.</p>\n</div>\n<div class=\"notecard note\" id=\"sect7\">\n  <p><strong>Note :</strong> une chose importante √† savoir au sujet des service workers est que si la d√©tection de fonctionnalit√© est utilis√©e comme ci-dessus, les navigateurs qui ne supportent pas les service workers peuvent simplement utiliser l'application de la mani√®re normalement attendue. De plus, si vous utilisez AppCache et SW sur une page, les navigateurs qui ne supportent pas SW mais supportent AppCache l'utiliseront, et les navigateurs qui supportent les deux ignoreront AppCache au profit de SW.</p>\n</div>\n<h4 id=\"pourquoi_mon_service_worker_√©choue_√†_senregistrer_\">Pourquoi mon service worker √©choue √† s'enregistrer ?</h4>\n<p>Ce pourrait √™tre pour les raisons suivantes :</p>\n<ol>\n  <li>L'application ne fonctionne pas au travers d'HTTPS</li>\n  <li>Le chemin du fichier du service worker file est syntaxiquement incorrect ‚Äî il a besoin d'√™tre exprim√© relativement √† l'origine, et non pas par rapport au r√©pertoire racine. Dans l'exemple, le worker a comme emplacement <code>https://mdn.github.io/sw-test/sw.js</code>, et la racine de l'application est <code>https://mdn.github.io/sw-test/</code>. Mais la syntaxe du chemin s'√©crit <code>/sw-test/sw.js</code>, <code>et non /sw.js</code>.</li>\n  <li>Le service worker consid√©r√© se trouve sur une origine diff√©rente de celle de l'application. Ce qui n'est pas permis.</li>\n</ol>"}},{"type":"prose","value":{"id":"installer_et_activer_remplir_le_cache","title":"Installer et activer : remplir le cache","isH3":true,"content":"<p>Apr√®s l'enregistrement du service worker, le navigateur tente d'installer puis d'activer le service worker sur la page ou le site.</p>\n<p>L'√©v√©nement install est d√©clench√© lorsqu'une installation se termine avec succ√®s. L'√©v√©nement install est g√©n√©ralement utilis√© pour remplir le cache local du navigateur avec les ressources n√©cessaires pour faire fonctionner l'application en mode d√©connect√©. A cet effet, la toute nouvelle API de stockage est utilis√©e ‚Äî <a href=\"/fr/docs/Web/API/Cache\"><code>cache</code></a> ‚Äî un espace global au niveau du service worker qui permet de stocker les ressources fournies par les r√©ponses, et index√©es par leurs requ√™tes. Cette API fonctionne d'une mani√®re similaire au cache standard du navigateur, mais le cache demeure sp√©cifique au domaine. Il persiste jusqu'√† ce qu'il en soit d√©cid√© autrement ‚Äî de nouveau, le contr√¥le reste total.</p>\n<div class=\"notecard note\" id=\"sect8\">\n  <p><strong>Note :</strong> L'API Cache n'est pas support√©e par tous les navigateurs. Pour l'utiliser √† l'heure actuelle, on peut envisager un polyfill comme celui fournit par la <a href=\"https://github.com/Polymer/topeka/blob/master/sw.js\" class=\"external\" rel=\" noopener\">d√©mo Topeka de Google</a>, ou peut-√™tre stocker les ressources dans <a href=\"/fr/docs/Web/API/IndexedDB_API\">IndexedDB</a>.</p>\n</div>\n<p>Commen√ßons cette section par l'examen d'un exemple de code ‚Äî c'est le <a href=\"https://github.com/mdn/sw-test/blob/gh-pages/sw.js#L1-L18\" class=\"external\" rel=\" noopener\">premier bloc pr√©sent dans le service worker</a>:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        <span class=\"token string\">'/sw-test/'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/index.html'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/style.css'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/app.js'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/image-list.js'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/star-wars-logo.jpg'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/gallery/'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/gallery/bountyHunters.jpg'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/gallery/myLittleVader.jpg'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/gallery/snowTroopers.jpg'</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ol>\n  <li>Un √©couteur d'√©v√©nement <code>install</code> est d'abord ajout√© au service worker (d'o√π le <code>this</code>), puis une m√©thode <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/ExtendableEvent/waitUntil\"><code>ExtendableEvent.waitUntil()</code> <small>(en-US)</small></a> est cha√Æn√©e √† l'√©v√©nement ‚Äî cela garantit que le Service Worker ne s'installera pas tant que le code √† l'int√©rieur de <code>waitUntil()</code> n'a pas √©t√© ex√©cut√© avec succ√®s.</li>\n  <li>A l'int√©rieur de <code>waitUntil()</code> la m√©thode <a href=\"/fr/docs/Web/API/CacheStorage/open\"><code>caches.open()</code></a> est utilis√©e pour cr√©er un nouveau cache appel√© <code>v1</code>, ce qui constitue la version 1 du cache de ressources de notre site. Cette fonction retourne une promesse lorsque le cache est cr√©√©; une fois r√©solue, est appel√©e une fonction qui appelle elle-m√™me <code>addAll()</code> sur le cache cr√©√©, avec pour param√®tre un tableau d'URLs relatives √† l'origine correspondant aux ressources √† mettre en cache.</li>\n  <li>Si la promesse est rejet√©e, l'installation √©choue, et le worker ne fait rien de plus. Le code peut √™tre alors corrig√© et l'op√©ration retent√©e la prochaine fois que l'enregistrement survient.</li>\n  <li>Apr√®s une installation couronn√©e de succ√®s, le service worker est activ√©. Cela ne fait pas une grande diff√©rence la premi√®re fois que le service worker est install√©/activ√©, mais cela fait plus sens lorsque le service worker est mis √† jour (voir la section <a href=\"#mettre_%C3%A0_jour_le_service_worker\">Mettre √† jour le service worker</a> plus bas).</li>\n</ol>\n<div class=\"notecard note\" id=\"sect9\">\n  <p><strong>Note :</strong> <a href=\"/fr/docs/Web/API/Web_Storage_API\">localStorage</a> fonctionne de la m√™me fa√ßon que le cache du service worker, mais de mani√®re synchrone, et il n'est donc pas autoris√© dans les service workers.</p>\n</div>\n<div class=\"notecard note\" id=\"sect10\">\n  <p><strong>Note :</strong> <a href=\"/fr/docs/Web/API/IndexedDB_API\">IndexedDB</a> peut √™tre utilis√© dans un service worker pour le stockage des donn√©s si n√©cessaire.</p>\n</div>"}},{"type":"prose","value":{"id":"r√©ponses_personnalis√©es_aux_requ√™tes","title":"R√©ponses personnalis√©es aux requ√™tes","isH3":true,"content":"<p>Une fois que les ressources du site sont mises en cache, les service workers doivent savoir quoi faire de ce contenu en cache. L'√©v√©nement <code>fetch</code> permet de g√©rer cela facilement.</p>\n<p>Un √©v√©nement <code>fetch</code> se d√©clenche √† chaque fois qu'une ressource contr√¥l√©e par un service worker est retourn√©e, ce qui inclut les documents √† l'int√©rieur du contour sp√©cifi√©, et toute ressource r√©f√©renc√©e dans ces documents (par exemple <code>si index.html</code> effectue une requ√™te vers un autre domaine pour l'insertion d'une image, cela se fait encore au travers de son service worker.)</p>\n<p>On peut attacher un √©couteur de l'√©v√©nement <code>fetch</code> au service worker, puis appeler la m√©thode <code>respondWith()</code> sur l'√©v√©nement pour d√©tourner les r√©ponses HTTP et les mettre √† jour en leur jetant un sort particulier.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// la magie op√®re ici</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>On peut d√©j√† simplement r√©pondre avec la ressource en cache dont l'url correspond √† celle de la requ√™te r√©seau, dans chaque cas :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><code>caches.match(event.request)</code> permet de mettre en correspondance chaque ressource demand√©e sur le r√©seau avec la ressource √©quivalente en cache, si elle se trouve √™tre disponible. La comparaison est effectu√©e via l'url et diverses en-t√™tes, comme habituellement avec des requ√™tes HTTP normales.</p>\n<p>Voici quelques autres options disponibles pour que la magie op√®re (voir la <a href=\"/fr/docs/Web/API/Fetch_API\">documentation de l'API Fetch</a> pour plus d'informations sur les objets <a href=\"/fr/docs/Web/API/Request\"><code>Request</code></a> et <a href=\"/fr/docs/Web/API/Response\"><code>Response</code></a>).</p>\n<ol>\n  <li>Le constructeur <code><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Response/Response\"><code>Response()</code> <small>(en-US)</small></a></code> permet de cr√©er une r√©ponse personnalis√©e. Dans cet exemple, une cha√Æne de caract√®res est simplement retourn√©e :\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello from your friendly neighbourhood service worker!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n  </li>\n  <li>La <code>Response</code> plus complexe ci-dessous montre qu'il est possible de passer optionnellement un ensemble d'en-t√™tes avec la r√©ponse, √©mulant ainsi des en-t√™tes de r√©ponse HTTP standards. Ici, on signale au navigateur quel est le type de contenu de notre r√©ponse artificielle :\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;p&gt;Hello from your friendly neighbourhood service worker!&lt;/p&gt;'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/html'</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n  </li>\n  <li>Si une correspondance n'est pas trouv√©e en cache, on peut indiquer simplement au navigateur d'effectuer (<a href=\"/fr/docs/Web/API/fetch\" title=\"fetch\"><code>fetch</code></a>) la requ√™te r√©seau par d√©faut pour cette ressource, afin de r√©cup√©rer cette nouvelle ressource sur le r√©seau si disponible :\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span>\n</code></pre></div>\n  </li>\n  <li>Si une correspondance n'est pas trouv√©e en cache et que le r√©seau n'est pas disponible, on peut alors faire correspondre la requ√™te avec une page de rechange par d√©faut en guise de r√©ponse en utilisant <a href=\"/fr/docs/Web/API/CacheStorage/match\" title=\"match()\"><code>match()</code></a>, comme suit :\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/fallback.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n  </li>\n  <li>On peut r√©cup√©rer beaucoup d'informations √† propos de chaque requ√™te en interrogeant les param√®tres de l'objet <a href=\"/fr/docs/Web/API/Request\"><code>Request</code></a> retourn√© par <a href=\"/fr/docs/Web/API/FetchEvent\"><code>FetchEvent</code></a> :\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url\nevent<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>method\nevent<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>headers\nevent<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>body\n</code></pre></div>\n  </li>\n</ol>"}},{"type":"prose","value":{"id":"r√©cup√©rer_des_requ√™tes_en_erreur","title":"R√©cup√©rer des requ√™tes en erreur","isH3":false,"content":"<p>On vient de voir que <code>caches.match(event.request)</code> est important lorsqu'il y a correspondance avec le cache du service worker, mais qu'en est-il des cas o√π rien ne correspond ? Si aucune sorte de gestionnaire d'erreur n'est fourni, la promesse est rejet√©e et une erreur r√©seau est retourn√©e lorsqu'aucune correspondance n'est trouv√©e.</p>\n<p>Heureusement, la structure des service workers qui repose sur les promesses rend triviale la gestion des alternatives √† une situation de succ√®s. On pourrait faire ceci :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Si la promesse est rejet√©e, la fonction <code>catch()</code> retourne √† la place la requ√™te r√©seau par d√©faut, ce qui signifie que si le r√©seau est disponible la ressource sera charg√©e √† partir du serveur.</p>\n<p>Plus malin encore, on pourrait non seulement r√©cup√©rer la ressource √† partir du serveur, mais aussi la sauvegarder dans le cache afin que les requ√™tes ult√©rieures pour cette ressource puissent √™tre disponibles aussi en mode d√©connect√©. Cela signifierait que toute image suppl√©mentaire ajout√©e √† la galerie Star Wars pourrait √™tre r√©cup√©r√©e par l'application et mise en cache. Le code suivant illustre ce m√©canisme :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Ici on retourne la requ√™te r√©seau par d√©faut au moyen de <code>return fetch(event.request)</code>, qui retourne lui-m√™me une promesse. Lorsque cette promesse est r√©solue, on ex√©cute une fonction qui sollicite le cache en utilisant <code>caches.open('v1')</code>; une promesse est de nouveau retourn√©e. Lorsque cette promesse est r√©solue, <code>cache.put()</code> est utilis√©e pour ajouter la ressource au cache. La ressource est r√©cup√©r√©e √† partir de <code>event.request</code>, et la r√©ponse est alors clon√©e avec <code>response.clone()</code> et ajout√©e au cache. Le clone est plac√© dans le cache, et la r√©ponse originale est retourn√©e au navigateur et d√©livr√©e √† la page qui la requiert.</p>\n<p>Pourquoi un clone ? Il se trouve que les flux de requ√™te et de r√©ponse peuvent seulement √™tre lus une fois. Afin de retourner la r√©ponse au navigateur et de la mettre en cache, elle doit √™tre clon√©e. Aussi, l'original est retourn√© au navigateur tandis que le clone est envoy√© dans le cache. Ils sont chacun lus une seule fois.</p>\n<p>Le dernier probl√®me qui demeure alors est l'√©chec de la requ√™te au cas o√π elle n'a aucune correspondance dans le cache et que le r√©seau n'est pas disponible. Fournir un document de rechange par d√©faut permet quoiqu'il arrive, √† l'utilisateur de r√©cup√©rer quelque chose :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/sw-test/gallery/myLittleVader.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Une image de rechange a √©t√© choisie parce que les seules mises √† jour susceptibles d'√©chouer sont les nouvelles images, puisque tous les autres √©l√©ments d√©pendent de l'installation comme vu pr√©c√©demment dans la description de l'√©couteur de l'√©v√©nement <code>install</code>.</p>"}},{"type":"prose","value":{"id":"suggestion_dam√©lioration_dun_mod√®le_de_code","title":"Suggestion d'am√©lioration d'un mod√®le de code","isH3":false,"content":"<p>Ce code utilise un cha√Ænage de promesses plus standard et retourne la r√©ponse au document sans avoir √† attendre que <code>caches.open()</code> soit r√©solue :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> response<span class=\"token punctuation\">;</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>functio\n    response <span class=\"token operator\">=</span> r<span class=\"token punctuation\">;</span>\n    cac\n    c\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/sw-test/gallery/myLittleVader.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"mettre_√†_jour_le_service_worker","title":"Mettre √† jour le service worker","isH3":false,"content":"<p>Si le service worker a √©t√© pr√©c√©demment install√©, et qu'une nouvelle version du worker est disponible au chargement ou au rafra√Æchissement de la page, la nouvelle version est install√©e en arri√®re-plan, mais pas encore activ√©e. Elle ne sera activ√©e que lorsqu'il n'y aura plus aucune page charg√©e qui utilise encore l'ancien service worker. D√®s lors qu'il n'y a plus de telles pages encore charg√©es, le nouveau service worker est activ√©.</p>\n<p>On souhaite mettre √† jour l'√©couteur d'√©v√©nement <code>install</code> dans le nouveau service worker de la fa√ßon suivante (√† noter le nouveau num√©ro de version) :</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        <span class=\"token string\">'/sw-test/'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/index.html'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/style.css'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/app.js'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'/sw-test/image-list.js'</span><span class=\"token punctuation\">,</span>\n\n             ‚Ä¶\n\n              <span class=\"token comment\">// include other new resources for the new version...</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Tandis que la mise √† jour se produit, la version pr√©c√©dente est encore en charge de r√©cup√©rer des ressources. La nouvelle version est install√©e en arri√®re-plan. Le nouveau cache se nomme v2, et ainsi ne perturbe en rien le pr√©c√©dent cache nomm√© v1.</p>\n<p>Lorsque plus aucune page n'utilise la version actuelle, le nouveau worker est activ√© et prend en charge les requ√™tes.</p>"}},{"type":"prose","value":{"id":"supprimer_les_anciens_caches","title":"Supprimer les anciens caches","isH3":true,"content":"<p>Il existe un √©v√©nement <code>activate</code>. Il est g√©n√©ralement utilis√© pour faire un travail qui aurait interrompu le fonctionnement d'une version pr√©c√©dente alors qu'elle √©tait encore en cours d'utilisation, comme par exemple se d√©barrasser des anciens caches. Il est aussi utile pour supprimer des donn√©es qui ne sont plus n√©cessaires afin d'√©viter de surcharger l'espace disque ‚Äî chaque navigateur dispose d'une limite physique quant √† la capacit√© de stockage en cache dont le service worker peut b√©n√©ficier. Le navigateur g√®re au mieux l'espace disque, mais il peut supprimer le stockage du Cache pour une origine. Le navigateur supprimera g√©n√©ralement toutes les donn√©es d'une origine ou bien aucune.</p>\n<p>Les promesses pass√©es √† <code>waitUntil()</code> bloqueront les autres √©v√©nements jusqu'√† r√©alisation compl√®te, ainsi on a l'assurance que l'op√©ration de nettoyage aura √©t√© men√©e √† terme au moment o√π surviendra le premier √©v√©nement <code>fetch</code> du nouveau cache.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'activate'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> cacheWhitelist <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'v2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">keyList</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>keyList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cacheWhitelist<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"outils_de_d√©veloppement","title":"Outils de d√©veloppement","isH3":false,"content":"<p>Chrome dispose de <code>chrome://inspect/#service-workers</code>, qui montre l'activit√© du service worker courant et le stockage sur l'appareil, et <code>chrome://serviceworker-internals</code>, qui offre plus de d√©tails et permet de d√©marrer/arr√™ter/d√©boguer le processus du worker. A l'avenir, des modes d√©grad√©/d√©connect√© seront ajout√©s pour simuler des connexions mauvaises ou inexistantes, ce qui sera une bonne chose.</p>\n<p>Firefox a aussi commenc√© √† implanter quelques outils utiles concernant les service workers :</p>\n<ul>\n  <li>Consulter about:serviceworkers pour voir quels SWs sont enregistr√©s et les mettre √† jour ou les supprimer.</li>\n  <li>Lors de tests, il est possible de contourner la restriction HTTPS en cochant l'option \"Activer les Service Workers via HTTP (lorsque la bo√Æte √† outils est ouverte)\" dans les options des outils de d√©veloppement de Firefox (la roue dent√©e dans le menu.)</li>\n</ul>"}},{"type":"prose","value":{"id":"voir_aussi","title":"Voir aussi","isH3":false,"content":"<ul>\n  <li><a href=\"https://jakearchibald.github.io/isserviceworkerready/\" class=\"external\" rel=\" noopener\">Is ServiceWorker ready?</a></li>\n  <li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise\">Promises</a></li>\n  <li><a href=\"/en-US/docs/Web/API/Web_Workers_API/Using_web_workers\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">Using web workers (en-US)</a></li>\n</ul>"}}],"toc":[{"text":"Le pr√©ambule aux Service Workers","id":"le_pr√©ambule_aux_service_workers"},{"text":"Pr√©paratifs aux Service Workers","id":"pr√©paratifs_aux_service_workers"},{"text":"Architecture de base","id":"architecture_de_base"},{"text":"D√©mo de service workers","id":"d√©mo_de_service_workers"},{"text":"Introduction aux service workers","id":"introduction_aux_service_workers"},{"text":"R√©cup√©rer des requ√™tes en erreur","id":"r√©cup√©rer_des_requ√™tes_en_erreur"},{"text":"Suggestion d'am√©lioration d'un mod√®le de code","id":"suggestion_dam√©lioration_dun_mod√®le_de_code"},{"text":"Mettre √† jour le service worker","id":"mettre_√†_jour_le_service_worker"},{"text":"Outils de d√©veloppement","id":"outils_de_d√©veloppement"},{"text":"Voir aussi","id":"voir_aussi"}],"summary":"Cet article fournit des informations pour bien d√©buter avec les service workers, en pr√©sentant une architecture de base, l'inscription d'un service worker, l'installation et l'activation d'un processus pour un nouveau service worker, la mise √† jour d'un service worker, le contr√¥le du cache et la personnalisation des r√©ponses, le tout dans le contexte d'une application de base disponible en mode d√©connect√©.","popularity":0.0006,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Using Service Workers","locale":"en-US","native":"English (US)"},{"title":"Usar Service Workers","locale":"es","native":"Espa√±ol"},{"title":"„Çµ„Éº„Éì„Çπ„ÉØ„Éº„Ç´„Éº„ÅÆ‰ΩøÁî®","locale":"ja","native":"Êó•Êú¨Ë™û"},{"title":"Using Service Workers","locale":"ko","native":"ÌïúÍµ≠Ïñ¥"},{"title":"Usando Service Workers","locale":"pt-BR","native":"Portugu√™s (do¬†Brasil)"},{"title":"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Service Worker","locale":"ru","native":"–†—É—Å—Å–∫–∏–π"},{"title":"‰ΩøÁî® Service Workers","locale":"zh-CN","native":"‰∏≠Êñá (ÁÆÄ‰Ωì)"}],"source":{"folder":"fr/web/api/service_worker_api/using_service_workers","github_url":"https://github.com/mdn/translated-content/blob/main/files/fr/web/api/service_worker_api/using_service_workers/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/fr/docs/Web","title":"Technologies web pour d√©veloppeurs"},{"uri":"/fr/docs/Web/API","title":"R√©f√©rence Web API"},{"uri":"/fr/docs/Web/API/Service_Worker_API","title":"Service Worker API"},{"uri":"/fr/docs/Web/API/Service_Worker_API/Using_Service_Workers","title":"Utiliser les Service Workers"}],"pageTitle":"Utiliser les Service Workers - R√©f√©rence Web API | MDN","noIndexing":false}}</script></body></html>