{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"FinalizationRegistry","mdn_url":"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry","locale":"fr","native":"Français","sidebarHTML":"<ol><li><strong><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects\">Objets standards</a></strong></li><li><strong><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry\"><code>FinalizationRegistry</code></a></strong></li><li data-default-state=\"open\"><a href=\"#\"><strong>Méthodes</strong></a><ol><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry/register\"><code>FinalizationRegistry.prototype.register()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry/unregister\"><code>FinalizationRegistry.prototype.unregister()</code></a></li></ol></li><li><strong>Héritage&nbsp;:</strong></li><li><strong><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function\"><code>Function</code></a></strong></li><li><a href=\"#\"><strong>Propriétés</strong></a><ol><li><svg class=\"icon icon-nonstandard\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-nonstandard\"></use>\n</svg><svg class=\"icon icon-deprecated\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-deprecated\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/arguments\"><code>Function.prototype.arguments</code></a></li><li><svg class=\"icon icon-nonstandard\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-nonstandard\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/caller\"><code>Function.prototype.caller</code></a></li><li><svg class=\"icon icon-nonstandard\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-nonstandard\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/displayName\"><code>Function.prototype.displayName</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/length\"><code>Function.prototype.length</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/name\"><code>Function.prototype.name</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function\"><code>Function.prototype.prototype</code></a></li></ol></li><li><a href=\"#\"><strong>Méthodes</strong></a><ol><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/apply\"><code>Function.prototype.apply()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\"><code>Function.prototype.bind()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/call\"><code>Function.prototype.call()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Function/toString\"><code>Function.prototype.toString()</code></a></li></ol></li><li><strong><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object\"><code>Object</code></a></strong></li><li><a href=\"#\"><strong>Propriétés</strong></a><ol><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor\"><code>Object.prototype.constructor</code></a></li><li><svg class=\"icon icon-deprecated\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-deprecated\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/proto\"><code>Object.prototype.__proto__</code></a></li></ol></li><li><a href=\"#\"><strong>Méthodes</strong></a><ol><li><svg class=\"icon icon-deprecated\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-deprecated\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/__defineGetter__\"><code>Object.prototype.__defineGetter__()</code></a></li><li><svg class=\"icon icon-deprecated\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-deprecated\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/__defineSetter__\"><code>Object.prototype.__defineSetter__()</code></a></li><li><svg class=\"icon icon-deprecated\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-deprecated\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/__lookupGetter__\"><code>Object.prototype.__lookupGetter__()</code></a></li><li><svg class=\"icon icon-deprecated\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-deprecated\"></use>\n</svg><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/__lookupSetter__\"><code>Object.prototype.__lookupSetter__()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty\"><code>Object.prototype.hasOwnProperty()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/isPrototypeOf\"><code>Object.prototype.isPrototypeOf()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/propertyIsEnumerable\"><code>Object.prototype.propertyIsEnumerable()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf\"><code>Object.setPrototypeOf()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/toLocaleString\"><code>Object.prototype.toLocaleString()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/toString\"><code>Object.prototype.toString()</code></a></li><li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf\"><code>Object.prototype.valueOf()</code></a></li></ol></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Un objet <strong><code>FinalizationRegistry</code></strong> permet de déclencher une fonction de rappel (<i lang=\"en\">callback</i>) lorsqu'un objet est récupéré par le ramasse-miettes.</p>"}},{"type":"prose","value":{"id":"description","title":"Description","isH3":false,"content":"<p><code>FinalizationRegistry</code> fournit une méthode pour demander à ce qu'une fonction de nettoyage soit appelée à un moment lorsqu'un objet enregistré dans le registre de mémoire a été <em>récupéré</em> (traité par le ramasse-miettes). Ces fonctions de rappel pour du nettoyage sont parfois appelées <em>finaliseurs</em>.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note :</strong> Ces fonctions de rappels ne devraient pas être utilisées pour des opérations essentielles à la logique d'un programme. Voir les notes ci-après pour plus de détails.</p>\n</div>\n<p>On crée le registre en passant la fonction de rappel en paramètre&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> registre <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FinalizationRegistry</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">valeurTenue</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// …</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Ensuite, avec la méthode <code>register</code> on inscrit au registre les différents objets pour lesquels on veut que la fonction de rappel de nettoyage soit appelée. Cette fonction prend en argument la valeur courante et une <em>valeur tenue</em> pour celle-ci&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>registre<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>unObjet<span class=\"token punctuation\">,</span> <span class=\"token string\">\"une valeur\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Le registre ne conserve pas de référence forte vers l'objet, cela irait contre son objectif premier, car l'objet ne serait alors jamais traité par le ramasse-miettes.</p>\n<p>Lorsque <code>unObjet</code> est récupéré, la fonction de rappel de nettoyage pourra être appelée à un moment avec la <em>valeur tenue</em> fournie (<code>\"une valeur\"</code> dans l'exemple qui précède). La valeur tenue peut être n'importe quelle valeur&nbsp;: une valeur primitive, un objet, même <code>undefined</code>. Si la valeur tenue est un objet, le registre conservera une référence <em>forte</em> vers celle-ci (afin de pouvoir la passer comme argument à la fonction de rappel de nettoyage).</p>\n<p>Si vous souhaitez retirer un objet du registre plus tard, on passera un troisième argument à la méthode <code>register</code>. Cet argument sera <em>le jeton de désenregistrement</em> qui sera utilisé plus tard avec la méthode <code>unregister</code> afin de retirer l'objet du registre. Le registre ne conserve qu'une référence faible pour le jeton de désenregistrement.</p>\n<p>Une pratique fréquente consiste à utiliser l'objet lui-même comme jeton, ce qui fonctionne sans problème&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>registre<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>unObjet<span class=\"token punctuation\">,</span> <span class=\"token string\">\"une valeur\"</span><span class=\"token punctuation\">,</span> unObjet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// …plus tard si on ne s'intéresse plus à `unObjet`…</span>\nregistre<span class=\"token punctuation\">.</span><span class=\"token function\">unregister</span><span class=\"token punctuation\">(</span>unObjet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Il n'est toutefois pas nécessaire que ce soit le même objet, on peut tout à fait utiliser une autre valeur&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>registre<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>unObjet<span class=\"token punctuation\">,</span> <span class=\"token string\">\"une valeur\"</span><span class=\"token punctuation\">,</span> objetJeton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// …plus tard si on ne s'intéresse plus à `unObjet`…</span>\nregistre<span class=\"token punctuation\">.</span><span class=\"token function\">unregister</span><span class=\"token punctuation\">(</span>objetJeton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"constructeur","title":"Constructeur","isH3":false,"content":"<dl>\n  <dt id=\"finalizationregistry\"><a href=\"/fr/docs/Web/JavaScript/Reference/FinalizationRegistry/FinalizationRegistry\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>FinalizationRegistry()</code></a></dt>\n  <dd>\n    <p>Crée un nouvel objet <code>FinalizationRegistry</code>.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"méthodes_de_linstance","title":"Méthodes de l'instance","isH3":false,"content":"<dl>\n  <dt id=\"finalizationregistry.prototype.register\"><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry/register\"><code>FinalizationRegistry.prototype.register()</code></a></dt>\n  <dd>\n    <p>Enregistre un objet dans le registre afin de pouvoir déclencher une fonction de rappel de nettoyage lorsque l'objet est traité par le ramasse-miettes.</p>\n  </dd>\n  <dt id=\"finalizationregistry.prototype.unregister\"><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry/unregister\"><code>FinalizationRegistry.prototype.unregister()</code></a></dt>\n  <dd>\n    <p>Retire un objet du registre.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"à_éviter_si_possible","title":"À éviter si possible","isH3":false,"content":"<p>Une utilisation correcte de <code>FinalizationRegistry</code> nécessite une réflexion suffisante et il est préférable d'avoir à utiliser ces traitements si possible. Il est également important d'éviter d'avoir à dépendre de fonctionnements spécifiques non garantis par la spécification. Le moment, la façon et l'exécution même du ramasse-miettes dépendent éminemment de l'implémentation du moteur JavaScript. Tout comportement observé pour un moteur pourra être différent dans un autre moteur, dans une version différente du même moteur ou encore même dans une situation légèrement différente et pour la même version du même moteur. La gestion du ramasse-miettes est un problème complexe sur lequel travaillent constamment les personnes qui implémentent les moteurs JavaScript.</p>\n<p>Voici quelques sujets spécifiques inclus dans <a href=\"https://github.com/tc39/proposal-weakrefs/blob/master/reference.md\" class=\"external\" rel=\" noopener\">le document explicatif de la proposition correspondante</a>&nbsp;:</p>\n<blockquote>\n  <p><a href=\"https://fr.wikipedia.org/wiki/Ramasse-miettes_(informatique)\" class=\"external\" rel=\" noopener\">Les ramasses-miettes</a> sont compliqués. Si une application ou une bibliothèque dépend d'un ramasse-miettes nettoyant un registre FinalizationRegistry ou appelant un finaliseur de façon précise et prédictible, qu'elle se prépare à être déçue&nbsp;: le nettoyage pourra avoir lieu bien plus tard que prévu voire pas du tout. Ce comportement grandement variable est dû&nbsp;:</p>\n  <ul>\n    <li>Au fait qu'un objet peut être récupéré par le ramasse-miettes bien plus tôt qu'un autre, même s'il devient inaccessible au même temps, par exemple en raison du ramassage générationnel.</li>\n    <li>À l'action du ramasse-miettes qui peut être divisée dans le temps en utilisant des techniques incrémentales et concurrentes.</li>\n    <li>À des heuristiques d'exécution qui peuvent être utilisées afin d'équilibrer l'usage de la mémoire et la réactivité.</li>\n    <li>Au moteur JavaScript qui pourra tenir des références envers des choses qui semblent inaccessibles (comme des fermetures ou des caches en ligne).</li>\n    <li>À la différence des moteurs JavaScript ou au changement d'algorithmes pour un même moteur au fur et à mesure de ses différentes versions.</li>\n    <li>À des facteurs complexes pouvant maintenir en vie des objets pendant une période indéfinie comme avec l'utilisation de certaines API.</li>\n  </ul>\n</blockquote>"}},{"type":"prose","value":{"id":"notes_quant_aux_fonctions_de_rappel_de_nettoyage","title":"Notes quant aux fonctions de rappel de nettoyage","isH3":false,"content":"<p>Quelques notes à propos des fonctions de rappel de nettoyage&nbsp;:</p>\n<ul>\n  <li>On ne doit pas faire reposer une logique essentielle d'un programme sur les fonctions de rappel de nettoyage. Ces dernières peuvent être utiles afin de réduire l'utilisation de la mémoire pendant la vie d'un programme mais seront vraisemblablement inutiles autrement.</li>\n  <li>Une implémentation JavaScript conforme, y compris parmi celles qui implémentent un ramasse-miettes, n'est pas tenue d'appeler les fonctions de rappel de nettoyage. Le moment et l'éventualité de cet appel est entièrement dépendant des choix d'implémentation du moteur JavaScript. Lorsqu'un objet enregistré est récupéré, toute fonction de rappel de nettoyage déclarée pourra être appelée sur le coup, plus tard ou jamais.</li>\n  <li>Il est probable que les implémentations majeures des moteurs appelleront les fonctions de rappel de nettoyage à un moment pendant l'exécution mais ces appels pourront arriver bien après que l'objet en question ait été récupéré.</li>\n  <li>Il existe des situations où même les implémentations qui appellent ces fonctions de rappel ont peu de chance de les invoquer&nbsp;:\n    <ul>\n      <li>Lorsque le programme JavaScript s'interrompt entièrement (par exemple, lorsqu'on ferme un onglet dans un navigateur).</li>\n      <li>Lorsque l'instance de <code>FinalizationRegistry</code>, elle-même, n'est plus accessible depuis le reste du code JavaScript.</li>\n    </ul>\n  </li>\n</ul>"}},{"type":"prose","value":{"id":"exemples","title":"Exemples","isH3":false,"content":""}},{"type":"prose","value":{"id":"créer_un_nouveau_registre","title":"Créer un nouveau registre","isH3":true,"content":"<p>On crée le registre en y passant la fonction de rappel&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> registre <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FinalizationRegistry</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">valeurTenue</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ....</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"enregistrer_des_objets_en_vue_de_leur_nettoyage","title":"Enregistrer des objets en vue de leur nettoyage","isH3":true,"content":"<p>Ensuite, on enregistre les objets pour lesquels on souhaite avoir la fonction de rappel de nettoyage exécutée. Pour cela, on appelle la méthode <code>register</code> en lui passant l'objet et une <em>valeur tenue</em> correspondante&nbsp;:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>registre<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>unObjet<span class=\"token punctuation\">,</span> <span class=\"token string\">\"une valeur\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"specifications","value":{"title":"Spécifications","id":"spécifications","isH3":false,"specifications":[{"bcdSpecificationURL":"https://tc39.es/ecma262/multipage/managing-memory.html#sec-finalization-registry-objects","title":"ECMAScript Language Specification"}],"query":"javascript.builtins.FinalizationRegistry"}},{"type":"browser_compatibility","value":{"title":"Compatibilité des navigateurs","id":"compatibilité_des_navigateurs","isH3":false,"query":"javascript.builtins.FinalizationRegistry","dataURL":"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry/bcd.json"}},{"type":"prose","value":{"id":"voir_aussi","title":"Voir aussi","isH3":false,"content":"<ul>\n  <li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/WeakRef\"><code>WeakRef</code></a></li>\n  <li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/WeakSet\"><code>WeakSet</code></a></li>\n  <li><a href=\"/fr/docs/Web/JavaScript/Reference/Global_Objects/WeakMap\"><code>WeakMap</code></a></li>\n</ul>"}}],"toc":[{"text":"Description","id":"description"},{"text":"Constructeur","id":"constructeur"},{"text":"Méthodes de l'instance","id":"méthodes_de_linstance"},{"text":"À éviter si possible","id":"à_éviter_si_possible"},{"text":"Notes quant aux fonctions de rappel de nettoyage","id":"notes_quant_aux_fonctions_de_rappel_de_nettoyage"},{"text":"Exemples","id":"exemples"},{"text":"Spécifications","id":"spécifications"},{"text":"Compatibilité des navigateurs","id":"compatibilité_des_navigateurs"},{"text":"Voir aussi","id":"voir_aussi"}],"summary":"Un objet FinalizationRegistry permet de déclencher une fonction de rappel (callback) lorsqu'un objet est récupéré par le ramasse-miettes.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"FinalizationRegistry","locale":"en-US","native":"English (US)"},{"title":"FinalizationRegistry","locale":"ja","native":"日本語"},{"title":"FinalizationRegistry","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"fr/web/javascript/reference/global_objects/finalizationregistry","github_url":"https://github.com/mdn/translated-content/blob/main/files/fr/web/javascript/reference/global_objects/finalizationregistry/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/fr/docs/Web","title":"Technologies web pour développeurs"},{"uri":"/fr/docs/Web/JavaScript","title":"JavaScript"},{"uri":"/fr/docs/Web/JavaScript/Reference","title":"Référence JavaScript"},{"uri":"/fr/docs/Web/JavaScript/Reference/Global_Objects","title":"Objets globaux"},{"uri":"/fr/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry","title":"FinalizationRegistry"}],"pageTitle":"FinalizationRegistry - JavaScript | MDN","noIndexing":false}}