{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Using the Resource Timing API","mdn_url":"/zh-CN/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"<ol><li><strong><a href=\"/zh-CN/docs/Web/API/Resource_Timing_API\">Resource Timing API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>指南</summary><ol><li><a href=\"/zh-CN/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API\">Using the Resource Timing API</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>接口</summary><ol><li><a href=\"/zh-CN/docs/Web/API/Performance\"><code>Performance</code></a></li><li><a href=\"/zh-CN/docs/Web/API/PerformanceEntry\"><code>PerformanceEntry</code></a></li><li><a href=\"/zh-CN/docs/Web/API/PerformanceResourceTiming\"><code>PerformanceResourceTiming</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>属性</summary><ol><li><a href=\"/zh-CN/docs/Web/API/performance_property\"><code>performance_property</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p><strong>Resource Timing API</strong> 提供了获取和分析应用程序<em>资源</em>加载的详细网络计时数据的一种途径。应用可以使用一些可量化的时间度量标准，如加载特定资源的时长。这些资源可能是 <a href=\"/zh-CN/docs/Web/API/XMLHttpRequest\"><code>XMLHttpRequest</code></a>, <a href=\"/zh-CN/docs/Web/SVG/Element/svg\"><code>&lt;SVG&gt;</code></a>、图片、脚本等等。</p>\n<p>这个接口提供了使用 <a href=\"/zh-CN/docs/Web/API/DOMHighResTimeStamp\" title=\"高精度时间戳\"><code>高精度时间戳</code></a> 度量的资源加载时间轴。此时间轴包含众多网络事件的时间，如重定向开始和结束时间，开始请求资源时间，DNS 查询开始和结束时间，响应开始和结束时间等等。也包含了请求到的资源的大小、请求发起者的<em>类型</em>。</p>\n<p>这篇文档展示了如何使用 Resource Timing 接口。获取更详细的信息或示例，请查看每个接口的文档和<a href=\"#see_also\">See also</a>章节。</p>\n<p><a href=\"https://mdn.github.io/dom-examples/performance-apis/Using_the_Resource_Timing_API.html\" class=\"external\" rel=\" noopener\">Github</a>上有一个真实的例子，这里是它的源码 <a href=\"https://github.com/mdn/dom-examples/blob/master/performance-apis/Using_the_Resource_Timing_API.html\" class=\"external\" rel=\" noopener\">source code</a>. 欢迎提 pull request 和<a href=\"https://github.com/mdn/dom-examples/issues\" class=\"external\" rel=\" noopener\">报告 bug</a>。</p>"}},{"type":"prose","value":{"id":"资源加载的各个阶段","title":"资源加载的各个阶段","isH3":false,"content":"<p>应用可以获取到资源加载的各个阶段的时间戳，如重定向、DNS 查询、TCP 连接建立。这些阶段和他们的属性名在图 1 中列出。</p>\n<p>\n  <img src=\"/en-US/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API/resourcetiming-timestamps.jpg\" alt=\"Graphic of Resource Timing timestamps\" width=\"720\" height=\"540\" loading=\"lazy\">\n  图 1. Resource timing 属性\n</p>\n<p>应用开发者可以使用这些属性值去计算某个阶段的耗时长度，用来帮助诊断性能问题。</p>"}},{"type":"prose","value":{"id":"计算资源加载各阶段的时间","title":"计算资源加载各阶段的时间","isH3":false,"content":"<p>接下来的这段例子展示了用 Resource timing 属性去计算以下阶段的耗时：重定向 (<a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/redirectStart\"><code>redirectStart</code> <small>(en-US)</small></a> 和 <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/redirectEnd\"><code>redirectEnd</code> <small>(en-US)</small></a> )，DNS 查询 (<a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/domainLookupStart\"><code>domainLookupStart</code> <small>(en-US)</small></a> 和 <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/domainLookupEnd\"><code>domainLookupEnd</code> <small>(en-US)</small></a>)，TCP 握手 (<a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/connectStart\"><code>connectStart</code> <small>(en-US)</small></a> 和 <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/connectEnd\"><code>connectEnd</code> <small>(en-US)</small></a>)， 响应 (<a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/responseStart\"><code>responseStart</code> <small>(en-US)</small></a> 和 <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/responseEnd\"><code>responseEnd</code> <small>(en-US)</small></a>)。 这段例子也计算了从开始获取资源和请求开始（分别为<a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/fetchStart\"><code>fetchStart</code> <small>(en-US)</small></a> and <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/requestStart\"><code>requestStart</code> <small>(en-US)</small></a>）到响应结束 (<a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/responseEnd\"><code>responseEnd</code> <small>(en-US)</small></a>) 的时间。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">calculate_load_times</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Check performance support</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>performance <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= Calculate Load Times: performance NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Get a list of \"resource\" performance entries</span>\n  <span class=\"token keyword\">var</span> resources <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">getEntriesByType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resources <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">||</span> resources<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= Calculate Load Times: there are NO `resource` performance records\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= Calculate Load Times\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> resources<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"== Resource[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] - \"</span> <span class=\"token operator\">+</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Redirect time</span>\n    <span class=\"token keyword\">var</span> t <span class=\"token operator\">=</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>redirectEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>redirectStart<span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Redirect time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// DNS time</span>\n    t <span class=\"token operator\">=</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>domainLookupEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>domainLookupStart<span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... DNS lookup time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// TCP handshake time</span>\n    t <span class=\"token operator\">=</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>connectEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>connectStart<span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... TCP time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Secure connection time</span>\n    t <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>secureConnectionStart <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>connectEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>secureConnectionStart<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Secure connection time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Response time</span>\n    t <span class=\"token operator\">=</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>responseEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>responseStart<span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Response time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Fetch until response end</span>\n    t <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>fetchStart <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>responseEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>fetchStart<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Fetch until response end time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Request start until reponse end</span>\n    t <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>requestStart <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>responseEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>requestStart<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Request start until response end time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Start until reponse end</span>\n    t <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>responseEnd <span class=\"token operator\">-</span> resources<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>startTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Start until response end time = \"</span> <span class=\"token operator\">+</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"size_matters","title":"Size matters?","isH3":false,"content":"<p>The size of an application's resources can affect an application's performance so getting accurate data on resource size can be important (especially for non-hosted resources). The <a href=\"/zh-CN/docs/Web/API/PerformanceResourceTiming\"><code>PerformanceResourceTiming</code></a> interface has three properties that can be used to obtain size data about a resource. The <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/transferSize\"><code>transferSize</code> <small>(en-US)</small></a> property returns the size (in octets) of the fetched resource including the response header fields plus the response payload body. The <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/encodedBodySize\"><code>encodedBodySize</code> <small>(en-US)</small></a> property returns the size (in octets) received from the fetch (HTTP or cache), of the <em>payload body</em>, <strong>before</strong> removing any applied content-codings. <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceResourceTiming/decodedBodySize\"><code>decodedBodySize</code> <small>(en-US)</small></a> returns the size (in octets) received from the fetch (HTTP or cache) of the <em>message body</em>, <strong>after</strong> removing any applied content-codings.</p>\n<p>The following example demonstrates using these three properties.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">display_size_data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Check for support of the PerformanceResourceTiming.*size properties and print their values</span>\n  <span class=\"token comment\">// if supported.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>performance <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= Display Size Data: performance NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">var</span> list <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">getEntriesByType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>list <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= Display Size Data: performance.getEntriesByType() is  NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// For each \"resource\", display its *Size property values</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= Display Size Data\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> list<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"== Resource[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] - \"</span> <span class=\"token operator\">+</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"decodedBodySize\"</span> <span class=\"token keyword\">in</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... decodedBodySize[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] = \"</span> <span class=\"token operator\">+</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>decodedBodySize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... decodedBodySize[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] = NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"encodedBodySize\"</span> <span class=\"token keyword\">in</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... encodedBodySize[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] = \"</span> <span class=\"token operator\">+</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>encodedBodySize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... encodedBodySize[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] = NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"transferSize\"</span> <span class=\"token keyword\">in</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... transferSize[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] = \"</span> <span class=\"token operator\">+</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>transferSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... transferSize[\"</span> <span class=\"token operator\">+</span> i <span class=\"token operator\">+</span> <span class=\"token string\">\"] = NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"managing_the_resource_buffer","title":"Managing the resource buffer","isH3":false,"content":"<p>Although the browser is required to support at least 150 resource timing performance entries in its <em>resource timing buffer</em>, some applications may use more resources than that limit. To help the developer manage the buffer size, Resource Timing defines two methods that extend the <a href=\"/zh-CN/docs/Web/API/Performance\"><code>Performance</code></a> interface. The <a href=\"/zh-CN/docs/Web/API/Performance/clearResourceTimings\" title=\"clearResourceTimings()\"><code>clearResourceTimings()</code></a> method removes all \"<code>resource</code>\" type performance entries from the browser's resource performance entry buffer. The <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Performance/setResourceTimingBufferSize\"><code>setResourceTimingBufferSize()</code> <small>(en-US)</small></a> method sets the resource performance entry buffer size to the specified number of resource <a href=\"/zh-CN/docs/Web/API/PerformanceEntry\" title=\"performance entries\"><code>performance entries</code></a>.</p>\n<p>The following example demonstrates the usage of these two methods.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">clear_resource_timings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>performance <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= performance.clearResourceTimings(): peformance NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Check if Performance.clearResourceTiming() is supported</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"= Print performance.clearResourceTimings()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> supported <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> performance<span class=\"token punctuation\">.</span>clearResourceTimings <span class=\"token operator\">==</span> <span class=\"token string\">\"function\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>supported<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Performance.clearResourceTimings() = supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    performance<span class=\"token punctuation\">.</span><span class=\"token function\">clearResourceTimings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Performance.clearResourceTiming() = NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// getEntries should now return zero</span>\n  <span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">getEntriesByType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Performance data buffer cleared\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Performance data buffer NOT cleared (still have `\"</span> <span class=\"token operator\">+</span> p<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> <span class=\"token string\">\"` items\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">set_resource_timing_buffer_size</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>performance <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"= performance.setResourceTimingBufferSize(): peformance NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Check if Performance.setResourceTimingBufferSize() is supported</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"= performance.setResourceTimingBufferSize()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> supported <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> performance<span class=\"token punctuation\">.</span>setResourceTimingBufferSize <span class=\"token operator\">==</span> <span class=\"token string\">\"function\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>supported<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Performance.setResourceTimingBufferSize() = supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    performance<span class=\"token punctuation\">.</span><span class=\"token function\">setResourceTimingBufferSize</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"... Performance.setResourceTimingBufferSize() = NOT supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The <a href=\"/zh-CN/docs/Web/API/Performance\"><code>Performance</code></a> interface has a <a href=\"/zh-CN/docs/Web/API/Performance/resourcetimingbufferfull_event\" title=\"onresourcetimingbufferfull\"><code>onresourcetimingbufferfull</code></a> event handler that gets called (with an <a href=\"/zh-CN/docs/Web/API/Event\"><code>Event</code></a> of type <a href=\"/zh-CN/docs/Web/API/Event/type\"><code>Event.type</code></a> of \"<code><a href=\"/zh-CN/docs/Web/Reference/Events/resourcetimingbufferfull\" title=\"This is a link to an unwritten page\" class=\"page-not-created\">resourcetimingbufferfull</a></code>\") when the browser's resource performance entry buffer is full. The following code example sets a <a href=\"/zh-CN/docs/Web/API/Performance/resourcetimingbufferfull_event\" title=\"onresourcetimingbufferfull\"><code>onresourcetimingbufferfull</code></a> event callback in the <code>init()</code> function.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">buffer_full</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WARNING: Resource Timing Buffer is FULL!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">set_resource_timing_buffer_size</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// load some image to trigger \"resource\" fetch events</span>\n  <span class=\"token keyword\">var</span> image1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  image1<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"https://developer.mozilla.org/static/img/opengraph-logo.png\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> image2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  image2<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"http://mozorg.cdn.mozilla.net/media/img/firefox/firefox-256.e2c1fc556816.jpg\"</span>\n\n  <span class=\"token comment\">// Set a callback if the resource buffer becomes filled</span>\n  performance<span class=\"token punctuation\">.</span>onresourcetimingbufferfull <span class=\"token operator\">=</span> buffer_full<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"coping_with_cors","title":"Coping with CORS","isH3":false,"content":"<p>When <a href=\"/zh-CN/docs/Glossary/CORS\">CORS</a> is in effect, many of the timing properties' values are returned as zero unless the server's access policy permits these values to be shared. This requires the server providing the resource to send the <a href=\"/zh-CN/docs/Web/HTTP/Headers/Timing-Allow-Origin\"><code>Timing-Allow-Origin</code></a> HTTP response header with a value specifying the origin or origins which are allowed to get the restricted timestamp values.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>备注：</strong> The properties which are returned as 0 by default when loading a resource from a domain other than the one of the web page itself: <code>redirectStart</code>, <code>redirectEnd</code>, <code>domainLookupStart</code>, <code>domainLookupEnd</code>, <code>connectStart</code>, <code>connectEnd</code>, <code>secureConnectionStart</code>, <code>requestStart</code>, and <code>responseStart</code>.</p>\n</div>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"https://firefox-source-docs.mozilla.org/devtools-user/performance/index.html\" class=\"external\" rel=\" noopener\">Firefox Performance Tool</a></li>\n  <li><a href=\"https://w3c.github.io/resource-timing/\" class=\"external\" rel=\" noopener\">Resource Timing Standard</a>; W3C Editor's Draft</li>\n  <li><a href=\"https://www.stevesouders.com/blog/2014/08/21/resource-timing-practical-tips/\" class=\"external\" rel=\" noopener\">Resource Timing practical tips</a>; Steve Souders; 2014 August 21</li>\n  <li><a href=\"https://googledevelopers.blogspot.ca/2013/12/measuring-network-performance-with.html\" class=\"external\" rel=\" noopener\">Measuring network performance with Resource Timing API</a>; Ilya Grigorik; 2013 December 11</li>\n</ul>"}}],"toc":[{"text":"资源加载的各个阶段","id":"资源加载的各个阶段"},{"text":"计算资源加载各阶段的时间","id":"计算资源加载各阶段的时间"},{"text":"Size matters?","id":"size_matters"},{"text":"Managing the resource buffer","id":"managing_the_resource_buffer"},{"text":"Coping with CORS","id":"coping_with_cors"},{"text":"See also","id":"see_also"}],"summary":"Resource Timing API 提供了获取和分析应用程序资源加载的详细网络计时数据的一种途径。应用可以使用一些可量化的时间度量标准，如加载特定资源的时长。这些资源可能是 XMLHttpRequest, <SVG>、图片、脚本等等。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Using the Resource Timing API","locale":"en-US","native":"English (US)"},{"title":"Using the Resource Timing API","locale":"ja","native":"日本語"}],"source":{"folder":"zh-cn/web/api/resource_timing_api/using_the_resource_timing_api","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/web/api/resource_timing_api/using_the_resource_timing_api/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Web","title":"Web 开发技术"},{"uri":"/zh-CN/docs/Web/API","title":"Web API 接口参考"},{"uri":"/zh-CN/docs/Web/API/Resource_Timing_API","title":"Resource Timing API"},{"uri":"/zh-CN/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API","title":"Using the Resource Timing API"}],"pageTitle":"Using the Resource Timing API - Web API 接口参考 | MDN","noIndexing":false}}