{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Web-based protocol handlers","mdn_url":"/zh-CN/docs/Web/API/Navigator/registerProtocolHandler/Web-based_protocol_handlers","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"","body":[{"type":"prose","value":{"id":"背景","title":"背景","isH3":false,"content":"<p>利用非 HTTP 协议，从网页链接到一些别的资源，这种做法是相当普遍的。比如 <code>mailto:</code> 协议：</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mailto:webmaster@example.com<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Web Master<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>当 Web 页面作者想直接从网页上，为用户提供一个方便的方式发送一个电子邮件，时可以使用 <code>mailto:</code> 链接。激活链接时，浏览器应该启动默认的桌面应用程序来处理电子邮件。你可以认为这是一个<em>基于桌面的</em>协议处理器。</p>\n<p>基于网络的协议处理程序也允许基于 Web 的应用程序参与这一过程。随着越来越多的类型的应用程序迁移到 Web，这变得越来越重要。事实上，有许多基于 Web 的电子邮件处理的应用程序可以处理一个 mailto 链接。</p>"}},{"type":"prose","value":{"id":"注册","title":"注册","isH3":false,"content":"<p>设置一个 Web 应用程序作为一个协议处理器不是一个很麻烦的过程。Web 应用程序可以使用 <a href=\"/en-US/docs/Web/API/Navigator/registerProtocolHandler\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">registerProtocolHandler() (en-US)</a> 注册到浏览器上，从而对于一个给定的协议来讲，作为一个潜在的处理程序。例如：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>navigator<span class=\"token punctuation\">.</span><span class=\"token function\">registerProtocolHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mailto\"</span><span class=\"token punctuation\">,</span>\n                                  <span class=\"token string\">\"https://www.example.com/?uri=%s\"</span><span class=\"token punctuation\">,</span>\n                                  <span class=\"token string\">\"Example Mail\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>参数为：</p>\n<ul>\n  <li>协议名称。</li>\n  <li>URL 模板。%s 用来替换链接的 <code>href</code> 属性，之后通过这个 URL 来发起一个 GET 请求。</li>\n  <li>一个对用户友好的协议处理器的名字。</li>\n</ul>\n<p>当一个浏览器执行这段代码时，它应该向用户显示一个请求，让用户许可为处理这个协议而注册一个 Web 应用程序的请求。Firefox 在通知栏区域显示一个提示：</p>\n<p>\n  <img src=\"/@api/deki/files/972/=Wph-notification.png\" alt=\"Image:wph-notification.png\" loading=\"lazy\">\n</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>备注：</strong> 试图执行登记或注册时，当前网页必须与提供的 URL 模板在相同的域，否则将会失败。例如，<code>http://example.com/homepage.html</code> 可以为 <code>http://example.com/handle_mailto/%s</code> 注册一个协议处理程序，但 <code>http://example.org/handle_mailto/%s</code> 不可以。</p>\n</div>\n<p>多次注册相同的协议处理程序会弹出不同的通知，表明协议处理器已经注册。因此，发起一个注册协议处理程序的请求，之后检查是否注册是一个很好的方法。比如下面的例子：</p>"}},{"type":"prose","value":{"id":"例子","title":"例子","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> <span class=\"token constant\">HTML</span> <span class=\"token constant\">PUBLIC</span> <span class=\"token string\">\"-//W3C//DTD HTML 4.01//EN\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"en\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">&gt;</span>\n  <span class=\"token operator\">&lt;</span>title<span class=\"token operator\">&gt;</span>Web Protocol Handler Sample <span class=\"token operator\">-</span> Register<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">&gt;</span>\n  <span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/javascript\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://starkravingfinkle.org/projects/wph/handler.php?value=%s\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>navigator<span class=\"token punctuation\">.</span><span class=\"token function\">isProtocolHandlerRegistered</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fake\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      navigator<span class=\"token punctuation\">.</span><span class=\"token function\">registerProtocolHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fake\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Fake Protocol\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">&gt;</span>\n  <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">&gt;</span>Web Protocol Handler Sample<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">&gt;</span>\n  <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">&gt;</span>This web page will install a web protocol handler <span class=\"token keyword\">for</span> the <span class=\"token operator\">&lt;</span>code<span class=\"token operator\">&gt;</span>fake<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>code<span class=\"token operator\">&gt;</span> protocol<span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">&gt;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"激活","title":"激活","isH3":false,"content":"<p>现在，只要用户点击链接，使用注册协议，浏览器将跳转到 Web 应用程序注册时提供的 URL。Firefox 在默认情况下，跳转前会提示用户操作。</p>\n<p>\n  <img src=\"/@api/deki/files/971/=Wph-launch.png\" alt=\"Image:wph-launch.png\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"example","title":"Example","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">HTML</span> <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//W3C//DTD HTML 4.01//EN\"</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">&gt;</span></span>Web Protocol Handler Sample - Test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>Hey have you seen <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fake:this%20is%20fake<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>this<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span> before?<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"处理","title":"处理","isH3":false,"content":"<p>下一步是处理这个动作。浏览器在激活的链接中提取出 href 属性，之后与注册时提供的 URL 模板进行拼装，之后经由拼装好的 URL 发起一个 HTTP GET 请求。因此下面的例子中，浏览器会基于此 URL 发起一个 GET 请求：</p>\n<pre class=\"notranslate\">http://starkravingfinkle.org/projects/wph/handler.php?value=fake:this%20is%20fake\n</pre>\n<p>服务端代码可以提取查询字符串的参数，执行所需的操作。</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>备注：</strong> 服务端代码会接收到 href 的<strong>全部</strong>内容。这意味着服务端代码必须解析出数据中的协议。</p>\n</div>"}},{"type":"prose","value":{"id":"example_2","title":"Example","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: php notranslate\"><code><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$value</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"value\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$value</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"value\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?&gt;</span></span>\n\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">HTML</span> <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//W3C//DTD HTML 4.01//EN\"</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">&gt;</span></span>Web Protocol Handler Sample<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>Web Protocol Handler Sample - Handler<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>This web page is called when handling a <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>code</span><span class=\"token punctuation\">&gt;</span></span>fake:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>code</span><span class=\"token punctuation\">&gt;</span></span> protocol action. The data sent:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>textarea</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">htmlspecialchars</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ENT_QUOTES</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'UTF-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>textarea</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"参考","title":"参考","isH3":false,"content":"<ul>\n  <li><a href=\"https://www.w3.org/TR/2011/WD-html5-20110525/timers.html#custom-handlers\" class=\"external\" rel=\" noopener\">http://www.w3.org/TR/2011/WD-html5-20110525/timers.html#custom-handlers</a></li>\n</ul>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"/zh-CN/docs/DOM/window.navigator.registerContentHandler\" class=\"page-not-created\" title=\"This is a link to an unwritten page\">window.navigator.registerContentHandler</a></li>\n  <li><a href=\"/zh-CN/docs/XPCOM_Interface_Reference/nsIProtocolHandler\" class=\"page-not-created\" title=\"This is a link to an unwritten page\">nsIProtocolHandler</a> (XUL only)</li>\n  <li><a href=\"https://blog.mozilla.com/webdev/2010/07/26/registerprotocolhandler-enhancing-the-federated-web/\" class=\"external\" rel=\" noopener\">RegisterProtocolHandler Enhancing the Federated Web</a> at Mozilla Webdev</li>\n  <li><a href=\"https://developers.google.com/web/updates/2011/06/Registering-a-custom-protocol-handler\" class=\"external\" rel=\" noopener\">Register a custom protocolHandler</a> at Google Developers.</li>\n</ul>"}}],"toc":[{"text":"背景","id":"背景"},{"text":"注册","id":"注册"},{"text":"激活","id":"激活"},{"text":"处理","id":"处理"},{"text":"参考","id":"参考"},{"text":"See also","id":"see_also"}],"summary":"利用非 HTTP 协议，从网页链接到一些别的资源，这种做法是相当普遍的。比如 mailto: 协议：","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Web-based protocol handlers","locale":"en-US","native":"English (US)"},{"title":"Controladores de protocolos basados en web","locale":"es","native":"Español"},{"title":"Gestionnaires de protocoles web","locale":"fr","native":"Français"},{"title":"ウェブベースのプロトコルハンドラー","locale":"ja","native":"日本語"},{"title":"Firefox 3 Web-based protocol handler","locale":"zh-TW","native":"正體中文 (繁體)"}],"source":{"folder":"zh-cn/web/api/navigator/registerprotocolhandler/web-based_protocol_handlers","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/web/api/navigator/registerprotocolhandler/web-based_protocol_handlers/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Web","title":"Web 开发技术"},{"uri":"/zh-CN/docs/Web/API","title":"Web API 接口参考"},{"uri":"/zh-CN/docs/Web/API/Navigator","title":"Navigator"},{"uri":"/zh-CN/docs/Web/API/Navigator/registerProtocolHandler","title":"Navigator.registerProtocolHandler()"},{"uri":"/zh-CN/docs/Web/API/Navigator/registerProtocolHandler/Web-based_protocol_handlers","title":"Web-based protocol handlers"}],"pageTitle":"Web-based protocol handlers - Web API 接口参考 | MDN","noIndexing":false}}