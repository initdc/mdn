{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Long Tasks API","mdn_url":"/zh-CN/docs/Web/API/Long_Tasks_API","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"","body":[{"type":"prose","value":{"id":"目的","title":"目的","isH3":false,"content":"<p>*Long Tasks，*这是一个实验性 API，它可以直观地告诉我们哪些任务执行耗费了 50 毫秒或更多时间。50 毫秒这个阈值标准来源于《<a href=\"https://developers.google.com/web/fundamentals/performance/rail\" class=\"external\" rel=\" noopener\">RAIL Model</a>》中 <a href=\"https://developers.google.com/web/fundamentals/performance/rail#response\" class=\"external\" rel=\" noopener\">\"Response: process events in under 50ms\"</a> 章节。</p>\n<p>阻塞主线程达 50 毫秒或以上的任务会导致以下问题：</p>\n<ul>\n  <li><a href=\"https://www.w3.org/TR/2017/WD-longtasks-1-20170907/#intro\" class=\"external\" rel=\" noopener\"></a><a class=\"page-not-created\" title=\"此文档尚未被撰写，期待你的贡献!\"><code>可交互时间</code></a> 延迟</li>\n  <li>严重不稳定的交互行为 (轻击、单击、滚动、滚轮等) 延迟（<a href=\"https://www.w3.org/TR/2017/WD-longtasks-1-20170907/#intro\" class=\"external\" rel=\" noopener\">High/variable input latency</a>）</li>\n  <li>严重不稳定的事件回调延迟（<a href=\"https://www.w3.org/TR/2017/WD-longtasks-1-20170907/#intro\" class=\"external\" rel=\" noopener\">High/variable event handling latency</a>）</li>\n  <li>紊乱的动画和滚动（<a href=\"https://www.w3.org/TR/2017/WD-longtasks-1-20170907/#intro\" class=\"external\" rel=\" noopener\">Janky animations and scrolling</a>）</li>\n</ul>"}},{"type":"prose","value":{"id":"概念","title":"概念","isH3":false,"content":"<p>长任务（Long task）API 使用的一些关键术语或思想。</p>"}},{"type":"prose","value":{"id":"长任务（long_task）","title":"长任务（Long task）","isH3":true,"content":"<p>任何连续不间断的且主 UI 线程繁忙 50 毫秒及以上的时间区间。比如以下常规场景：</p>\n<ul>\n  <li>长耗时的事件回调（long running event handlers）</li>\n  <li>代价高昂的回流和其他重绘（expensive reflows and other re-renders）</li>\n  <li>浏览器在超过 50 毫秒的事件循环的相邻循环之间所做的工作（work the browser does between different turns of the event loop that exceeds 50 ms）</li>\n</ul>"}},{"type":"prose","value":{"id":"浏览上下文的罪魁容器","title":"浏览上下文的罪魁容器","isH3":true,"content":"<p>浏览上下文的罪魁容器，简称“容器”，指任务发生在其中的顶层页面（the top level page）、iframe、嵌入插槽（embed）或对象（object）。</p>"}},{"type":"prose","value":{"id":"清单（attributions）","title":"清单（Attributions）","isH3":true,"content":"<p>即执行任务的容器清单。针对没有在顶层页面容器内执行的任务，<code>containerId</code>、<code>containerName</code>和<code>containerSrc</code>字段可以用来提供任务源信息。</p>"}},{"type":"prose","value":{"id":"用法","title":"用法","isH3":false,"content":"<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PerformanceObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">list</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> perfEntries <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">getEntries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> perfEntries<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Process long task notifications:</span>\n        <span class=\"token comment\">// report back for analytics and monitoring</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// register observer for long task notifications</span>\nobserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">entryTypes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"longtask\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Long script execution after this will result in queueing</span>\n<span class=\"token comment\">// and receiving \"longtask\" entries in the observer.</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"接口","title":"接口","isH3":false,"content":"<dl>\n  <dt id=\"performancelongtasktiming_en-us\"><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceLongTaskTiming\"><code>PerformanceLongTaskTiming</code> <small>(en-US)</small></a></dt>\n  <dd>\n    <p>返回长任务实例。</p>\n  </dd>\n  <dt id=\"taskattributiontiming_en-us\"><a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/TaskAttributionTiming\"><code>TaskAttributionTiming</code> <small>(en-US)</small></a></dt>\n  <dd>\n    <p>返回长任务中涉及的工作及其关联的框架上下文信息。</p>\n  </dd>\n</dl>"}},{"type":"specifications","value":{"title":"规范","id":"规范","isH3":false,"query":"api.PerformanceLongTaskTiming,api.TaskAttributionTiming","specifications":[]}},{"type":"browser_compatibility","value":{"title":"浏览器兼容性","id":"浏览器兼容性","isH3":false,"data":null,"query":"api.PerformanceLongTaskTiming,api.TaskAttributionTiming","browsers":null}},{"type":"prose","value":{"id":"相关推荐","title":"相关推荐","isH3":false,"content":"<ul>\n  <li><a href=\"https://github.com/w3c/longtasks\" class=\"external\" rel=\" noopener\">GitHub repository</a> 包含文档和代码范例。</li>\n  <li><a href=\"https://calendar.perfplanet.com/2017/tracking-cpu-with-long-tasks-api/\" class=\"external\" rel=\" noopener\">PerfPlanet article</a> on Long Tasks API from 20th December 2017.</li>\n</ul>"}}],"toc":[{"text":"目的","id":"目的"},{"text":"概念","id":"概念"},{"text":"用法","id":"用法"},{"text":"接口","id":"接口"},{"text":"规范","id":"规范"},{"text":"浏览器兼容性","id":"浏览器兼容性"},{"text":"相关推荐","id":"相关推荐"}],"summary":"*Long Tasks，*这是一个实验性 API，它可以直观地告诉我们哪些任务执行耗费了 50 毫秒或更多时间。50 毫秒这个阈值标准来源于《RAIL Model》中 \"Response: process events in under 50ms\" 章节。","popularity":0.0002,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Long Tasks API","locale":"en-US","native":"English (US)"},{"title":"Long Tasks API","locale":"ja","native":"日本語"}],"source":{"folder":"zh-cn/web/api/long_tasks_api","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/web/api/long_tasks_api/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Web","title":"Web 开发技术"},{"uri":"/zh-CN/docs/Web/API","title":"Web API 接口参考"},{"uri":"/zh-CN/docs/Web/API/Long_Tasks_API","title":"Long Tasks API"}],"pageTitle":"Long Tasks API - Web API 接口参考 | MDN","noIndexing":false}}