{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"canvas 的优化","mdn_url":"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"\n <ol>\n  <li><a href=\"/zh-CN/docs/Web/API/Canvas_API\"><strong>Canvas API</strong></a></li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Canvas 教程</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Basic_usage\">基本用法</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes\">绘制形状</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Applying_styles_and_colors\">添加样式和颜色</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_text\">绘制文本</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Using_images\">使用图片</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Transformations\">变形</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing\">合成与裁剪</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Basic_animations\">基本动画</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Advanced_animations\">高级动画</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas\">像素操作</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas\">canvas 的优化</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Finale\">终极</a></li>\n        </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>示例</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/A_basic_ray-caster\">一个基本的光线投射例子</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Manipulating_video_using_canvas\">在 canvas 中操作视频</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>接口</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/Web/API/HTMLCanvasElement\"><code>HTMLCanvasElement</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/CanvasRenderingContext2D\"><code>CanvasRenderingContext2D</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/CanvasGradient\"><code>CanvasGradient</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/CanvasPattern\"><code>CanvasPattern</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/ImageBitmap\"><code>ImageBitmap</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/ImageData\"><code>ImageData</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/TextMetrics\"><code>TextMetrics</code></a></li>\n        <li><svg class=\"icon icon-experimental\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-experimental\"></use>\n</svg> <a href=\"/zh-CN/docs/Web/API/Path2D\"><code>Path2D</code></a></li>\n      </ol>\n    </details>\n  </li>\n  <li><strong><a href=\"/zh-CN/docs/MDN\">文档:</a></strong></li>\n  <li class=\"toggle\">\n    <details>\n      <summary>贡献</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/MDN\">MDN 项目</a></li>\n      </ol>\n    </details>\n  </li>\n </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<ul class=\"prev-next\">\n    <li><a class=\"button minimal page-not-created\" href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Hit_regions_and_accessibility\" title=\"This is a link to an unwritten page\">« 上一页</a></li>\n    <li><a class=\"button minimal\" href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Finale\">下一页  »</a></li>\n</ul>\n<p><a href=\"/zh-CN/docs/Web/HTML/Element/canvas\"><code>&lt;canvas&gt;</code></a>元素是众多广泛使用的网络 2D 图像渲染标准之一。它被广泛用于游戏及复杂的图像可视化中。然而，随着网站和应用将 canvas 画布推至极限，性能开始成为问题。此文目标是给使用 canvas 画布元素的优化带来建议，去保证你的网站或者应用表现卓越。</p>"}},{"type":"prose","value":{"id":"性能贴士","title":"性能贴士","isH3":false,"content":"<p>下面是一些改善性能的建议</p>"}},{"type":"prose","value":{"id":"在离屏_canvas_上预渲染相似的图形或重复的对象","title":"在离屏 canvas 上预渲染相似的图形或重复的对象","isH3":true,"content":"<p>如果发现自己在每个动画帧上重复了一些相同的绘制操作，请考虑将其分流到屏幕外的画布上。然后，您可以根据需要频繁地将屏幕外图像渲染到主画布上，而不必首先重复生成该图像的步骤。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>myEntity<span class=\"token punctuation\">.</span>offscreenCanvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyEntity<span class=\"token punctuation\">.</span>offscreenCanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> myEntity<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\nmyEntity<span class=\"token punctuation\">.</span>offscreenCanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> myEntity<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\nmyEntity<span class=\"token punctuation\">.</span>offscreenContext <span class=\"token operator\">=</span> myEntity<span class=\"token punctuation\">.</span>offscreenCanvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmyEntity<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>myEntity<span class=\"token punctuation\">.</span>offscreenContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"避免浮点数的坐标点，用整数取而代之","title":"避免浮点数的坐标点，用整数取而代之","isH3":true,"content":"<p>当你画一个没有整数坐标点的对象时会发生子像素渲染。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>myImage<span class=\"token punctuation\">,</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>浏览器为了达到抗锯齿的效果会做额外的运算。为了避免这种情况，请保证在你调用<a href=\"/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage\" title=\"drawImage()\"><code>drawImage()</code></a>函数时，用<a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/floor\"><code>Math.floor()</code></a>函数对所有的坐标点取整。</p>"}},{"type":"prose","value":{"id":"不要在用drawimage时缩放图像","title":"不要在用<code>drawImage</code>时缩放图像","isH3":true,"content":"<p>在离屏 canvas 中缓存图片的不同尺寸，而不要用<a href=\"/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage\" title=\"drawImage()\"><code>drawImage()</code></a>去缩放它们。</p>","titleAsText":"不要在用drawImage时缩放图像"}},{"type":"prose","value":{"id":"使用多层画布去画一个复杂的场景","title":"使用多层画布去画一个复杂的场景","isH3":true,"content":"<p>在您的应用程序中，您可能会发现某些对象需要经常移动或更改，而其他对象则保持相对静态。在这种情况下，可能的优化是使用多个<code>&lt;canvas&gt;</code>元素对您的项目进行分层。</p>\n<p>例如，假设您有一个游戏，其 UI 位于顶部，中间是游戏性动作，底部是静态背景。在这种情况下，您可以将游戏分成三个<code>&lt;canvas&gt;</code>层。UI 将仅在用户输入时发生变化，游戏层随每个新框架发生变化，并且背景通常保持不变。</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stage<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ui-layer<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>480<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>320<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>game-layer<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>480<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>320<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>background-layer<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>480<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>320<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token style\"><span class=\"token language-css\">\n  <span class=\"token selector\">#stage</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 480px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 320px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 2px solid black\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\">canvas</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\">#ui-layer</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 3 <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\">#game-layer</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 2 <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\">#background-layer</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 1 <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"用_css_设置大的背景图","title":"用 CSS 设置大的背景图","isH3":true,"content":"<p>如果像大多数游戏那样，你有一张静态的背景图，用一个静态的<a href=\"/zh-CN/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a>元素，结合<a href=\"/zh-CN/docs/Web/CSS/background\"><code>background</code></a> 特性，以及将它置于画布元素之后。这么做可以避免在每一帧在画布上绘制大图。</p>"}},{"type":"prose","value":{"id":"用_css_transforms_特性缩放画布","title":"用 CSS transforms 特性缩放画布","isH3":true,"content":"<p><a href=\"/zh-CN/docs/Web/CSS/CSS_Transforms/Using_CSS_transforms\">CSS transforms</a> 使用 GPU，因此速度更快。最好的情况是不直接缩放画布，或者具有较小的画布并按比例放大，而不是较大的画布并按比例缩小。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> scaleX <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">/</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> scaleY <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">/</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> scaleToFit <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>scaleX<span class=\"token punctuation\">,</span> scaleY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> scaleToCover <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>scaleX<span class=\"token punctuation\">,</span> scaleY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nstage<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transformOrigin <span class=\"token operator\">=</span> <span class=\"token string\">'0 0'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//scale from top left</span>\nstage<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transform <span class=\"token operator\">=</span> <span class=\"token string\">'scale('</span> <span class=\"token operator\">+</span> scaleToFit <span class=\"token operator\">+</span> <span class=\"token string\">')'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"关闭透明度","title":"关闭透明度","isH3":true,"content":"<p>如果你的游戏使用画布而且不需要透明，当使用 <a href=\"/zh-CN/docs/Web/API/HTMLCanvasElement/getContext\"><code>HTMLCanvasElement.getContext()</code></a> 创建一个绘图上下文时把 <code>alpha</code> 选项设置为 <code>false</code> 。这个选项可以帮助浏览器进行内部优化。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">alpha</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"更多的贴士","title":"更多的贴士","isH3":true,"content":"<ul>\n  <li>将画布的函数调用集合到一起（例如，画一条折线，而不要画多条分开的直线）</li>\n  <li>避免不必要的画布状态改变</li>\n  <li>渲染画布中的不同点，而非整个新状态</li>\n  <li>尽可能避免 <a href=\"/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowBlur\" title=\"shadowBlur\"><code>shadowBlur</code></a>特性</li>\n  <li>尽可能避免<a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_text\">text rendering</a></li>\n  <li>尝试不同的方法来清除画布 (<a href=\"/zh-CN/docs/Web/API/CanvasRenderingContext2D/clearRect\" title=\"clearRect()\"><code>clearRect()</code></a> vs. <a href=\"/zh-CN/docs/Web/API/CanvasRenderingContext2D/fillRect\" title=\"fillRect()\"><code>fillRect()</code></a> vs. 调整 canvas 大小)</li>\n  <li>有动画，请使用<a href=\"/zh-CN/docs/Web/API/Window/requestAnimationFrame\"><code>window.requestAnimationFrame()</code></a> 而非<a href=\"/zh-CN/docs/Web/API/setInterval\"><code>window.setInterval()</code></a></li>\n  <li>请谨慎使用大型物理库</li>\n</ul>"}},{"type":"prose","value":{"id":"参见","title":"参见","isH3":false,"content":"<ul>\n  <li><a href=\"https://www.html5rocks.com/en/tutorials/canvas/performance/#toc-ref\" class=\"external\" rel=\" noopener\">Improving HTML5 Canvas Performance – HTML5 Rocks</a></li>\n  <li><a href=\"https://hacks.mozilla.org/2013/05/optimizing-your-javascript-game-for-firefox-os/\" class=\"external\" rel=\" noopener\">Optimizing your JavaScript game for Firefox OS – Mozilla Hacks</a></li>\n</ul><ul class=\"prev-next\">\n    <li><a class=\"button minimal page-not-created\" href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Hit_regions_and_accessibility\" title=\"This is a link to an unwritten page\">« 上一页</a></li>\n    <li><a class=\"button minimal\" href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Finale\">下一页  »</a></li>\n</ul>"}}],"toc":[{"text":"性能贴士","id":"性能贴士"},{"text":"参见","id":"参见"}],"summary":"<canvas>元素是众多广泛使用的网络 2D 图像渲染标准之一。它被广泛用于游戏及复杂的图像可视化中。然而，随着网站和应用将 canvas 画布推至极限，性能开始成为问题。此文目标是给使用 canvas 画布元素的优化带来建议，去保证你的网站或者应用表现卓越。","popularity":0.0008,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Optimizing canvas","locale":"en-US","native":"English (US)"},{"title":"Optimizing canvas","locale":"es","native":"Español"},{"title":"Optimiser les Canvas","locale":"fr","native":"Français"},{"title":"キャンバスの最適化","locale":"ja","native":"日本語"},{"title":"캔버스 최적화","locale":"ko","native":"한국어"},{"title":"Otimizando canvas","locale":"pt-BR","native":"Português (do Brasil)"},{"title":"Оптимизация canvas","locale":"ru","native":"Русский"},{"title":"最佳化canvas","locale":"zh-TW","native":"正體中文 (繁體)"}],"source":{"folder":"zh-cn/web/api/canvas_api/tutorial/optimizing_canvas","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/web/api/canvas_api/tutorial/optimizing_canvas/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Web","title":"Web 开发技术"},{"uri":"/zh-CN/docs/Web/API","title":"Web API 接口参考"},{"uri":"/zh-CN/docs/Web/API/Canvas_API","title":"Canvas"},{"uri":"/zh-CN/docs/Web/API/Canvas_API/Tutorial","title":"Canvas 教程"},{"uri":"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas","title":"canvas 的优化"}],"pageTitle":"canvas 的优化 - Web API 接口参考 | MDN","noIndexing":false}}