{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Compositing 示例","mdn_url":"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing/Example","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"\n <ol>\n  <li><a href=\"/zh-CN/docs/Web/API/Canvas_API\"><strong>Canvas API</strong></a></li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Canvas 教程</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Basic_usage\">基本用法</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes\">绘制形状</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Applying_styles_and_colors\">添加样式和颜色</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_text\">绘制文本</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Using_images\">使用图片</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Transformations\">变形</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing\">合成与裁剪</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Basic_animations\">基本动画</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Advanced_animations\">高级动画</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas\">像素操作</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas\">canvas 的优化</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Finale\">终极</a></li>\n        </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>示例</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/A_basic_ray-caster\">一个基本的光线投射例子</a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/Canvas_API/Manipulating_video_using_canvas\">在 canvas 中操作视频</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>接口</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/Web/API/HTMLCanvasElement\"><code>HTMLCanvasElement</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/CanvasRenderingContext2D\"><code>CanvasRenderingContext2D</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/CanvasGradient\"><code>CanvasGradient</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/CanvasPattern\"><code>CanvasPattern</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/ImageBitmap\"><code>ImageBitmap</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/ImageData\"><code>ImageData</code></a></li>\n        <li><a href=\"/zh-CN/docs/Web/API/TextMetrics\"><code>TextMetrics</code></a></li>\n        <li><svg class=\"icon icon-experimental\" tabindex=\"0\">\n    <use xlink:href=\"/assets/badges.svg#icon-experimental\"></use>\n</svg> <a href=\"/zh-CN/docs/Web/API/Path2D\"><code>Path2D</code></a></li>\n      </ol>\n    </details>\n  </li>\n  <li><strong><a href=\"/zh-CN/docs/MDN\">文档:</a></strong></li>\n  <li class=\"toggle\">\n    <details>\n      <summary>贡献</summary>\n      <ol>\n        <li><a href=\"/zh-CN/docs/MDN\">MDN 项目</a></li>\n      </ol>\n    </details>\n  </li>\n </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>这个案例程序演示了一些<a href=\"/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">图像合成操作 (en-US)</a>，其结果如下所示：</p><iframe class=\"sample-code-frame\" title=\"合成示例 sample\" id=\"frame_合成示例\" width=\"100%\" height=\"7250\" src=\"https://yari-demos.prod.mdn.mozit.cloud/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing/Example/_sample_.%E5%90%88%E6%88%90%E7%A4%BA%E4%BE%8B.html\" loading=\"lazy\"></iframe>"}},{"type":"prose","value":{"id":"合成示例","title":"合成示例","isH3":false,"content":"<p>下面的代码定义了一些全局变量，可用于程序的其他部分。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> canvas1 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> canvas2 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> gco <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">'source-over'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'source-in'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'source-out'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'source-atop'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'destination-over'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'destination-in'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'destination-out'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'destination-atop'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'lighter'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'copy'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'xor'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'multiply'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'screen'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'overlay'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'darken'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'lighten'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color-dodge'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color-burn'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hard-light'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'soft-light'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'difference'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'exclusion'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hue'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'saturation'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'luminosity'</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> gcoText <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n<span class=\"token string\">'这是默认设置，并在现有画布上下文之上绘制新图形。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新图形只在新图形和目标画布重叠的地方绘制。其他的都是透明的。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'在不与现有画布内容重叠的地方绘制新图形。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'新图形只在与现有画布内容重叠的地方绘制。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'在现有的画布内容后面绘制新的图形。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'现有的画布内容保持在新图形和现有画布内容重叠的位置。其他的都是透明的。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'现有内容保持在新图形不重叠的地方。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'现有的画布只保留与新图形重叠的部分，新的图形是在画布内容后面绘制的。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'两个重叠图形的颜色是通过颜色值相加来确定的。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'只显示新图形。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'图像中，那些重叠和正常绘制之外的其他地方是透明的。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'将顶层像素与底层相应像素相乘，结果是一幅更黑暗的图片。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'像素被倒转，相乘，再倒转，结果是一幅更明亮的图片。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'multiply 和 screen 的结合，原本暗的地方更暗，原本亮的地方更亮。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'保留两个图层中最暗的像素。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'保留两个图层中最亮的像素。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'将底层除以顶层的反置。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'将反置的底层除以顶层，然后将结果反过来。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'屏幕相乘（A combination of multiply and screen）类似于叠加，但上下图层互换了。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'用顶层减去底层或者相反来得到一个正值。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'一个柔和版本的强光（hard-light）。纯黑或纯白不会导致纯黑或纯白。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'和 difference 相似，但对比度较低。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'保留了底层的亮度（luma）和色度（chroma），同时采用了顶层的色调（hue）。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'保留底层的亮度（luma）和色调（hue），同时采用顶层的色度（chroma）。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'保留了底层的亮度（luma），同时采用了顶层的色调 (hue) 和色度 (chroma)。'</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">'保持底层的色调（hue）和色度（chroma），同时采用顶层的亮度（luma）。'</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">320</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> height <span class=\"token operator\">=</span> <span class=\"token number\">340</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"主程序","title":"主程序","isH3":true,"content":"<p>当页面加载时，这部分程序会运行，并执行示例代码：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// lum in sRGB</span>\n    <span class=\"token keyword\">var</span> lum <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">r</span><span class=\"token operator\">:</span> <span class=\"token number\">0.33</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">g</span><span class=\"token operator\">:</span> <span class=\"token number\">0.33</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token number\">0.33</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// resize canvas</span>\n    canvas1<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token punctuation\">;</span>\n    canvas1<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token punctuation\">;</span>\n    canvas2<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token punctuation\">;</span>\n    canvas2<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">lightMix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">colorSphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">runComposite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>这部分代码，<code>runComposite()</code>，处理了大部分的工作，但需要依赖于许多效用函数来完成复杂的处理工作。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>background <span class=\"token operator\">=</span> <span class=\"token string\">\"url(\"</span><span class=\"token operator\">+</span>op_8x8<span class=\"token punctuation\">.</span>data<span class=\"token operator\">+</span><span class=\"token string\">\")\"</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>border <span class=\"token operator\">=</span> <span class=\"token string\">\"1px solid #000\"</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>margin <span class=\"token operator\">=</span> <span class=\"token string\">\"5px\"</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> canvas<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">runComposite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> dl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dl\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>dl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>gco<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> pop <span class=\"token operator\">=</span> gco<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> dt <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dt<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> pop<span class=\"token punctuation\">;</span>\n        dl<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> dd <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        p<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> gcoText<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> canvasToDrawOn <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> canvasToDrawFrom <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> canvasToDrawResult <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvasToDrawResult<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas1<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> pop<span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas2<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">\"source-over\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,0,0.8)\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"14px arial\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>pop<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvasToDrawOn<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas1<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,0,0.8)\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"14px arial\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'existing content'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvasToDrawFrom<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>canvas2<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,0,0.8)\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">\"14px arial\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'new content'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>canvasToDrawOn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>canvasToDrawFrom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dd<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>canvasToDrawResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        dl<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>dd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"效用函数_utility_functions","title":"效用函数 (Utility functions)","isH3":true,"content":"<p>程序需要依赖许多效用函数。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">lightMix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvas2<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">\"lighter\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(255,0,0,1)\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,0,255,1)\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token number\">220</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(0,255,0,1)\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token number\">160</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#f00\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">colorSphere</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> canvas1<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">360</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> halfWidth <span class=\"token operator\">=</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> rotate <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">360</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// per degree</span>\n    <span class=\"token keyword\">var</span> offset <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// scrollbar offset</span>\n    <span class=\"token keyword\">var</span> oleft <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> otop <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> n <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">359</span><span class=\"token punctuation\">;</span> n <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> gradient <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">createLinearGradient</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop<span class=\"token punctuation\">,</span> oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> color <span class=\"token operator\">=</span> Color<span class=\"token punctuation\">.</span><span class=\"token constant\">HSV_RGB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token constant\">H</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">+</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">S</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">V</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        gradient<span class=\"token punctuation\">.</span><span class=\"token function\">addColorStop</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rgba(0,0,0,0)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        gradient<span class=\"token punctuation\">.</span><span class=\"token function\">addColorStop</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rgba(\"</span><span class=\"token operator\">+</span>color<span class=\"token punctuation\">.</span><span class=\"token constant\">R</span><span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>color<span class=\"token punctuation\">.</span><span class=\"token constant\">G</span><span class=\"token operator\">+</span><span class=\"token string\">\",\"</span><span class=\"token operator\">+</span>color<span class=\"token punctuation\">.</span><span class=\"token constant\">B</span><span class=\"token operator\">+</span><span class=\"token string\">\",1)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        gradient<span class=\"token punctuation\">.</span><span class=\"token function\">addColorStop</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rgba(255,255,255,1)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">moveTo</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth <span class=\"token operator\">+</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> otop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> gradient<span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">translate</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">,</span> otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">rotate</span><span class=\"token punctuation\">(</span>rotate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">translate</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>oleft <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>otop <span class=\"token operator\">+</span> halfWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#00f\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> ctx<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// HSV (1978) = H: Hue / S: Saturation / V: Value</span>\nColor <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nColor<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">HSV_RGB</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">o</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> <span class=\"token constant\">H</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token constant\">H</span> <span class=\"token operator\">/</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">S</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token constant\">S</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">V</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token constant\">V</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">R</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">G</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">D</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">S</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">H</span> <span class=\"token operator\">&gt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">H</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">H</span> <span class=\"token operator\">=</span> <span class=\"token number\">6</span> <span class=\"token operator\">*</span> <span class=\"token constant\">H</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">D</span> <span class=\"token operator\">=</span> <span class=\"token constant\">H</span> <span class=\"token operator\">-</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token constant\">H</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">A</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token constant\">S</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">S</span> <span class=\"token operator\">*</span> <span class=\"token constant\">D</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">C</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">S</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token constant\">D</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">V</span> <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span> <span class=\"token operator\">*</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token constant\">H</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span>\n                <span class=\"token constant\">R</span> <span class=\"token operator\">=</span> <span class=\"token constant\">V</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">G</span> <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n                <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">R</span><span class=\"token operator\">:</span> <span class=\"token constant\">R</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">G</span><span class=\"token operator\">:</span> <span class=\"token constant\">G</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">B</span><span class=\"token operator\">:</span> <span class=\"token constant\">B</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">createInterlace</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">size<span class=\"token punctuation\">,</span> color1<span class=\"token punctuation\">,</span> color2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> proto <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> size <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> size <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color1<span class=\"token punctuation\">;</span> <span class=\"token comment\">// top-left</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color2<span class=\"token punctuation\">;</span> <span class=\"token comment\">// top-right</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color2<span class=\"token punctuation\">;</span> <span class=\"token comment\">// bottom-left</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    proto<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color1<span class=\"token punctuation\">;</span> <span class=\"token comment\">// bottom-right</span>\n    proto<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> pattern <span class=\"token operator\">=</span> proto<span class=\"token punctuation\">.</span><span class=\"token function\">createPattern</span><span class=\"token punctuation\">(</span>proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">,</span> <span class=\"token string\">\"repeat\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pattern<span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> proto<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> pattern<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> op_8x8 <span class=\"token operator\">=</span> <span class=\"token function\">createInterlace</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#FFF\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#eee\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}}],"toc":[{"text":"合成示例","id":"合成示例"}],"summary":"这个案例程序演示了一些图像合成操作 (en-US)，其结果如下所示：","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Compositing example","locale":"en-US","native":"English (US)"},{"title":"Ejemplo de composición","locale":"es","native":"Español"},{"title":"Exemple de composition","locale":"fr","native":"Français"},{"title":"合成の例","locale":"ja","native":"日本語"},{"title":"도형 합성 예제","locale":"ko","native":"한국어"},{"title":"Exemplo de Composição","locale":"pt-BR","native":"Português (do Brasil)"},{"title":"Compositing example","locale":"zh-TW","native":"正體中文 (繁體)"}],"source":{"folder":"zh-cn/web/api/canvas_api/tutorial/compositing/example","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/web/api/canvas_api/tutorial/compositing/example/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Web","title":"Web 开发技术"},{"uri":"/zh-CN/docs/Web/API","title":"Web API 接口参考"},{"uri":"/zh-CN/docs/Web/API/Canvas_API","title":"Canvas"},{"uri":"/zh-CN/docs/Web/API/Canvas_API/Tutorial","title":"Canvas 教程"},{"uri":"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing","title":"组合 Compositing"},{"uri":"/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing/Example","title":"Compositing 示例"}],"pageTitle":"Compositing 示例 - Web API 接口参考 | MDN","noIndexing":false}}