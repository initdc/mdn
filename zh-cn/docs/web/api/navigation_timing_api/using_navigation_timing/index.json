{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Using Navigation Timing","mdn_url":"/zh-CN/docs/Web/API/Navigation_timing_API/Using_Navigation_Timing","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"<ol><li><strong><a href=\"/zh-CN/docs/Web/API/Navigation_timing_API\">Navigation timing API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>指南</summary><ol><li><a href=\"/zh-CN/docs/Web/API/Navigation_timing_API/Using_Navigation_Timing\">Using Navigation Timing</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>接口</summary><ol><li><a href=\"/zh-CN/docs/Web/API/Performance\"><code>Performance</code></a></li><li><a href=\"/zh-CN/docs/Web/API/PerformanceNavigation\"><code>PerformanceNavigation</code></a></li><li><a href=\"/zh-CN/docs/Web/API/PerformanceTiming\"><code>PerformanceTiming</code></a></li><li><a href=\"/zh-CN/docs/Web/API/PerformanceNavigationTiming\"><code>PerformanceNavigationTiming</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>属性</summary><ol><li><a href=\"/zh-CN/docs/Web/API/performance_property\"><code>performance_property</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Navigation Timing 接口使你可以轻松获取详细且高度准确的计时信息，以帮助从你的网站代码或资源隔离出性能问题。与其他工具或库不同，Navigation Timing 接口使你可以收集这些只有浏览器才能提供的信息，其准确性要比其他技术大大提高。它还具有能够提供用户所感知的计时信息而不是与用户体验无关的数据的优势。</p>"}},{"type":"prose","value":{"id":"收集计时信息","title":"收集计时信息","isH3":false,"content":"<p>使用该 API 就像使用 <a href=\"/zh-CN/docs/Web/API/performance_property\"><code>window.performance</code></a> 获取 <a href=\"/zh-CN/docs/Web/API/Performance\"><code>Performance</code></a> 对象并在返回的对象中查找所需内容一样简单。比如，为了测量页面的感知到的加载时间：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"load\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> loadingTime <span class=\"token operator\">=</span> now <span class=\"token operator\">-</span> performance<span class=\"token punctuation\">.</span>timing<span class=\"token punctuation\">.</span>navigationStart<span class=\"token punctuation\">;</span>\n\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".output\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span>\n        loadingTime <span class=\"token operator\">+</span> <span class=\"token string\">\" ms\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>在发生 <code><a href=\"/en-US/docs/Web/API/Window/load_event\" title=\"Currently only available in English (US)\" class=\"only-in-en-us\">load (en-US)</a></code> 事件时执行的该代码从当前时间中减去浏览器导航开始时记录的时间 (<a href=\"/zh-CN/docs/Web/API/PerformanceTiming/navigationStart\" title=\"performance.timing.navigationStart\"><code>performance.timing.navigationStart</code></a>)，并通过将该信息插入到元素中，输出到屏幕。</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>output<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: css hidden notranslate\"><code><span class=\"token selector\">.output</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid #bbb<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font</span><span class=\"token punctuation\">:</span> 16px <span class=\"token string\">\"Open Sans\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Helvetica\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Arial\"</span><span class=\"token punctuation\">,</span> sans-serif<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>结合适当的 HTML 和 CSS，结果就是：</p><iframe class=\"sample-code-frame\" title=\"收集计时信息 sample\" id=\"frame_收集计时信息\" width=\"500\" height=\"80\" src=\"https://yari-demos.prod.mdn.mozit.cloud/zh-CN/docs/Web/API/Navigation_timing_API/Using_Navigation_Timing/_sample_.%E6%94%B6%E9%9B%86%E8%AE%A1%E6%97%B6%E4%BF%A1%E6%81%AF.html\" loading=\"lazy\"></iframe>\n<p>列出的值适用于上面展示了示例的 <a href=\"/zh-CN/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code></a>。</p>\n<p>你可以在 <a href=\"/zh-CN/docs/Web/API/PerformanceTiming\"><code>PerformanceTiming</code></a> 中查找可用的计时值的列表，请参见 <a href=\"/zh-CN/docs/Web/API/PerformanceTiming\"><code>PerformanceTiming</code></a> 接口的“<a href=\"/zh-CN/docs/Web/API/PerformanceTiming\">属性</a>”部分。</p>"}},{"type":"prose","value":{"id":"确定导航类型","title":"确定导航类型","isH3":false,"content":"<p>为了将从 <a href=\"/zh-CN/docs/Web/API/PerformanceTiming\"><code>PerformanceTiming</code></a> 获取到的计时信息放入正确的观点，你需要更多地了解发生了哪种加载操作。特别是你需要知道：</p>\n<ul>\n  <li>这是加载还是重新加载？</li>\n  <li>这是历史的导航还是前进或后退？</li>\n  <li>完成导航需要多少个（如果有）重定向？</li>\n</ul>\n<p>此信息由 <a href=\"/zh-CN/docs/Web/API/Performance/navigation\"><code>Performance.navigation</code></a> 属性提供，该属性返回包含所需信息的 <a href=\"/zh-CN/docs/Web/API/PerformanceNavigation\"><code>PerformanceNavigation</code></a> 对象。</p>\n<p>让我们将此信息添加到上面的示例中。新代码如下所示：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"load\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> loadingTime <span class=\"token operator\">=</span> now <span class=\"token operator\">-</span> performance<span class=\"token punctuation\">.</span>timing<span class=\"token punctuation\">.</span>navigationStart<span class=\"token punctuation\">;</span>\n\n  output <span class=\"token operator\">=</span> <span class=\"token string\">\"Load time: \"</span> <span class=\"token operator\">+</span> loadingTime <span class=\"token operator\">+</span> <span class=\"token string\">\" ms&lt;br/&gt;\"</span><span class=\"token punctuation\">;</span>\n  output <span class=\"token operator\">+=</span> <span class=\"token string\">\"Navigation type: \"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>performance<span class=\"token punctuation\">.</span>navigation<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> PerformanceNavigation<span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE_NAVIGATE</span><span class=\"token operator\">:</span>\n        output <span class=\"token operator\">+=</span> <span class=\"token string\">\"Navigation\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> PerformanceNavigation<span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE_RELOAD</span><span class=\"token operator\">:</span>\n        output <span class=\"token operator\">+=</span> <span class=\"token string\">\"Reload\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> PerformanceNavigation<span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE_BACK_FORWARD</span><span class=\"token operator\">:</span>\n        output <span class=\"token operator\">+=</span> <span class=\"token string\">\"History\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        output <span class=\"token operator\">+=</span> <span class=\"token string\">\"Unknown\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  output <span class=\"token operator\">+=</span> <span class=\"token string\">\"&lt;br/&gt;Redirects: \"</span> <span class=\"token operator\">+</span>\n      performance<span class=\"token punctuation\">.</span>navigation<span class=\"token punctuation\">.</span>redirectCount<span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".output\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> output<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>这通过查看 <code>performance.navigation</code> 对象的内容来修改了前面的示例。<a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceNavigation/type\"><code>performance.navigation.type</code> <small>(en-US)</small></a> 指示发生了哪种加载操作：导航，重新加载或浏览器历史记录的切换。我们还从 <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/PerformanceNavigation/redirectCount\"><code>performance.navigation.redirectCount</code> <small>(en-US)</small></a> 获取导航期间发生的重定向次数。就像以前的页面加载时间一样，此信息通过插入到具有 <code>\"output\"</code> 类的元素中输出到屏幕上。</p>\n<div class=\"code-example\"><pre class=\"brush: html hidden notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>output<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: css hidden notranslate\"><code><span class=\"token selector\">.output</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid #bbb<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font</span><span class=\"token punctuation\">:</span> 16px <span class=\"token string\">\"Open Sans\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Helvetica\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Arial\"</span><span class=\"token punctuation\">,</span> sans-serif<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>使用此代码后，结果如下所示：</p><iframe class=\"sample-code-frame\" title=\"确定导航类型 sample\" id=\"frame_确定导航类型\" width=\"500\" height=\"120\" src=\"https://yari-demos.prod.mdn.mozit.cloud/zh-CN/docs/Web/API/Navigation_timing_API/Using_Navigation_Timing/_sample_.%E7%A1%AE%E5%AE%9A%E5%AF%BC%E8%88%AA%E7%B1%BB%E5%9E%8B.html\" loading=\"lazy\"></iframe>\n<p>列出的值适用于展示示例的 <a href=\"/zh-CN/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code></a>。</p>"}},{"type":"prose","value":{"id":"也可以看看","title":"也可以看看","isH3":false,"content":"<ul>\n  <li><a href=\"/zh-CN/docs/Web/API/Navigation_timing_API\">Navigation Timing API</a></li>\n  <li><a href=\"/zh-CN/docs/Web/API/performance_property\"><code>window.performance</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/API/Performance\"><code>Performance</code></a>, <a href=\"/zh-CN/docs/Web/API/PerformanceTiming\"><code>PerformanceTiming</code></a>, and <a href=\"/zh-CN/docs/Web/API/PerformanceNavigation\"><code>PerformanceNavigation</code></a></li>\n</ul>"}}],"toc":[{"text":"收集计时信息","id":"收集计时信息"},{"text":"确定导航类型","id":"确定导航类型"},{"text":"也可以看看","id":"也可以看看"}],"summary":"Navigation Timing 接口使你可以轻松获取详细且高度准确的计时信息，以帮助从你的网站代码或资源隔离出性能问题。与其他工具或库不同，Navigation Timing 接口使你可以收集这些只有浏览器才能提供的信息，其准确性要比其他技术大大提高。它还具有能够提供用户所感知的计时信息而不是与用户体验无关的数据的优势。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Using Navigation Timing","locale":"en-US","native":"English (US)"}],"source":{"folder":"zh-cn/web/api/navigation_timing_api/using_navigation_timing","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/web/api/navigation_timing_api/using_navigation_timing/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Web","title":"Web 开发技术"},{"uri":"/zh-CN/docs/Web/API","title":"Web API 接口参考"},{"uri":"/zh-CN/docs/Web/API/Navigation_timing_API","title":"Navigation Timing API"},{"uri":"/zh-CN/docs/Web/API/Navigation_timing_API/Using_Navigation_Timing","title":"Using Navigation Timing"}],"pageTitle":"Using Navigation Timing - Web API 接口参考 | MDN","noIndexing":false}}