{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Interact with the clipboard","mdn_url":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions\"><strong>浏览器扩展程序</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>开始</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">什么是扩展程序?</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">你的第一个扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">你的第二个扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">详解扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Examples\">扩展程序示例</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_next_\">接下来呢?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>概念</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">使用 JavaScript APIs</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">匹配样式</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">处理文件</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">国际化</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">内容安全举措</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">本地消息</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">API实现之间的差异</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome不兼容</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>用户界面</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface\">用户界面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">工具栏按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">地址栏按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">侧边栏</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">上下文菜单项</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">选项页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">扩展页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">通知</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">地址栏建议</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">开发人员工具面板</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>怎么做</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">拦截HTTP 请求</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">修改网页</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">插入外部内容</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">向工具栏添加按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">应用设置页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">使用Tabs API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">使用Bookmarks API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">使用Cookies API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">使用上下文身份</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">构建跨浏览器扩展</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox的优势</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">介绍</a></li>\n        </ol>\n      <ol><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">applications</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">作者 - author</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">名称 - name</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">后台 - background</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">描述 - description</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">权限 - permissions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">短名称 - short_name</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/Contact_us\"><strong>联系我们</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>渠道</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons博客</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons论坛</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>有两种方式可以让浏览器扩展与系统剪贴板交互：<a href=\"/zh-CN/docs/Web/API/Document/execCommand\"><code>Document.execCommand()</code></a> 方法以及现代的异步的 <a href=\"/zh-CN/docs/Web/API/Clipboard_API\">Clipboard API</a>.</p>\n<p><a href=\"/zh-CN/docs/Web/API/Document/execCommand\"><code>Document.execCommand()</code></a> 方法常通过以下指令使用：</p>\n<ul>\n  <li><code>document.execCommand(\"copy\")</code></li>\n  <li><code>document.execCommand(\"cut\")</code></li>\n  <li><code>document.execCommand(\"paste\")</code></li>\n</ul>\n<p>Clipboard API 提供了异步的连接来直接读写剪贴板内容。例，如此从剪贴板读取文本：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>navigator<span class=\"token punctuation\">.</span>clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">readText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span> <span class=\"token operator\">=&gt;</span> outputElem<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>这将请求剪贴板内容，并且当接收到响应时存储剪贴板文本到一个元素的 <a href=\"/zh-CN/docs/Web/API/HTMLElement/innerText\" title=\"innerText\"><code>innerText</code></a>.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>备注：</strong> 异步的 Clipboard API 方法是一个近期新增的规范，并且这个规范可能不适用于所有浏览器。请在使用前测试了每一种方法的兼容性，以确保支持满足您的需求。</p>\n</div>"}},{"type":"prose","value":{"id":"写入系统粘贴板","title":"写入系统粘贴板","isH3":false,"content":"<p>有两种向剪贴板写入数据的方法。你可以使用 <a href=\"/zh-CN/docs/Web/API/Document/execCommand\" title=\"document.execCommand()\"><code>document.execCommand()</code></a> 来触发 \"剪切\" 和 \"复制\" 行为，这将用选择的数据覆盖剪贴板的当前内容。另一个选项是使用 Clipboard API 的 <a href=\"/zh-CN/docs/Web/API/Clipboard/writeText\"><code>Clipboard.writeText()</code></a> 或 <a href=\"/zh-CN/docs/Web/API/Clipboard/write\"><code>Clipboard.write()</code></a> 方法来用指定数据覆盖剪贴板内容。</p>"}},{"type":"prose","value":{"id":"使用_execcommand","title":"使用 execCommand()","isH3":true,"content":"<p><a href=\"/zh-CN/docs/Web/API/Document/execCommand\" title=\"document.execCommand()\"><code>document.execCommand()</code></a> 方法的 <code>\"cut\"</code> 与 <code>\"copy\"</code> 命令可以被用于以选中素材代替剪贴板的当前内容。这些命令无需任何特别的权限就可以使用，如果你在一个用于用户操作的短生存期的事件处理程序中使用他们 (例如，一次点击事件).</p>\n<p>例如，假设你有一个下面的弹出菜单页面：</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>input<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>copy<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Copy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>使 \"copy\"按钮能复制 \"input\"中的文本，代码如下：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> copyText <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#input\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  copyText<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">execCommand</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Copy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#copy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> copy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>由于<code>execCommand()</code>命令在单击事件中，所以不需要特别的权限。</p>\n<p>此外，如果用警报（alarm）替换上面的命令来触发复制事件：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> copyText <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#input\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  copyText<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">execCommand</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Copy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>alarms<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">delayInMinutes</span><span class=\"token operator\">:</span> <span class=\"token number\">0.1</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nbrowser<span class=\"token punctuation\">.</span>alarms<span class=\"token punctuation\">.</span>onAlarm<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>copy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>这种触发不一定成功，它取决于浏览器是否支持。Firefox 浏览器就不支持该功能，你会在浏览器控制台中看到以下信息：</p>\n<pre class=\"notranslate\">\"document.execCommand(‘cut’/‘copy’) was denied because it was not called from inside a short running user-generated event handler.\"\n</pre>\n<p>为了能够在这种情形下使用，你需要拥有\"clipboardWrite\"的权限（ <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a>）。因此，\"clipboardWrite\"权限能使你不通过临时事件处理程序就可以写入系统粘贴板中。</p>"}},{"type":"prose","value":{"id":"使用_clipboard_api","title":"使用 Clipboard API","isH3":true,"content":"<p>Clipboard API 更加灵活，因为你不仅可以将当前选择复制到剪贴板中，还可以直接指定要放入剪贴板的信息。</p>\n<p>要使用 Clipboard API 需要在你的 <code>manifest.json</code> 文件中申请 <code>clipboardRead</code> 与 <code>clipboardWrite</code> 权限。</p>\n<p>对于页面脚本，需要权限 API 的 <code>clipboard-write</code> 权限。你可通过 <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/Permissions/query\"><code>navigator.permissions.query()</code> <small>(en-US)</small></a> 来检查这个权限：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>navigator<span class=\"token punctuation\">.</span>permissions<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"clipboard-write\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>state <span class=\"token operator\">==</span> <span class=\"token string\">\"granted\"</span> <span class=\"token operator\">||</span> result<span class=\"token punctuation\">.</span>state <span class=\"token operator\">==</span> <span class=\"token string\">\"prompt\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* write to the clipboard now */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>这个函数使用一个字符串作为输入并且用它更新剪贴板：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">updateClipboard</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">newClip</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  navigator<span class=\"token punctuation\">.</span>clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">writeText</span><span class=\"token punctuation\">(</span>newClip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* clipboard successfully set */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* clipboard write failed */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"特定浏览器注意事项","title":"特定浏览器注意事项","isH3":true,"content":"<p>这里涉及的剪贴板和其他 API 正在快速发展，因此浏览器在工作方式上存在差异。</p>\n<p>在 Chrome 中：</p>\n<ul>\n  <li>你可以在所有执行上下文中写入系统粘贴板，像背景网页、内容脚本、标签页和弹出菜单。</li>\n  <li>你不需要 <code>\"clipboardWrite\"</code> 权限，甚至不需要在用户生成的事件处理程序中写入粘贴板</li>\n</ul>\n<p>在 Firefox 中：</p>\n<ul>\n  <li>除了背景网页外，你可以在所有执行上下文中使用 execCommand 写入粘贴板。在 Firefox 中，你无法选择文本或将输入字段聚焦在后台页面中，因此无法使用 execCommand 从后台页面写入剪贴板。</li>\n  <li>只有 version 51 以上才支持\"clipboardWrite\" 权限。</li>\n  <li>从 version 57 开始，可以使用 <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/clipboard/setImageData\"><code>clipboard.setImageData()</code></a> API 将图像复制到剪贴板。</li>\n  <li>在 Firefox 633 中添加了对 Clipboard API <a href=\"/zh-CN/docs/Web/API/Clipboard/writeText\" title=\"navigator.clipboard.writeText()\"><code>navigator.clipboard.writeText()</code></a> 方法的支持。</li>\n  <li>当使用一个内容脚本，Clipboard API 只可用于 HTTPS 页。解决方法是，在内容脚本和后台脚本之间使用消息传递。</li>\n</ul>"}},{"type":"prose","value":{"id":"读取系统粘贴板","title":"读取系统粘贴板","isH3":false,"content":"<p><code>execCommand()</code> 方法提供了 <code>\"paste\"</code> 指令，能让你粘贴内容。你可以使用 Clipboard API 的更灵活的方法： <a href=\"/zh-CN/docs/Web/API/Clipboard/read\"><code>Clipboard.read()</code></a> 和 <a href=\"/zh-CN/docs/Web/API/Clipboard/readText\"><code>Clipboard.readText()</code></a>。</p>"}},{"type":"prose","value":{"id":"使用_execcommand_2","title":"使用 execCommand()","isH3":true,"content":"<p>首先，你需要为扩展申请 <code>\"clipboardRead\"</code> <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a> 。即便你在用户生成的事件处理程序 ( 例如 <code><a href=\"/en-US/docs/Web/API/Element/click_event\" title=\"Currently only available in English (US)\" class=\"only-in-en-us\">click (en-US)</a></code> 或 <code><a href=\"/en-US/docs/Web/API/Element/keypress_event\" title=\"Currently only available in English (US)\" class=\"only-in-en-us\">keypress (en-US)</a></code> ) 中使用 \"paste\" 指令也是如此。</p>\n<p>假设你的 HTML 页面内容如下：</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>output<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>paste<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>粘贴<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>要在用户单机 id 为 <code>\"paste\"</code> 的 <a href=\"/zh-CN/docs/Web/HTML/Element/button\"><code>&lt;button&gt;</code></a> 时从剪贴板设置 id 为 <code>\"output\"</code> 的 <a href=\"/zh-CN/docs/Web/HTML/Element/textarea\"><code>&lt;textarea&gt;</code></a> 的内容，可以使用这样的代码：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">paste</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> pasteText <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#output\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  pasteText<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">execCommand</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"paste\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>pasteText<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#paste\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> paste<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"使用_clipboard_api_2","title":"使用 Clipboard API","isH3":true,"content":"<p>剪贴板 API 的 <a href=\"/zh-CN/docs/Web/API/Clipboard/readText\" title=\"navigator.clipboard.readText()\"><code>navigator.clipboard.readText()</code></a> 和 <a href=\"/zh-CN/docs/Web/API/Clipboard/read\" title=\"navigator.clipboard.read()\"><code>navigator.clipboard.read()</code></a> 方法让你从剪贴板读取任意文本或二进制数据。这让你从剪贴板访问数据无需将它们粘贴至一个可编辑的元素中。</p>\n<p>一旦你通过 <a href=\"/zh-CN/docs/Web/API/Permissions_API\">Permissions API</a> 获取了 <code>\"clipboard-read\"</code> 权限，你就可以轻松读取剪贴板：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>navigator<span class=\"token punctuation\">.</span>clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">readText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">clipText</span> <span class=\"token operator\">=&gt;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"outbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> clipText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>这个代码片段从剪贴板提取文本并且用该文本替换 ID 为 <code>\"outbox\"</code> 的元素的当前内容。</p>"}},{"type":"prose","value":{"id":"特定浏览器注意事项_2","title":"特定浏览器注意事项","isH3":true,"content":"<p>Firefox 在 54 版本提供了 <code>\"clipboardRead\"</code> <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a> ，但是仅支持向处于 <a href=\"/zh-CN/docs/Web/Guide/HTML/Editable_content\">内容可编辑模式</a> 的元素粘贴，对于内容脚本，只能在 <a href=\"/zh-CN/docs/Web/HTML/Element/textarea\"><code>&lt;textarea&gt;</code></a> 工作。对于后台脚本，任何元素都可被设置为内容可编辑模式。</p>"}}],"toc":[{"text":"写入系统粘贴板","id":"写入系统粘贴板"},{"text":"读取系统粘贴板","id":"读取系统粘贴板"}],"summary":"有两种方式可以让浏览器扩展与系统剪贴板交互：Document.execCommand() 方法以及现代的异步的 Clipboard API.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Interact with the clipboard","locale":"en-US","native":"English (US)"},{"title":"Interagir avec le presse-papier","locale":"fr","native":"Français"},{"title":"クリップボードとのやりとり","locale":"ja","native":"日本語"}],"source":{"folder":"zh-cn/mozilla/add-ons/webextensions/interact_with_the_clipboard","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/mozilla/add-ons/webextensions/interact_with_the_clipboard/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Mozilla","title":"Mozilla"},{"uri":"/zh-CN/docs/Mozilla/Add-ons","title":"附加组件"},{"uri":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions","title":"浏览器扩展"},{"uri":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard","title":"Interact with the clipboard"}],"pageTitle":"Interact with the clipboard - Mozilla | MDN","noIndexing":false}}