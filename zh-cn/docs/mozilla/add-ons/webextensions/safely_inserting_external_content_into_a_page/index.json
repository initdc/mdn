{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Safely inserting external content into a page","mdn_url":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions\"><strong>浏览器扩展程序</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>开始</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">什么是扩展程序?</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">你的第一个扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">你的第二个扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">详解扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Examples\">扩展程序示例</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_next_\">接下来呢?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>概念</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">使用 JavaScript APIs</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">匹配样式</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">处理文件</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">国际化</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">内容安全举措</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">本地消息</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">API实现之间的差异</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome不兼容</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>用户界面</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface\">用户界面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">工具栏按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">地址栏按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">侧边栏</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">上下文菜单项</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">选项页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">扩展页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">通知</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">地址栏建议</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">开发人员工具面板</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>怎么做</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">拦截HTTP 请求</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">修改网页</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">插入外部内容</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">向工具栏添加按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">应用设置页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">使用Tabs API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">使用Bookmarks API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">使用Cookies API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">使用上下文身份</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">构建跨浏览器扩展</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox的优势</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">介绍</a></li>\n        </ol>\n      <ol><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">applications</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">作者 - author</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">名称 - name</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">后台 - background</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">描述 - description</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">权限 - permissions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">短名称 - short_name</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/Contact_us\"><strong>联系我们</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>渠道</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons博客</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons论坛</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>很多时候你需要从外部资源引入内容到你的插件。但是，源可能被嵌入了恶意的源代码，这些恶意的源代码可能由源的开发者或者恶意的第三方所编写。</p>\n<p>以 RSS 读取器为例子。你不知道你的插件将会打开什么 RSS 源也无法控制那些 RSS 源的内容。所以，可能用户可能订阅到一个 RSS 源里面包含了带有恶意脚本的标题。可能就是简单的 JavaScript 代码标签&lt;script&gt;&lt;/script&gt;。如果你在提取标题的时候，当作一般文本添加到一个页面的 DOM，用户可能加载未知的脚本。因此，需要注意避免直接把一般文本加载为 HTML。</p>\n<p>你还需要记住扩展有授权的上下文，例如后台的脚本 backgroup scrips 以及内容脚本 content scripts。最坏的情况里，一个内嵌的洁白你可能运行在一个或多种上下文中，导致一些提取操作。这种情况会导致用户的浏览器暴露在远程攻击下，被注入代码访问用户的重要数据，例如密码、浏览器历史或者浏览器行为等。</p>\n<p>这篇文章说明如何安全的对待远端数据并添加到 DOM。</p>"}},{"type":"prose","value":{"id":"处理任意字符串","title":"处理任意字符串","isH3":false,"content":"<p>当处理字符串时，有很多推荐的策略来安全添加他们到页面：标准的 DOM 节点创建方法或 jQuery。</p>"}},{"type":"prose","value":{"id":"dom_节点创建方法函数","title":"DOM 节点创建方法/函数","isH3":true,"content":"<p>一个轻量级的方法来插入字符串到页面是使用原生的 DOM 操纵方法/函数: <a href=\"/zh-CN/docs/Web/API/Document/createElement\"><code>document.createElement</code></a>, <a href=\"/zh-CN/docs/Web/API/Element/setAttribute\"><code>Element.setAttribute</code></a>, 以及<a href=\"/zh-CN/docs/Web/API/Node/textContent\"><code>Node.textContent</code></a>. 安全的方法是分别创建节点并使用 textContent 属性赋值：</p>\n<div class=\"code-example\"><pre class=\"brush: js example-good notranslate\"><code><span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> div <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndiv<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">;</span>\ndiv<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"Your favorite color is now \"</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">;</span>\naddonElement<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>div<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>这种方法安全原因是使用<code>.textContent</code> 时会自动消除 <code>data.color</code>.中的任何远程 HTML 代码。</p>\n<p>但是要注意，使用原生方法不能保证绝对安全，例如下面的代码：</p>\n<div class=\"code-example\"><pre class=\"brush: js example-bad notranslate\"><code><span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\naddonElement<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;div class='\"</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">.</span>className <span class=\"token operator\">+</span> <span class=\"token string\">\"'&gt;\"</span> <span class=\"token operator\">+</span>\n                         <span class=\"token string\">\"Your favorite color is now \"</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">.</span>color <span class=\"token operator\">+</span>\n                         <span class=\"token string\">\"&lt;/div&gt;\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>在其中，Here, the contents of <code>data.className</code> 或 <code>data.color</code> 的内容可能包含 HTML 代码使得标签提早关闭，并插入更多的 HTML 内容，之后关闭另一个标签。</p>\n<p>jQuery</p>\n<p>当使用 jQuery 的方法如 <code>attr()</code> 和 <code>text()</code> ，会清洗添加到 DOM 的内容。所以，上面“favorite color”例子采用 jQuery 实现会形如：</p>\n<div class=\"code-example\"><pre class=\"brush: js example-good notranslate\"><code><span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;/div&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nnode<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nnode<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Your favorite color is now \"</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"处理_html_内容","title":"处理 HTML 内容","isH3":false,"content":"<p>当你知道处理外部源的内容是 HTML 的时候，添加到页面之前净化 HTML 是很关键的。净化 HTML 的最好办法是使用 HTML 净化的库或者一个带有 HTML 净化特性的模板引擎。在这一节，我们来看一些合适的工具以及使用方法。</p>"}},{"type":"prose","value":{"id":"html_净化","title":"HTML 净化","isH3":true,"content":"<p>An HTML sanitization library strips anything that could lead to script execution from HTML, so you can safely inject complete sets of HTML nodes from a remote source into your DOM. <a href=\"https://github.com/cure53/DOMPurify\" class=\"external\" rel=\" noopener\">DOMPurify</a>,是一个 HTML 净化的库，可以脱离任意会导致脚本执行的元素，以便安全注入远端源到 HTML 节点，这个库被很多不同的安全专家评估过，是很适合这种任务扩展的库。</p>\n<p><a href=\"https://github.com/cure53/DOMPurify\" class=\"external\" rel=\" noopener\">DOMPurify</a> 有一个简约版用于生产环境，purify.min.js. 你可以使用这个版本来适配你的扩展，例如你可以这样添加：</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"matches\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;all_urls&gt;\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"purify.min.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"myinjectionscript.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>之后，在 myinjectionscript.js 中你可以读取外部 HTML 并净化，之后添加到页面的 DOM 中：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> elem <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> cleanHTML <span class=\"token operator\">=</span> DOMPurify<span class=\"token punctuation\">.</span><span class=\"token function\">sanitize</span><span class=\"token punctuation\">(</span>externalHTML<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelem<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> cleanHTML<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>你可以使用任何方法添加净化后的 HTML 到 DOM，例如 jQuery’s <code>.html()</code> 方法。注意这种情况需要使用 Remember though that the <code>SAFE_FOR_JQUERY</code> 标记：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> elem <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;div/&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> cleanHTML <span class=\"token operator\">=</span> DOMPurify<span class=\"token punctuation\">.</span><span class=\"token function\">sanitize</span><span class=\"token punctuation\">(</span>externalHTML<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SAFE_FOR_JQUERY</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelem<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span>cleanHTML<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"模板引擎","title":"模板引擎","isH3":true,"content":"<p>另一个常见的模式是对一个页面创建本地 HTML 模板并通过远端的值来填空。这种方法被广泛应用，应该注意去避免构造函数的使用，可能会导致执行代码的注入。当模板引擎使用构造函数插入 HTML 到文档的时候会发生这种情况，如果用来注入原始 HTML 的变量是远端代码，这就属于上面介绍中的安全风险。</p>\n<p>例如，当使用<a href=\"https://mustache.github.io/\" class=\"external\" rel=\" noopener\">mustache templates</a> 你必须使用两个花括号<code>{{variable}}</code>,来去掉任何 HTML。使用三个花括号<code>{{{variable}}}</code> 必须避免注入原始 HTML 字符串到模板。</p>\n<p><a href=\"http://handlebarsjs.com/\" class=\"external\" rel=\" noopener\">Handlebars</a> 工作原理也是类似，<code>{{variable}}</code> 。同时，如果创造了 Handlebars helper 使用 <code>Handlebars.SafeString</code> 使用<code>Handlebars.escapeExpression()</code> 来消除任何传给 helper 的动态参数。<code>Handlebars.SafeString</code> 的结果被认为是安全的，当插入到双 handlebars 的时候就不会做消除动作。</p>\n<p>在其他模板系统中也有类似的构造函数，需要有同样的考虑。</p>"}},{"type":"prose","value":{"id":"其他参考","title":"其他参考","isH3":false,"content":"<p>关于这个主题更多的信息，可以查看下面的文章</p>\n<ul>\n  <li><a href=\"https://owasp.org/www-community/xss-filter-evasion-cheatsheet\" class=\"external\" rel=\" noopener\">XSS (Cross Site Scripting) Prevention Cheat Sheet</a></li>\n</ul>"}}],"toc":[{"text":"处理任意字符串","id":"处理任意字符串"},{"text":"处理 HTML 内容","id":"处理_html_内容"},{"text":"其他参考","id":"其他参考"}],"summary":"很多时候你需要从外部资源引入内容到你的插件。但是，源可能被嵌入了恶意的源代码，这些恶意的源代码可能由源的开发者或者恶意的第三方所编写。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Safely inserting external content into a page","locale":"en-US","native":"English (US)"},{"title":"Insérer en toute sécurité du contenu externe dans une page","locale":"fr","native":"Français"}],"source":{"folder":"zh-cn/mozilla/add-ons/webextensions/safely_inserting_external_content_into_a_page","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/mozilla/add-ons/webextensions/safely_inserting_external_content_into_a_page/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Mozilla","title":"Mozilla"},{"uri":"/zh-CN/docs/Mozilla/Add-ons","title":"附加组件"},{"uri":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions","title":"浏览器扩展"},{"uri":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page","title":"Safely inserting external content into a page"}],"pageTitle":"Safely inserting external content into a page - Mozilla | MDN","noIndexing":false}}