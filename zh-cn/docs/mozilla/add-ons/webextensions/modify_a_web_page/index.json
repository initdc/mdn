{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"修改 web 页面","mdn_url":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page","locale":"zh-CN","native":"中文 (简体)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions\"><strong>浏览器扩展程序</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>开始</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">什么是扩展程序?</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">你的第一个扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">你的第二个扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">详解扩展程序</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Examples\">扩展程序示例</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_next_\">接下来呢?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>概念</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">使用 JavaScript APIs</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">匹配样式</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">处理文件</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">国际化</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">内容安全举措</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">本地消息</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">API实现之间的差异</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome不兼容</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>用户界面</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface\">用户界面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">工具栏按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">地址栏按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">侧边栏</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">上下文菜单项</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">选项页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">扩展页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">通知</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">地址栏建议</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">开发人员工具面板</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>怎么做</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">拦截HTTP 请求</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">修改网页</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">插入外部内容</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">向工具栏添加按钮</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">应用设置页面</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">使用Tabs API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">使用Bookmarks API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">使用Cookies API</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">使用上下文身份</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">构建跨浏览器扩展</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox的优势</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">介绍</a></li>\n        </ol>\n      <ol><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">applications</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">作者 - author</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">名称 - name</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">后台 - background</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">描述 - description</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">权限 - permissions</a></li><li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">短名称 - short_name</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/Contact_us\"><strong>联系我们</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>渠道</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons博客</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons论坛</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>浏览器附加组件 ( add-on ) 常被用于修改网页。例如更改页面的样式，隐藏特定的 DOM 节点或把 DOM 节点注入到页面中。</p>\n<p>使用 WebExtensions 有两种方式：</p>\n<ul>\n  <li>声明方式：定义一个网址格式，用来匹配特定的网址，然后加载脚本到对应的网页中。</li>\n  <li>编程方式：使用 JavaScript 接口，将脚本加载到一个指定标签页所承载的页面中</li>\n</ul>\n<p>无论使用上面何种方式，它们都被称为内容脚本，与其他脚本的区别：</p>\n<ul>\n  <li>只能使用一部分的 webextension API。</li>\n  <li>能读取加载了内容脚本的网页。</li>\n  <li>通过使用消息 API 与其他的 webextension 通信。</li>\n</ul>\n<p>在本文中，我们将看下加载脚本的两种方式。</p>"}},{"type":"prose","value":{"id":"修改匹配_url_的页面","title":"修改匹配 URL 的页面","isH3":false,"content":"<p>首先，创建一个名为“modify-page”的文件夹，并在目录下创建“manifest.json”文件，内容如下：</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"modify-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"matches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://developer.mozilla.org/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"page-eater.js\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>\"content_scripts\"指出符合 URL 格式的页面地址，然后让浏览器加载脚本 (“page-eater.js“) 到匹配的 URL 页面 (<a href=\"/\">https://developer.mozilla.org/</a> )。</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>备注：</strong> 由于 <code>content_scripts</code> 的 <code>\"js\"</code> 属性是一个数组，因此可以使用它将多个脚本注入匹配的页面。如果这样做，页面将按照数组中列出的顺序加载多个脚本。</p>\n</div>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>备注：</strong> <code>content_scripts</code> 键还具有一个 <code>\"css\"</code> 属性，可以使用它来注入 CSS 样式表。</p>\n</div>\n<p>在 \"modify-page\" 文件夹下创建“page-eater.js”文件，内容如下：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> header <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nheader<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"This page has been eaten\"</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>现在安装这个<a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Temporary_Installation_in_Firefox\">WebExtension</a>, 然后浏览 <a href=\"/\">https://developer.mozilla.org/</a>：</p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/lxf2Tkg6U1M\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>备注：</strong> 请注意，虽然此视频显示在 <a href=\"https://addons.mozilla.org/en-US/firefox/\" class=\"external\" rel=\" noopener\">addons.mozilla.org</a> 工作的 content scripts，但目前该网站已禁止 content scripts。</p>\n</div>"}},{"type":"prose","value":{"id":"通过程序修改页面","title":"通过程序修改页面","isH3":false,"content":"<p>如何修改程序使其在用户要求时才吞页面。现在修改上面的例子，在点击右键菜单项时才注入内容脚本。</p>\n<p>修改 \"manifest.json\" 内容如下：</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"modify-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"activeTab\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"contextMenus\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>这里我们要移除\"<code>content_scripts</code>\"键值，并添加两个键：</p>\n<ul>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\"><code>permissions</code></a>:要向页面中注入脚本，就需要拥有修改页面对应的权限。<a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab_permission\"><code>activeTab</code></a>可以临时获得修改当前活动标签所加载的页面的权限。另外还通过 contextmenus 来获取添加右键菜单项的权限。</li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\"><code>background</code></a>: 加载名为 \"background.js\" 的 <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#background_scripts\">\"background script\"</a> （长期有效的后台脚本），在该脚本中，我们将设置注入右键菜单的内容脚本。</li>\n</ul>\n<p>在 \"modify-page\" 文件夹下创建名为 \"background.js\"的新文件，内容如下：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>browser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Eat this page\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nbrowser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">info<span class=\"token punctuation\">,</span> tab</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>menuItemId <span class=\"token operator\">==</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">file</span><span class=\"token operator\">:</span> <span class=\"token string\">\"page-eater.js\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>在该脚本中我们创建了一个右键菜单项，给了它一个具体的 id 和标题 (将在菜单中显示的文本)。然后又设置了一个事件侦听器，当用户点击菜单项时，检查该菜单项是否就是我们的吞页菜单项。如果是，就通过<a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript\"><code>tabs.executeScript()</code></a> 接口，把\"page-eater.js\" 注入到活动标签页中。这个接口用标签 ID 做为参数：如果省略标签 ID 参数，就默认把脚本注入当前活动标签。</p>\n<p>现在，附加组件看起来像这样：</p>\n<div class=\"code-example\"><pre class=\"brush: plain notranslate\">modify-page/\n    background.js\n    manifest.json\n    page-eater.js\n</pre></div>\n<p>重新加载<a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Temporary_Installation_in_Firefox#reloading_a_temporary_add-on\">WebExtension</a>, 打开页面 (这次可以是任何一个页面) 激活右键菜单，然后选择 \"Eat this page\"：</p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/zX4Bcv8VctA\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n<div class=\"notecard note\" id=\"sect4\">\n  <p><strong>备注：</strong> 请注意，虽然此视频显示在 <a href=\"https://addons.mozilla.org/en-US/firefox/\" class=\"external\" rel=\" noopener\">addons.mozilla.org</a> 工作的 content scripts，但目前该网站已禁止 content scripts。</p>\n</div>"}},{"type":"prose","value":{"id":"消息","title":"消息","isH3":false,"content":"<p>内容脚本和后台脚本不能直接相互访问，但可以通过发送消息进行通信。当一端设置一个消息侦听器时，另一个端就可以发送消息了。下面的表格总结了通信时的 api 接口：</p>\n<table class=\"fullwidth-table standard-table\">\n  <thead>\n    <tr>\n      <th scope=\"row\"></th>\n      <th scope=\"col\">在内容脚本中</th>\n      <th scope=\"col\">在后台脚本中</th>\n    </tr>\n    <tr>\n      <th scope=\"row\">发送消息</th>\n      <td><code><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime#sendmessage()\">browser.runtime.sendMessage()</a></code></td>\n      <td><code><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/Tabs/sendMessage\">browser.tabs.sendMessage()</a></code></td>\n    </tr>\n    <tr>\n      <th scope=\"row\">接收消息</th>\n      <td><code><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\">browser.runtime.onMessage</a></code></td>\n      <td><code><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime#onmessage\">browser.runtime.onMessage</a></code></td>\n    </tr>\n  </thead>\n</table>\n<p>修改上面的示例，使得可以通过后台脚本来发送消息。</p>\n<p>首先，修改 \"background.js\" 如下：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>browser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Eat this page\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">messageTab</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tabs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">replacement</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Message from the add-on!\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>contextMenus<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">info<span class=\"token punctuation\">,</span> tab</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>menuItemId <span class=\"token operator\">==</span> <span class=\"token string\">\"eat-page\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">file</span><span class=\"token operator\">:</span> <span class=\"token string\">\"page-eater.js\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> querying <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">active</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">currentWindow</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    querying<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>messageTab<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>注入 \"page-eater.js\"后，通过使用 <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query\"><code>tabs.query()</code></a> 获取当前活动标签页，然后使用<a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage\"><code>tabs.sendMessage()</code></a> 将消息发送到该标签页中的内容脚本。该消息的内容 <code>{replacement: \"Message from the add-on!\"}</code>。</p>\n<p>接下来，修改 \"page-eater.js\" 如下：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">eatPage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> sender<span class=\"token punctuation\">,</span> sendResponse</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> header <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  header<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>replacement<span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>eatPage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>现在，不再立即执行吞页，内容脚本将先通过使用 <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\"><code>runtime.onMessage</code></a>来监听消息。当监听到消息时，内容脚本才开始运作，除了来自<code>request.replacement</code>的替换文本不一样以外，其他的脚本运作本质上与之前的相同。</p>\n<p>如果我们想将消息从内容脚本发送到后台页面，除了在内容脚本中使用 <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage\"><code>runtime.sendMessage()</code></a> ，其他与上面的过程相反。</p>\n<div class=\"notecard note\" id=\"sect5\">\n  <p><strong>备注：</strong> 这些例子注入的都是 JavaScript; 想注入 CSS 可以使用 <a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/insertCSS\"><code>tabs.insertCSS()</code></a> 函数。</p>\n</div>"}},{"type":"prose","value":{"id":"了解更多","title":"了解更多","isH3":false,"content":"<ul>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a> 指南</li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\"><code>content_scripts</code></a> manifest key</li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\"><code>permissions</code></a> manifest key</li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript\"><code>tabs.executeScript()</code></a></li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/insertCSS\"><code>tabs.insertCSS()</code></a></li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage\"><code>tabs.sendMessage()</code></a></li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage\"><code>runtime.sendMessage()</code></a></li>\n  <li><a href=\"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\"><code>runtime.onMessage</code></a></li>\n  <li>使用<code>content_scripts</code>的例子：\n    <ul>\n      <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/borderify\" class=\"external\" rel=\" noopener\">borderify</a></li>\n      <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/inpage-toolbar-ui\" class=\"external\" rel=\" noopener\">inpage-toolbar-ui</a></li>\n      <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/notify-link-clicks-i18n\" class=\"external\" rel=\" noopener\">notify-link-clicks-i18n</a></li>\n      <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/page-to-extension-messaging\" class=\"external\" rel=\" noopener\">page-to-extension-messaging</a></li>\n    </ul>\n  </li>\n  <li>使用<code>tabs.executeScript()</code>的例子：\n    <ul>\n      <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/beastify\" class=\"external\" rel=\" noopener\">beastify</a></li>\n      <li><a href=\"https://github.com/mdn/webextensions-examples/tree/master/context-menu-demo\" class=\"external\" rel=\" noopener\">context-menu-demo</a></li>\n    </ul>\n  </li>\n</ul>"}}],"toc":[{"text":"修改匹配 URL 的页面","id":"修改匹配_url_的页面"},{"text":"通过程序修改页面","id":"通过程序修改页面"},{"text":"消息","id":"消息"},{"text":"了解更多","id":"了解更多"}],"summary":"浏览器附加组件 ( add-on ) 常被用于修改网页。例如更改页面的样式，隐藏特定的 DOM 节点或把 DOM 节点注入到页面中。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Modify a web page","locale":"en-US","native":"English (US)"},{"title":"Modify a web page","locale":"es","native":"Español"},{"title":"Modifier une page web","locale":"fr","native":"Français"},{"title":"ウェブページを変更する","locale":"ja","native":"日本語"},{"title":"Модификация веб страницы","locale":"ru","native":"Русский"}],"source":{"folder":"zh-cn/mozilla/add-ons/webextensions/modify_a_web_page","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/mozilla/add-ons/webextensions/modify_a_web_page/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Mozilla","title":"Mozilla"},{"uri":"/zh-CN/docs/Mozilla/Add-ons","title":"附加组件"},{"uri":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions","title":"浏览器扩展"},{"uri":"/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page","title":"修改 web 页面"}],"pageTitle":"修改 web 页面 - Mozilla | MDN","noIndexing":false}}