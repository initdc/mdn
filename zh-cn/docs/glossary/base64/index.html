<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>Base64 çš„ç¼–ç ä¸è§£ç  - æœ¯è¯­è¡¨ | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><link rel="alternate" title="Base64 çš„ç¼–ç ä¸è§£ç " href="https://developer.mozilla.org/zh-CN/docs/Glossary/Base64" hreflang="zh"><link rel="alternate" title="ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ´ĞµĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Base64" href="https://developer.mozilla.org/ru/docs/Glossary/Base64" hreflang="ru"><link rel="alternate" title="Base64" href="https://developer.mozilla.org/ja/docs/Glossary/Base64" hreflang="ja"><link rel="alternate" title="DÃ©coder et encoder en base64" href="https://developer.mozilla.org/fr/docs/Glossary/Base64" hreflang="fr"><link rel="alternate" title="Base64 codificando y decodificando" href="https://developer.mozilla.org/es/docs/Glossary/Base64" hreflang="es"><link rel="alternate" title="Base64" href="https://developer.mozilla.org/en-US/docs/Glossary/Base64" hreflang="en"><meta name="description" content="Base64 æ˜¯ä¸€ç»„ç›¸ä¼¼çš„äºŒè¿›åˆ¶åˆ°æ–‡æœ¬ï¼ˆbinary-to-textï¼‰çš„ç¼–ç è§„åˆ™ï¼Œä½¿å¾—äºŒè¿›åˆ¶æ•°æ®åœ¨è§£é‡Šæˆ radix-64 çš„è¡¨ç°å½¢å¼åèƒ½å¤Ÿç”¨ ASCII å­—ç¬¦ä¸²çš„æ ¼å¼è¡¨ç¤ºå‡ºæ¥ã€‚Base64 è¿™ä¸ªè¯å‡ºè‡ªä¸€ç§ MIME æ•°æ®ä¼ è¾“ç¼–ç ã€‚"><meta property="og:url" content="https://developer.mozilla.org/zh-CN/docs/Glossary/Base64"><meta property="og:title" content="Base64 çš„ç¼–ç ä¸è§£ç  - æœ¯è¯­è¡¨ | MDN"><meta property="og:description" content="Base64 æ˜¯ä¸€ç»„ç›¸ä¼¼çš„äºŒè¿›åˆ¶åˆ°æ–‡æœ¬ï¼ˆbinary-to-textï¼‰çš„ç¼–ç è§„åˆ™ï¼Œä½¿å¾—äºŒè¿›åˆ¶æ•°æ®åœ¨è§£é‡Šæˆ radix-64 çš„è¡¨ç°å½¢å¼åèƒ½å¤Ÿç”¨ ASCII å­—ç¬¦ä¸²çš„æ ¼å¼è¡¨ç¤ºå‡ºæ¥ã€‚Base64 è¿™ä¸ªè¯å‡ºè‡ªä¸€ç§ MIME æ•°æ®ä¼ è¾“ç¼–ç ã€‚"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Base64"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/zh-CN/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/zh-CN/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/zh-CN/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/zh-CN/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> ğŸŒ</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> ğŸŒ</a></li></ul></li></ul></nav><div class="header-search"><form action="/zh-CN/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/zh-CN/docs/Glossary"><span property="name">æœ¯è¯­è¡¨</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/zh-CN/docs/Glossary/Base64"><span property="name">Base64 çš„ç¼–ç ä¸è§£ç </span></a><meta property="position" content="2"></li></ol></nav><ul class="language-toggle"><li><a href="#select-language" class="language-icon"><span class="show-desktop">Change language</span></a></li><li><a class="view-in-english" href="/en-US/docs/Glossary/Base64"><span class="show-desktop">View in</span> English</a></li></ul></div><div class="localized-content-note notecard inline neutral"><a href="/en-US/docs/MDN/Contribute/Localize#active_locales">This page was translated from English by the community. Learn more and join the MDN Web Docs community.</a></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#æ–‡æ¡£">æ–‡æ¡£</a></li><li><a href="#å·¥å…·">å·¥å…·</a></li><li><a href="#ç›¸å…³æ–‡ç« ">ç›¸å…³æ–‡ç« </a></li><li><a href="#unicode_é—®é¢˜_2">Unicode é—®é¢˜</a></li><li><a href="#å‚è§">å‚è§</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="zh-CN"><h1>Base64 çš„ç¼–ç ä¸è§£ç </h1><div><p><strong>Base64</strong> æ˜¯ä¸€ç»„ç›¸ä¼¼çš„<a href="https://en.wikipedia.org/wiki/Binary-to-text_encoding" class="external" rel=" noopener">äºŒè¿›åˆ¶åˆ°æ–‡æœ¬</a>ï¼ˆbinary-to-textï¼‰çš„ç¼–ç è§„åˆ™ï¼Œä½¿å¾—äºŒè¿›åˆ¶æ•°æ®åœ¨è§£é‡Šæˆ radix-64 çš„è¡¨ç°å½¢å¼åèƒ½å¤Ÿç”¨ ASCII å­—ç¬¦ä¸²çš„æ ¼å¼è¡¨ç¤ºå‡ºæ¥ã€‚<em>Base64</em> è¿™ä¸ªè¯å‡ºè‡ªä¸€ç§ <a href="https://en.wikipedia.org/wiki/MIME#Content-Transfer-Encoding" class="external" rel=" noopener">MIME æ•°æ®ä¼ è¾“ç¼–ç </a>ã€‚</p>
<p>Base64 ç¼–ç æ™®éåº”ç”¨äºéœ€è¦é€šè¿‡è¢«è®¾è®¡ä¸ºå¤„ç†æ–‡æœ¬æ•°æ®çš„åª’ä»‹ä¸Šå‚¨å­˜å’Œä¼ è¾“äºŒè¿›åˆ¶æ•°æ®è€Œéœ€è¦ç¼–ç è¯¥äºŒè¿›åˆ¶æ•°æ®çš„åœºæ™¯ã€‚è¿™æ ·æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´å¹¶ä¸”ä¸ç”¨åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¿®æ”¹è¿™äº›æ•°æ®ã€‚Base64 ä¹Ÿè¢«ä¸€äº›åº”ç”¨ï¼ˆåŒ…æ‹¬ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/MIME" class="external" rel=" noopener">MIME</a> çš„ç”µå­é‚®ä»¶ï¼‰å’Œåœ¨ <a href="/zh-CN/docs/Web/XML">XML</a> ä¸­å‚¨å­˜å¤æ‚æ•°æ®æ—¶ä½¿ç”¨ã€‚</p>
<p>åœ¨ JavaScript ä¸­ï¼Œæœ‰ä¸¤ä¸ªå‡½æ•°è¢«åˆ†åˆ«ç”¨æ¥å¤„ç†è§£ç å’Œç¼–ç  <em>base64</em> å­—ç¬¦ä¸²ï¼š</p>
<ul>
  <li><a href="/zh-CN/docs/Web/API/atob" title="atob()"><code>atob()</code></a></li>
  <li><a href="/zh-CN/docs/Web/API/btoa" title="btoa()"><code>btoa()</code></a></li>
</ul>
<p><code>atob()</code> å‡½æ•°èƒ½å¤Ÿè§£ç é€šè¿‡ base-64 ç¼–ç çš„å­—ç¬¦ä¸²æ•°æ®ã€‚ç›¸ååœ°ï¼Œ<code>btoa()</code> å‡½æ•°èƒ½å¤Ÿä»äºŒè¿›åˆ¶æ•°æ®â€œå­—ç¬¦ä¸²â€åˆ›å»ºä¸€ä¸ª base-64 ç¼–ç çš„ ASCII å­—ç¬¦ä¸²ã€‚</p>
<p><code>atob()</code> å’Œ <code>btoa()</code> å‡ä½¿ç”¨å­—ç¬¦ä¸²ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffers</code></a>ï¼Œè¯·å‚é˜…åæ–‡ã€‚</p>
<h4 id="ç¼–ç å°ºå¯¸å¢åŠ ">ç¼–ç å°ºå¯¸å¢åŠ </h4>
<p>æ¯ä¸€ä¸ª Base64 å­—ç¬¦å®é™…ä¸Šä»£è¡¨ç€ 6 æ¯”ç‰¹ä½ã€‚å› æ­¤ï¼Œ3 å­—èŠ‚ï¼ˆä¸€å­—èŠ‚æ˜¯ 8 æ¯”ç‰¹ï¼Œ3 å­—èŠ‚ä¹Ÿå°±æ˜¯ 24 æ¯”ç‰¹ï¼‰çš„å­—ç¬¦ä¸²/äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥è½¬æ¢æˆ 4 ä¸ª Base64 å­—ç¬¦ (4x6 = 24 æ¯”ç‰¹)ã€‚</p>
<p>è¿™æ„å‘³ç€ Base64 æ ¼å¼çš„å­—ç¬¦ä¸²æˆ–æ–‡ä»¶çš„å°ºå¯¸çº¦æ˜¯åŸå§‹å°ºå¯¸çš„ 133%ï¼ˆå¢åŠ äº†å¤§çº¦ 33%ï¼‰ã€‚å¦‚æœç¼–ç çš„æ•°æ®å¾ˆå°‘ï¼Œå¢åŠ çš„æ¯”ä¾‹å¯èƒ½ä¼šæ›´é«˜ã€‚ä¾‹å¦‚ï¼šå­—ç¬¦ä¸²<code>"a"</code>çš„<code>length === 1</code>è¿›è¡Œ Base64 ç¼–ç åæ˜¯<code>"YQ=="</code>çš„<code>length === 4</code>ï¼Œå°ºå¯¸å¢åŠ äº† 300%ã€‚</p></div><h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" title="Permalink to æ–‡æ¡£">æ–‡æ¡£</a></h2><div><dl>
  <dt id="data_uris"><a href="/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Data_URLs"><code>data</code> URIs</a></dt>
  <dd>
    <p><code>data</code> URIs, å®šä¹‰äº <a href="https://tools.ietf.org/html/rfc2397" class="external" rel=" noopener">RFC 2397</a>ï¼Œç”¨äºåœ¨æ–‡æ¡£å†…åµŒå…¥å°çš„æ–‡ä»¶ã€‚</p>
  </dd>
  <dt id="base64"><a href="https://en.wikipedia.org/wiki/Base64" class="external" rel=" noopener">Base64</a></dt>
  <dd>
    <p>ç»´åŸºç™¾ç§‘ä¸Šå…³äº Base64 çš„æ–‡ç« ã€‚</p>
  </dd>
  <dt id="atob"><a href="/zh-CN/docs/Web/API/atob" title="atob()"><code>atob()</code></a></dt>
  <dd>
    <p>è§£ç ä¸€ä¸ª Base64 å­—ç¬¦ä¸²ã€‚</p>
  </dd>
  <dt id="btoa"><a href="/zh-CN/docs/Web/API/btoa" title="btoa()"><code>btoa()</code></a></dt>
  <dd>
    <p>ä»ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸€ä¸ª Base64 å­—ç¬¦ä¸²ã€‚</p>
  </dd>
  <dt id="unicode_é—®é¢˜"><a href="#the_.22unicode_problem.22">"Unicode é—®é¢˜"</a></dt>
  <dd>
    <p>åœ¨å¤§å¤šæ•°æµè§ˆå™¨é‡Œé‡Œï¼Œåœ¨ä¸€ä¸ª Unicode å­—ç¬¦ä¸²ä¸Šè°ƒç”¨ btoa() ä¼šé€ æˆä¸€ä¸ª<code>Character Out Of Range</code> å¼‚å¸¸ã€‚è¿™ä¸€æ®µå†™äº†ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚</p>
  </dd>
  <dt id="urischeme"><a href="/zh-CN/docs/URIScheme" class="page-not-created" title="This is a link to an unwritten page">URIScheme</a></dt>
  <dd>
    <p>Mozilla æ”¯æŒçš„ URI schemes åˆ—è¡¨ã€‚</p>
  </dd>
  <dt id="stringview"><a href="/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView" class="page-not-created" title="This is a link to an unwritten page"><code>StringView</code></a></dt>
  <dd>
    <p>è¿™ç¯‡æ–‡ç« å‘å¸ƒäº†ä¸€ä¸ªæˆ‘ä»¬åšçš„åº“ï¼Œç›®çš„åœ¨äºï¼š</p>
    <ul>
      <li>ä¸ºå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªç±» C æ¥å£ (i.e. array of characters codes â€” <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code>ArrayBufferView</code></a> in JavaScript) ï¼ŒåŸºäº JavaScript <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a> æ¥å£ã€‚</li>
      <li>ä¸ºç±»å­—ç¬¦ä¸²å¯¹è±¡ (ç›®å‰ä¸ºæ­¢ä¸ºï¼š<code>stringView</code>s) åˆ›å»ºä¸€ç³»åˆ—æ–¹æ³•ï¼Œå®ƒä»¬<strong>ä¸¥æ ¼æŒ‰ç…§æ•°å­—æ•°ç»„</strong>å·¥ä½œï¼Œè€Œä¸æ˜¯ä¸å¯å˜çš„å­—ç¬¦ä¸²ã€‚</li>
      <li>å¯ç”¨äºå…¶å®ƒ Unicode ç¼–ç ï¼Œå’Œé»˜è®¤çš„ <code>DOMStrings</code> ä¸åŒã€‚</li>
    </ul>
  </dd>
</dl></div><h2 id="å·¥å…·"><a href="#å·¥å…·" title="Permalink to å·¥å…·">å·¥å…·</a></h2><div><ul>
  <li><a href="#solution_.232_.e2.80.93_rewriting_atob_and_btoa_using_typedarrays_and_utf-8">Rewriting <code>atob()</code> and <code>btoa()</code> using <code>TypedArray</code>s and UTF-8</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView" class="page-not-created" title="This is a link to an unwritten page"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a></li>
</ul></div><h2 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " title="Permalink to ç›¸å…³æ–‡ç« ">ç›¸å…³æ–‡ç« </a></h2><div><ul>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Typed_arrays">Typed arrays</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">ArrayBufferView</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code>Uint8Array</code></a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView" class="page-not-created" title="This is a link to an unwritten page"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String"><code>DOMString</code></a></li>
  <li><a href="/zh-CN/docs/Glossary/URI"><code>URI</code></a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURI"><code>encodeURI()</code></a></li>
</ul></div><h2 id="unicode_é—®é¢˜_2"><a href="#unicode_é—®é¢˜_2" title="Permalink to Unicode é—®é¢˜">Unicode é—®é¢˜</a></h2><div><p>ç”±äº <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String"><code>DOMString</code></a> æ˜¯ 16 ä½ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¦‚æœæœ‰å­—ç¬¦è¶…å‡ºäº† 8 ä½ ASCII ç¼–ç çš„å­—ç¬¦èŒƒå›´æ—¶ï¼Œåœ¨å¤§å¤šæ•°çš„æµè§ˆå™¨ä¸­å¯¹ Unicode å­—ç¬¦ä¸²è°ƒç”¨ <code>window.btoa</code> å°†ä¼šé€ æˆä¸€ä¸ª <code>Character Out Of Range</code> çš„å¼‚å¸¸ã€‚æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
  <li><a href="#solution_1_â€“_javascript's_utf-16_>_base64">the first method</a> consists in encoding JavaScript's native UTF-16 strings directly into base64 (fast, portable, clean)</li>
  <li><a href="#solution_2_â€“_javascript's_utf-16_>_utf-8_>_base64">the second method</a> consists in converting JavaScript's native UTF-16 strings to UTF-8 and then encode the latter into base64 (relatively fast, portable, clean)</li>
  <li><a href="#solution_3_â€“_javascript's_utf-16_>_binary_string_>_base64">the third method</a> consists in encoding JavaScript's native UTF-16 strings directly into base64 via binary strings (very fast, relatively portable, very compact)</li>
  <li><a href="#solution_4_â€“_escaping_the_string_before_encoding_it">the fourth method</a> consists in escaping the whole string (with UTF-8, see <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent"><code>encodeURIComponent</code></a>) and then encode it (portable, non-standard)</li>
  <li><a href="#solution_5_â€“_rewrite_the_doms_atob_and_btoa_using_javascripts_typedarrays_and_utf-8">the fifth method</a> is similar to the second method, but uses third party libraries</li>
</ul></div><h3 id="solution_1_â€“_javascripts_utf-16__base64"><a href="#solution_1_â€“_javascripts_utf-16__base64" title="Permalink to Solution #1 â€“ JavaScript's UTF-16 => base64">Solution #1 â€“ JavaScript's UTF-16 =&gt; base64</a></h3><div><p>A very fast and widely useable way to solve the unicode problem is by encoding JavaScript native UTF-16 strings directly into base64. Please visit the URL <code>data:text/plain;charset=utf-16;base64,OCY5JjomOyY8Jj4mPyY=</code> for a demonstration (copy the data uri, open a new tab, paste the data URI into the address bar, then press enter to go to the page). This method is particularly efficient because it does not require any type of conversion, except mapping a string into an array. The following code is also useful to get an <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a> from a <em>Base64</em> string and/or viceversa (<a href="#appendix_to_solution_1_decode_a_base64_string_to_uint8array_or_arraybuffer">see below</a>).</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token string">"use strict"</span><span class="token punctuation">;</span>

<span class="token comment">/*\
|*|
|*|  Base64 / binary data / UTF-8 strings utilities (#1)
|*|
|*|  https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding
|*|
|*|  Author: madmurphy
|*|
\*/</span>

<span class="token comment">/* Array of bytes to base64 string decoding */</span>

<span class="token keyword">function</span> <span class="token function">b64ToUint6</span> <span class="token punctuation">(</span><span class="token parameter">nChr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> nChr <span class="token operator">&gt;</span> <span class="token number">64</span> <span class="token operator">&amp;&amp;</span> nChr <span class="token operator">&lt;</span> <span class="token number">91</span> <span class="token operator">?</span>
      nChr <span class="token operator">-</span> <span class="token number">65</span>
    <span class="token operator">:</span> nChr <span class="token operator">&gt;</span> <span class="token number">96</span> <span class="token operator">&amp;&amp;</span> nChr <span class="token operator">&lt;</span> <span class="token number">123</span> <span class="token operator">?</span>
      nChr <span class="token operator">-</span> <span class="token number">71</span>
    <span class="token operator">:</span> nChr <span class="token operator">&gt;</span> <span class="token number">47</span> <span class="token operator">&amp;&amp;</span> nChr <span class="token operator">&lt;</span> <span class="token number">58</span> <span class="token operator">?</span>
      nChr <span class="token operator">+</span> <span class="token number">4</span>
    <span class="token operator">:</span> nChr <span class="token operator">===</span> <span class="token number">43</span> <span class="token operator">?</span>
      <span class="token number">62</span>
    <span class="token operator">:</span> nChr <span class="token operator">===</span> <span class="token number">47</span> <span class="token operator">?</span>
      <span class="token number">63</span>
    <span class="token operator">:</span>
      <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">base64DecToArr</span> <span class="token punctuation">(</span><span class="token parameter">sBase64<span class="token punctuation">,</span> nBlockSize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span>
    sB64Enc <span class="token operator">=</span> sBase64<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[^A-Za-z0-9\+\/]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nInLen <span class="token operator">=</span> sB64Enc<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
    nOutLen <span class="token operator">=</span> nBlockSize <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nInLen <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> nBlockSize<span class="token punctuation">)</span> <span class="token operator">*</span> nBlockSize <span class="token operator">:</span> nInLen <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> aBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>nOutLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nMod3<span class="token punctuation">,</span> nMod4<span class="token punctuation">,</span> nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nOutIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nInIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nInIdx <span class="token operator">&lt;</span> nInLen<span class="token punctuation">;</span> nInIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nMod4 <span class="token operator">=</span> nInIdx <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>
    nUint24 <span class="token operator">|=</span> <span class="token function">b64ToUint6</span><span class="token punctuation">(</span>sB64Enc<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>nInIdx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">18</span> <span class="token operator">-</span> <span class="token number">6</span> <span class="token operator">*</span> nMod4<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nMod4 <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">||</span> nInLen <span class="token operator">-</span> nInIdx <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>nMod3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nMod3 <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> nOutIdx <span class="token operator">&lt;</span> nOutLen<span class="token punctuation">;</span> nMod3<span class="token operator">++</span><span class="token punctuation">,</span> nOutIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        aBytes<span class="token punctuation">[</span>nOutIdx<span class="token punctuation">]</span> <span class="token operator">=</span> nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">&gt;&gt;&gt;</span> nMod3 <span class="token operator">&amp;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> aBytes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Base64 string to array encoding */</span>

<span class="token keyword">function</span> <span class="token function">uint6ToB64</span> <span class="token punctuation">(</span><span class="token parameter">nUint6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> nUint6 <span class="token operator">&lt;</span> <span class="token number">26</span> <span class="token operator">?</span>
      nUint6 <span class="token operator">+</span> <span class="token number">65</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">&lt;</span> <span class="token number">52</span> <span class="token operator">?</span>
      nUint6 <span class="token operator">+</span> <span class="token number">71</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">&lt;</span> <span class="token number">62</span> <span class="token operator">?</span>
      nUint6 <span class="token operator">-</span> <span class="token number">4</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">===</span> <span class="token number">62</span> <span class="token operator">?</span>
      <span class="token number">43</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">===</span> <span class="token number">63</span> <span class="token operator">?</span>
      <span class="token number">47</span>
    <span class="token operator">:</span>
      <span class="token number">65</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">base64EncArr</span> <span class="token punctuation">(</span><span class="token parameter">aBytes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> eqLen <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">,</span> sB64Enc <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nMod3<span class="token punctuation">,</span> nLen <span class="token operator">=</span> aBytes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nIdx <span class="token operator">&lt;</span> nLen<span class="token punctuation">;</span> nIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nMod3 <span class="token operator">=</span> nIdx <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token comment">/* Uncomment the following line in order to split the output in lines 76-character long: */</span>
    <span class="token comment">/*
    if (nIdx &gt; 0 &amp;&amp; (nIdx * 4 / 3) % 76 === 0) { sB64Enc += "\r\n"; }
    */</span>
    nUint24 <span class="token operator">|=</span> aBytes<span class="token punctuation">[</span>nIdx<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">&gt;&gt;&gt;</span> nMod3 <span class="token operator">&amp;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nMod3 <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">||</span> aBytes<span class="token punctuation">.</span>length <span class="token operator">-</span> nIdx <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sB64Enc <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">18</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span>  eqLen <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span>
      <span class="token literal-property property">sB64Enc</span>
    <span class="token operator">:</span>
      sB64Enc<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sB64Enc<span class="token punctuation">.</span>length <span class="token operator">-</span> eqLen<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>eqLen <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"="</span> <span class="token operator">:</span> <span class="token string">"=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="tests">Tests</h4>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> myString <span class="token operator">=</span> <span class="token string">"â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿"</span><span class="token punctuation">;</span>

<span class="token comment">/* Part 1: Encode `myString` to base64 using native UTF-16 */</span>

<span class="token keyword">var</span> aUTF16CodeUnits <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>myString<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>aUTF16CodeUnits<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> arr<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> myString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sUTF16Base64 <span class="token operator">=</span> <span class="token function">base64EncArr</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>aUTF16CodeUnits<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Show output */</span>

<span class="token function">alert</span><span class="token punctuation">(</span>sUTF16Base64<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "OCY5JjomOyY8Jj4mPyY="</span>

<span class="token comment">/* Part 2: Decode `sUTF16Base64` to UTF-16 */</span>

<span class="token keyword">var</span> sDecodedString <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token function">base64DecToArr</span><span class="token punctuation">(</span>sUTF16Base64<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Show output */</span>

<span class="token function">alert</span><span class="token punctuation">(</span>sDecodedString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿"</span>
</code></pre></div>
<p>The produced string is fully portable, although represented as UTF-16. If you prefer UTF-8, see <a href="#solution_2_â€“_javascript's_utf-16_>_utf-8_>_base64">the next solution</a>.</p>
<h4 id="appendix_to_solution_1_decode_a_base64_string_to_uint8array_or_arraybuffer">Appendix to <a href="#solution_1_â€“_javascript's_utf-16_>_base64">Solution #1</a>: Decode a <em>Base64</em> string to <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">Uint8Array</a> or <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></h4>
<p>The functions above let us also create <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">uint8Arrays</a> or <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">arrayBuffers</a> from <em>base64</em>-encoded strings:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> myArray <span class="token operator">=</span> <span class="token function">base64DecToArr</span><span class="token punctuation">(</span><span class="token string">"QmFzZSA2NCDigJQgTW96aWxsYSBEZXZlbG9wZXIgTmV0d29yaw=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Base 64 \u2014 Mozilla Developer Network" (as UTF-8)</span>

<span class="token keyword">var</span> myBuffer <span class="token operator">=</span> <span class="token function">base64DecToArr</span><span class="token punctuation">(</span><span class="token string">"QmFzZSA2NCDigJQgTW96aWxsYSBEZXZlbG9wZXIgTmV0d29yaw=="</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer<span class="token punctuation">;</span> <span class="token comment">// "Base 64 \u2014 Mozilla Developer Network" (as UTF-8)</span>

<span class="token function">alert</span><span class="token punctuation">(</span>myBuffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect1">
  <p><strong>å¤‡æ³¨ï¼š</strong> The function <code>base64DecToArr(sBase64[, nBlockSize])</code> returns an <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code>uint8Array</code></a> of bytes. If your aim is to build a buffer of 16-bit / 32-bit / 64-bit raw data, use the <code>nBlockSize</code> argument, which is the number of bytes which the <code>uint8Array.buffer.bytesLength</code> property must result to be a multiple of (<code>1</code> or omitted for ASCII, binary content, <a href="/zh-CN/docs/Web/API/btoa">binary strings</a>, UTF-8-encoded strings; <code>2</code> for UTF-16 strings; <code>4</code> for UTF-32 strings).</p>
</div>
<p>For a more complete library, see <a href="/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView" class="page-not-created" title="This is a link to an unwritten page"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a> (source code <a href="https://github.com/madmurphy/stringview.js" class="external" rel=" noopener">available on GitHub</a>).</p></div><h3 id="solution_2_â€“_javascripts_utf-16__utf-8__base64"><a href="#solution_2_â€“_javascripts_utf-16__utf-8__base64" title="Permalink to Solution #2 â€“ JavaScript's UTF-16 => UTF-8 => base64">Solution #2 â€“ JavaScript's UTF-16 =&gt; UTF-8 =&gt; base64</a></h3><div><p>This solution consists in converting a JavaScript's native UTF-16 string into a UTF-8 string and then encoding the latter into base64. This also grants that converting a pure ASCII string to base64 always produces the same output as the native <a href="/zh-CN/docs/Web/API/btoa"><code>btoa()</code></a>.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token string">"use strict"</span><span class="token punctuation">;</span>

<span class="token comment">/*\
|*|
|*|  Base64 / binary data / UTF-8 strings utilities (#2)
|*|
|*|  https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding
|*|
|*|  Author: madmurphy
|*|
\*/</span>

<span class="token comment">/* Array of bytes to base64 string decoding */</span>

<span class="token keyword">function</span> <span class="token function">b64ToUint6</span> <span class="token punctuation">(</span><span class="token parameter">nChr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> nChr <span class="token operator">&gt;</span> <span class="token number">64</span> <span class="token operator">&amp;&amp;</span> nChr <span class="token operator">&lt;</span> <span class="token number">91</span> <span class="token operator">?</span>
      nChr <span class="token operator">-</span> <span class="token number">65</span>
    <span class="token operator">:</span> nChr <span class="token operator">&gt;</span> <span class="token number">96</span> <span class="token operator">&amp;&amp;</span> nChr <span class="token operator">&lt;</span> <span class="token number">123</span> <span class="token operator">?</span>
      nChr <span class="token operator">-</span> <span class="token number">71</span>
    <span class="token operator">:</span> nChr <span class="token operator">&gt;</span> <span class="token number">47</span> <span class="token operator">&amp;&amp;</span> nChr <span class="token operator">&lt;</span> <span class="token number">58</span> <span class="token operator">?</span>
      nChr <span class="token operator">+</span> <span class="token number">4</span>
    <span class="token operator">:</span> nChr <span class="token operator">===</span> <span class="token number">43</span> <span class="token operator">?</span>
      <span class="token number">62</span>
    <span class="token operator">:</span> nChr <span class="token operator">===</span> <span class="token number">47</span> <span class="token operator">?</span>
      <span class="token number">63</span>
    <span class="token operator">:</span>
      <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">base64DecToArr</span> <span class="token punctuation">(</span><span class="token parameter">sBase64<span class="token punctuation">,</span> nBlockSize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span>
    sB64Enc <span class="token operator">=</span> sBase64<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[^A-Za-z0-9\+\/]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nInLen <span class="token operator">=</span> sB64Enc<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
    nOutLen <span class="token operator">=</span> nBlockSize <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nInLen <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> nBlockSize<span class="token punctuation">)</span> <span class="token operator">*</span> nBlockSize <span class="token operator">:</span> nInLen <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> aBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>nOutLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nMod3<span class="token punctuation">,</span> nMod4<span class="token punctuation">,</span> nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nOutIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nInIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nInIdx <span class="token operator">&lt;</span> nInLen<span class="token punctuation">;</span> nInIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nMod4 <span class="token operator">=</span> nInIdx <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>
    nUint24 <span class="token operator">|=</span> <span class="token function">b64ToUint6</span><span class="token punctuation">(</span>sB64Enc<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>nInIdx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">18</span> <span class="token operator">-</span> <span class="token number">6</span> <span class="token operator">*</span> nMod4<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nMod4 <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">||</span> nInLen <span class="token operator">-</span> nInIdx <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>nMod3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nMod3 <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> nOutIdx <span class="token operator">&lt;</span> nOutLen<span class="token punctuation">;</span> nMod3<span class="token operator">++</span><span class="token punctuation">,</span> nOutIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        aBytes<span class="token punctuation">[</span>nOutIdx<span class="token punctuation">]</span> <span class="token operator">=</span> nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">&gt;&gt;&gt;</span> nMod3 <span class="token operator">&amp;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> aBytes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Base64 string to array encoding */</span>

<span class="token keyword">function</span> <span class="token function">uint6ToB64</span> <span class="token punctuation">(</span><span class="token parameter">nUint6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> nUint6 <span class="token operator">&lt;</span> <span class="token number">26</span> <span class="token operator">?</span>
      nUint6 <span class="token operator">+</span> <span class="token number">65</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">&lt;</span> <span class="token number">52</span> <span class="token operator">?</span>
      nUint6 <span class="token operator">+</span> <span class="token number">71</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">&lt;</span> <span class="token number">62</span> <span class="token operator">?</span>
      nUint6 <span class="token operator">-</span> <span class="token number">4</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">===</span> <span class="token number">62</span> <span class="token operator">?</span>
      <span class="token number">43</span>
    <span class="token operator">:</span> nUint6 <span class="token operator">===</span> <span class="token number">63</span> <span class="token operator">?</span>
      <span class="token number">47</span>
    <span class="token operator">:</span>
      <span class="token number">65</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">base64EncArr</span> <span class="token punctuation">(</span><span class="token parameter">aBytes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> eqLen <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">,</span> sB64Enc <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nMod3<span class="token punctuation">,</span> nLen <span class="token operator">=</span> aBytes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nIdx <span class="token operator">&lt;</span> nLen<span class="token punctuation">;</span> nIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nMod3 <span class="token operator">=</span> nIdx <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token comment">/* Uncomment the following line in order to split the output in lines 76-character long: */</span>
    <span class="token comment">/*
    if (nIdx &gt; 0 &amp;&amp; (nIdx * 4 / 3) % 76 === 0) { sB64Enc += "\r\n"; }
    */</span>
    nUint24 <span class="token operator">|=</span> aBytes<span class="token punctuation">[</span>nIdx<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">&gt;&gt;&gt;</span> nMod3 <span class="token operator">&amp;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nMod3 <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">||</span> aBytes<span class="token punctuation">.</span>length <span class="token operator">-</span> nIdx <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sB64Enc <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">18</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uint6ToB64</span><span class="token punctuation">(</span>nUint24 <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      nUint24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span>  eqLen <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span>
      <span class="token literal-property property">sB64Enc</span>
    <span class="token operator">:</span>
      sB64Enc<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sB64Enc<span class="token punctuation">.</span>length <span class="token operator">-</span> eqLen<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>eqLen <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"="</span> <span class="token operator">:</span> <span class="token string">"=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">/* UTF-8 array to DOMString and vice versa */</span>

<span class="token keyword">function</span> <span class="token function">UTF8ArrToStr</span> <span class="token punctuation">(</span><span class="token parameter">aBytes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> sView <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nPart<span class="token punctuation">,</span> nLen <span class="token operator">=</span> aBytes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> nIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nIdx <span class="token operator">&lt;</span> nLen<span class="token punctuation">;</span> nIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nPart <span class="token operator">=</span> aBytes<span class="token punctuation">[</span>nIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    sView <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>
      nPart <span class="token operator">&gt;</span> <span class="token number">251</span> <span class="token operator">&amp;&amp;</span> nPart <span class="token operator">&lt;</span> <span class="token number">254</span> <span class="token operator">&amp;&amp;</span> nIdx <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">&lt;</span> nLen <span class="token operator">?</span> <span class="token comment">/* six bytes */</span>
        <span class="token comment">/* (nPart - 252 &lt;&lt; 30) may be not so safe in ECMAScript! So...: */</span>
        <span class="token punctuation">(</span>nPart <span class="token operator">-</span> <span class="token number">252</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1073741824</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span>
      <span class="token operator">:</span> nPart <span class="token operator">&gt;</span> <span class="token number">247</span> <span class="token operator">&amp;&amp;</span> nPart <span class="token operator">&lt;</span> <span class="token number">252</span> <span class="token operator">&amp;&amp;</span> nIdx <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">&lt;</span> nLen <span class="token operator">?</span> <span class="token comment">/* five bytes */</span>
        <span class="token punctuation">(</span>nPart <span class="token operator">-</span> <span class="token number">248</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span>
      <span class="token operator">:</span> nPart <span class="token operator">&gt;</span> <span class="token number">239</span> <span class="token operator">&amp;&amp;</span> nPart <span class="token operator">&lt;</span> <span class="token number">248</span> <span class="token operator">&amp;&amp;</span> nIdx <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">&lt;</span> nLen <span class="token operator">?</span> <span class="token comment">/* four bytes */</span>
        <span class="token punctuation">(</span>nPart <span class="token operator">-</span> <span class="token number">240</span> <span class="token operator">&lt;&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span>
      <span class="token operator">:</span> nPart <span class="token operator">&gt;</span> <span class="token number">223</span> <span class="token operator">&amp;&amp;</span> nPart <span class="token operator">&lt;</span> <span class="token number">240</span> <span class="token operator">&amp;&amp;</span> nIdx <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;</span> nLen <span class="token operator">?</span> <span class="token comment">/* three bytes */</span>
        <span class="token punctuation">(</span>nPart <span class="token operator">-</span> <span class="token number">224</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span>
      <span class="token operator">:</span> nPart <span class="token operator">&gt;</span> <span class="token number">191</span> <span class="token operator">&amp;&amp;</span> nPart <span class="token operator">&lt;</span> <span class="token number">224</span> <span class="token operator">&amp;&amp;</span> nIdx <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> nLen <span class="token operator">?</span> <span class="token comment">/* two bytes */</span>
        <span class="token punctuation">(</span>nPart <span class="token operator">-</span> <span class="token number">192</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> aBytes<span class="token punctuation">[</span><span class="token operator">++</span>nIdx<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">128</span>
      <span class="token operator">:</span> <span class="token comment">/* nPart &lt; 127 ? */</span> <span class="token comment">/* one byte */</span>
        nPart
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> sView<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">strToUTF8Arr</span> <span class="token punctuation">(</span><span class="token parameter">sDOMStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> aBytes<span class="token punctuation">,</span> nChr<span class="token punctuation">,</span> nStrLen <span class="token operator">=</span> sDOMStr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> nArrLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">/* mapping... */</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nMapIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nMapIdx <span class="token operator">&lt;</span> nStrLen<span class="token punctuation">;</span> nMapIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nChr <span class="token operator">=</span> sDOMStr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>nMapIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    nArrLen <span class="token operator">+=</span> nChr <span class="token operator">&lt;</span> <span class="token number">0x80</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> nChr <span class="token operator">&lt;</span> <span class="token number">0x800</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> nChr <span class="token operator">&lt;</span> <span class="token number">0x10000</span> <span class="token operator">?</span> <span class="token number">3</span> <span class="token operator">:</span> nChr <span class="token operator">&lt;</span> <span class="token number">0x200000</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> nChr <span class="token operator">&lt;</span> <span class="token number">0x4000000</span> <span class="token operator">?</span> <span class="token number">5</span> <span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  aBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>nArrLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* transcription... */</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nChrIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> nIdx <span class="token operator">&lt;</span> nArrLen<span class="token punctuation">;</span> nChrIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nChr <span class="token operator">=</span> sDOMStr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>nChrIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nChr <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* one byte */</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> nChr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nChr <span class="token operator">&lt;</span> <span class="token number">0x800</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* two bytes */</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">192</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nChr <span class="token operator">&lt;</span> <span class="token number">0x10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* three bytes */</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">224</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nChr <span class="token operator">&lt;</span> <span class="token number">0x200000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* four bytes */</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">240</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nChr <span class="token operator">&lt;</span> <span class="token number">0x4000000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* five bytes */</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">248</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">18</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token comment">/* if (nChr &lt;= 0x7fffffff) */</span> <span class="token punctuation">{</span>
      <span class="token comment">/* six bytes */</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">252</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">18</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aBytes<span class="token punctuation">[</span>nIdx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">128</span> <span class="token operator">+</span> <span class="token punctuation">(</span>nChr <span class="token operator">&amp;</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> aBytes<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="tests_2">Tests</h4>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">/* Tests */</span>

<span class="token keyword">var</span> sMyInput <span class="token operator">=</span> <span class="token string">"Base 64 \u2014 Mozilla Developer Network"</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> aMyUTF8Input <span class="token operator">=</span> <span class="token function">strToUTF8Arr</span><span class="token punctuation">(</span>sMyInput<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> sMyBase64 <span class="token operator">=</span> <span class="token function">base64EncArr</span><span class="token punctuation">(</span>aMyUTF8Input<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>sMyBase64<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "QmFzZSA2NCDigJQgTW96aWxsYSBEZXZlbG9wZXIgTmV0d29yaw=="</span>

<span class="token keyword">var</span> aMyUTF8Output <span class="token operator">=</span> <span class="token function">base64DecToArr</span><span class="token punctuation">(</span>sMyBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> sMyOutput <span class="token operator">=</span> <span class="token function">UTF8ArrToStr</span><span class="token punctuation">(</span>aMyUTF8Output<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>sMyOutput<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Base 64 â€” Mozilla Developer Network"</span>
</code></pre></div></div><h3 id="solution_3_â€“_javascripts_utf-16__binary_string__base64"><a href="#solution_3_â€“_javascripts_utf-16__binary_string__base64" title="Permalink to Solution #3 â€“ JavaScript's UTF-16 => binary string => base64">Solution #3 â€“ JavaScript's UTF-16 =&gt; binary string =&gt; base64</a></h3><div><p>The following is the fastest and most compact possible approach. The output is exactly the same produced by <a href="#solution_1_â€“_javascript's_utf-16_>_base64">Solution #1</a> (UTF-16 encoded strings), but instead of rewriting <a href="/zh-CN/docs/Web/API/atob" title="atob()"><code>atob()</code></a> and <a href="/zh-CN/docs/Web/API/btoa" title="btoa()"><code>btoa()</code></a> it uses the native ones. This is made possible by the fact that instead of using typed arrays as encoding/decoding inputs this solution uses <a href="/zh-CN/docs/Web/API/btoa">binary strings</a> as an intermediate format. It is a â€œdirtyâ€ workaround in comparison to <a href="#solution_1_â€“_javascript's_utf-16_>_base64">Solution #1</a> (<a href="/zh-CN/docs/Web/API/btoa">binary strings</a> are a grey area), however it works pretty well and requires only a few lines of code.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token string">"use strict"</span><span class="token punctuation">;</span>

<span class="token comment">/*\
|*|
|*|  Base64 / binary data / UTF-8 strings utilities (#3)
|*|
|*|  https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding
|*|
|*|  Author: madmurphy
|*|
\*/</span>

<span class="token keyword">function</span> <span class="token function">btoaUTF16</span> <span class="token punctuation">(</span><span class="token parameter">sString</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> aUTF16CodeUnits <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>sString<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>aUTF16CodeUnits<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> arr<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> sString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">btoa</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>aUTF16CodeUnits<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">atobUTF16</span> <span class="token punctuation">(</span><span class="token parameter">sBase64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

 <span class="token keyword">var</span> sBinaryString <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>sBase64<span class="token punctuation">)</span><span class="token punctuation">,</span> aBinaryView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>sBinaryString<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>aBinaryView<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> arr<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> sBinaryString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>aBinaryView<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="tests_3">Tests</h4>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">var</span> myString <span class="token operator">=</span> <span class="token string">"â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿"</span><span class="token punctuation">;</span>

<span class="token comment">/* Part 1: Encode `myString` to base64 using native UTF-16 */</span>

<span class="token keyword">var</span> sUTF16Base64 <span class="token operator">=</span> <span class="token function">btoaUTF16</span><span class="token punctuation">(</span>myString<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Show output */</span>

<span class="token function">alert</span><span class="token punctuation">(</span>sUTF16Base64<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "OCY5JjomOyY8Jj4mPyY="</span>

<span class="token comment">/* Part 2: Decode `sUTF16Base64` to UTF-16 */</span>

<span class="token keyword">var</span> sDecodedString <span class="token operator">=</span> <span class="token function">atobUTF16</span><span class="token punctuation">(</span>sUTF16Base64<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Show output */</span>

<span class="token function">alert</span><span class="token punctuation">(</span>sDecodedString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿"</span>
</code></pre></div>
<p>For a cleaner solution that uses typed arrays instead of binary strings, see solutions <a href="#solution_1_â€“_javascript's_utf-16_>_base64">#1</a> and <a href="#solution_2_â€“_javascript's_utf-16_>_utf-8_>_base64">#2</a>.</p></div><h3 id="solution_4_â€“_escaping_the_string_before_encoding_it"><a href="#solution_4_â€“_escaping_the_string_before_encoding_it" title="Permalink to Solution #4 â€“ escaping the string before encoding it">Solution #4 â€“ escaping the string before encoding it</a></h3><div><div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">b64EncodeUnicode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// first we use encodeURIComponent to get percent-encoded UTF-8,</span>
    <span class="token comment">// then we convert the percent encodings into raw bytes which</span>
    <span class="token comment">// can be fed into btoa.</span>
    <span class="token keyword">return</span> <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">%([0-9A-F]{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
        <span class="token keyword">function</span> <span class="token function">toSolidBytes</span><span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> p1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">b64EncodeUnicode</span><span class="token punctuation">(</span><span class="token string">'âœ“ Ã  la mode'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "4pyTIMOgIGxhIG1vZGU="</span>
<span class="token function">b64EncodeUnicode</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Cg=="</span>
</code></pre></div>
<p>To decode the Base64-encoded value back into a String:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">b64DecodeUnicode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Going backwards: from bytestream, to percent-encoding, to original string.</span>
    <span class="token keyword">return</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'00'</span> <span class="token operator">+</span> c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">b64DecodeUnicode</span><span class="token punctuation">(</span><span class="token string">'4pyTIMOgIGxhIG1vZGU='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "âœ“ Ã  la mode"</span>
<span class="token function">b64DecodeUnicode</span><span class="token punctuation">(</span><span class="token string">'Cg=='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "\n"</span>
</code></pre></div>
<p><a href="https://git.daplie.com/Daplie/unibabel-js" class="external" rel=" noopener">Unibabel</a> implements common conversions using this strategy.</p></div><h3 id="solution_5_â€“_rewrite_the_doms_atob_and_btoa_using_javascripts_typedarrays_and_utf-8"><a href="#solution_5_â€“_rewrite_the_doms_atob_and_btoa_using_javascripts_typedarrays_and_utf-8" title="Permalink to Solution #5 â€“ rewrite the DOMs atob() and btoa() using JavaScript's TypedArrays and UTF-8">Solution #5 â€“ rewrite the DOMs <code>atob()</code> and <code>btoa()</code> using JavaScript's <code>TypedArray</code>s and UTF-8</a></h3><div><p>Use a <a href="/zh-CN/docs/Web/API/TextEncoder">TextEncoder</a> polyfill such as <a href="https://github.com/inexorabletash/text-encoding" class="external" rel=" noopener">TextEncoding</a> (also includes legacy windows, mac, and ISO encodings), <a href="https://github.com/coolaj86/TextEncoderLite" class="external" rel=" noopener">TextEncoderLite</a>, combined with a <a href="https://github.com/feross/buffer" class="external" rel=" noopener">Buffer</a> and a Base64 implementation such as <a href="https://github.com/beatgammit/base64-js" class="external" rel=" noopener">base64-js</a> or <a href="https://github.com/waitingsong/base64" class="external" rel=" noopener">TypeScript version of base64-js</a> for both modern browsers and Node.js.</p>
<p>When a native <code>TextEncoder</code> implementation is not available, the most light-weight solution would be to use <a href="#solution_3_â€“_javascript's_utf-16_>_binary_string_>_base64">Solution #3</a> because in addition to being much faster, <a href="#solution_3_â€“_javascript's_utf-16_>_binary_string_>_base64">Solution #3</a> also works in IE9 "out of the box." Alternatively, use <a href="https://github.com/coolaj86/TextEncoderLite" class="external" rel=" noopener">TextEncoderLite</a> with <a href="https://github.com/beatgammit/base64-js" class="external" rel=" noopener">base64-js</a>. Use the browser implementation when you can.</p>
<p>The following function implements such a strategy. It assumes base64-js imported as <code>&lt;script type="text/javascript" src="base64js.min.js"/&gt;</code>. Note that TextEncoderLite only works with UTF-8.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">Base64Encode</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> TextEncoder <span class="token operator">===</span> <span class="token string">"undefined"</span> <span class="token operator">?</span> TextEncoderLite <span class="token operator">:</span> TextEncoder<span class="token punctuation">)</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> base64js<span class="token punctuation">.</span><span class="token function">fromByteArray</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Base64Decode</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> bytes <span class="token operator">=</span> base64js<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> TextDecoder <span class="token operator">===</span> <span class="token string">"undefined"</span> <span class="token operator">?</span> TextDecoderLite <span class="token operator">:</span> TextDecoder<span class="token punctuation">)</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>
  <strong>æ³¨æ„</strong>: <a href="https://github.com/coolaj86/TextEncoderLite" class="external" rel=" noopener">TextEncoderLite</a> ä¸èƒ½æ­£ç¡®å¤„ç†å››å­—èŠ‚ UTF-8 å­—ç¬¦ï¼Œæ¯”å¦‚ '\uD842\uDFB7' æˆ–ç¼©å†™ä¸º '\u{20BB7}' ã€‚å‚è§ <a href="https://github.com/solderjs/TextEncoderLite/issues/16" class="external" rel=" noopener">issue</a>
  å¯ä½¿ç”¨ <a href="https://github.com/inexorabletash/text-encoding" class="external" rel=" noopener">text-encoding</a> ä½œä¸ºæ›¿ä»£ã€‚
</p>
<p>æŸäº›åœºæ™¯ä¸‹ï¼Œä»¥ä¸Šç»ç”± UTF-8 è½¬æ¢åˆ° Base64 çš„å®ç°åœ¨ç©ºé—´åˆ©ç”¨ä¸Šä¸ä¸€å®šé«˜æ•ˆã€‚å½“å¤„ç†åŒ…å«å¤§é‡ U+0800-U+FFFF åŒºåŸŸé—´å­—ç¬¦çš„æ–‡æœ¬æ—¶ï¼ŒUTF-8 è¾“å‡ºç»“æœé•¿äº UTF-16 çš„ï¼Œå› ä¸ºè¿™äº›å­—ç¬¦åœ¨ UTF-8 ä¸‹å ç”¨ä¸‰ä¸ªå­—èŠ‚è€Œ UTF-16 æ˜¯ä¸¤ä¸ªã€‚åœ¨å¤„ç†å‡åŒ€åˆ†å¸ƒ UTF-16 ç ç‚¹çš„ JavaScript å­—ç¬¦ä¸²æ—¶åº”è€ƒè™‘é‡‡ç”¨ UTF-16 æ›¿ä»£ UTF-8 ä½œä¸º Base64 ç»“æœçš„ä¸­é—´ç¼–ç æ ¼å¼ï¼Œè¿™å°†å‡å°‘ 40% å°ºå¯¸ã€‚</p>
<div class="notecard note" id="sect2">
  <p><strong>å¤‡æ³¨ï¼š</strong> ä¸‹ä¸ºé™ˆæ—§ç¿»è¯‘ç‰‡æ®µ</p>
</div>
<ul>
  <li>ç¬¬ä¸€ä¸ªæ˜¯è½¬ä¹‰ (escape) æ•´ä¸ªå­—ç¬¦ä¸²ç„¶åç¼–ç è¿™ä¸ªå®ƒï¼›</li>
  <li>ç¬¬äºŒä¸ªæ˜¯æŠŠ UTF-16 çš„ <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String"><code>DOMString</code></a> è½¬ç ä¸º UTF-8 çš„å­—ç¬¦æ•°ç»„ç„¶åç¼–ç å®ƒã€‚</li>
</ul></div><h3 id="æ–¹æ¡ˆ_1_â€“_ç¼–ç ä¹‹å‰è½¬ä¹‰_escape_å­—ç¬¦ä¸²"><a href="#æ–¹æ¡ˆ_1_â€“_ç¼–ç ä¹‹å‰è½¬ä¹‰_escape_å­—ç¬¦ä¸²" title="Permalink to æ–¹æ¡ˆ #1 â€“ ç¼–ç ä¹‹å‰è½¬ä¹‰ (escape) å­—ç¬¦ä¸²">æ–¹æ¡ˆ #1 â€“ ç¼–ç ä¹‹å‰è½¬ä¹‰ (escape) å­—ç¬¦ä¸²</a></h3><div><div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">b64EncodeUnicode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">%([0-9A-F]{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> p1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">b64EncodeUnicode</span><span class="token punctuation">(</span><span class="token string">'âœ“ Ã  la mode'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "4pyTIMOgIGxhIG1vZGU="</span>
</code></pre></div>
<p>æŠŠ base64 è½¬æ¢å›å­—ç¬¦ä¸²</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">b64DecodeUnicode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'00'</span> <span class="token operator">+</span> c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">b64DecodeUnicode</span><span class="token punctuation">(</span><span class="token string">'4pyTIMOgIGxhIG1vZGU='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "âœ“ Ã  la mode"</span>
<span class="token function">b64DecodeUnicode</span><span class="token punctuation">(</span><span class="token string">'Cg=='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "\n"</span>
</code></pre></div>
<p><a href="https://github.com/coolaj86/unibabel-js" class="external" rel=" noopener">Unibabel</a> æ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸€äº›ä½¿ç”¨è¿™ç§ç­–ç•¥çš„é€šç”¨è½¬æ¢çš„åº“ã€‚</p></div><h3 id="æ–¹æ¡ˆ_6_â€“_ç”¨_javascript_çš„_typedarray_å’Œ_utf-8_é‡å†™_dom_çš„_atob_å’Œ_btoa"><a href="#æ–¹æ¡ˆ_6_â€“_ç”¨_javascript_çš„_typedarray_å’Œ_utf-8_é‡å†™_dom_çš„_atob_å’Œ_btoa" title="Permalink to æ–¹æ¡ˆ #6 â€“ ç”¨ JavaScript çš„ TypedArray å’Œ UTF-8 é‡å†™ DOM çš„ atob() å’Œ btoa()">æ–¹æ¡ˆ #6 â€“ ç”¨ JavaScript çš„ <code>TypedArray</code> å’Œ UTF-8 é‡å†™ DOM çš„ <code>atob()</code> å’Œ <code>btoa()</code></a></h3><div><p>ä½¿ç”¨åƒ<a href="https://github.com/inexorabletash/text-encoding" class="external" rel=" noopener">TextEncoding</a>(åŒ…å«äº†æ—©æœŸ (legacy) çš„ windowsï¼Œmacï¼Œå’Œ ISO ç¼–ç )ï¼Œ<a href="https://github.com/coolaj86/TextEncoderLite/blob/master/index.js" class="external" rel=" noopener">TextEncoderLite</a> æˆ–è€… <a href="https://github.com/feross/buffer" class="external" rel=" noopener">Buffer</a> è¿™æ ·çš„æ–‡æœ¬ç¼–ç å™¨å¢å¼º (polyfill) å’Œ Base64 å¢å¼ºï¼Œæ¯”å¦‚<a href="https://github.com/beatgammit/base64-js/blob/master/index.js" class="external" rel=" noopener">base64-js</a> æˆ– <a href="https://github.com/waitingsong/base64" class="external" rel=" noopener">TypeScript ç‰ˆæœ¬çš„ base64-js</a>ï¼ˆé€‚ç”¨äºé•¿é’æµè§ˆå™¨å’Œ Node.jsï¼‰ã€‚</p>
<p>æœ€ç®€å•ï¼Œæœ€è½»é‡çº§çš„è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨ <a href="https://github.com/coolaj86/TextEncoderLite/blob/master/index.js" class="external" rel=" noopener">TextEncoderLite</a> å’Œ <a href="https://github.com/beatgammit/base64-js/blob/master/index.js" class="external" rel=" noopener">base64-js</a>.</p>
<p>æƒ³è¦æ›´å®Œæ•´çš„åº“çš„è¯ï¼Œå‚è§ <a href="/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView" class="page-not-created" title="This is a link to an unwritten page"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a>.</p></div><h2 id="å‚è§"><a href="#å‚è§" title="Permalink to å‚è§">å‚è§</a></h2><div><ul>
  <li><a href="/zh-CN/docs/Web/API/atob" title="atob()"><code>atob()</code></a></li>
  <li><a href="/zh-CN/docs/Web/API/btoa" title="btoa()"><code>btoa()</code></a></li>
  <li><a href="/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Data_URLs"><code>data</code> URIs</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Typed_arrays">TypedArrays</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">ArrayBufferView</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">Uint8Array</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView" class="page-not-created" title="This is a link to an unwritten page"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String">DOMString</a></li>
  <li><a href="/zh-CN/docs/Glossary/URI"><code>URI</code></a></li>
  <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURI"><code>encodeURI()</code></a></li>
  <li><a href="/zh-CN/docs/XPCOM_Interface_Reference/nsIURIFixup" class="page-not-created" title="This is a link to an unwritten page"><code>nsIURIFixup()</code></a></li>
  <li><a href="https://en.wikipedia.org/wiki/Base64" class="external" rel=" noopener"><code>Base64 on Wikipedia</code></a></li>
</ul></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/translated-content/edit/main/files/zh-cn/glossary/base64/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/blob/main/files/zh-cn/glossary/base64/index.md" title="Folder: zh-cn/glossary/base64 (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/translated-content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FGlossary%2FBase64%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60zh-cn%2Fglossary%2Fbase64%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FGlossary%2FBase64%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fblob%2Fmain%2Ffiles%2Fzh-cn%2Fglossary%2Fbase64%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Ftranslated-content%2Fcommit%2F921c46a374ab0a9f4cc809af0370f8c412e54701%0A*+Document+last+modified%3A+2022-10-01T03%3A41%3A16.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22Base64+%E7%9A%84%E7%BC%96%E7%A0%81%E4%B8%8E%E8%A7%A3%E7%A0%81%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2Cl10n-zh" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-10-01T03:41:16.000Z">Oct 1, 2022</time>,<!-- --> <a href="/zh-CN/docs/Glossary/Base64/contributors.txt">by MDN contributors</a></p><form class="language-menu"><fieldset id="select-language"><legend>Change your language</legend><label for="language-selector" class="visually-hidden">Select your preferred language</label> <select id="language-selector" name="language"><option selected="" value="zh-CN">ä¸­æ–‡ (ç®€ä½“)</option><option value="en-US">English (US)</option><option value="es">EspaÃ±ol</option><option value="fr">FranÃ§ais</option><option value="ja">æ—¥æœ¬èª</option><option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option></select> <button type="submit" class="button minimal">Change language</button></fieldset></form></div></aside></main></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/zh-CN/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/zh-CN/docs/Web">Web Technologies</a></li><li><a href="/zh-CN/docs/Learn">Learn Web Development</a></li><li><a href="/zh-CN/docs/MDN/About">About MDN</a></li><li><a href="/zh-CN/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">Â© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Base64 çš„ç¼–ç ä¸è§£ç ","mdn_url":"/zh-CN/docs/Glossary/Base64","locale":"zh-CN","native":"ä¸­æ–‡ (ç®€ä½“)","sidebarHTML":"","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p><strong>Base64</strong> æ˜¯ä¸€ç»„ç›¸ä¼¼çš„<a href=\"https://en.wikipedia.org/wiki/Binary-to-text_encoding\" class=\"external\" rel=\" noopener\">äºŒè¿›åˆ¶åˆ°æ–‡æœ¬</a>ï¼ˆbinary-to-textï¼‰çš„ç¼–ç è§„åˆ™ï¼Œä½¿å¾—äºŒè¿›åˆ¶æ•°æ®åœ¨è§£é‡Šæˆ radix-64 çš„è¡¨ç°å½¢å¼åèƒ½å¤Ÿç”¨ ASCII å­—ç¬¦ä¸²çš„æ ¼å¼è¡¨ç¤ºå‡ºæ¥ã€‚<em>Base64</em> è¿™ä¸ªè¯å‡ºè‡ªä¸€ç§ <a href=\"https://en.wikipedia.org/wiki/MIME#Content-Transfer-Encoding\" class=\"external\" rel=\" noopener\">MIME æ•°æ®ä¼ è¾“ç¼–ç </a>ã€‚</p>\n<p>Base64 ç¼–ç æ™®éåº”ç”¨äºéœ€è¦é€šè¿‡è¢«è®¾è®¡ä¸ºå¤„ç†æ–‡æœ¬æ•°æ®çš„åª’ä»‹ä¸Šå‚¨å­˜å’Œä¼ è¾“äºŒè¿›åˆ¶æ•°æ®è€Œéœ€è¦ç¼–ç è¯¥äºŒè¿›åˆ¶æ•°æ®çš„åœºæ™¯ã€‚è¿™æ ·æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´å¹¶ä¸”ä¸ç”¨åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¿®æ”¹è¿™äº›æ•°æ®ã€‚Base64 ä¹Ÿè¢«ä¸€äº›åº”ç”¨ï¼ˆåŒ…æ‹¬ä½¿ç”¨ <a href=\"https://en.wikipedia.org/wiki/MIME\" class=\"external\" rel=\" noopener\">MIME</a> çš„ç”µå­é‚®ä»¶ï¼‰å’Œåœ¨ <a href=\"/zh-CN/docs/Web/XML\">XML</a> ä¸­å‚¨å­˜å¤æ‚æ•°æ®æ—¶ä½¿ç”¨ã€‚</p>\n<p>åœ¨ JavaScript ä¸­ï¼Œæœ‰ä¸¤ä¸ªå‡½æ•°è¢«åˆ†åˆ«ç”¨æ¥å¤„ç†è§£ç å’Œç¼–ç  <em>base64</em> å­—ç¬¦ä¸²ï¼š</p>\n<ul>\n  <li><a href=\"/zh-CN/docs/Web/API/atob\" title=\"atob()\"><code>atob()</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/API/btoa\" title=\"btoa()\"><code>btoa()</code></a></li>\n</ul>\n<p><code>atob()</code> å‡½æ•°èƒ½å¤Ÿè§£ç é€šè¿‡ base-64 ç¼–ç çš„å­—ç¬¦ä¸²æ•°æ®ã€‚ç›¸ååœ°ï¼Œ<code>btoa()</code> å‡½æ•°èƒ½å¤Ÿä»äºŒè¿›åˆ¶æ•°æ®â€œå­—ç¬¦ä¸²â€åˆ›å»ºä¸€ä¸ª base-64 ç¼–ç çš„ ASCII å­—ç¬¦ä¸²ã€‚</p>\n<p><code>atob()</code> å’Œ <code>btoa()</code> å‡ä½¿ç”¨å­—ç¬¦ä¸²ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\"><code>ArrayBuffers</code></a>ï¼Œè¯·å‚é˜…åæ–‡ã€‚</p>\n<h4 id=\"ç¼–ç å°ºå¯¸å¢åŠ \">ç¼–ç å°ºå¯¸å¢åŠ </h4>\n<p>æ¯ä¸€ä¸ª Base64 å­—ç¬¦å®é™…ä¸Šä»£è¡¨ç€ 6 æ¯”ç‰¹ä½ã€‚å› æ­¤ï¼Œ3 å­—èŠ‚ï¼ˆä¸€å­—èŠ‚æ˜¯ 8 æ¯”ç‰¹ï¼Œ3 å­—èŠ‚ä¹Ÿå°±æ˜¯ 24 æ¯”ç‰¹ï¼‰çš„å­—ç¬¦ä¸²/äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥è½¬æ¢æˆ 4 ä¸ª Base64 å­—ç¬¦ (4x6 = 24 æ¯”ç‰¹)ã€‚</p>\n<p>è¿™æ„å‘³ç€ Base64 æ ¼å¼çš„å­—ç¬¦ä¸²æˆ–æ–‡ä»¶çš„å°ºå¯¸çº¦æ˜¯åŸå§‹å°ºå¯¸çš„ 133%ï¼ˆå¢åŠ äº†å¤§çº¦ 33%ï¼‰ã€‚å¦‚æœç¼–ç çš„æ•°æ®å¾ˆå°‘ï¼Œå¢åŠ çš„æ¯”ä¾‹å¯èƒ½ä¼šæ›´é«˜ã€‚ä¾‹å¦‚ï¼šå­—ç¬¦ä¸²<code>\"a\"</code>çš„<code>length === 1</code>è¿›è¡Œ Base64 ç¼–ç åæ˜¯<code>\"YQ==\"</code>çš„<code>length === 4</code>ï¼Œå°ºå¯¸å¢åŠ äº† 300%ã€‚</p>"}},{"type":"prose","value":{"id":"æ–‡æ¡£","title":"æ–‡æ¡£","isH3":false,"content":"<dl>\n  <dt id=\"data_uris\"><a href=\"/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Data_URLs\"><code>data</code> URIs</a></dt>\n  <dd>\n    <p><code>data</code> URIs, å®šä¹‰äº <a href=\"https://tools.ietf.org/html/rfc2397\" class=\"external\" rel=\" noopener\">RFC 2397</a>ï¼Œç”¨äºåœ¨æ–‡æ¡£å†…åµŒå…¥å°çš„æ–‡ä»¶ã€‚</p>\n  </dd>\n  <dt id=\"base64\"><a href=\"https://en.wikipedia.org/wiki/Base64\" class=\"external\" rel=\" noopener\">Base64</a></dt>\n  <dd>\n    <p>ç»´åŸºç™¾ç§‘ä¸Šå…³äº Base64 çš„æ–‡ç« ã€‚</p>\n  </dd>\n  <dt id=\"atob\"><a href=\"/zh-CN/docs/Web/API/atob\" title=\"atob()\"><code>atob()</code></a></dt>\n  <dd>\n    <p>è§£ç ä¸€ä¸ª Base64 å­—ç¬¦ä¸²ã€‚</p>\n  </dd>\n  <dt id=\"btoa\"><a href=\"/zh-CN/docs/Web/API/btoa\" title=\"btoa()\"><code>btoa()</code></a></dt>\n  <dd>\n    <p>ä»ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸€ä¸ª Base64 å­—ç¬¦ä¸²ã€‚</p>\n  </dd>\n  <dt id=\"unicode_é—®é¢˜\"><a href=\"#the_.22unicode_problem.22\">\"Unicode é—®é¢˜\"</a></dt>\n  <dd>\n    <p>åœ¨å¤§å¤šæ•°æµè§ˆå™¨é‡Œé‡Œï¼Œåœ¨ä¸€ä¸ª Unicode å­—ç¬¦ä¸²ä¸Šè°ƒç”¨ btoa() ä¼šé€ æˆä¸€ä¸ª<code>Character Out Of Range</code> å¼‚å¸¸ã€‚è¿™ä¸€æ®µå†™äº†ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚</p>\n  </dd>\n  <dt id=\"urischeme\"><a href=\"/zh-CN/docs/URIScheme\" class=\"page-not-created\" title=\"This is a link to an unwritten page\">URIScheme</a></dt>\n  <dd>\n    <p>Mozilla æ”¯æŒçš„ URI schemes åˆ—è¡¨ã€‚</p>\n  </dd>\n  <dt id=\"stringview\"><a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>StringView</code></a></dt>\n  <dd>\n    <p>è¿™ç¯‡æ–‡ç« å‘å¸ƒäº†ä¸€ä¸ªæˆ‘ä»¬åšçš„åº“ï¼Œç›®çš„åœ¨äºï¼š</p>\n    <ul>\n      <li>ä¸ºå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªç±» C æ¥å£ (i.e. array of characters codes â€” <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\"><code>ArrayBufferView</code></a> in JavaScript) ï¼ŒåŸºäº JavaScript <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\"><code>ArrayBuffer</code></a> æ¥å£ã€‚</li>\n      <li>ä¸ºç±»å­—ç¬¦ä¸²å¯¹è±¡ (ç›®å‰ä¸ºæ­¢ä¸ºï¼š<code>stringView</code>s) åˆ›å»ºä¸€ç³»åˆ—æ–¹æ³•ï¼Œå®ƒä»¬<strong>ä¸¥æ ¼æŒ‰ç…§æ•°å­—æ•°ç»„</strong>å·¥ä½œï¼Œè€Œä¸æ˜¯ä¸å¯å˜çš„å­—ç¬¦ä¸²ã€‚</li>\n      <li>å¯ç”¨äºå…¶å®ƒ Unicode ç¼–ç ï¼Œå’Œé»˜è®¤çš„ <code>DOMStrings</code> ä¸åŒã€‚</li>\n    </ul>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"å·¥å…·","title":"å·¥å…·","isH3":false,"content":"<ul>\n  <li><a href=\"#solution_.232_.e2.80.93_rewriting_atob_and_btoa_using_typedarrays_and_utf-8\">Rewriting <code>atob()</code> and <code>btoa()</code> using <code>TypedArray</code>s and UTF-8</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a></li>\n</ul>"}},{"type":"prose","value":{"id":"ç›¸å…³æ–‡ç« ","title":"ç›¸å…³æ–‡ç« ","isH3":false,"content":"<ul>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\"><code>ArrayBuffer</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays\">Typed arrays</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\">ArrayBufferView</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array\"><code>Uint8Array</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String\"><code>DOMString</code></a></li>\n  <li><a href=\"/zh-CN/docs/Glossary/URI\"><code>URI</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\"><code>encodeURI()</code></a></li>\n</ul>"}},{"type":"prose","value":{"id":"unicode_é—®é¢˜_2","title":"Unicode é—®é¢˜","isH3":false,"content":"<p>ç”±äº <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String\"><code>DOMString</code></a> æ˜¯ 16 ä½ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¦‚æœæœ‰å­—ç¬¦è¶…å‡ºäº† 8 ä½ ASCII ç¼–ç çš„å­—ç¬¦èŒƒå›´æ—¶ï¼Œåœ¨å¤§å¤šæ•°çš„æµè§ˆå™¨ä¸­å¯¹ Unicode å­—ç¬¦ä¸²è°ƒç”¨ <code>window.btoa</code> å°†ä¼šé€ æˆä¸€ä¸ª <code>Character Out Of Range</code> çš„å¼‚å¸¸ã€‚æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>\n<ul>\n  <li><a href=\"#solution_1_â€“_javascript's_utf-16_>_base64\">the first method</a> consists in encoding JavaScript's native UTF-16 strings directly into base64 (fast, portable, clean)</li>\n  <li><a href=\"#solution_2_â€“_javascript's_utf-16_>_utf-8_>_base64\">the second method</a> consists in converting JavaScript's native UTF-16 strings to UTF-8 and then encode the latter into base64 (relatively fast, portable, clean)</li>\n  <li><a href=\"#solution_3_â€“_javascript's_utf-16_>_binary_string_>_base64\">the third method</a> consists in encoding JavaScript's native UTF-16 strings directly into base64 via binary strings (very fast, relatively portable, very compact)</li>\n  <li><a href=\"#solution_4_â€“_escaping_the_string_before_encoding_it\">the fourth method</a> consists in escaping the whole string (with UTF-8, see <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\"><code>encodeURIComponent</code></a>) and then encode it (portable, non-standard)</li>\n  <li><a href=\"#solution_5_â€“_rewrite_the_doms_atob_and_btoa_using_javascripts_typedarrays_and_utf-8\">the fifth method</a> is similar to the second method, but uses third party libraries</li>\n</ul>"}},{"type":"prose","value":{"id":"solution_1_â€“_javascripts_utf-16__base64","title":"Solution #1 â€“ JavaScript's UTF-16 =&gt; base64","isH3":true,"content":"<p>A very fast and widely useable way to solve the unicode problem is by encoding JavaScript native UTF-16 strings directly into base64. Please visit the URL <code>data:text/plain;charset=utf-16;base64,OCY5JjomOyY8Jj4mPyY=</code> for a demonstration (copy the data uri, open a new tab, paste the data URI into the address bar, then press enter to go to the page). This method is particularly efficient because it does not require any type of conversion, except mapping a string into an array. The following code is also useful to get an <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\">ArrayBuffer</a> from a <em>Base64</em> string and/or viceversa (<a href=\"#appendix_to_solution_1_decode_a_base64_string_to_uint8array_or_arraybuffer\">see below</a>).</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\\\n|*|\n|*|  Base64 / binary data / UTF-8 strings utilities (#1)\n|*|\n|*|  https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\n|*|\n|*|  Author: madmurphy\n|*|\n\\*/</span>\n\n<span class=\"token comment\">/* Array of bytes to base64 string decoding */</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">b64ToUint6</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">nChr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">return</span> nChr <span class=\"token operator\">&gt;</span> <span class=\"token number\">64</span> <span class=\"token operator\">&amp;&amp;</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">91</span> <span class=\"token operator\">?</span>\n      nChr <span class=\"token operator\">-</span> <span class=\"token number\">65</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&gt;</span> <span class=\"token number\">96</span> <span class=\"token operator\">&amp;&amp;</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">123</span> <span class=\"token operator\">?</span>\n      nChr <span class=\"token operator\">-</span> <span class=\"token number\">71</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&gt;</span> <span class=\"token number\">47</span> <span class=\"token operator\">&amp;&amp;</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">58</span> <span class=\"token operator\">?</span>\n      nChr <span class=\"token operator\">+</span> <span class=\"token number\">4</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">===</span> <span class=\"token number\">43</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">62</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">===</span> <span class=\"token number\">47</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">63</span>\n    <span class=\"token operator\">:</span>\n      <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">base64DecToArr</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sBase64<span class=\"token punctuation\">,</span> nBlockSize</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span>\n    sB64Enc <span class=\"token operator\">=</span> sBase64<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[^A-Za-z0-9\\+\\/]</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> nInLen <span class=\"token operator\">=</span> sB64Enc<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span>\n    nOutLen <span class=\"token operator\">=</span> nBlockSize <span class=\"token operator\">?</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>nInLen <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> nBlockSize<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> nBlockSize <span class=\"token operator\">:</span> nInLen <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> aBytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>nOutLen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> nMod3<span class=\"token punctuation\">,</span> nMod4<span class=\"token punctuation\">,</span> nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nOutIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nInIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nInIdx <span class=\"token operator\">&lt;</span> nInLen<span class=\"token punctuation\">;</span> nInIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nMod4 <span class=\"token operator\">=</span> nInIdx <span class=\"token operator\">&amp;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    nUint24 <span class=\"token operator\">|=</span> <span class=\"token function\">b64ToUint6</span><span class=\"token punctuation\">(</span>sB64Enc<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>nInIdx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">18</span> <span class=\"token operator\">-</span> <span class=\"token number\">6</span> <span class=\"token operator\">*</span> nMod4<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nMod4 <span class=\"token operator\">===</span> <span class=\"token number\">3</span> <span class=\"token operator\">||</span> nInLen <span class=\"token operator\">-</span> nInIdx <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>nMod3 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nMod3 <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span> <span class=\"token operator\">&amp;&amp;</span> nOutIdx <span class=\"token operator\">&lt;</span> nOutLen<span class=\"token punctuation\">;</span> nMod3<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> nOutIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        aBytes<span class=\"token punctuation\">[</span>nOutIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">&gt;&gt;&gt;</span> nMod3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> aBytes<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Base64 string to array encoding */</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">uint6ToB64</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">nUint6</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">return</span> nUint6 <span class=\"token operator\">&lt;</span> <span class=\"token number\">26</span> <span class=\"token operator\">?</span>\n      nUint6 <span class=\"token operator\">+</span> <span class=\"token number\">65</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">&lt;</span> <span class=\"token number\">52</span> <span class=\"token operator\">?</span>\n      nUint6 <span class=\"token operator\">+</span> <span class=\"token number\">71</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">&lt;</span> <span class=\"token number\">62</span> <span class=\"token operator\">?</span>\n      nUint6 <span class=\"token operator\">-</span> <span class=\"token number\">4</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">===</span> <span class=\"token number\">62</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">43</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">===</span> <span class=\"token number\">63</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">47</span>\n    <span class=\"token operator\">:</span>\n      <span class=\"token number\">65</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">base64EncArr</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">aBytes</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> eqLen <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">%</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> sB64Enc <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> nMod3<span class=\"token punctuation\">,</span> nLen <span class=\"token operator\">=</span> aBytes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nIdx <span class=\"token operator\">&lt;</span> nLen<span class=\"token punctuation\">;</span> nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nMod3 <span class=\"token operator\">=</span> nIdx <span class=\"token operator\">%</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/* Uncomment the following line in order to split the output in lines 76-character long: */</span>\n    <span class=\"token comment\">/*\n    if (nIdx &gt; 0 &amp;&amp; (nIdx * 4 / 3) % 76 === 0) { sB64Enc += \"\\r\\n\"; }\n    */</span>\n    nUint24 <span class=\"token operator\">|=</span> aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">&gt;&gt;&gt;</span> nMod3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nMod3 <span class=\"token operator\">===</span> <span class=\"token number\">2</span> <span class=\"token operator\">||</span> aBytes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> nIdx <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      sB64Enc <span class=\"token operator\">+=</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">18</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">12</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">6</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span>  eqLen <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span>\n      <span class=\"token literal-property property\">sB64Enc</span>\n    <span class=\"token operator\">:</span>\n      sB64Enc<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> sB64Enc<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> eqLen<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>eqLen <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"=\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"tests\">Tests</h4>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> myString <span class=\"token operator\">=</span> <span class=\"token string\">\"â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Part 1: Encode `myString` to base64 using native UTF-16 */</span>\n\n<span class=\"token keyword\">var</span> aUTF16CodeUnits <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint16Array</span><span class=\"token punctuation\">(</span>myString<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>aUTF16CodeUnits<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">el<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">,</span> arr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> arr<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> myString<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> sUTF16Base64 <span class=\"token operator\">=</span> <span class=\"token function\">base64EncArr</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>aUTF16CodeUnits<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Show output */</span>\n\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>sUTF16Base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"OCY5JjomOyY8Jj4mPyY=\"</span>\n\n<span class=\"token comment\">/* Part 2: Decode `sUTF16Base64` to UTF-16 */</span>\n\n<span class=\"token keyword\">var</span> sDecodedString <span class=\"token operator\">=</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint16Array</span><span class=\"token punctuation\">(</span><span class=\"token function\">base64DecToArr</span><span class=\"token punctuation\">(</span>sUTF16Base64<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Show output */</span>\n\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>sDecodedString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿\"</span>\n</code></pre></div>\n<p>The produced string is fully portable, although represented as UTF-16. If you prefer UTF-8, see <a href=\"#solution_2_â€“_javascript's_utf-16_>_utf-8_>_base64\">the next solution</a>.</p>\n<h4 id=\"appendix_to_solution_1_decode_a_base64_string_to_uint8array_or_arraybuffer\">Appendix to <a href=\"#solution_1_â€“_javascript's_utf-16_>_base64\">Solution #1</a>: Decode a <em>Base64</em> string to <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array\">Uint8Array</a> or <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\">ArrayBuffer</a></h4>\n<p>The functions above let us also create <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array\">uint8Arrays</a> or <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\">arrayBuffers</a> from <em>base64</em>-encoded strings:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> myArray <span class=\"token operator\">=</span> <span class=\"token function\">base64DecToArr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"QmFzZSA2NCDigJQgTW96aWxsYSBEZXZlbG9wZXIgTmV0d29yaw==\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Base 64 \\u2014 Mozilla Developer Network\" (as UTF-8)</span>\n\n<span class=\"token keyword\">var</span> myBuffer <span class=\"token operator\">=</span> <span class=\"token function\">base64DecToArr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"QmFzZSA2NCDigJQgTW96aWxsYSBEZXZlbG9wZXIgTmV0d29yaw==\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Base 64 \\u2014 Mozilla Developer Network\" (as UTF-8)</span>\n\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>myBuffer<span class=\"token punctuation\">.</span>byteLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>å¤‡æ³¨ï¼š</strong> The function <code>base64DecToArr(sBase64[, nBlockSize])</code> returns an <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array\"><code>uint8Array</code></a> of bytes. If your aim is to build a buffer of 16-bit / 32-bit / 64-bit raw data, use the <code>nBlockSize</code> argument, which is the number of bytes which the <code>uint8Array.buffer.bytesLength</code> property must result to be a multiple of (<code>1</code> or omitted for ASCII, binary content, <a href=\"/zh-CN/docs/Web/API/btoa\">binary strings</a>, UTF-8-encoded strings; <code>2</code> for UTF-16 strings; <code>4</code> for UTF-32 strings).</p>\n</div>\n<p>For a more complete library, see <a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a> (source code <a href=\"https://github.com/madmurphy/stringview.js\" class=\"external\" rel=\" noopener\">available on GitHub</a>).</p>","titleAsText":"Solution #1 â€“ JavaScript's UTF-16 => base64"}},{"type":"prose","value":{"id":"solution_2_â€“_javascripts_utf-16__utf-8__base64","title":"Solution #2 â€“ JavaScript's UTF-16 =&gt; UTF-8 =&gt; base64","isH3":true,"content":"<p>This solution consists in converting a JavaScript's native UTF-16 string into a UTF-8 string and then encoding the latter into base64. This also grants that converting a pure ASCII string to base64 always produces the same output as the native <a href=\"/zh-CN/docs/Web/API/btoa\"><code>btoa()</code></a>.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\\\n|*|\n|*|  Base64 / binary data / UTF-8 strings utilities (#2)\n|*|\n|*|  https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\n|*|\n|*|  Author: madmurphy\n|*|\n\\*/</span>\n\n<span class=\"token comment\">/* Array of bytes to base64 string decoding */</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">b64ToUint6</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">nChr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">return</span> nChr <span class=\"token operator\">&gt;</span> <span class=\"token number\">64</span> <span class=\"token operator\">&amp;&amp;</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">91</span> <span class=\"token operator\">?</span>\n      nChr <span class=\"token operator\">-</span> <span class=\"token number\">65</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&gt;</span> <span class=\"token number\">96</span> <span class=\"token operator\">&amp;&amp;</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">123</span> <span class=\"token operator\">?</span>\n      nChr <span class=\"token operator\">-</span> <span class=\"token number\">71</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&gt;</span> <span class=\"token number\">47</span> <span class=\"token operator\">&amp;&amp;</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">58</span> <span class=\"token operator\">?</span>\n      nChr <span class=\"token operator\">+</span> <span class=\"token number\">4</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">===</span> <span class=\"token number\">43</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">62</span>\n    <span class=\"token operator\">:</span> nChr <span class=\"token operator\">===</span> <span class=\"token number\">47</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">63</span>\n    <span class=\"token operator\">:</span>\n      <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">base64DecToArr</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sBase64<span class=\"token punctuation\">,</span> nBlockSize</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span>\n    sB64Enc <span class=\"token operator\">=</span> sBase64<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[^A-Za-z0-9\\+\\/]</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> nInLen <span class=\"token operator\">=</span> sB64Enc<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span>\n    nOutLen <span class=\"token operator\">=</span> nBlockSize <span class=\"token operator\">?</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>nInLen <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> nBlockSize<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> nBlockSize <span class=\"token operator\">:</span> nInLen <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> aBytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>nOutLen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> nMod3<span class=\"token punctuation\">,</span> nMod4<span class=\"token punctuation\">,</span> nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nOutIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nInIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nInIdx <span class=\"token operator\">&lt;</span> nInLen<span class=\"token punctuation\">;</span> nInIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nMod4 <span class=\"token operator\">=</span> nInIdx <span class=\"token operator\">&amp;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    nUint24 <span class=\"token operator\">|=</span> <span class=\"token function\">b64ToUint6</span><span class=\"token punctuation\">(</span>sB64Enc<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>nInIdx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">18</span> <span class=\"token operator\">-</span> <span class=\"token number\">6</span> <span class=\"token operator\">*</span> nMod4<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nMod4 <span class=\"token operator\">===</span> <span class=\"token number\">3</span> <span class=\"token operator\">||</span> nInLen <span class=\"token operator\">-</span> nInIdx <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>nMod3 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nMod3 <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span> <span class=\"token operator\">&amp;&amp;</span> nOutIdx <span class=\"token operator\">&lt;</span> nOutLen<span class=\"token punctuation\">;</span> nMod3<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> nOutIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        aBytes<span class=\"token punctuation\">[</span>nOutIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">&gt;&gt;&gt;</span> nMod3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> aBytes<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Base64 string to array encoding */</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">uint6ToB64</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">nUint6</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">return</span> nUint6 <span class=\"token operator\">&lt;</span> <span class=\"token number\">26</span> <span class=\"token operator\">?</span>\n      nUint6 <span class=\"token operator\">+</span> <span class=\"token number\">65</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">&lt;</span> <span class=\"token number\">52</span> <span class=\"token operator\">?</span>\n      nUint6 <span class=\"token operator\">+</span> <span class=\"token number\">71</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">&lt;</span> <span class=\"token number\">62</span> <span class=\"token operator\">?</span>\n      nUint6 <span class=\"token operator\">-</span> <span class=\"token number\">4</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">===</span> <span class=\"token number\">62</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">43</span>\n    <span class=\"token operator\">:</span> nUint6 <span class=\"token operator\">===</span> <span class=\"token number\">63</span> <span class=\"token operator\">?</span>\n      <span class=\"token number\">47</span>\n    <span class=\"token operator\">:</span>\n      <span class=\"token number\">65</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">base64EncArr</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">aBytes</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> eqLen <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">%</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> sB64Enc <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> nMod3<span class=\"token punctuation\">,</span> nLen <span class=\"token operator\">=</span> aBytes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nIdx <span class=\"token operator\">&lt;</span> nLen<span class=\"token punctuation\">;</span> nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nMod3 <span class=\"token operator\">=</span> nIdx <span class=\"token operator\">%</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/* Uncomment the following line in order to split the output in lines 76-character long: */</span>\n    <span class=\"token comment\">/*\n    if (nIdx &gt; 0 &amp;&amp; (nIdx * 4 / 3) % 76 === 0) { sB64Enc += \"\\r\\n\"; }\n    */</span>\n    nUint24 <span class=\"token operator\">|=</span> aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">&gt;&gt;&gt;</span> nMod3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nMod3 <span class=\"token operator\">===</span> <span class=\"token number\">2</span> <span class=\"token operator\">||</span> aBytes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> nIdx <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      sB64Enc <span class=\"token operator\">+=</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">18</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">12</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">6</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">uint6ToB64</span><span class=\"token punctuation\">(</span>nUint24 <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      nUint24 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span>  eqLen <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span>\n      <span class=\"token literal-property property\">sB64Enc</span>\n    <span class=\"token operator\">:</span>\n      sB64Enc<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> sB64Enc<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> eqLen<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>eqLen <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"=\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* UTF-8 array to DOMString and vice versa */</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">UTF8ArrToStr</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">aBytes</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> sView <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> nPart<span class=\"token punctuation\">,</span> nLen <span class=\"token operator\">=</span> aBytes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> nIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nIdx <span class=\"token operator\">&lt;</span> nLen<span class=\"token punctuation\">;</span> nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nPart <span class=\"token operator\">=</span> aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    sView <span class=\"token operator\">+=</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span>\n      nPart <span class=\"token operator\">&gt;</span> <span class=\"token number\">251</span> <span class=\"token operator\">&amp;&amp;</span> nPart <span class=\"token operator\">&lt;</span> <span class=\"token number\">254</span> <span class=\"token operator\">&amp;&amp;</span> nIdx <span class=\"token operator\">+</span> <span class=\"token number\">5</span> <span class=\"token operator\">&lt;</span> nLen <span class=\"token operator\">?</span> <span class=\"token comment\">/* six bytes */</span>\n        <span class=\"token comment\">/* (nPart - 252 &lt;&lt; 30) may be not so safe in ECMAScript! So...: */</span>\n        <span class=\"token punctuation\">(</span>nPart <span class=\"token operator\">-</span> <span class=\"token number\">252</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1073741824</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span>\n      <span class=\"token operator\">:</span> nPart <span class=\"token operator\">&gt;</span> <span class=\"token number\">247</span> <span class=\"token operator\">&amp;&amp;</span> nPart <span class=\"token operator\">&lt;</span> <span class=\"token number\">252</span> <span class=\"token operator\">&amp;&amp;</span> nIdx <span class=\"token operator\">+</span> <span class=\"token number\">4</span> <span class=\"token operator\">&lt;</span> nLen <span class=\"token operator\">?</span> <span class=\"token comment\">/* five bytes */</span>\n        <span class=\"token punctuation\">(</span>nPart <span class=\"token operator\">-</span> <span class=\"token number\">248</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span>\n      <span class=\"token operator\">:</span> nPart <span class=\"token operator\">&gt;</span> <span class=\"token number\">239</span> <span class=\"token operator\">&amp;&amp;</span> nPart <span class=\"token operator\">&lt;</span> <span class=\"token number\">248</span> <span class=\"token operator\">&amp;&amp;</span> nIdx <span class=\"token operator\">+</span> <span class=\"token number\">3</span> <span class=\"token operator\">&lt;</span> nLen <span class=\"token operator\">?</span> <span class=\"token comment\">/* four bytes */</span>\n        <span class=\"token punctuation\">(</span>nPart <span class=\"token operator\">-</span> <span class=\"token number\">240</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span>\n      <span class=\"token operator\">:</span> nPart <span class=\"token operator\">&gt;</span> <span class=\"token number\">223</span> <span class=\"token operator\">&amp;&amp;</span> nPart <span class=\"token operator\">&lt;</span> <span class=\"token number\">240</span> <span class=\"token operator\">&amp;&amp;</span> nIdx <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">&lt;</span> nLen <span class=\"token operator\">?</span> <span class=\"token comment\">/* three bytes */</span>\n        <span class=\"token punctuation\">(</span>nPart <span class=\"token operator\">-</span> <span class=\"token number\">224</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span>\n      <span class=\"token operator\">:</span> nPart <span class=\"token operator\">&gt;</span> <span class=\"token number\">191</span> <span class=\"token operator\">&amp;&amp;</span> nPart <span class=\"token operator\">&lt;</span> <span class=\"token number\">224</span> <span class=\"token operator\">&amp;&amp;</span> nIdx <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;</span> nLen <span class=\"token operator\">?</span> <span class=\"token comment\">/* two bytes */</span>\n        <span class=\"token punctuation\">(</span>nPart <span class=\"token operator\">-</span> <span class=\"token number\">192</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> aBytes<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>nIdx<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">128</span>\n      <span class=\"token operator\">:</span> <span class=\"token comment\">/* nPart &lt; 127 ? */</span> <span class=\"token comment\">/* one byte */</span>\n        nPart\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> sView<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">strToUTF8Arr</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sDOMStr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> aBytes<span class=\"token punctuation\">,</span> nChr<span class=\"token punctuation\">,</span> nStrLen <span class=\"token operator\">=</span> sDOMStr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> nArrLen <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* mapping... */</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> nMapIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nMapIdx <span class=\"token operator\">&lt;</span> nStrLen<span class=\"token punctuation\">;</span> nMapIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nChr <span class=\"token operator\">=</span> sDOMStr<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>nMapIdx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    nArrLen <span class=\"token operator\">+=</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x80</span> <span class=\"token operator\">?</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x800</span> <span class=\"token operator\">?</span> <span class=\"token number\">2</span> <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x10000</span> <span class=\"token operator\">?</span> <span class=\"token number\">3</span> <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x200000</span> <span class=\"token operator\">?</span> <span class=\"token number\">4</span> <span class=\"token operator\">:</span> nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x4000000</span> <span class=\"token operator\">?</span> <span class=\"token number\">5</span> <span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  aBytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>nArrLen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* transcription... */</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> nIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nChrIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> nIdx <span class=\"token operator\">&lt;</span> nArrLen<span class=\"token punctuation\">;</span> nChrIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nChr <span class=\"token operator\">=</span> sDOMStr<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>nChrIdx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/* one byte */</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> nChr<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x800</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/* two bytes */</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">192</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x10000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/* three bytes */</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">224</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">6</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x200000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/* four bytes */</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">240</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">12</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">6</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0x4000000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/* five bytes */</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">248</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">18</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">12</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">6</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token comment\">/* if (nChr &lt;= 0x7fffffff) */</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/* six bytes */</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">252</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">24</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">18</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">12</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&gt;&gt;&gt;</span> <span class=\"token number\">6</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      aBytes<span class=\"token punctuation\">[</span>nIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>nChr <span class=\"token operator\">&amp;</span> <span class=\"token number\">63</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> aBytes<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"tests_2\">Tests</h4>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/* Tests */</span>\n\n<span class=\"token keyword\">var</span> sMyInput <span class=\"token operator\">=</span> <span class=\"token string\">\"Base 64 \\u2014 Mozilla Developer Network\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> aMyUTF8Input <span class=\"token operator\">=</span> <span class=\"token function\">strToUTF8Arr</span><span class=\"token punctuation\">(</span>sMyInput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> sMyBase64 <span class=\"token operator\">=</span> <span class=\"token function\">base64EncArr</span><span class=\"token punctuation\">(</span>aMyUTF8Input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>sMyBase64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"QmFzZSA2NCDigJQgTW96aWxsYSBEZXZlbG9wZXIgTmV0d29yaw==\"</span>\n\n<span class=\"token keyword\">var</span> aMyUTF8Output <span class=\"token operator\">=</span> <span class=\"token function\">base64DecToArr</span><span class=\"token punctuation\">(</span>sMyBase64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> sMyOutput <span class=\"token operator\">=</span> <span class=\"token function\">UTF8ArrToStr</span><span class=\"token punctuation\">(</span>aMyUTF8Output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>sMyOutput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Base 64 â€” Mozilla Developer Network\"</span>\n</code></pre></div>","titleAsText":"Solution #2 â€“ JavaScript's UTF-16 => UTF-8 => base64"}},{"type":"prose","value":{"id":"solution_3_â€“_javascripts_utf-16__binary_string__base64","title":"Solution #3 â€“ JavaScript's UTF-16 =&gt; binary string =&gt; base64","isH3":true,"content":"<p>The following is the fastest and most compact possible approach. The output is exactly the same produced by <a href=\"#solution_1_â€“_javascript's_utf-16_>_base64\">Solution #1</a> (UTF-16 encoded strings), but instead of rewriting <a href=\"/zh-CN/docs/Web/API/atob\" title=\"atob()\"><code>atob()</code></a> and <a href=\"/zh-CN/docs/Web/API/btoa\" title=\"btoa()\"><code>btoa()</code></a> it uses the native ones. This is made possible by the fact that instead of using typed arrays as encoding/decoding inputs this solution uses <a href=\"/zh-CN/docs/Web/API/btoa\">binary strings</a> as an intermediate format. It is a â€œdirtyâ€ workaround in comparison to <a href=\"#solution_1_â€“_javascript's_utf-16_>_base64\">Solution #1</a> (<a href=\"/zh-CN/docs/Web/API/btoa\">binary strings</a> are a grey area), however it works pretty well and requires only a few lines of code.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\\\n|*|\n|*|  Base64 / binary data / UTF-8 strings utilities (#3)\n|*|\n|*|  https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\n|*|\n|*|  Author: madmurphy\n|*|\n\\*/</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">btoaUTF16</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sString</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> aUTF16CodeUnits <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint16Array</span><span class=\"token punctuation\">(</span>sString<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>aUTF16CodeUnits<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">el<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">,</span> arr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> arr<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sString<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">btoa</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>aUTF16CodeUnits<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">atobUTF16</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sBase64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n <span class=\"token keyword\">var</span> sBinaryString <span class=\"token operator\">=</span> <span class=\"token function\">atob</span><span class=\"token punctuation\">(</span>sBase64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> aBinaryView <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>sBinaryString<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>aBinaryView<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">el<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">,</span> arr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> arr<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sBinaryString<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">return</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint16Array</span><span class=\"token punctuation\">(</span>aBinaryView<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"tests_3\">Tests</h4>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> myString <span class=\"token operator\">=</span> <span class=\"token string\">\"â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Part 1: Encode `myString` to base64 using native UTF-16 */</span>\n\n<span class=\"token keyword\">var</span> sUTF16Base64 <span class=\"token operator\">=</span> <span class=\"token function\">btoaUTF16</span><span class=\"token punctuation\">(</span>myString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Show output */</span>\n\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>sUTF16Base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"OCY5JjomOyY8Jj4mPyY=\"</span>\n\n<span class=\"token comment\">/* Part 2: Decode `sUTF16Base64` to UTF-16 */</span>\n\n<span class=\"token keyword\">var</span> sDecodedString <span class=\"token operator\">=</span> <span class=\"token function\">atobUTF16</span><span class=\"token punctuation\">(</span>sUTF16Base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Show output */</span>\n\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>sDecodedString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"â˜¸â˜¹â˜ºâ˜»â˜¼â˜¾â˜¿\"</span>\n</code></pre></div>\n<p>For a cleaner solution that uses typed arrays instead of binary strings, see solutions <a href=\"#solution_1_â€“_javascript's_utf-16_>_base64\">#1</a> and <a href=\"#solution_2_â€“_javascript's_utf-16_>_utf-8_>_base64\">#2</a>.</p>","titleAsText":"Solution #3 â€“ JavaScript's UTF-16 => binary string => base64"}},{"type":"prose","value":{"id":"solution_4_â€“_escaping_the_string_before_encoding_it","title":"Solution #4 â€“ escaping the string before encoding it","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">b64EncodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// first we use encodeURIComponent to get percent-encoded UTF-8,</span>\n    <span class=\"token comment\">// then we convert the percent encodings into raw bytes which</span>\n    <span class=\"token comment\">// can be fed into btoa.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">btoa</span><span class=\"token punctuation\">(</span><span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">%([0-9A-F]{2})</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">function</span> <span class=\"token function\">toSolidBytes</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">match<span class=\"token punctuation\">,</span> p1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'0x'</span> <span class=\"token operator\">+</span> p1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">b64EncodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'âœ“ Ã  la mode'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"4pyTIMOgIGxhIG1vZGU=\"</span>\n<span class=\"token function\">b64EncodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Cg==\"</span>\n</code></pre></div>\n<p>To decode the Base64-encoded value back into a String:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">b64DecodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Going backwards: from bytestream, to percent-encoding, to original string.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">decodeURIComponent</span><span class=\"token punctuation\">(</span><span class=\"token function\">atob</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'%'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'00'</span> <span class=\"token operator\">+</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">b64DecodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'4pyTIMOgIGxhIG1vZGU='</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"âœ“ Ã  la mode\"</span>\n<span class=\"token function\">b64DecodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Cg=='</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"\\n\"</span>\n</code></pre></div>\n<p><a href=\"https://git.daplie.com/Daplie/unibabel-js\" class=\"external\" rel=\" noopener\">Unibabel</a> implements common conversions using this strategy.</p>"}},{"type":"prose","value":{"id":"solution_5_â€“_rewrite_the_doms_atob_and_btoa_using_javascripts_typedarrays_and_utf-8","title":"Solution #5 â€“ rewrite the DOMs <code>atob()</code> and <code>btoa()</code> using JavaScript's <code>TypedArray</code>s and UTF-8","isH3":true,"content":"<p>Use a <a href=\"/zh-CN/docs/Web/API/TextEncoder\">TextEncoder</a> polyfill such as <a href=\"https://github.com/inexorabletash/text-encoding\" class=\"external\" rel=\" noopener\">TextEncoding</a> (also includes legacy windows, mac, and ISO encodings), <a href=\"https://github.com/coolaj86/TextEncoderLite\" class=\"external\" rel=\" noopener\">TextEncoderLite</a>, combined with a <a href=\"https://github.com/feross/buffer\" class=\"external\" rel=\" noopener\">Buffer</a> and a Base64 implementation such as <a href=\"https://github.com/beatgammit/base64-js\" class=\"external\" rel=\" noopener\">base64-js</a> or <a href=\"https://github.com/waitingsong/base64\" class=\"external\" rel=\" noopener\">TypeScript version of base64-js</a> for both modern browsers and Node.js.</p>\n<p>When a native <code>TextEncoder</code> implementation is not available, the most light-weight solution would be to use <a href=\"#solution_3_â€“_javascript's_utf-16_>_binary_string_>_base64\">Solution #3</a> because in addition to being much faster, <a href=\"#solution_3_â€“_javascript's_utf-16_>_binary_string_>_base64\">Solution #3</a> also works in IE9 \"out of the box.\" Alternatively, use <a href=\"https://github.com/coolaj86/TextEncoderLite\" class=\"external\" rel=\" noopener\">TextEncoderLite</a> with <a href=\"https://github.com/beatgammit/base64-js\" class=\"external\" rel=\" noopener\">base64-js</a>. Use the browser implementation when you can.</p>\n<p>The following function implements such a strategy. It assumes base64-js imported as <code>&lt;script type=\"text/javascript\" src=\"base64js.min.js\"/&gt;</code>. Note that TextEncoderLite only works with UTF-8.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">Base64Encode</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> encoding <span class=\"token operator\">=</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> TextEncoder <span class=\"token operator\">===</span> <span class=\"token string\">\"undefined\"</span> <span class=\"token operator\">?</span> TextEncoderLite <span class=\"token operator\">:</span> TextEncoder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>encoding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> base64js<span class=\"token punctuation\">.</span><span class=\"token function\">fromByteArray</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Base64Decode</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> encoding <span class=\"token operator\">=</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> bytes <span class=\"token operator\">=</span> base64js<span class=\"token punctuation\">.</span><span class=\"token function\">toByteArray</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> TextDecoder <span class=\"token operator\">===</span> <span class=\"token string\">\"undefined\"</span> <span class=\"token operator\">?</span> TextDecoderLite <span class=\"token operator\">:</span> TextDecoder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>encoding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>\n  <strong>æ³¨æ„</strong>: <a href=\"https://github.com/coolaj86/TextEncoderLite\" class=\"external\" rel=\" noopener\">TextEncoderLite</a> ä¸èƒ½æ­£ç¡®å¤„ç†å››å­—èŠ‚ UTF-8 å­—ç¬¦ï¼Œæ¯”å¦‚ '\\uD842\\uDFB7' æˆ–ç¼©å†™ä¸º '\\u{20BB7}' ã€‚å‚è§ <a href=\"https://github.com/solderjs/TextEncoderLite/issues/16\" class=\"external\" rel=\" noopener\">issue</a>\n  å¯ä½¿ç”¨ <a href=\"https://github.com/inexorabletash/text-encoding\" class=\"external\" rel=\" noopener\">text-encoding</a> ä½œä¸ºæ›¿ä»£ã€‚\n</p>\n<p>æŸäº›åœºæ™¯ä¸‹ï¼Œä»¥ä¸Šç»ç”± UTF-8 è½¬æ¢åˆ° Base64 çš„å®ç°åœ¨ç©ºé—´åˆ©ç”¨ä¸Šä¸ä¸€å®šé«˜æ•ˆã€‚å½“å¤„ç†åŒ…å«å¤§é‡ U+0800-U+FFFF åŒºåŸŸé—´å­—ç¬¦çš„æ–‡æœ¬æ—¶ï¼ŒUTF-8 è¾“å‡ºç»“æœé•¿äº UTF-16 çš„ï¼Œå› ä¸ºè¿™äº›å­—ç¬¦åœ¨ UTF-8 ä¸‹å ç”¨ä¸‰ä¸ªå­—èŠ‚è€Œ UTF-16 æ˜¯ä¸¤ä¸ªã€‚åœ¨å¤„ç†å‡åŒ€åˆ†å¸ƒ UTF-16 ç ç‚¹çš„ JavaScript å­—ç¬¦ä¸²æ—¶åº”è€ƒè™‘é‡‡ç”¨ UTF-16 æ›¿ä»£ UTF-8 ä½œä¸º Base64 ç»“æœçš„ä¸­é—´ç¼–ç æ ¼å¼ï¼Œè¿™å°†å‡å°‘ 40% å°ºå¯¸ã€‚</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>å¤‡æ³¨ï¼š</strong> ä¸‹ä¸ºé™ˆæ—§ç¿»è¯‘ç‰‡æ®µ</p>\n</div>\n<ul>\n  <li>ç¬¬ä¸€ä¸ªæ˜¯è½¬ä¹‰ (escape) æ•´ä¸ªå­—ç¬¦ä¸²ç„¶åç¼–ç è¿™ä¸ªå®ƒï¼›</li>\n  <li>ç¬¬äºŒä¸ªæ˜¯æŠŠ UTF-16 çš„ <a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String\"><code>DOMString</code></a> è½¬ç ä¸º UTF-8 çš„å­—ç¬¦æ•°ç»„ç„¶åç¼–ç å®ƒã€‚</li>\n</ul>","titleAsText":"Solution #5 â€“ rewrite the DOMs atob() and btoa() using JavaScript's TypedArrays and UTF-8"}},{"type":"prose","value":{"id":"æ–¹æ¡ˆ_1_â€“_ç¼–ç ä¹‹å‰è½¬ä¹‰_escape_å­—ç¬¦ä¸²","title":"æ–¹æ¡ˆ #1 â€“ ç¼–ç ä¹‹å‰è½¬ä¹‰ (escape) å­—ç¬¦ä¸²","isH3":true,"content":"<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">b64EncodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">btoa</span><span class=\"token punctuation\">(</span><span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">%([0-9A-F]{2})</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">match<span class=\"token punctuation\">,</span> p1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'0x'</span> <span class=\"token operator\">+</span> p1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">b64EncodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'âœ“ Ã  la mode'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"4pyTIMOgIGxhIG1vZGU=\"</span>\n</code></pre></div>\n<p>æŠŠ base64 è½¬æ¢å›å­—ç¬¦ä¸²</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">b64DecodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">decodeURIComponent</span><span class=\"token punctuation\">(</span><span class=\"token function\">atob</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'%'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'00'</span> <span class=\"token operator\">+</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">b64DecodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'4pyTIMOgIGxhIG1vZGU='</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"âœ“ Ã  la mode\"</span>\n<span class=\"token function\">b64DecodeUnicode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Cg=='</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"\\n\"</span>\n</code></pre></div>\n<p><a href=\"https://github.com/coolaj86/unibabel-js\" class=\"external\" rel=\" noopener\">Unibabel</a> æ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸€äº›ä½¿ç”¨è¿™ç§ç­–ç•¥çš„é€šç”¨è½¬æ¢çš„åº“ã€‚</p>"}},{"type":"prose","value":{"id":"æ–¹æ¡ˆ_6_â€“_ç”¨_javascript_çš„_typedarray_å’Œ_utf-8_é‡å†™_dom_çš„_atob_å’Œ_btoa","title":"æ–¹æ¡ˆ #6 â€“ ç”¨ JavaScript çš„ <code>TypedArray</code> å’Œ UTF-8 é‡å†™ DOM çš„ <code>atob()</code> å’Œ <code>btoa()</code>","isH3":true,"content":"<p>ä½¿ç”¨åƒ<a href=\"https://github.com/inexorabletash/text-encoding\" class=\"external\" rel=\" noopener\">TextEncoding</a>(åŒ…å«äº†æ—©æœŸ (legacy) çš„ windowsï¼Œmacï¼Œå’Œ ISO ç¼–ç )ï¼Œ<a href=\"https://github.com/coolaj86/TextEncoderLite/blob/master/index.js\" class=\"external\" rel=\" noopener\">TextEncoderLite</a> æˆ–è€… <a href=\"https://github.com/feross/buffer\" class=\"external\" rel=\" noopener\">Buffer</a> è¿™æ ·çš„æ–‡æœ¬ç¼–ç å™¨å¢å¼º (polyfill) å’Œ Base64 å¢å¼ºï¼Œæ¯”å¦‚<a href=\"https://github.com/beatgammit/base64-js/blob/master/index.js\" class=\"external\" rel=\" noopener\">base64-js</a> æˆ– <a href=\"https://github.com/waitingsong/base64\" class=\"external\" rel=\" noopener\">TypeScript ç‰ˆæœ¬çš„ base64-js</a>ï¼ˆé€‚ç”¨äºé•¿é’æµè§ˆå™¨å’Œ Node.jsï¼‰ã€‚</p>\n<p>æœ€ç®€å•ï¼Œæœ€è½»é‡çº§çš„è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨ <a href=\"https://github.com/coolaj86/TextEncoderLite/blob/master/index.js\" class=\"external\" rel=\" noopener\">TextEncoderLite</a> å’Œ <a href=\"https://github.com/beatgammit/base64-js/blob/master/index.js\" class=\"external\" rel=\" noopener\">base64-js</a>.</p>\n<p>æƒ³è¦æ›´å®Œæ•´çš„åº“çš„è¯ï¼Œå‚è§ <a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a>.</p>","titleAsText":"æ–¹æ¡ˆ #6 â€“ ç”¨ JavaScript çš„ TypedArray å’Œ UTF-8 é‡å†™ DOM çš„ atob() å’Œ btoa()"}},{"type":"prose","value":{"id":"å‚è§","title":"å‚è§","isH3":false,"content":"<ul>\n  <li><a href=\"/zh-CN/docs/Web/API/atob\" title=\"atob()\"><code>atob()</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/API/btoa\" title=\"btoa()\"><code>btoa()</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Data_URLs\"><code>data</code> URIs</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\">ArrayBuffer</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays\">TypedArrays</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\">ArrayBufferView</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array\">Uint8Array</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Typed_arrays/StringView\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>StringView</code> â€“ a C-like representation of strings based on typed arrays</a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String\">DOMString</a></li>\n  <li><a href=\"/zh-CN/docs/Glossary/URI\"><code>URI</code></a></li>\n  <li><a href=\"/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\"><code>encodeURI()</code></a></li>\n  <li><a href=\"/zh-CN/docs/XPCOM_Interface_Reference/nsIURIFixup\" class=\"page-not-created\" title=\"This is a link to an unwritten page\"><code>nsIURIFixup()</code></a></li>\n  <li><a href=\"https://en.wikipedia.org/wiki/Base64\" class=\"external\" rel=\" noopener\"><code>Base64 on Wikipedia</code></a></li>\n</ul>"}}],"toc":[{"text":"æ–‡æ¡£","id":"æ–‡æ¡£"},{"text":"å·¥å…·","id":"å·¥å…·"},{"text":"ç›¸å…³æ–‡ç« ","id":"ç›¸å…³æ–‡ç« "},{"text":"Unicode é—®é¢˜","id":"unicode_é—®é¢˜_2"},{"text":"å‚è§","id":"å‚è§"}],"summary":"Base64 æ˜¯ä¸€ç»„ç›¸ä¼¼çš„äºŒè¿›åˆ¶åˆ°æ–‡æœ¬ï¼ˆbinary-to-textï¼‰çš„ç¼–ç è§„åˆ™ï¼Œä½¿å¾—äºŒè¿›åˆ¶æ•°æ®åœ¨è§£é‡Šæˆ radix-64 çš„è¡¨ç°å½¢å¼åèƒ½å¤Ÿç”¨ ASCII å­—ç¬¦ä¸²çš„æ ¼å¼è¡¨ç¤ºå‡ºæ¥ã€‚Base64 è¿™ä¸ªè¯å‡ºè‡ªä¸€ç§ MIME æ•°æ®ä¼ è¾“ç¼–ç ã€‚","popularity":0.0019,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Base64","locale":"en-US","native":"English (US)"},{"title":"Base64 codificando y decodificando","locale":"es","native":"EspaÃ±ol"},{"title":"DÃ©coder et encoder en base64","locale":"fr","native":"FranÃ§ais"},{"title":"Base64","locale":"ja","native":"æ—¥æœ¬èª"},{"title":"ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ´ĞµĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Base64","locale":"ru","native":"Ğ ÑƒÑÑĞºĞ¸Ğ¹"}],"source":{"folder":"zh-cn/glossary/base64","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-cn/glossary/base64/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-CN/docs/Glossary","title":"æœ¯è¯­è¡¨"},{"uri":"/zh-CN/docs/Glossary/Base64","title":"Base64 çš„ç¼–ç ä¸è§£ç "}],"pageTitle":"Base64 çš„ç¼–ç ä¸è§£ç  - æœ¯è¯­è¡¨ | MDN","noIndexing":false}}</script></body></html>