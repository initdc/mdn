{"doc":{"isMarkdown":false,"isTranslated":true,"isActive":true,"flaws":{},"title":"Hacer que las PWAs trabajen desconectadas con servicio workers","mdn_url":"/es/docs/Web/Progressive_web_apps/Offline_Service_workers","locale":"es","native":"Español","sidebarHTML":"\n<ol><li><a href=\"/es/docs/Web/Progressive_web_apps/Loading\">Carga progresiva</a></li><li><a href=\"/es/docs/Web/Progressive_web_apps/Installable_PWAs\">Cómo hacer PWAs instalables</a></li><li><a href=\"/es/docs/Web/Progressive_web_apps/Re-engageable_Notifications_Push\">Cómo hacer que las PWAs se puedan volver a conectar usando Notificaciones y Push</a></li><li><a href=\"/es/docs/Web/Progressive_web_apps/App_structure\">Estructura de una aplicación web progresiva</a></li><li><a href=\"/es/docs/Web/Progressive_web_apps/Offline_Service_workers\">Hacer que las PWAs trabajen desconectadas con servicio workers</a></li><li><a href=\"/es/docs/Web/Progressive_web_apps/Installing\">Instalar y desinstalar aplicaciones web</a></li><li><a href=\"/es/docs/Web/Progressive_web_apps/Introduction\">Introducción a  aplicaciones web progresivas</a></li></ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div id=\"sect1\"><ul class=\"prev-next\">\n    <li><a class=\"button minimal\" href=\"/es/docs/Web/Progressive_web_apps/App_structure\"> Anterior </a></li>\n    <li><a class=\"button minimal\" href=\"/es/docs/Web/Progressive_web_apps\"> Overview: Progressive web apps</a></li>\n    <li><a class=\"button minimal\" href=\"/es/docs/Web/Progressive_web_apps/Installable_PWAs\"> Siguiente  </a></li>\n</ul></div>\n\n<p class=\"summary\">Ahora que hemos visto cómo se ve la estructura de js13kPWA y hemos visto el intérprete básico en funcionamiento, veamos cómo se implementan las capacidades sin conexión con el Servicio <em>Worker</em>. En este artículo, analizamos cómo se usa en nuestro <a href=\"https://mdn.github.io/pwa-examples/js13kpwa/\" class=\"external\" rel=\" noopener\">ejemplo de js13kPWA</a> (<a href=\"https: //github.com/mdn/pwa-examples/tree/master/js13kpwa\" class=\"external\" rel=\" noopener\">ve el código fuente también</a>). Examinamos cómo agregar funcionalidad fuera de línea.</p>"}},{"type":"prose","value":{"id":"el_servicio_workers_explicado","title":"El servicio <em>workers</em> explicado","isH3":false,"content":"<p>El servicio <em>workers</em> son un delegado virtual entre el navegador y la red. Finalmente, solucionan problemas con los que los desarrolladores de aplicaciones para el usuario han luchado durante años, en particular, cómo almacenar correctamente en caché los activos de un sitio web y ponerlos a disposición cuando el dispositivo del usuario está desconectado.</p>\n\n<p>Se ejecutan en un hilo separado del código JavaScript principal de nuestra página y no tienen acceso a la estructura DOM. Esto introduce un enfoque diferente al de la programación web tradicional — la API no bloquea y puede enviar y recibir comunicación entre diferentes contextos. Puede darle a un servicio <em>worker</em> algo en lo que trabajar y recibir el resultado cuando esté listo utilizando un enfoque basado en una <a class=\"page-not-created\" title=\"La documentación acerca de este tema no ha sido escrita todavía . ¡Por favor  considera contribuir !\"><code>promesa</code></a>.</p>\n\n<p>Pueden hacer mucho más que \"solo\" ofrecer capacidades sin conexión, incluido el manejo de notificaciones, la realización de cálculos pesados​en un hilo separado, etc. El servicio <em>workers</em> es bastante poderoso, ya que pueden tomar el control de las solicitudes de red, modificarlas, entregar respuestas personalizadas recuperadas de la caché o sintetizar respuestas por completo.</p>","titleAsText":"El servicio workers explicado"}},{"type":"prose","value":{"id":"seguridad","title":"Seguridad","isH3":true,"content":"<p>Debido a que son tan poderosos, los Servicios <em>Workers</em> solo se pueden ejecutar en contextos seguros (es decir, HTTPS). Si deseas experimentar primero antes de enviar tu código a producción, siempre puedes probar en un anfitrión local o configurar las páginas de GitHub — ambas admiten HTTPS.</p>"}},{"type":"prose","value":{"id":"desconectado_primero","title":"Desconectado primero","isH3":false,"content":"<p>El patrón \"desconectado primero\" o \"primero caché\" es la estrategia más popular para entregar contenido al usuario. Si un recurso está almacenado en caché y disponible sin conexión, devuélvelo primero antes de intentar descargarlo del servidor. Si aún no está en la caché, descárgalo y almacénalo para uso futuro.</p>"}},{"type":"prose","value":{"id":"progresiva_en_pwa","title":"\"Progresiva\" en PWA","isH3":false,"content":"<p>Cuando se implementa correctamente como una mejora progresiva, el servicio <em>workers</em> puede beneficiar a los usuarios que tienen navegadores modernos que admiten la API al brindar soporte fuera de línea, pero no romperán nada para aquellos que usan navegadores heredados.</p>"}},{"type":"prose","value":{"id":"el_servicio_workers_en_la_aplicación_js13kpwa","title":"El servicio <em>workers</em> en la aplicación <code>js13kPWA</code>","isH3":false,"content":"<p>Suficiente teoría, ¡veamos algo de código real!</p>","titleAsText":"El servicio workers en la aplicación js13kPWA"}},{"type":"prose","value":{"id":"registrar_el_servicio_worker","title":"Registrar el servicio <em>worker</em>","isH3":true,"content":"<p>Comenzaremos mirando el código que registra un nuevo Servicio <em>Worker</em>, en el archivo <code>app.js</code>:</p>\n\n<p><strong>Nota</strong>: Usamos la sintaxis de las <strong>funciones flecha</strong> de <a href=\"http://es6-features.org/\" class=\"external\" rel=\" noopener\">ES6</a> en la implementación del servicio <em>worker</em></p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pwa-examples/js13kpwa/sw.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Si la API del servicio <em>worker</em> es compatible con el navegador, se registra en el sitio mediante el método <a href=\"/es/docs/Web/API/ServiceWorkerContainer/register\"><code>ServiceWorkerContainer.register()</code></a>. Su contenido reside en el archivo <code>sw.js</code> y se puede ejecutar después de que el registro sea exitoso. Es la única parte del código de servicio <em>worker</em> que se encuentra dentro del archivo <code>app.js</code>; todo lo demás que sea específico de servicio <em>worker</em> se escribe en el archivo <code>sw.js</code>.</p>","titleAsText":"Registrar el servicio worker"}},{"type":"prose","value":{"id":"ciclo_de_vida_de_un_servicio_worker","title":"Ciclo de vida de un servicio <em>worker</em>","isH3":true,"content":"<p>Cuando se completa el registro, el archivo <code>sw.js</code> se descarga automáticamente, luego se instala y finalmente se activa.</p>\n\n<h4 id=\"instalación\">Instalación</h4>\n\n<p>La API nos permite agregar escuchas de eventos para los eventos clave que nos interesan; el primero es el evento <code>install</code>:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] Install'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>En el escucha de <code>install</code>, podemos iniciar la caché y agregarle archivos para su uso sin conexión. Nuestra aplicación <em>js13kPWA</em> hace exactamente eso.</p>\n\n<p>Primero, se crea una variable para almacenar el nombre de la caché y los archivos del intérprete de la aplicación se enumeran en un arreglo.</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> cacheName <span class=\"token operator\">=</span> <span class=\"token string\">'js13kPWA-v1'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> appShellFiles <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/index.html'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/app.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/style.css'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/fonts/graduate.eot'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/fonts/graduate.ttf'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/fonts/graduate.woff'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/favicon.ico'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/img/js13kgames.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/img/bg.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-32.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-64.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-96.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-128.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-168.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-192.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-256.png'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-512.png'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>A continuación, los enlaces a las imágenes que se cargarán junto con el contenido del archivo <code>data/games.js</code> se generan en el segundo arreglo. Después de eso, ambos arreglos se fusionan usando la función <a href=\"/es/docs/Web/JavaScript/Reference/Global_Objects/Array/concat\"><code>Array.prototype.concat()</code></a>.</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> gamesImages <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>games<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  gamesImages<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data/img/'</span><span class=\"token operator\">+</span>games<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>slug<span class=\"token operator\">+</span><span class=\"token string\">'.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> contentToCache <span class=\"token operator\">=</span> appShellFiles<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>gamesImages<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Entonces podemos manejar el evento <code>install</code> en sí mismo:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Service Worker] Install'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Servicio Worker] Almacena todo en caché: contenido e intérprete de la aplicación'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>contentToCache<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Aquí hay dos cosas que necesitan una explicación: qué hace <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/ExtendableEvent/waitUntil\"><code>ExtendableEvent.waitUntil</code> <small>(en-US)</small></a> y qué es el objeto <a href=\"/es/docs/Web/API/caches\" title=\"caches\"><code>caches</code></a>.</p>\n\n<p>El servicio <em>worker</em> no se instala hasta que se ejecuta el código dentro de <code>waitUntil</code>. Este devuelve una promesa — este enfoque es necesario porque la instalación puede llevar algún tiempo, por lo que tenemos que esperar a que finalice.</p>\n\n<p><code>caches</code> es un objeto <a href=\"/es/docs/Web/API/CacheStorage\"><code>CacheStorage</code></a> especial disponible en el ámbito del servicio <em>worker</em> dado para permitir guardar datos, guardar en el <a href=\"/es/docs/Web/API/Web_Storage_API\">almacenamiento web</a> no funcionará porque el almacenamiento web es síncrono. Con el servicio <em>workers</em>, usamos la API de <code>Cache</code> en su lugar.</p>\n\n<p>Aquí, abrimos una caché con un nombre dado, luego agregamos a la caché todos los archivos que nuestra aplicación usa, para que estén disponibles la próxima vez que se cargue (identificado por la URL de la solicitud).</p>\n\n<h4 id=\"activación\">Activación</h4>\n\n<p>También hay un evento <code>activate</code>, que se usa de la misma manera que <code>install</code>. Este evento generalmente se usa para eliminar cualquier archivo que ya no sea necesario y limpiar después la aplicación en general. No es necesario que hagamos eso en nuestra aplicación, así que lo omitiremos.</p>","titleAsText":"Ciclo de vida de un servicio worker"}},{"type":"prose","value":{"id":"responder_a_las_recuperaciones","title":"Responder a las recuperaciones","isH3":true,"content":"<p>También tenemos un evento <code>fetch</code> a nuestra disposición, que se activa cada vez que se activa una solicitud HTTP desde nuestra aplicación. Esto es muy útil, ya que nos permite interceptar solicitudes y reaccionar con respuestas personalizadas. Aquí hay un sencillo ejemplo de uso:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Servicio Worker] Recurso obtenido '</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>La respuesta puede ser cualquier cosa que queramos: el archivo solicitado, su copia en caché o un fragmento de código JavaScript que hará algo específico; las posibilidades son infinitas.</p>\n\n<p>En nuestra aplicación de ejemplo, servimos contenido de la caché en lugar de la red siempre que el recurso realmente esté en la caché. Hacemos esto tanto si la aplicación está en línea como si está fuera de línea. Si el archivo no está en la caché, la aplicación primero lo agrega allí antes de servirlo:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Servicio Worker] Obteniendo recurso: '</span><span class=\"token operator\">+</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> r <span class=\"token operator\">||</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Servicio Worker] Almacena el nuevo recurso: '</span><span class=\"token operator\">+</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Aquí, respondemos al evento <code>fetch</code> con una función que intenta encontrar el recurso en la caché y devolver la respuesta si está allí. Si no es así, usamos otra solicitud de recuperación para obtenerla de la red, luego almacenamos la respuesta en la caché para que esté disponible allí la próxima vez que se solicite.</p>\n\n<p>El método <a class=\"only-in-en-us\" title=\"Currently only available in English (US)\" href=\"/en-US/docs/Web/API/FetchEvent/respondWith\"><code>FetchEvent.respondWith</code> <small>(en-US)</small></a> toma el control; esta es la parte que funciona como un servidor delegado entre la aplicación y la red. Esto nos permite responder a cada solicitud con cualquier cosa que queramos: preparada por el servicio <em>worker</em>, tomada de la caché o modificada si es necesario.</p>\n\n<p>¡Eso es! Nuestra aplicación almacena en caché sus recursos al instalarlos y los sirve con la recuperación de la caché, por lo tanto, funciona incluso si el usuario está desconectado. También almacena en caché contenido nuevo cada vez que se agrega.</p>"}},{"type":"prose","value":{"id":"actualizaciones","title":"Actualizaciones","isH3":false,"content":"<p>Todavía hay un punto que cubrir: ¿cómo se actualiza un servicio <em>worker</em> cuando hay disponible una nueva versión de la aplicación que contiene nuevos activos? El número de versión en el nombre de la caché es clave para esto:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">var</span> cacheName <span class=\"token operator\">=</span> <span class=\"token string\">'js13kPWA-v1'</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Cuando esto se actualice a v2, podemos agregar todos nuestros archivos (incluidos nuestros archivos nuevos) a una nueva caché:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>contentToCache<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/pwa-examples/js13kpwa/icons/icon-32.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js13kPWA-v2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>contentToCache<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Se instala un nuevo servicio <em>worker</em> en segundo plano y el anterior (v1) funciona correctamente hasta que no hay páginas que lo utilicen; el nuevo servicio <em>worker</em> se activa y se hace cargo de la administración de la página desde el anterior.</p>"}},{"type":"prose","value":{"id":"limpiar_la_caché","title":"Limpiar la caché","isH3":false,"content":"<p>¿Recuerdas el evento <code>active</code> que omitimos?, se puede usar para borrar la antigua caché que ya no necesitamos:</p>\n\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'activate'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">keyList</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>keyList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">!==</span> cacheName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n\n<p>Esto asegura que solo tengamos los archivos que necesitamos en la caché, por lo que no dejamos basura; el <a href=\"/en-US/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">espacio de caché disponible en el navegador es limitado (en-US)</a>, por lo que es una buena idea limpiarlo nosotros mismos después.</p>"}},{"type":"prose","value":{"id":"otros_casos_de_uso","title":"Otros casos de uso","isH3":false,"content":"<p>Servir archivos desde la caché no es la única característica que ofrece el servicio <em>worker</em>. Si tienes que hacer cálculos pesados, los puedes descargar del hilo principal y hacerlos en el <em>worker</em>, y recibir el resultado tan pronto como estén disponibles. En cuanto al rendimiento, puedes obtener recursos que no se necesitan en este momento, pero que podrían serlo en un futuro cercano, por lo que la aplicación será más rápida cuando realmente los necesite.</p>"}},{"type":"prose","value":{"id":"resumen","title":"Resumen","isH3":false,"content":"<p>En este artículo, analizamos cómo puedes hacer que tu PWA funcione sin conexión con el servicio <em>workers</em>. Asegúrate de consultar nuestra documentación adicional si deseas obtener más información sobre los conceptos detrás de la <a href=\"/es/docs/Web/API/Service_Worker_API\">API de Service Worker</a> y cómo usarla con más detalle.</p>\n\n<p>El servicio <em>workers</em> también se utilizan cuando se trata de <a href=\"/es/docs/Web/API/Push_API\">notificaciones push</a>; esto se explicará en un artículo posterior.</p>\n\n<p></p><ul class=\"prev-next\">\n    <li><a class=\"button minimal\" href=\"/es/docs/Web/Progressive_web_apps/App_structure\"> Anterior </a></li>\n    <li><a class=\"button minimal\" href=\"/es/docs/Web/Progressive_web_apps\"> Overview: Progressive web apps</a></li>\n    <li><a class=\"button minimal\" href=\"/es/docs/Web/Progressive_web_apps/Installable_PWAs\"> Siguiente  </a></li>\n</ul><p></p>\n\n<div id=\"sect2\"></div>"}}],"toc":[{"text":"El servicio <em>workers</em> explicado","id":"el_servicio_workers_explicado"},{"text":"Desconectado primero","id":"desconectado_primero"},{"text":"\"Progresiva\" en PWA","id":"progresiva_en_pwa"},{"text":"El servicio <em>workers</em> en la aplicación <code>js13kPWA</code>","id":"el_servicio_workers_en_la_aplicación_js13kpwa"},{"text":"Actualizaciones","id":"actualizaciones"},{"text":"Limpiar la caché","id":"limpiar_la_caché"},{"text":"Otros casos de uso","id":"otros_casos_de_uso"},{"text":"Resumen","id":"resumen"}],"summary":"Ahora que hemos visto cómo se ve la estructura de js13kPWA y hemos visto el intérprete básico en funcionamiento, veamos cómo se implementan las capacidades sin conexión con el Servicio Worker. En este artículo, analizamos cómo se usa en nuestro ejemplo de js13kPWA (ve el código fuente también). Examinamos cómo agregar funcionalidad fuera de línea.","popularity":0.0003,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Making PWAs work offline with Service workers","locale":"en-US","native":"English (US)"},{"title":"Faire fonctionner les PWAs en mode déconnecté grâce aux Service workers","locale":"fr","native":"Français"},{"title":"サービスワーカーで PWA をオフラインで動作させる","locale":"ja","native":"日本語"},{"title":"Service worker를 사용해 PWA를 오프라인에서 동작하게 만들기","locale":"ko","native":"한국어"},{"title":"通过 Service workers 让 PWA 离线工作","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"es/web/progressive_web_apps/offline_service_workers","github_url":"https://github.com/mdn/translated-content/blob/main/files/es/web/progressive_web_apps/offline_service_workers/index.html","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.html"},"parents":[{"uri":"/es/docs/Web","title":"Tecnología para desarrolladores web"},{"uri":"/es/docs/Web/Progressive_web_apps","title":"Aplicaciones Web Progresivas"},{"uri":"/es/docs/Web/Progressive_web_apps/Offline_Service_workers","title":"Hacer que las PWAs trabajen desconectadas con servicio workers"}],"pageTitle":"Hacer que las PWAs trabajen desconectadas con servicio workers - Aplicaciones Web Progresivas | MDN","noIndexing":false}}