{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"Tu segunda extensión","mdn_url":"/es/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension","locale":"es","native":"Español","sidebarHTML":"\n  <ol>\n    <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions\"><strong>Extensiónes del navegador</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Comenzar</summary>\n        <ol>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">¿Qué son las extensiones?</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Tu primera extensión</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Tu segunda extensión</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomía de una extensión</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Examples\">Extensiones de ejemplo</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/What_next_\">¿Qué sigue?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Conceptos</summary>\n        <ol>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Uso de las API de JavaScript</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Guiones de contenido</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Patrones de coincidencia</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Trabajar con archivos</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internacionalización</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Política de seguridad de contenido</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Mensajería nativa</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Diferencias entre implementaciones de API</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Incompatibilidades de Chrome</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Interfaz de usuario</summary>\n        <ol>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface\">Interfaz de usuario</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Botón de la barra de herramientas</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Botón de la barra de direcciones</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Barras laterales</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Elementos del menú contextual</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Página de opciones</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Páginas de extensión</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notificaciones</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Sugerencias de la barra de direcciones</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Paneles de herramientas para desarrolladores</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Cómo hacer</summary>\n        <ol>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Interceptar solicitudes HTTP</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modificar una página web</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insertar contenido externo</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Comparta objetos con scripts de página</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Agregar un botón a la barra de herramientas</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Implementar una página de configuración</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Trabajar con la API de pestañas</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Trabajar con la API de marcadores</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Trabajar con la API de Cookies</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Trabajar con identidades contextuales</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interactuar con el portapapeles</a></li>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Cree una extensión multinavegador</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Diferenciadores de Firefox</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>API de JavaScript</summary>\n        <ol><li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Claves de manifiesto</summary>\n        <ol>\n          <li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introducción</a></li>\n        </ol>\n      <ol><li><a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Taller de Extensión</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Desarrollar</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Gestionar</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Empresa</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/es/docs/Mozilla/Add-ons/Contact_us\"><strong>Contáctenos</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Canales de discusión</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Blog de complementos</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Foro de complementos</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Chat de complementos</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Si ya ha visto el artículo <a href=\"/es/Add-ons/WebExtensions/Tu_primera_WebExtension\">tu primer extensión</a>, ya posee una idea de como escribir una extensión. En este artículo se escribirá una extensión ligeramente más compleja para demostrar un par de cosas más de las APIs.</p>\n<p>La extensión añade un nuevo botón a la barra de herramientas de Firefox. Cuando el usuario da clic sobre el botón, mostraremos una ventana emergente que permite escoger un animal. Una vez que un animal sea escogido, reemplazaremos todas las imágenes en la página actual con la imagen del animal seleccionado.</p>\n<p>Para implementar esto, haremos lo siguiente:</p>\n<ul>\n  <li>\n    <strong>Definir una <a href=\"/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">acción del navegador</a>, que será el botón añadido a la barra de herramientas de Firefox</strong>.\n    Para el botón vamos a proporcionar:\n    <ul>\n      <li>un icono, llamado \"beasts-32.png\"</li>\n      <li>una ventana emergente para abrir cuando el botón sea presionado. La ventana emergente incluye HTML, CSS y JavaScript.</li>\n    </ul>\n  </li>\n  <li><strong>Define un ícono para la extensión,</strong> llamado \"beasts-48.png\". Este será mostrado en el Administrador de Complementos.</li>\n  <li>\n    <strong>Escribe un script de contenido, \"beastify.js\" que será inyectado dentro de las páginas web.</strong>\n    Este es el código que modificará las páginas web.\n  </li>\n  <li>\n    <strong>Empaqueta algunas imágenes de animales, para reemplazar las imágnes de la página web</strong>.\n    Nosotros haremos las imágenes \"recursos web accesibles\" para que la página web pueda referenciarlos.\n  </li>\n</ul>\n<p>Tu puedes notar que la estructura general de la extensión luce como esto:</p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/13671/Untitled-1.png\" alt=\"\" loading=\"lazy\">\n</p>\n<p>Esta es una extensión simple, pero muestra muchos de los principales conceptos de la API WebExtensions:</p>\n<ul>\n  <li>Adicionando un botón a la barra de herramientas</li>\n  <li>Definiendo un panel emergente usando HTML, CSS y JavaScript</li>\n  <li>Inyectando scripts de contenido dentro de las páginas web</li>\n  <li>Comunicándonos entre los scripts de contenido y el resto de la extensión</li>\n  <li>Empaquetando recursos con tu extensión que pueden ser usados por las páginas web</li>\n</ul>\n<p>Tu puedes encontrar el <a href=\"https://github.com/mdn/webextensions-examples/tree/master/beastify\" class=\"external\" rel=\" noopener\">código fuente completo de la extensión en GitHub</a>.</p>\n<p>Para escribir una extensión, necesitará de Firefox 45 o más reciente.</p>"}},{"type":"prose","value":{"id":"escribiendo_la_extensión","title":"Escribiendo la extensión","isH3":false,"content":"<p>Crea una carpeta nueva y navega hacia ella:</p>\n<div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code><span class=\"token function\">mkdir</span> beastify\n<span class=\"token builtin class-name\">cd</span> beastify\n</code></pre></div>"}},{"type":"prose","value":{"id":"manifest.json","title":"manifest.json","isH3":true,"content":"<p>Ahora crea un archivo llamado \"manifest.json\", y agrega el siguiente contenido:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Beastify\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Agrega un icono de acción navegación a la barra de herramientas. Haga clic en el botón para elegir una bestia. El contenido del cuerpo de la pestaña activa se sustituye por una imagen de la bestia elegida. Consulte https://developer.mozilla.org/es/Add-ons/WebExtensions/Examples#beastify\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"homepage_url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://github.com/mdn/webextensions-examples/tree/master/beastify\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"48\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/beasts-48.png\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"activeTab\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"browser_action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"default_icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/beasts-32.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bestificar\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_popup\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"popup/choose_beast.html\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"web_accessible_resources\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"beasts/frog.jpg\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"beasts/turtle.jpg\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"beasts/snake.jpg\"</span>\n  <span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n  <li>Las tres primeras llaves: <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\"><code>manifest_version</code></a> , <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\"><code>name</code></a> , y <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\"><code>version</code></a> , son obligatorias y contienen los metadatos básicos para la extensión.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\"><code>description</code></a> y <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\"><code>homepage_url</code></a> son opcionales, pero recomendadas: proporcionan información útil acerca de la extensión.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\"><code>icons</code></a> es opcional, pero recomedada: permite la especificación de un ícono para la extensión, que será mostrada en el Administrador de Complementos.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\"><code>permissions</code></a> lista los permisos que la extensión necesita. Aquí solo se pide el permiso de <a href=\"/en-US/Add-ons/WebExtensions/manifest.json/permissions#activeTab_permission\"><code>activeTab</code> permission</a>.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\"><code>browser_action</code></a> especifica el botón de la barra de herramientas. Nosotros proveemos tres piezas de información aquí:\n    <ul>\n      <li><code>default_icon</code> es obligatorio y enlaza al icono para el botón</li>\n      <li><code>default_title</code> es opcional y será mostrado como descripción</li>\n      <li><code>default_popup</code> es usado su tu quieres una ventana emergente que será mostrada cuando el usuario de clic en el botón. Lo hacemos y hemos incluido esta llave que apunta a un archivo HTML de la extensión.</li>\n    </ul>\n  </li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\"><code>web_accessible_resources</code></a> lista los archivos que queremos hacer accesibles a las páginas web. Como la extensión reemplaza imágenes en una página con imágenes que hemos empaquetado, necesitamos hacer estas imágenes accesibles a la página.</li>\n</ul>\n<p>Nota que todas las rutas dadas son relativas a manifest.json.</p>"}},{"type":"prose","value":{"id":"el_ícono","title":"El ícono","isH3":true,"content":"<p>La extensión debería tener un íncono. Éste, será mostrado junto a la lista de complementos en el Administrador de Complementos (Pude abrirlo introduciendo en la URL \"about:addons\"). El manifest.json promete que se posee un ícono para la barra de herramientas en \"icons/beasts-48.png\".</p>\n<p>Cree el directorio \"icons\" y guarde un ícono ahí y nómbrelo como \"beasts-48.png\". Puede utilizar <a href=\"https://github.com/mdn/webextensions-examples/blob/master/beastify/icons/beasts-48.png\" class=\"external\" rel=\" noopener\">uno de nuestro ejemplo</a>, el cual ha sido tomado del <a href=\"https://www.iconfinder.com/iconsets/free-retina-icon-set\" class=\"external\" rel=\" noopener\">conjuto de íconos Aha-Soft’s Free Retina</a>, que es utilizado bajo el término de su propia <a href=\"http://www.aha-soft.com/free-icons/free-retina-icon-set/\" class=\"external\" rel=\" noopener\">licencia</a>.</p>\n<p>Si elige proporcionar su propio ícono, debería ser de 48x48 pixeles. También puede proporcionar un ícono de 96x96 pixeles, para pantallas de altas resoluciones y, si usted hace esto, deberá especificarlo como la propiedad <code>96</code> del objeto <code>icons</code> en el manifest.json:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"48\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/beasts-48.png\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"96\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/beasts-96.png\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"el_botón_de_la_barra_de_herramientas","title":"El botón de la barra de herramientas","isH3":true,"content":"<p>El botón de la barra de herramientas necesita un ícono, y nuestro manifest.json promete eso y nos gustaría tener un ícono para la barra de herramientas en \"icons/beasts-32.png\".</p>\n<p>Guarde un ícono llamado \"beasts-32.png\" en el directorio \"icons\". Tu podrías usar <a href=\"https://github.com/mdn/webextensions-examples/blob/master/beastify/icons/beasts-32.png\" class=\"external\" rel=\" noopener\">uno de nuestros ejemplos</a>, los cuales son tomados desde el sitio <a href=\"http://www.iconbeast.com/free\" class=\"external\" rel=\" noopener\">IconBeast Lite icon set</a> y empleados bajo sus términos de <a href=\"http://www.iconbeast.com/faq/\" class=\"external\" rel=\" noopener\">licencia</a>.</p>\n<p>Si tu no provees una ventana emergente, entonces el evento clic es disparado hacia tu extensión cuando el usuario de clic sobre el botón. Si provees una ventana emergente entonces el evento clic no se disparará, pero en cambio, se muestra la ventana emergente. Nosotros queremos una ventana emergente, así que vamos a crearla.</p>"}},{"type":"prose","value":{"id":"la_ventana_emergente","title":"La ventana emergente","isH3":true,"content":"<p>La función de la ventana emergente es habilitada si el usuario escoge una de los tres animales.</p>\n<p>Crea una nueva carpeta llamada \"popup\" bajo la carpeta raíz de la extensión . Esta será donde pondremos el código para la ventana emergente. La carpeta \"popup\" contendrá estos tres archivos:</p>\n<ul>\n  <li><strong><code>choose_beast.html</code></strong> define el contenido del panel</li>\n  <li><strong><code>choose_beast.css</code></strong> los estilos CSS para el contenido</li>\n  <li><strong><code>choose_beast.js</code></strong> maneja las opciones del usuario ejecutando un script de contenido en la pestaña activa</li>\n</ul>\n<h4 id=\"choose_beast.html\">choose_beast.html</h4>\n<p>El archivo HTML luce así:</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>choose_beast.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>popup-content<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button beast<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Frog<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button beast<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Turtle<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button beast<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Snake<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button reset<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Reset<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>error-content<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>Can't beastify this web page.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>Try a different page.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>choose_beast.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>Tenemos un elemento <code>&lt;div&gt;</code> con un ID <code>\"popup-content\"</code> que contiene un elemento para cada elección de animal. Además, tenemos otro <code>&lt;div&gt;</code> con un ID <code>\"error-content\"</code> y una clase <code>\"hidden\"</code>, que usaremos en el case de que surja algún problema al inicializar la ventana emergente.</p>\n<p>Note que referenciamos los archivos CSS y JS en el HTML como lo haríamos si se tratase de una página web.</p>\n<h4 id=\"choose_beast.css\">choose_beast.css</h4>\n<p>El CSS ajusta el tamaño de la ventana emergente, se asegura que las tres posibles opciones llenen el espacio y les da un poco de estilo básico. Además oculta los elementos con <code>class=\"hidden\"</code>: esto significa que nuestro <code>\"error-content\"</code> <code>&lt;div&gt;</code> estará oculto por defecto.</p>\n<div class=\"code-example\"><pre class=\"brush: css notranslate\"><code><span class=\"token selector\">html, body</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.hidden</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.button</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 3% auto<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 4px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">text-align</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 1.5em<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.beast:hover</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #CFF2F2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.beast</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #E5F2F2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.reset</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #FBFBC9<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.reset:hover</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #EAEA9D<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"choose_beast.js\">choose_beast.js</h4>\n<p>Aquí está el JavaScript para la ventana emergente:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/**\n * CSS para ocultar toda la página\n * Excepto los elementos que pertenecen a la clase \"beastify-image\".\n */</span>\n<span class=\"token keyword\">const</span> hidePage <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">body &gt; :not(.beastify-image) {\n                    display: none;\n                  }</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Esucha los clicks en los botones y envía el mensaje apropiado\n * al script de contenido de la página.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">listenForClicks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/**\n     * Recibe el nombre de una bestia y obtiene la URL de la imagen correspondiente.\n     */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">beastNameToURL</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">beastName</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>beastName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">\"Frog\"</span><span class=\"token operator\">:</span>\n          <span class=\"token keyword\">return</span> browser<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">.</span><span class=\"token function\">getURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beasts/frog.jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">\"Snake\"</span><span class=\"token operator\">:</span>\n          <span class=\"token keyword\">return</span> browser<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">.</span><span class=\"token function\">getURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beasts/snake.jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">\"Turtle\"</span><span class=\"token operator\">:</span>\n          <span class=\"token keyword\">return</span> browser<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">.</span><span class=\"token function\">getURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beasts/turtle.jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Inserta dentro de la pestaña activa el CSS que oculta la página\n     * luego toma la URL de la imagen y\n     * envía un mensaje \"beastify\" al script de contenido de la pestaña activa.\n     */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">beastify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">insertCSS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">code</span><span class=\"token operator\">:</span> hidePage<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> url <span class=\"token operator\">=</span> <span class=\"token function\">beastNameToURL</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tabs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">command</span><span class=\"token operator\">:</span> <span class=\"token string\">\"beastify\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">beastURL</span><span class=\"token operator\">:</span> url\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Remueve el CSS que oculta la página y\n     * envía un mensaje de \"reset\" al script de contenido de la pestaña activa.\n     */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">removeCSS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">code</span><span class=\"token operator\">:</span> hidePage<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tabs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">command</span><span class=\"token operator\">:</span> <span class=\"token string\">\"reset\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Imprime el error en consola.\n     */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">reportError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Could not beastify: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Toma la pestaña activa y\n     * llama a \"beastify()\" o \"reset()\" según corresponda.\n     */</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beast\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">active</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">currentWindow</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>beastify<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>reportError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"reset\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">active</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">currentWindow</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>reset<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>reportError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Si hubo algún error al ejecutar el script,\n * Despliega un popup con el mensaje de error y oculta la UI normal.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">reportExecuteScriptError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#popup-content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hidden\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#error-content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hidden\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Failed to execute beastify content script: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Cuando se carga la ventana emergente, inyecta el script de contenido en la pestaña activa,\n * y agrega un manejador de eventos.\n * Si no es posible inyectar el script, se ocupa de manejar el error.\n */</span>\nbrowser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">executeScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">file</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/content_scripts/beastify.js\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>listenForClicks<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>reportExecuteScriptError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Empecemos por la linea 96. La ventana emergente ejecuta un script de contenido en la pestaña activa tan pronto como se termina de cargar, usando la API <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript\"><code>browser.tabs.executeScript()</code></a>. Si la ejecución del script de contenido es exitosa, este quedará cargado en la página hasta que sea cerrada la pestaña o hasta que el usuario navegue hacia una página distinta.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Nota:</strong> Un motivo común por el cual el llamado a <code>browser.tabs.executeScript()</code> puede fallar, es porque no es posible ejecutar scripts de contenido en todas las páginas, por ejemplo, en páginas de navegador privilegiadas como about:debugging, o páginas del dominio <a href=\"https://addons.mozilla.org/\" class=\"external\" rel=\" noopener\">addons.mozilla.org</a>, no es posible hacerlo.</p>\n</div>\n<p>Si la ejecución falla, <code>reportExecuteScriptError()</code> ocultará el <code>&lt;div&gt;</code> <code>\"popup-content\"</code>, mostrará el <code>&lt;div&gt;</code> <code>\"error-content\"</code>, y reportará el error en la consola.</p>\n<p>Si la ejecución del script de contenido es exitosa, se llamará a <code>listenForClicks()</code>, que atiende los eventos que se generan al cliquear en la ventana emergente.</p>\n<ul>\n  <li>Si el clic se produjo en el botón con <code>class=\"beast\"</code>, se llama a <code>beastify()</code>.</li>\n  <li>Si el clic se produjo en el botón con <code>class=\"reset\"</code>, se llama a <code>reset()</code>.</li>\n</ul>\n<p>La función <code>beastify()</code> hace tres cosas:</p>\n<ul>\n  <li>map the button clicked to a URL pointing to an image of a particular beast</li>\n  <li>Oculta todo el contenido de la página al insertar CSS con la API <a href=\"/en-US/Add-ons/WebExtensions/API/tabs/insertCSS\"><code>browser.tabs.insertCSS()</code></a></li>\n  <li>Envía un mensaje \"beastify\" al script de contenido usando la API <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage\"><code>browser.tabs.sendMessage()</code></a>, solicitándole \"bestificar\" la página, y enviándole la URL de la imagen.</li>\n</ul>\n<p>La función <code>reset()</code> deshace lo hecho por <code>beastify()</code>:</p>\n<ul>\n  <li>Remueve el CSS que agregó, usando la API <a href=\"/en-US/Add-ons/WebExtensions/API/tabs/removeCSS\"><code>browser.tabs.removeCSS()</code></a></li>\n  <li>Envía un mensaje de \"reset\" al script de contenido, solicitándole que resetee la página</li>\n</ul>"}},{"type":"prose","value":{"id":"el_script_de_contenido","title":"El script de contenido","isH3":true,"content":"<p>Crea una carpeta nueva bajo la raíz del complemento llamada \"content_scripts\" y crea un nuevo archivo en ella llamado \"beastify.js\", con el contenido siguiente:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * Revisa e inicializa una variable de guardia.\n   * Si este script de contenido es insertado más de una vez\n   * en la misma página, dejará de ejecutarse.\n   */</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>hasRun<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  window<span class=\"token punctuation\">.</span>hasRun <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n* Recibe la URL de la imagen, remueve las que se hayan agregado antes,\n* crea un nodo IMG que apunt hacia la imagen\n* e inserta ese nodo en el documento.\n*/</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">insertBeast</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">beastURL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">removeExistingBeasts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> beastImage <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    beastImage<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span> beastURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    beastImage<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token string\">\"100vh\"</span><span class=\"token punctuation\">;</span>\n    beastImage<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"beastify-image\"</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>beastImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * Remueve todas las bestias de la página.\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">removeExistingBeasts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> existingBeasts <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".beastify-image\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> beast <span class=\"token keyword\">of</span> existingBeasts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      beast<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * Atiende mensajes del script de segundo plano.\n   * Llama a \"beastify()\" o \"reset()\".\n  */</span>\n  browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>command <span class=\"token operator\">===</span> <span class=\"token string\">\"beastify\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">insertBeast</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>beastURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>command <span class=\"token operator\">===</span> <span class=\"token string\">\"reset\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">removeExistingBeasts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Lo primero que hace el script de contenido es revisar la variable global <code>window.hasRun</code>: si está inicializada termina su ejecución, sino, la inicializa y continúa. La razón por la que hacemos esto es porque cada vez que el usuario abre la ventana emergente, se vuelve a ejecutar el script de contenido en la pestaña activa, por lo que podríamos tener múltiples instancias del script ejecutandose en una sola pestaña. Si esto sucede, necesitamos asegurarnos de que sea sólo la primera instancia la que vaya a realizar cambios.</p>\n<p>Luego, en la linea 40, donde el script de contenido atiende mensajes provenientes de la ventana emergente (usando la API <a href=\"/en-US/Add-ons/WebExtensions/API/runtime/onMessage\"><code>browser.runtime.onMessage</code></a>), vemos que ésta puede enviar dos mensajes diferentes: \"beastify\" y \"reset\".</p>\n<ul>\n  <li>si el mensaje es \"beastify\", esperamos que contenga la URL de la imagen. Removemos el contenido que ha sido agregado por el anterior llamado a \"beastify\", y luego construimos y añadimos un elemento <a href=\"/en-US/docs/Web/HTML/Element/img\"><code>&lt;img&gt;</code></a> cuyo atributo <code>src</code> contiene la URL de la imagen.</li>\n  <li>si el mensaje es \"reset\", simplemente removemos cualquier imagen que haya sido agregada antes.</li>\n</ul>"}},{"type":"prose","value":{"id":"las_bestias","title":"Las bestias","isH3":true,"content":"<p>Finalmente, necesitamos incluir las imágenes de los animales.</p>\n<p>Crea una carpeta nueva llamada \"beasts\", y adiciona tres imágenes en ella, con su nombre apropiado. Tu puedes obtener estas imágenes desde el <a href=\"https://github.com/mdn/webextensions-examples/tree/master/beastify/beasts\" class=\"external\" rel=\" noopener\">repositorio en GitHub</a>, o desde aquí:</p>\n<p>\n  <img src=\"https://mdn.mozillademos.org/files/11459/frog.jpg\" alt=\"\" loading=\"lazy\">\n  <img src=\"https://mdn.mozillademos.org/files/11461/snake.jpg\" alt=\"\" loading=\"lazy\">\n  <img src=\"https://mdn.mozillademos.org/files/11463/turtle.jpg\" alt=\"\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"probándolo","title":"Probándolo","isH3":false,"content":"<p>Primero, comprueba nuevamente que tienes todos los archivos necesarios en el lugar adecuado:</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code>beastify/\n\n    beasts/\n        frog.jpg\n        snake.jpg\n        turtle.jpg\n\n    content_scripts/\n        beastify.js\n\n    icons/\n        beasts-32.png\n        beasts-48.png\n\n    popup/\n        choose_beast.css\n        choose_beast.html\n        choose_beast.js\n\n    manifest.json\n</code></pre></div>\n<p>Comenzando con Firefox 45, pueden instalar temporalmente una extensión desde el disco.</p>\n<p>Abre \"about:debugging\" en Firefox, de clic en \"Cargar complemento temporalmente\", y seleccione el archivo manifest.json. Entonces, debería de ver el ícono de la extensión aparecer en la barra de herramientas de Firefox:</p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/sAM78GU4P34\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n<p>Abra una página web, luego haga clic sobre el ícono, seleccione una bestia, y vea cómo cambia la página web:</p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/YMQXyAQSiE8\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" loading=\"lazy\"></iframe>"}},{"type":"prose","value":{"id":"desarrollo_desde_la_línea_de_comandos","title":"Desarrollo desde la línea de comandos","isH3":false,"content":"<p>Puede automatizar el paso de instalación temporal mediante la herramienta <a href=\"/es/Add-ons/WebExtensions/Getting_started_with_web-ext\">web-ext</a>. Pruebe esto:</p>\n<div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code><span class=\"token builtin class-name\">cd</span> beastify\nweb-ext run\n</code></pre></div>"}}],"toc":[{"text":"Escribiendo la extensión","id":"escribiendo_la_extensión"},{"text":"Probándolo","id":"probándolo"},{"text":"Desarrollo desde la línea de comandos","id":"desarrollo_desde_la_línea_de_comandos"}],"summary":"Si ya ha visto el artículo tu primer extensión, ya posee una idea de como escribir una extensión. En este artículo se escribirá una extensión ligeramente más compleja para demostrar un par de cosas más de las APIs.","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Your second extension","locale":"en-US","native":"English (US)"},{"title":"Votre deuxième WebExtension","locale":"fr","native":"Français"},{"title":"2 つめの拡張機能","locale":"ja","native":"日本語"},{"title":"Your second extension","locale":"ko","native":"한국어"},{"title":"Passo-a-Passo","locale":"pt-BR","native":"Português (do Brasil)"},{"title":"Ваш второй WebExtension","locale":"ru","native":"Русский"},{"title":"你的第二个 WebExtension","locale":"zh-CN","native":"中文 (简体)"},{"title":"你的第二個 WebExtension","locale":"zh-TW","native":"正體中文 (繁體)"}],"source":{"folder":"es/mozilla/add-ons/webextensions/your_second_webextension","github_url":"https://github.com/mdn/translated-content/blob/main/files/es/mozilla/add-ons/webextensions/your_second_webextension/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/es/docs/Mozilla","title":"Mozilla"},{"uri":"/es/docs/Mozilla/Add-ons","title":"Complementos"},{"uri":"/es/docs/Mozilla/Add-ons/WebExtensions","title":"Extensiones del navegador"},{"uri":"/es/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension","title":"Tu segunda extensión"}],"pageTitle":"Tu segunda extensión - Mozilla | MDN","noIndexing":false}}