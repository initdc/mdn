{"version":3,"sources":["auth/sign-out.tsx","ui/atoms/auth-disabled/index.tsx"],"names":["SignOutApp","useSearchParams","searchParams","locale","useLocale","userData","useUserData","sp","URLSearchParams","userSettingsAPIURL","React","useMemo","isAuthenticated","useSWR","url","a","fetch","response","ok","Error","status","json","data","error","defaultNext","next","get","toLowerCase","window","location","pathname","set","DISABLE_AUTH","className","method","action","onSubmit","removeSessionStorageData","csrfmiddlewaretoken","type","name","value","to","Loading","style","minHeight","AuthDisabled"],"mappings":"8RAgBe,SAASA,IAAc,IAAD,EACZC,cAAhBC,EAD4B,oBAE7BC,EAASC,cACTC,EAAWC,cACXC,EAAK,IAAIC,gBAGTC,EAAqBC,IAAMC,SAAQ,WACvC,OAAON,GAAYA,EAASO,gBAAkB,mBAAqB,OAClE,CAACP,IAT+B,EAUXQ,YACtBJ,EAD4B,uCAE5B,WAAOK,GAAP,eAAAC,EAAA,sEACyBC,MAAMF,GAD/B,WACQG,EADR,QAEgBC,GAFhB,sBAGU,IAAIC,MAAJ,UAAaF,EAASG,OAAtB,eAAmCN,IAH7C,uBAKeG,EAASI,OALxB,mFAF4B,uDAAtBC,EAV2B,EAU3BA,KAAMC,EAVqB,EAUrBA,MAaRC,EAAW,WAAOrB,EAAP,KAEbsB,EAAOvB,EAAawB,IAAI,SAAWF,EACnCC,EAAKE,gBAAkBC,OAAOC,SAASC,SAASH,gBAGlDF,EAAOD,GAkBT,OAFAjB,EAAGwB,IAAI,OAAQN,GAEXO,IACK,cAAC,IAAD,IAIP,mCAQG3B,EACCA,EAASO,gBACP,uBACEqB,UAAU,gBACVC,OAAO,OACPC,OAAM,UAjCH,GAiCG,4BACNC,SAAU,WACRC,eALJ,UAQGf,GAAQA,EAAKgB,qBACZ,uBACEC,KAAK,SACLC,KAAK,sBACLC,MAAOnB,EAAKgB,sBAIhB,uBAAOC,KAAK,SAASC,KAAK,OAAOC,MAAOhB,IACvCF,GACC,qBAAKU,UAAU,oBAAf,SACE,8BACE,kDADF,yCAKHX,GAAQA,EAAKgB,qBACZ,wBAAQC,KAAK,SAASN,UAAU,6BAAhC,yBAMJ,qCACE,8BACE,sDADF,WAGA,4BACE,cAAC,IAAD,CAAMS,GAAE,WAAMvC,EAAN,WAAR,wCAKN,cAACwC,EAAD,MAMR,SAASA,IACP,OAAO,mBAAGC,MAAO,CAAEC,UAAW,KAAvB,0B,6EC9HF,SAASC,IACd,OACE,sBAAKb,UAAU,mBAAf,UACE,yDACA,qG","file":"static/js/10.ebd2b3f6.chunk.js","sourcesContent":["import React from \"react\";\nimport { Link, useSearchParams } from \"react-router-dom\";\nimport useSWR from \"swr\";\n\nimport { DISABLE_AUTH } from \"../constants\";\nimport { useUserData, removeSessionStorageData } from \"../user-context\";\nimport { useLocale } from \"../hooks\";\nimport { AuthDisabled } from \"../ui/atoms/auth-disabled\";\n\nimport \"./index.scss\";\nimport \"./sign-out.scss\";\n\ninterface UserSettings {\n  csrfmiddlewaretoken: string;\n}\n\nexport default function SignOutApp() {\n  const [searchParams] = useSearchParams();\n  const locale = useLocale();\n  const userData = useUserData();\n  const sp = new URLSearchParams();\n\n  // First check that you're signed in and if you are, get a CSRF token.\n  const userSettingsAPIURL = React.useMemo(() => {\n    return userData && userData.isAuthenticated ? \"/api/v1/settings\" : null;\n  }, [userData]);\n  const { data, error } = useSWR<UserSettings>(\n    userSettingsAPIURL,\n    async (url) => {\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(`${response.status} on ${url}`);\n      }\n      return await response.json();\n    }\n  );\n\n  // This is the `?next=` parameter we send into the redirect loop IF you did\n  // not click into this page from an existing one.\n  const defaultNext = `/${locale}/`;\n\n  let next = searchParams.get(\"next\") || defaultNext;\n  if (next.toLowerCase() === window.location.pathname.toLowerCase()) {\n    // It's never OK for the ?next= variable to be to come back here to this page.\n    // Explicitly check that.\n    next = defaultNext;\n  }\n\n  let prefix = \"\";\n  // When doing local development with Yari, the link to authenticate in Kuma\n  // needs to be absolute. And we also need to send the absolute URL as the\n  // `next` query string parameter so Kuma sends us back when the user has\n  // authenticated there.\n  if (\n    process.env.NODE_ENV === \"development\" &&\n    process.env.REACT_APP_KUMA_HOST\n  ) {\n    const combined = new URL(next, window.location.href);\n    next = combined.toString();\n    prefix = `http://${process.env.REACT_APP_KUMA_HOST}`;\n  }\n  sp.set(\"next\", next);\n\n  if (DISABLE_AUTH) {\n    return <AuthDisabled />;\n  }\n\n  return (\n    <>\n      {/* We need to wait for the userData (/api/v1/whoami) because it will\n          determine what we display.\n          We *could* render on the optimism that people most likely will be\n          on this page because they're NOT signed in. But it feels a bit\n          \"ugly\" if a page has to change its mind and rerender something\n          completely different without it being due to a user action.\n      */}\n      {userData ? (\n        userData.isAuthenticated ? (\n          <form\n            className=\"sign-out-form\"\n            method=\"post\"\n            action={`${prefix}/users/fxa/login/logout/`}\n            onSubmit={() => {\n              removeSessionStorageData();\n            }}\n          >\n            {data && data.csrfmiddlewaretoken && (\n              <input\n                type=\"hidden\"\n                name=\"csrfmiddlewaretoken\"\n                value={data.csrfmiddlewaretoken}\n              />\n            )}\n            {/* XXX Here it would be great to link to the account settings page */}\n            <input type=\"hidden\" name=\"next\" value={next} />\n            {error && (\n              <div className=\"notecard negative\">\n                <p>\n                  <strong>Server error</strong> Unable to connect to the server.\n                </p>\n              </div>\n            )}\n            {data && data.csrfmiddlewaretoken && (\n              <button type=\"submit\" className=\"button icon-button outline\">\n                Sign out\n              </button>\n            )}\n          </form>\n        ) : (\n          <>\n            <p>\n              <b>You're not signed in.</b> Yet.\n            </p>\n            <p>\n              <Link to={`/${locale}/signin`}>Click here to sign in</Link>\n            </p>\n          </>\n        )\n      ) : (\n        <Loading />\n      )}\n    </>\n  );\n}\n\nfunction Loading() {\n  return <p style={{ minHeight: 200 }}>Loading...</p>;\n}\n","export function AuthDisabled() {\n  return (\n    <div className=\"notecard warning\">\n      <h4>Authentication disabled</h4>\n      <p>Authentication and the user settings app is currently disabled.</p>\n    </div>\n  );\n}\n"],"sourceRoot":""}