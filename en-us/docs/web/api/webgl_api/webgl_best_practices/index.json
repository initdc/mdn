{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"WebGL best practices","mdn_url":"/en-US/docs/Web/API/WebGL_API/WebGL_best_practices","locale":"en-US","native":"English (US)","sidebarHTML":"\n <ol>\n  <li><a href=\"/en-US/docs/Web/API/WebGL_API\"><strong>WebGL API</strong></a></li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>WebGL tutorial</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Getting_started_with_WebGL\">Getting started with WebGL</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Adding_2D_content_to_a_WebGL_context\">Adding 2D content to a WebGL context</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Using_shaders_to_apply_color_in_WebGL\">Using shaders to apply color in WebGL</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Animating_objects_with_WebGL\">Animating objects with WebGL</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Creating_3D_objects_using_WebGL\">Creating 3D objects using WebGL</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL\">Using textures in WebGL</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Lighting_in_WebGL\">Lighting in WebGL</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Tutorial/Animating_textures_in_WebGL\">Animating textures in WebGL</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Examples and articles</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\">Matrix math for the web</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/WebGL_model_view_projection\">WebGL model view projection</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\">WebGL best practices</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Using_Extensions\">Using WebGL extensions</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/Basic_2D_animation_example\">A basic 2D WebGL animation example</a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL_API/By_example\">WebGL by example</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Interfaces</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/Web/API/WebGLRenderingContext\"><code>WebGLRenderingContext</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGL2RenderingContext\"><code>WebGL2RenderingContext</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLActiveInfo\"><code>WebGLActiveInfo</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLBuffer\"><code>WebGLBuffer</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLContextEvent\"><code>WebGLContextEvent</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLFramebuffer\"><code>WebGLFramebuffer</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLProgram\"><code>WebGLProgram</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLQuery\"><code>WebGLQuery</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLRenderbuffer\"><code>WebGLRenderbuffer</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLSampler\"><code>WebGLSampler</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLShader\"><code>WebGLShader</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLShaderPrecisionFormat\"><code>WebGLShaderPrecisionFormat</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLSync\"><code>WebGLSync</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLTexture\"><code>WebGLTexture</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLTransformFeedback\"><code>WebGLTransformFeedback</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLUniformLocation\"><code>WebGLUniformLocation</code></a></li>\n        <li><a href=\"/en-US/docs/Web/API/WebGLVertexArrayObject\"><code>WebGLVertexArrayObject</code></a></li>\n      </ol>\n    </details>\n  </li>\n\n  <li><strong><a href=\"/en-US/docs/MDN\">Documentation:</a></strong></li>\n  <li class=\"toggle\">\n    <details>\n      <summary>Contribute</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/MDN\">The MDN project</a></li>\n      </ol>\n    </details>\n  </li>\n </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>WebGL is a complicated API, and it's often not obvious what the recommended ways to use it are. This page tackles recommendations across the spectrum of expertise, and not only highlights dos and don'ts, but also details <em>why</em>. You can rely on this document to guide your choice of approach, and ensure you're on the right track no matter what browser or hardware your users run.</p>"}},{"type":"prose","value":{"id":"address_and_eliminate_webgl_errors","title":"Address and eliminate WebGL errors","isH3":false,"content":"<p>Your application should run without generating any WebGL errors (as returned by <code>getError</code>). Every WebGL error is reported in the Web Console as a JavaScript warning with a descriptive message. After too many errors (32 in Firefox), WebGL stops generating descriptive messages, which really hinders debugging.</p>\n<p>The <em>only</em> errors a well-formed page generates are <code>OUT_OF_MEMORY</code> and <code>CONTEXT_LOST</code>.</p>"}},{"type":"prose","value":{"id":"understand_extension_availability","title":"Understand extension availability","isH3":false,"content":"<p>The availability of most WebGL extensions depends on the client system. When using WebGL extensions, if possible, try to make them optional by gracefully adapting to the case there they are not supported.</p>\n<p>These WebGL 1 extensions are universally supported, and can be relied upon to be present:</p>\n<ul>\n  <li>ANGLE_instanced_arrays</li>\n  <li>EXT_blend_minmax</li>\n  <li>OES_element_index_uint</li>\n  <li>OES_standard_derivatives</li>\n  <li>OES_vertex_array_object</li>\n  <li>WEBGL_debug_renderer_info</li>\n  <li>WEBGL_lose_context</li>\n</ul>\n<p><em>(see also: <a href=\"https://kdashg.github.io/misc/webgl/webgl-feature-levels.html\" class=\"external\" rel=\" noopener\">WebGL feature levels and % support</a>)</em></p>\n<p>Consider polyfilling these into WebGLRenderingContext, like: <a href=\"https://github.com/kdashg/misc/blob/tip/webgl/webgl-v1.1.js\" class=\"external\" rel=\" noopener\">https://github.com/kdashg/misc/blob/tip/webgl/webgl-v1.1.js</a></p>"}},{"type":"prose","value":{"id":"understand_system_limits","title":"Understand system limits","isH3":false,"content":"<p>Similarly to extensions, the limits of your system will be different than your clients' systems! Don't assume you can use thirty texture samplers per shader just because it works on your machine!</p>\n<p>The minimum requirements for WebGL are quite low. In practice, effectively all systems support at least the following:</p>\n<pre class=\"notranslate\">MAX_CUBE_MAP_TEXTURE_SIZE: 4096\nMAX_RENDERBUFFER_SIZE: 4096\nMAX_TEXTURE_SIZE: 4096\nMAX_VIEWPORT_DIMS: [4096,4096]\nMAX_VERTEX_TEXTURE_IMAGE_UNITS: 4\nMAX_TEXTURE_IMAGE_UNITS: 8\nMAX_COMBINED_TEXTURE_IMAGE_UNITS: 8\nMAX_VERTEX_ATTRIBS: 16\nMAX_VARYING_VECTORS: 8\nMAX_VERTEX_UNIFORM_VECTORS: 128\nMAX_FRAGMENT_UNIFORM_VECTORS: 64\nALIASED_POINT_SIZE_RANGE: [1,100]\n</pre>\n<p>Your desktop may support 16k textures, or maybe 16 texture units in the vertex shader, but most other systems don't, and content that works for you will not work for them!</p>"}},{"type":"prose","value":{"id":"avoid_invalidating_fbo_attachment_bindings","title":"Avoid invalidating FBO attachment bindings","isH3":false,"content":"<p>Almost any change to an FBO's attachment bindings will invalidate its framebuffer completeness. Set up your hot framebuffers ahead of time.</p>\n<p>In Firefox, setting the pref <code>webgl.perf.max-warnings</code> to <code>-1</code> in about:config will enable performance warnings that include warnings about FB completeness invalidations.</p>"}},{"type":"prose","value":{"id":"avoid_changing_vao_attachments_vertexattribpointer_disableenablevertexattribarray","title":"Avoid changing VAO attachments (vertexAttribPointer, disable/enableVertexAttribArray)","isH3":true,"content":"<p>Drawing from static, unchanging VAOs is faster than mutating the same VAO for every draw call. For unchanged VAOs, browsers can cache the fetch limits, whereas when VAOs change, browsers must revalidate and recalculate limits. The overhead for this is relatively low, but re-using VAOs means fewer <code>vertexAttribPointer</code> calls too, so it's worth doing wherever it's easy.</p>"}},{"type":"prose","value":{"id":"delete_objects_eagerly","title":"Delete objects eagerly","isH3":false,"content":"<p>Don't wait for the garbage collector/cycle collector to realize objects are orphaned and destroy them. Implementations track the liveness of objects, so 'deleting' them at the API level only releases the handle that refers to the actual object. (conceptually releasing the handle's ref-pointer to the object) Only once the object is unused in the implementation is it actually freed. For example, if you never want to access your shader objects directly again, just delete their handles after attaching them to a program object.</p>"}},{"type":"prose","value":{"id":"lose_contexts_eagerly","title":"Lose contexts eagerly","isH3":false,"content":"<p>Consider also eagerly losing WebGL contexts via the <code>WEBGL_lose_context</code> extension when you're definitely done with them and no longer need the target canvas's rendering results. Note that this is not necessary to do when navigating away from a page - don't add an unload event handler just for this purpose.</p>"}},{"type":"prose","value":{"id":"flush_when_expecting_results","title":"Flush when expecting results","isH3":false,"content":"<p>Call <code>flush()</code> when expecting results such as queries, or at completion of a rendering frame.</p>\n<p>Flush tells the implementation to push all pending commands out for execution, flushing them out of the queue, instead of waiting for more commands to enqueue before sending for execution.</p>\n<p>For example, it is possible for the following to never complete without context loss:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>sync <span class=\"token operator\">=</span> <span class=\"token function\">glFenceSync</span><span class=\"token punctuation\">(</span><span class=\"token constant\">GL_SYNC_GPU_COMMANDS_COMPLETE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">glClientWaitSync</span><span class=\"token punctuation\">(</span>sync<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">GL_TIMEOUT_IGNORED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>WebGL doesn't have a SwapBuffers call by default, so a flush can help fill the gap, as well.</p>"}},{"type":"prose","value":{"id":"use_webgl.flush_when_not_using_requestanimationframe","title":"Use <code>webgl.flush()</code> when not using requestAnimationFrame","isH3":true,"content":"<p>When not using RAF, (such as when using RPAF; see below) use <code>webgl.flush()</code> to encourage eager execution of enqueued commands.</p>\n<p>Because RAF is directly followed by the frame boundary, an explicit <code>webgl.flush()</code> isn't really needed with RAF.</p>","titleAsText":"Use webgl.flush() when not using requestAnimationFrame"}},{"type":"prose","value":{"id":"avoid_blocking_api_calls_in_production","title":"Avoid blocking API calls in production","isH3":false,"content":"<p>Certain WebGL entry points - including <code>getError</code> and <code>getParameter</code> - cause synchronous stalls on the calling thread. Even basic requests can take as long as 1ms, but they can take even longer if they need to wait for all graphics work to be completed (with an effect similar to <code>glFinish()</code> in native OpenGL).</p>\n<p>In production code, avoid such entry points, especially on the browser main thread where they can cause the entire page to jank (often including scrolling or even the whole browser).</p>\n<ul>\n  <li>\n    <code>getError()</code>: causes a flush + round-trip to fetch errors from the GPU process).\n    For example, within Firefox, the only time glGetError is checked is after allocations (<code>bufferData</code>, <code>*texImage*</code>, <code>texStorage*</code>) to pick up any GL_OUT_OF_MEMORY errors.\n  </li>\n  <li><code>getShader/ProgramParameter()</code>, <code>getShader/ProgramInfoLog()</code>, other <code>get</code>s on shaders/programs: flush + shader compile + round-trip, if not done after shader compilation is complete. (See also <a href=\"#compile_shaders_and_link_programs_in_parallel\">parallel shader compilation</a> below.)</li>\n  <li><code>get*Parameter()</code> in general: possible flush + round-trip. In some cases, these will be cached to avoid the round-trip, but try to avoid relying on this.</li>\n  <li><code>checkFramebufferStatus()</code>: possible flush + round-trip.</li>\n  <li><code>getBufferSubData()</code>: usual finish + round-trip. (This is okay for READ buffers in conjunction with fences - see <a href=\"#non-blocking_async_data_downloadreadback\">async data readback</a> below.)</li>\n  <li><code>readPixels()</code> to the CPU (i.e. without an UNPACK buffer bound): finish + round-trip. Instead, use GPU-GPU <code>readPixels</code> in conjunction with async data readback.</li>\n</ul>"}},{"type":"prose","value":{"id":"always_enable_vertex_attrib_0_as_an_array","title":"Always enable vertex attrib 0 as an array","isH3":false,"content":"<p>If you draw without vertex attrib 0 enabled as an array, you will force the browser to do complicated emulation when running on desktop OpenGL (such as on macOS). This is because in desktop OpenGL, nothing gets drawn if vertex attrib 0 is not array-enabled. You can use <code>bindAttribLocation</code> to force a vertex attribute to use location 0, and use <code>enableVertexAttribArray(0)</code> to make it array-enabled.</p>"}},{"type":"prose","value":{"id":"estimate_a_per-pixel_vram_budget","title":"Estimate a per-pixel VRAM Budget","isH3":false,"content":"<p>WebGL doesn't offer APIs to query the maximum amount of video memory on the system because such queries are not portable. Still, applications must be conscious of VRAM usage and not just allocate as much as possible.</p>\n<p>One technique pioneered by the Google Maps team is the notion of a <em>per-pixel VRAM budget</em>:</p>\n<p>1) For one system (e.g. a particular desktop / laptop), decide the maximum amount of VRAM your application should use. 2) Compute the number of pixels covered by a maximized browser window. E.g. <code>(window.innerWidth * devicePixelRatio) * (window.innerHeight * window.devicePixelRatio)</code> 3) The per-pixel VRAM budget is (1) divided by (2), and is a constant.</p>\n<p>This constant should <em>generally</em> be portable among systems. Mobile devices typically have smaller screens than powerful desktop machines with large monitors. Re-compute this constant on a few target systems to get a reliable estimate.</p>\n<p>Now adjust all internal caching in the application (WebGLBuffers, WebGLTextures, etc.) to obey a maximum size, computed by this constant multiplied by the number of pixels covered by the <em>current</em> browser window. This requires estimating the number of bytes consumed by each texture, for example. The cap also must typically be updated as the browser window resizes, and older resources above the limit must be purged.</p>\n<p>Keeping the application's VRAM usage under this cap will help to avoid out-of-memory errors and associated instability.</p>"}},{"type":"prose","value":{"id":"consider_rendering_to_a_smaller_back_buffer","title":"Consider rendering to a smaller back buffer","isH3":false,"content":"<p>A common (and easy) way to trade off quality for speed is rendering into a smaller back buffer, and upscaling the result. Consider reducing canvas.width and height and keeping canvas.style.width and height at a constant size.</p>"}},{"type":"prose","value":{"id":"batch_draw_calls","title":"Batch draw calls","isH3":false,"content":"<p>\"Batching\" draw calls into fewer, larger draw calls will generally improve performance. If you have 1000 sprites to paint, try to do it as a single drawArrays() or drawElements() call.</p>\n<p>It's common to use \"degenerate triangles\" if you need to draw discontinuous objects as a single drawArrays(TRIANGLE_STRIP) call. Degenerate triangles are triangles with no area, therefore any triangle where more than one point is in the same exact location. These triangles are effectively skipped, which lets you start a new triangle strip unattached to your previous one, without having to split into multiple draw calls.</p>\n<p>Another important method for batching is texture atlasing, where multiple images are placed into a single texture, often like a checkerboard. Since you need to split draw call batches to change textures, texture atlasing lets you combine more draw calls into fewer, bigger batches. See <a href=\"https://webglsamples.org/sprites/readme.html\" class=\"external\" rel=\" noopener\">this example</a> demonstrating how to combine even sprites referencing multiple texture atlases into a single draw call.</p>"}},{"type":"prose","value":{"id":"avoid_ifdef_gl_es","title":"Avoid \"#ifdef GL_ES\"","isH3":false,"content":"<p>You should never use <code>#ifdef GL_ES</code> in your WebGL shaders; this condition is always true in WebGL. Although some early examples used this, it's not necessary.</p>"}},{"type":"prose","value":{"id":"prefer_doing_work_in_the_vertex_shader","title":"Prefer doing work in the vertex shader","isH3":false,"content":"<p>Do as much work as you can in the vertex shader, rather than in the fragment shader. This is because per draw call, fragment shaders generally run many more times than vertex shaders. Any calculation that can be done on the vertices and then just interpolated among fragments (via <code>varying</code>s) is a performance boon. (The interpolation of varyings is very cheap, and is done automatically for you through the fixed functionality rasterization phase of the graphics pipeline.)</p>\n<p>For example, a simple animation of a textured surface can be achieved through a time-dependent transformation of texture coordinates. (The simplest case being adding a uniform vector to the texture coordinates attribute vector) If visually acceptable, one can transform the texture coordinates in the vertex shader rather than in the fragment shader, to get better performance.</p>\n<p>One common trade-off is to some lighting calculations per-vertex instead of per-fragment (pixel). In some cases, especially with simple models or dense vertices, this looks good enough.</p>\n<p>The inversion of this is if a model has more vertices than pixels in the rendered output. However, LOD meshes is usually the answer to this problem, rarely moving work from the vertex <em>to</em> the fragment shader.</p>"}},{"type":"prose","value":{"id":"compile_shaders_and_link_programs_in_parallel","title":"Compile Shaders and Link Programs in parallel","isH3":false,"content":"<p>It's tempting to compile shaders and link programs serially, but many browsers can compile and link in parallel on background threads.</p>\n<p>Instead of:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">compileOnce</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">gl<span class=\"token punctuation\">,</span> shader</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>shader<span class=\"token punctuation\">.</span>compiled<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">compileShader</span><span class=\"token punctuation\">(</span>shader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  shader<span class=\"token punctuation\">.</span>compiled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>vs<span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">,</span> prog<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> programs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">compileOnce</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> vs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">compileOnce</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">linkProgram</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramParameter</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">LINK_STATUS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Link failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramInfoLog</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">vs info-log: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">fs info-log: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Consider:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">compileOnce</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">gl<span class=\"token punctuation\">,</span> shader</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>shader<span class=\"token punctuation\">.</span>compiled<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">compileShader</span><span class=\"token punctuation\">(</span>shader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  shader<span class=\"token punctuation\">.</span>compiled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>vs<span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">,</span> prog<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> programs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">compileOnce</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> vs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">compileOnce</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>vs<span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">,</span> prog<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> programs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">linkProgram</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>vs<span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">,</span> prog<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> programs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramParameter</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">LINK_STATUS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Link failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramInfoLog</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">vs info-log: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">fs info-log: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"prefer_khr_parallel_shader_compile","title":"Prefer KHR_parallel_shader_compile","isH3":false,"content":"<p>While we've described a pattern to allow browsers to compile and link in parallel, normally checking <code>COMPILE_STATUS</code> or <code>LINK_STATUS</code> blocks until the compile or link completes. In browsers where it's available, the <a href=\"https://www.khronos.org/registry/webgl/extensions/KHR_parallel_shader_compile/\" class=\"external\" rel=\" noopener\">KHR_parallel_shader_compile</a> extension provides a <em>non-blocking</em> <code>COMPLETION_STATUS</code> query. Prefer to enable and use this extension.</p>\n<p>Example usage:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>ext <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">getExtension</span><span class=\"token punctuation\">(</span><span class=\"token string\">'KHR_parallel_shader_compile'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">compileProgram</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">compileProgram</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">attachShader</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">,</span> vs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">attachShader</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">linkProgram</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Store program in your data structure.</span>\n<span class=\"token comment\">// Later, for example the next frame:</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramParameter</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">,</span> ext<span class=\"token punctuation\">.</span><span class=\"token constant\">COMPLETION_STATUS_KHR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Check program link status; if OK, use and draw with it.</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Program linking is synchronous.</span>\n  <span class=\"token comment\">// Check program link status; if OK, use and draw with it.</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This technique may not work in all applications, for example those which require programs to be immediately available for rendering. Still, consider how variations may work.</p>"}},{"type":"prose","value":{"id":"dont_check_shader_compile_status_unless_linking_fails","title":"Don't check shader compile status unless linking fails","isH3":false,"content":"<p>There are very few errors that are guaranteed to cause shader compilation failure, but cannot be deferred to link time. The <a href=\"https://www.khronos.org/registry/OpenGL/specs/es/3.0/GLSL_ES_Specification_3.00.pdf\" class=\"external\" rel=\" noopener\">ESSL3 spec</a> says this under \"Error Handling\":</p>\n<blockquote>\n  <p>The implementation should report errors as early a possible but in any case must satisfy the following:</p>\n  <ul>\n    <li>All lexical, grammatical and semantic errors must have been detected following a call to glLinkProgram</li>\n    <li>Errors due to mismatch between the vertex and fragment shader (link errors) must have been detected following a call to glLinkProgram</li>\n    <li>Errors due to exceeding resource limits must have been detected following any draw call or a call to glValidateProgram</li>\n    <li>A call to glValidateProgram must report all errors associated with a program object given the current GL state.</li>\n  </ul>\n  <p>The allocation of tasks between the compiler and linker is implementation dependent. Consequently there are many errors which may be detected either at compile or link time, depending on the implementation.</p>\n</blockquote>\n<p>Additionally, querying compile status is a synchronous call, which breaks pipelining.</p>\n<p>Instead of:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>gl<span class=\"token punctuation\">.</span><span class=\"token function\">compileShader</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderParameter</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">COMPILE_STATUS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">vs compile failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">compileShader</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderParameter</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">COMPILE_STATUS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">fs compile failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">linkProgram</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramParameter</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">LINK_STATUS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Link failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramInfoLog</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Consider:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>gl<span class=\"token punctuation\">.</span><span class=\"token function\">compileShader</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">compileShader</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">linkProgram</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramParameter</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">LINK_STATUS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Link failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getProgramInfoLog</span><span class=\"token punctuation\">(</span>prog<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">vs info-log: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>vs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">fs info-log: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gl<span class=\"token punctuation\">.</span><span class=\"token function\">getShaderInfoLog</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"be_precise_with_glsl_precision_annotations","title":"Be precise with GLSL precision annotations","isH3":false,"content":"<p>If you expect to pass an essl300 <code>int</code> between shaders, and you need it to have 32-bits, you <em>must</em> use <code>highp</code> or you will have portability problems. (Works on Desktop, not on Android)</p>\n<p>If you have a float texture, iOS requires that you use <code>highp sampler2D foo;</code>, or it will very painfully give you <code>lowp</code> texture samples! (+/-2.0 max is probably not good enough for you)</p>"}},{"type":"prose","value":{"id":"implicit_defaults","title":"Implicit defaults","isH3":true,"content":"<p>The vertex language has the following predeclared globally scoped default precision statements:</p>\n<pre class=\"notranslate\">precision highp float;\nprecision highp int;\nprecision lowp sampler2D;\nprecision lowp samplerCube;\n</pre>\n<p>The fragment language has the following predeclared globally scoped default precision statements:</p>\n<pre class=\"notranslate\">precision mediump int;\nprecision lowp sampler2D;\nprecision lowp samplerCube;\n</pre>"}},{"type":"prose","value":{"id":"in_webgl_1_highp_float_support_is_optional_in_fragment_shaders","title":"In WebGL 1, \"highp float\" support is optional in fragment shaders","isH3":true,"content":"<p>Using <code>highp</code> precision unconditionally in fragment shaders will prevent your content from working on some older mobile hardware.</p>\n<p>While you can use <code>mediump float</code> instead, but be aware that this often results in corrupted rendering due to lack of precision (particularly mobile systems) though the corruption is not going to be visible on a typical desktop computer.</p>\n<p>If you know your precision requirements, <code>getShaderPrecisionFormat()</code> will tell you what the system supports.</p>\n<p>If <code>highp float</code> is available, <code>GL_FRAGMENT_PRECISION_HIGH</code> will be defined as <code>1</code>.</p>\n<p>A good pattern for \"always give me the highest precision\":</p>\n<pre class=\"notranslate\">#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n</pre>"}},{"type":"prose","value":{"id":"essl100_minimum_requirements_webgl_1","title":"ESSL100 minimum requirements (WebGL 1)","isH3":true,"content":"<table>\n  <thead>\n    <tr>\n      <th><code>float</code></th>\n      <th>think</th>\n      <th>range</th>\n      <th>min above zero</th>\n      <th>precision</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>highp</code></td>\n      <td>float24*</td>\n      <td>(-2^62, 2^62)</td>\n      <td>2^-62</td>\n      <td>2^-16 relative</td>\n    </tr>\n    <tr>\n      <td><code>mediump</code></td>\n      <td>IEEE float16</td>\n      <td>(-2^14, 2^14)</td>\n      <td>2^-14</td>\n      <td>2^-10 relative</td>\n    </tr>\n    <tr>\n      <td><code>lowp</code></td>\n      <td>10-bit signed fixed</td>\n      <td>(-2, 2)</td>\n      <td>2^-8</td>\n      <td>2^-8 absolute</td>\n    </tr>\n  </tbody>\n</table>\n<table>\n  <thead>\n    <tr>\n      <th><code>int</code></th>\n      <th>think</th>\n      <th>range</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>highp</code></td>\n      <td>int17</td>\n      <td>(-2^16, 2^16)</td>\n    </tr>\n    <tr>\n      <td><code>mediump</code></td>\n      <td>int11</td>\n      <td>(-2^10, 2^10)</td>\n    </tr>\n    <tr>\n      <td><code>lowp</code></td>\n      <td>int9</td>\n      <td>(-2^8, 2^8)</td>\n    </tr>\n  </tbody>\n</table>\n<p><em>*float24: sign bit, 7-bit for exponent, 16-bit for mantissa.</em></p>"}},{"type":"prose","value":{"id":"essl300_minimum_requirements_webgl_2","title":"ESSL300 minimum requirements (WebGL 2)","isH3":true,"content":"<table>\n  <thead>\n    <tr>\n      <th><code>float</code></th>\n      <th>think</th>\n      <th>range</th>\n      <th>min above zero</th>\n      <th>precision</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>highp</code></td>\n      <td>IEEE float32</td>\n      <td>(-2^126, 2^127)</td>\n      <td>2^-126</td>\n      <td>2^-24 relative</td>\n    </tr>\n    <tr>\n      <td><code>mediump</code></td>\n      <td>IEEE float16</td>\n      <td>(-2^14, 2^14)</td>\n      <td>2^-14</td>\n      <td>2^-10 relative</td>\n    </tr>\n    <tr>\n      <td><code>lowp</code></td>\n      <td>10-bit signed fixed</td>\n      <td>(-2, 2)</td>\n      <td>2^-8</td>\n      <td>2^-8 absolute</td>\n    </tr>\n  </tbody>\n</table>\n<table>\n  <thead>\n    <tr>\n      <th><code>(u)int</code></th>\n      <th>think</th>\n      <th><code>int</code> range</th>\n      <th><code>unsigned int</code> range</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>highp</code></td>\n      <td>(u)int32</td>\n      <td>[-2^31, 2^31]</td>\n      <td>[0, 2^32]</td>\n    </tr>\n    <tr>\n      <td><code>mediump</code></td>\n      <td>(u)int16</td>\n      <td>[-2^15, 2^15]</td>\n      <td>[0, 2^16]</td>\n    </tr>\n    <tr>\n      <td><code>lowp</code></td>\n      <td>(u)int9</td>\n      <td>[-2^8, 2^8]</td>\n      <td>[0, 2^9]</td>\n    </tr>\n  </tbody>\n</table>"}},{"type":"prose","value":{"id":"prefer_builtins_instead_of_building_your_own","title":"Prefer builtins instead of building your own","isH3":false,"content":"<p>Prefer builtins like <code>dot</code>, <code>mix</code>, and <code>normalize</code>. At best, custom implementations might run as fast as the builtins they replace, but don't expect them to. Hardware often has hyper-optimized or even specialized instructions for builtins, and the compiler can't reliably replace your custom builtin-replacements with the special builtin codepaths.</p>"}},{"type":"prose","value":{"id":"use_mipmaps_for_any_texture_youll_see_in_3d","title":"Use mipmaps for any texture you'll see in 3d","isH3":false,"content":"<p>When in doubt, call <code>generateMipmaps()</code> after texture uploads. Mipmaps are cheap on memory (only 30% overhead) while providing often-large performance advantages when textures are \"zoomed out\" or generally downscaled in the distance in 3d, or even for cube-maps!</p>\n<p>It's quicker to sample from smaller texture images due to better inherent texture fetch cache locality: Zooming out on a non-mipmapped texture ruins texture fetch cache locality, because neighboring pixels no longer sample from neighboring texels!</p>\n<p>However, for 2d resources that are never \"zoomed out\", don't pay the 30% memory surcharge for mipmaps:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> tex <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">createTexture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">bindTexture</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">TEXTURE_2D</span><span class=\"token punctuation\">,</span> tex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngl<span class=\"token punctuation\">.</span><span class=\"token function\">texParameterf</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">TEXTURE_2D</span><span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">TEXTURE_MIN_FILTER</span><span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">LINEAR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Defaults to NEAREST_MIPMAP_LINEAR, for mipmapping!</span>\n</code></pre></div>\n<p>(In WebGL 2, you should just use <code>texStorage</code> with <code>levels=1</code>)</p>\n<p>One caveat: <code>generateMipmaps</code> only works if you would be able to render into the texture if you attached it to a framebuffer. (The spec calls this \"color-renderable formats\") For example, if a system supports float-textures but not render-to-float, <code>generateMipmaps</code> will fail for float formats.</p>"}},{"type":"prose","value":{"id":"dont_assume_you_can_render_into_float_textures","title":"Don't assume you can render into float textures","isH3":false,"content":"<p>There are many, many systems that support RGBA32F textures, but if you attach one to a framebuffer you'll get <code>FRAMEBUFFER_INCOMPLETE_ATTACHMENT</code> from <code>checkFramebufferStatus()</code>. It may work on your system, but <em>most</em> mobile systems will not support it!</p>\n<p>On WebGL 1, use the <code>EXT_color_buffer_half_float</code> and <code>WEBGL_color_buffer_float</code> extensions to check for render-to-float-texture support for float16 and float32 respectively.</p>\n<p>On WebGL 2, <code>EXT_color_buffer_float</code> checks for render-to-float-texture support for both float32 and float16. <code>EXT_color_buffer_half_float</code> is present on systems which only support rendering to float16 textures.</p>"}},{"type":"prose","value":{"id":"render-to-float32_doesnt_imply_float32-blending!","title":"Render-to-float32 doesn't imply float32-blending!","isH3":true,"content":"<p>It may work on your system, but on many others it won't. Avoid it if you can. Check for the <code>EXT_float_blend</code> extension to check for support.</p>\n<p>Float16-blending is always supported.</p>"}},{"type":"prose","value":{"id":"some_formats_e.g._rgb_may_be_emulated","title":"Some formats (e.g. RGB) may be emulated","isH3":false,"content":"<p>A number of formats (particularly three-channel formats) are emulated. For example, RGB32F is often actually RGBA32F, and Luminance8 may actually be RGBA8. RGB8 in particular is often surprisingly slow, as masking out the alpha channel and/or patching blend functions has fairly high overhead. Prefer to use RGBA8 and ignore the alpha yourself for better performance.</p>"}},{"type":"prose","value":{"id":"avoid_alphafalse_which_can_be_expensive","title":"Avoid alpha:false, which can be expensive","isH3":false,"content":"<p>Specifying <code>alpha:false</code> during context creation causes the browser to composite the WebGL-rendered canvas as though it were opaque, ignoring any alpha values the application writes in its fragment shader. On some platforms, this capability unfortunately comes at a significant performance cost. The RGB back buffer may have to be emulated on top of an RGBA surface, and there are relatively few techniques available in the OpenGL API for making it appear to the application that an RGBA surface has no alpha channel. <a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=1045643\" class=\"external\" rel=\" noopener\">It has been found</a> that all of these techniques have approximately equal performance impact on affected platforms.</p>\n<p>Most applications, even those requiring alpha blending, can be structured to produce <code>1.0</code> for the alpha channel. The primary exception is any application requiring destination alpha in the blending function. If feasible, it is recommended to do this rather than using <code>alpha:false</code>.</p>"}},{"type":"prose","value":{"id":"consider_compressed_texture_formats","title":"Consider compressed texture formats","isH3":false,"content":"<p>While JPG and PNG are generally smaller over-the-wire, GPU compressed texture formats are smaller on in GPU memory, and are faster to sample from. (This reduces texture memory bandwidth, which is precious on mobile) However, compressed texture formats have worse quality than JPG, and are generally only acceptable for colors (not e.g. normals or coordinates).</p>\n<p>Unfortunately, there's no single universally supported format. Every system has at least one of the following though:</p>\n<ul>\n  <li>WEBGL_compressed_texture_s3tc (desktop)</li>\n  <li>WEBGL_compressed_texture_etc1 (Android)</li>\n  <li>WEBGL_compressed_texture_pvrtc (iOS)</li>\n</ul>\n<p>WebGL 2 has universal support by combining:</p>\n<ul>\n  <li>WEBGL_compressed_texture_s3tc (desktop)</li>\n  <li>WEBGL_compressed_texture_etc (mobile)</li>\n</ul>\n<p>WEBGL_compressed_texture_astc has both higher quality and/or higher compression, but is only supported on newer hardware.</p>"}},{"type":"prose","value":{"id":"basis_universal_texture_compression_formatlibrary","title":"Basis Universal texture compression format/library","isH3":true,"content":"<p>Basis Universal solves several of the issues mentioned above. It offers a way to support all common compressed texture formats with a single compressed texture file, through a JavaScript library that efficiently converts formats at load time. It also adds additional compression that makes Basis Universal compressed texture files much smaller than regular compressed textures over-the-wire, more comparable to JPEG.</p>\n<p><a href=\"https://github.com/BinomialLLC/basis_universal/blob/master/webgl/README.md\" class=\"external\" rel=\" noopener\">https://github.com/BinomialLLC/basis_universal/blob/master/webgl/README.md</a></p>"}},{"type":"prose","value":{"id":"memory_usage_of_depth_and_stencil_formats","title":"Memory usage of depth and stencil formats","isH3":false,"content":"<p>Depth and stencil attachments and formats are actually inseparable on many devices. You may ask for DEPTH_COMPONENT24 or STENCIL_INDEX8, but you're often getting D24X8 and X24S8 32bpp formats behind the scenes. Assume that the memory usage of depth and stencil formats is rounded up to the nearest four bytes.</p>"}},{"type":"prose","value":{"id":"teximagetexsubimage_uploads_esp._videos_can_cause_pipeline_flushes","title":"texImage/texSubImage uploads (esp. videos) can cause pipeline flushes","isH3":false,"content":"<p>Most texture uploads from DOM elements will incur a processing pass that will temporarily switch GL Programs internally, causing a pipeline flush. (Pipelines are formalized explicitly in Vulkan[<a href=\"https://www.khronos.org/registry/vulkan/specs/1.2/html/chap9.html#VkGraphicsPipelineCreateInfo\" class=\"external\" rel=\" noopener\">1</a>] et al, but are implicit behind-the-scenes in OpenGL and WebGL. Pipelines are more or less the tuple of shader program, depth/stencil/multisample/blend/rasterization state)</p>\n<p>In WebGL:</p>\n<pre class=\"notranslate\">    …\n    useProgram(prog1)\n&lt;pipeline flush&gt;\n    bindFramebuffer(target)\n    drawArrays()\n    bindTexture(webgl_texture)\n    texImage2D(HTMLVideoElement)\n    drawArrays()\n    …\n</pre>\n<p>Behind the scenes in the browser:</p>\n<pre class=\"notranslate\">    …\n    useProgram(prog1)\n&lt;pipeline flush&gt;\n    bindFramebuffer(target)\n    drawArrays()\n    bindTexture(webgl_texture)\n    -texImage2D(HTMLVideoElement):\n        +useProgram(_internal_tex_tranform_prog)\n&lt;pipeline flush&gt;\n        +bindFramebuffer(webgl_texture._internal_framebuffer)\n        +bindTexture(HTMLVideoElement._internal_video_tex)\n        +drawArrays() // y-flip/colorspace-transform/alpha-(un)premultiply\n        +bindTexture(webgl_texture)\n        +bindFramebuffer(target)\n        +useProgram(prog1)\n&lt;pipeline flush&gt;\n    drawArrays()\n    …\n</pre>\n<p>Prefer doing uploads before starting drawing, or at least between pipelines:</p>\n<p>In WebGL:</p>\n<pre class=\"notranslate\">    …\n    bindTexture(webgl_texture)\n    texImage2D(HTMLVideoElement)\n    useProgram(prog1)\n&lt;pipeline flush&gt;\n    bindFramebuffer(target)\n    drawArrays()\n    bindTexture(webgl_texture)\n    drawArrays()\n    …\n</pre>\n<p>Behind the scenes in the browser:</p>\n<pre class=\"notranslate\">    …\n    bindTexture(webgl_texture)\n    -texImage2D(HTMLVideoElement):\n        +useProgram(_internal_tex_tranform_prog)\n&lt;pipeline flush&gt;\n        +bindFramebuffer(webgl_texture._internal_framebuffer)\n        +bindTexture(HTMLVideoElement._internal_video_tex)\n        +drawArrays() // y-flip/colorspace-transform/alpha-(un)premultiply\n        +bindTexture(webgl_texture)\n        +bindFramebuffer(target)\n    useProgram(prog1)\n&lt;pipeline flush&gt;\n    bindFramebuffer(target)\n    drawArrays()\n    bindTexture(webgl_texture)\n    drawArrays()\n    …\n</pre>"}},{"type":"prose","value":{"id":"use_texstorage_to_create_textures","title":"Use texStorage to create textures","isH3":false,"content":"<p>The WebGL 2.0 <code>texImage*</code> API lets you define each mip level independently and at any size, even the mis-matching mips sizes are not an error until draw time which means there is no way the driver can actually prepare the texture in GPU memory until the first time the texture is drawn.</p>\n<p>Further, some drivers might unconditionally allocate the whole mip-chain (+30% memory!) even if you only want a single level.</p>\n<p>So, prefer <code>texStorage</code>+<code>texSubImage</code> for textures in WebGL 2</p>"}},{"type":"prose","value":{"id":"use_invalidateframebuffer","title":"Use invalidateFramebuffer","isH3":false,"content":"<p>Storing data that you won't use again can have high cost, particularly on tiled-rendering GPUs common on mobile. When you're done with the contents of a framebuffer attachment, use WebGL 2.0's <code>invalidateFramebuffer</code> to discard the data, instead of leaving the driver to waste time storing the data for later use. DEPTH/STENCIL and/or multisampled attachments in particular are great candidates for <code>invalidateFramebuffer</code>.</p>"}},{"type":"prose","value":{"id":"use_non-blocking_async_data_readback","title":"Use non-blocking async data readback","isH3":false,"content":"<p>Operations like <code>readPixels</code> and <code>getBufferSubData</code> are typically synchronous, but using the same APIs, non-blocking, asynchronous data readback can be achieved. The approach in WebGL 2 is analogous to the approach in OpenGL: <a href=\"https://kdashg.github.io/misc/async-gpu-downloads.html\" class=\"external\" rel=\" noopener\">Async downloads in blocking APIs</a></p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">clientWaitAsync</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">gl<span class=\"token punctuation\">,</span> sync<span class=\"token punctuation\">,</span> flags<span class=\"token punctuation\">,</span> interval_ms</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">clientWaitSync</span><span class=\"token punctuation\">(</span>sync<span class=\"token punctuation\">,</span> flags<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">===</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">WAIT_FAILED</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">===</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">TIMEOUT_EXPIRED</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">,</span> interval_ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getBufferSubDataAsync</span><span class=\"token punctuation\">(</span>\n    gl<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">,</span> srcByteOffset<span class=\"token punctuation\">,</span> dstBuffer<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">/* optional */</span> dstOffset<span class=\"token punctuation\">,</span> <span class=\"token comment\">/* optional */</span> length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sync <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">fenceSync</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">SYNC_GPU_COMMANDS_COMPLETE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> <span class=\"token function\">clientWaitAsync</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> sync<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">deleteSync</span><span class=\"token punctuation\">(</span>sync<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">bindBuffer</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">getBufferSubData</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> srcByteOffset<span class=\"token punctuation\">,</span> dstBuffer<span class=\"token punctuation\">,</span> dstOffset<span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">bindBuffer</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> dest<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">readPixelsAsync</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">gl<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> dest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> buf <span class=\"token operator\">=</span> gl<span class=\"token punctuation\">.</span><span class=\"token function\">createBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">bindBuffer</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">PIXEL_PACK_BUFFER</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">bufferData</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">PIXEL_PACK_BUFFER</span><span class=\"token punctuation\">,</span> dest<span class=\"token punctuation\">.</span>byteLength<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">STREAM_READ</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">readPixels</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">bindBuffer</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">.</span><span class=\"token constant\">PIXEL_PACK_BUFFER</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> <span class=\"token function\">getBufferSubDataAsync</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">.</span><span class=\"token constant\">PIXEL_PACK_BUFFER</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  gl<span class=\"token punctuation\">.</span><span class=\"token function\">deleteBuffer</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> dest<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"devicepixelratio_and_high-dpi_rendering","title":"<code>devicePixelRatio</code> and high-dpi rendering","isH3":true,"content":"<p>Handling <code>devicePixelRatio !== 1.0</code> is tricky. While the common approach is to set <code>canvas.width = width * devicePixelRatio</code>, this will cause moire artifacts with non-integer values of <code>devicePixelRatio</code>, as is common with UI scaling on Windows, as well as zooming on all platforms.</p>\n<p>Instead, we can use non-integer values for CSS's <code>top</code>/<code>bottom</code>/<code>left</code>/<code>right</code> to fairly reliably 'pre-snap' our canvas to whole integer device coordinates.</p>\n<p>Demo: <a href=\"https://kdashg.github.io/misc/webgl/device-pixel-presnap.html\" class=\"external\" rel=\" noopener\">Device pixel presnap</a></p>","titleAsText":"devicePixelRatio and high-dpi rendering"}},{"type":"prose","value":{"id":"resizeobserver_and_device-pixel-content-box","title":"ResizeObserver and 'device-pixel-content-box'","isH3":true,"content":"<p>On supporting browsers (Chromium?), <code>ResizeObserver</code> can be used with <code>'device-pixel-content-box'</code> to request a callback that includes the true device pixel size of an element. This can be used to build an async-but-accurate function:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span>getDevicePixelSize <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>getDevicePixelSize <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">elem</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn_resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResizeObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entries</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> cur <span class=\"token keyword\">of</span> entries<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> dev_size <span class=\"token operator\">=</span> cur<span class=\"token punctuation\">.</span>devicePixelContentBoxSize<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n               <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> dev_size<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>inlineSize<span class=\"token punctuation\">,</span>\n               <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> dev_size<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>blockSize<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">fn_resolve</span><span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            observer<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">}</span>\n         <span class=\"token keyword\">throw</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">device-pixel-content-box not observed for elem </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>elem<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">box</span><span class=\"token operator\">:</span> <span class=\"token string\">'device-pixel-content-box'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Please refer to <a href=\"https://www.w3.org/TR/resize-observer/#resize-observer-interface\" class=\"external\" rel=\" noopener\">the specification</a> for more details.</p>"}},{"type":"prose","value":{"id":"imagebitmap_creation","title":"ImageBitmap creation","isH3":false,"content":"<p>Using the <a href=\"https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#imagebitmapoptions\" class=\"external\" rel=\" noopener\">ImageBitmapOptions dictionary</a> is essential for properly preparing textures for upload to WebGL, but unfortunately there's no obvious way to query exactly which dictionary members are supported by a given browser.</p>\n<p><a href=\"https://jsfiddle.net/ptkyewhx/\" class=\"external\" rel=\" noopener\">This JSFiddle</a> illustrates how to determine which dictionary members a given browser supports.</p>"}}],"toc":[{"text":"Address and eliminate WebGL errors","id":"address_and_eliminate_webgl_errors"},{"text":"Understand extension availability","id":"understand_extension_availability"},{"text":"Understand system limits","id":"understand_system_limits"},{"text":"Avoid invalidating FBO attachment bindings","id":"avoid_invalidating_fbo_attachment_bindings"},{"text":"Delete objects eagerly","id":"delete_objects_eagerly"},{"text":"Lose contexts eagerly","id":"lose_contexts_eagerly"},{"text":"Flush when expecting results","id":"flush_when_expecting_results"},{"text":"Avoid blocking API calls in production","id":"avoid_blocking_api_calls_in_production"},{"text":"Always enable vertex attrib 0 as an array","id":"always_enable_vertex_attrib_0_as_an_array"},{"text":"Estimate a per-pixel VRAM Budget","id":"estimate_a_per-pixel_vram_budget"},{"text":"Consider rendering to a smaller back buffer","id":"consider_rendering_to_a_smaller_back_buffer"},{"text":"Batch draw calls","id":"batch_draw_calls"},{"text":"Avoid \"#ifdef GL_ES\"","id":"avoid_ifdef_gl_es"},{"text":"Prefer doing work in the vertex shader","id":"prefer_doing_work_in_the_vertex_shader"},{"text":"Compile Shaders and Link Programs in parallel","id":"compile_shaders_and_link_programs_in_parallel"},{"text":"Prefer KHR_parallel_shader_compile","id":"prefer_khr_parallel_shader_compile"},{"text":"Don't check shader compile status unless linking fails","id":"dont_check_shader_compile_status_unless_linking_fails"},{"text":"Be precise with GLSL precision annotations","id":"be_precise_with_glsl_precision_annotations"},{"text":"Prefer builtins instead of building your own","id":"prefer_builtins_instead_of_building_your_own"},{"text":"Use mipmaps for any texture you'll see in 3d","id":"use_mipmaps_for_any_texture_youll_see_in_3d"},{"text":"Don't assume you can render into float textures","id":"dont_assume_you_can_render_into_float_textures"},{"text":"Some formats (e.g. RGB) may be emulated","id":"some_formats_e.g._rgb_may_be_emulated"},{"text":"Avoid alpha:false, which can be expensive","id":"avoid_alphafalse_which_can_be_expensive"},{"text":"Consider compressed texture formats","id":"consider_compressed_texture_formats"},{"text":"Memory usage of depth and stencil formats","id":"memory_usage_of_depth_and_stencil_formats"},{"text":"texImage/texSubImage uploads (esp. videos) can cause pipeline flushes","id":"teximagetexsubimage_uploads_esp._videos_can_cause_pipeline_flushes"},{"text":"Use texStorage to create textures","id":"use_texstorage_to_create_textures"},{"text":"Use invalidateFramebuffer","id":"use_invalidateframebuffer"},{"text":"Use non-blocking async data readback","id":"use_non-blocking_async_data_readback"},{"text":"ImageBitmap creation","id":"imagebitmap_creation"}],"summary":"WebGL is a complicated API, and it's often not obvious what the recommended ways to use it are. This page tackles recommendations across the spectrum of expertise, and not only highlights dos and don'ts, but also details why. You can rely on this document to guide your choice of approach, and ensure you're on the right track no matter what browser or hardware your users run.","popularity":0.0015,"modified":"2022-09-09T05:19:45.000Z","other_translations":[{"title":"WebGL best practices","locale":"ja","native":"日本語"},{"title":"WebGL best practices","locale":"ko","native":"한국어"},{"title":"Лучшие практики WebGL","locale":"ru","native":"Русский"},{"title":"WebGL best practices","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"en-us/web/api/webgl_api/webgl_best_practices","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/web/api/webgl_api/webgl_best_practices/index.md","last_commit_url":"https://github.com/mdn/content/commit/f7dae62645a2c735ed6f6ed63f664bf279fdfc4b","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Web","title":"Web technology for developers"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/WebGL_API","title":"WebGL: 2D and 3D graphics for the web"},{"uri":"/en-US/docs/Web/API/WebGL_API/WebGL_best_practices","title":"WebGL best practices"}],"pageTitle":"WebGL best practices - Web APIs | MDN","noIndexing":false}}