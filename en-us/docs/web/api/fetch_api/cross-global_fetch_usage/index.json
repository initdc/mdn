{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Cross-global fetch usage","mdn_url":"/en-US/docs/Web/API/Fetch_API/Cross-global_fetch_usage","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/Fetch_API\">Fetch API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Guides</summary><ol><li><a href=\"/en-US/docs/Web/API/Fetch_API/Using_Fetch\">Using the Fetch API</a></li><li><a href=\"/en-US/docs/Web/API/Fetch_API/Basic_concepts\">Fetch basic concepts</a></li><li><a href=\"/en-US/docs/Web/API/Fetch_API/Cross-global_fetch_usage\">Cross-global fetch usage</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/Headers\"><code>Headers</code></a></li><li><a href=\"/en-US/docs/Web/API/Request\"><code>Request</code></a></li><li><a href=\"/en-US/docs/Web/API/Response\"><code>Response</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Methods</summary><ol><li><a href=\"/en-US/docs/Web/API/fetch\"><code>fetch()</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>This article explains an edge case that occurs with fetch (and potentially other APIs exhibiting the same kind of resource retrieval behavior). When a cross-origin fetch involving a relative URL is initiated from an <a href=\"/en-US/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code></a>, the relative URL used to be resolved against the current global location, rather than the iframe's location.</p>"}},{"type":"prose","value":{"id":"the_edge_case","title":"The edge case","isH3":false,"content":"<p>Many sites will never come up against this edge case. To see it:</p>\n<ul>\n  <li>You need a same-origin iframe</li>\n  <li>That same-origin iframe needs to have a location with a different base URL</li>\n  <li>You have to use the fetch function cross-global, e.g. <code>frame.contentWindow.fetch()</code></li>\n  <li>The URL passed to fetch needs to be relative</li>\n</ul>"}},{"type":"prose","value":{"id":"the_problem","title":"The problem","isH3":false,"content":"<p>In the past we would resolve the relative URL against the current global, for example:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> absolute <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>relative<span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>This is not a problem as such. It is just that different APIs that exhibit this kind of behavior were doing it inconsistently with the behavior defined in the spec, which could lead to problems further down the line.</p>"}},{"type":"prose","value":{"id":"the_solution","title":"The solution","isH3":false,"content":"<p>In Firefox 60 onwards, Mozilla resolves the relative URL against the global that owns the <code>fetch()</code> function being used (see <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1432272\" class=\"external\" rel=\" noopener\">bug&nbsp;1432272</a>). So in the case described above, it is resolved against the iframe's location:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> absolute <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>relative<span class=\"token punctuation\">,</span> frame<span class=\"token punctuation\">.</span>contentWindow<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>There is a lot of discussion in progress about getting new specs to align with this behavior change, to mitigate potential problems going forward.</p>"}}],"toc":[{"text":"The edge case","id":"the_edge_case"},{"text":"The problem","id":"the_problem"},{"text":"The solution","id":"the_solution"}],"summary":"This article explains an edge case that occurs with fetch (and potentially other APIs exhibiting the same kind of resource retrieval behavior). When a cross-origin fetch involving a relative URL is initiated from an <iframe>, the relative URL used to be resolved against the current global location, rather than the iframe's location.","popularity":0.0015,"modified":"2022-09-09T05:10:34.000Z","other_translations":[{"title":"グローバル間フェッチの使用","locale":"ja","native":"日本語"},{"title":"Uso de busca Cross-global","locale":"pt-BR","native":"Português (do Brasil)"},{"title":"Cross-global fetch usage","locale":"ru","native":"Русский"},{"title":"Cross-global fetch usage","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"en-us/web/api/fetch_api/cross-global_fetch_usage","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/web/api/fetch_api/cross-global_fetch_usage/index.md","last_commit_url":"https://github.com/mdn/content/commit/1511e914c6b1ce6f88056bfefd48a6aa585cebce","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Web","title":"Web technology for developers"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Fetch_API","title":"Fetch API"},{"uri":"/en-US/docs/Web/API/Fetch_API/Cross-global_fetch_usage","title":"Cross-global fetch usage"}],"pageTitle":"Cross-global fetch usage - Web APIs | MDN","noIndexing":false}}