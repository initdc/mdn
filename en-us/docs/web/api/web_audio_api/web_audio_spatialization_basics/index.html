<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>Web audio spatialization basics - Web APIs | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><link rel="alternate" title="Web audio spatialization basics" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics" hreflang="en"><link rel="alternate" title="Web audio 空间化基础" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics" hreflang="zh"><link rel="alternate" title="Web audio 공간화 기초" href="https://developer.mozilla.org/ko/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics" hreflang="ko"><link rel="alternate" title="Web audio spatialization basics" href="https://developer.mozilla.org/fr/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics" hreflang="fr"><meta name="description" content="Hopefully, this article has given you an insight into how Web Audio spatialization works, and what each of the PannerNode properties do (there are quite a few of them).
  The values can be hard to manipulate sometimes and depending on your use case it can take some time to get them right."><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics"><meta property="og:title" content="Web audio spatialization basics - Web APIs | MDN"><meta property="og:description" content="Hopefully, this article has given you an insight into how Web Audio spatialization works, and what each of the PannerNode properties do (there are quite a few of them).
  The values can be hard to manipulate sometimes and depending on your use case it can take some time to get them right."><meta property="og:locale" content="en-US"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> 🌐</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> 🌐</a></li></ul></li></ul></nav><div class="header-search"><form action="/en-US/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web"><span property="name">Web technology for developers</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web/API"><span property="name">Web APIs</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/en-US/docs/Web/API/Web_Audio_API"><span property="name">Web Audio API</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics"><span property="name">Web audio spatialization basics</span></a><meta property="position" content="4"></li></ol></nav><ul class="language-toggle single-option"><li><a href="#select-language" class="language-icon"><span class="show-desktop">Change language</span></a></li></ul></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#basics_of_spatialization">Basics of spatialization</a></li><li><a href="#3d_boombox_demo">3D boombox demo</a></li><li><a href="#creating_an_audio_listener">Creating an audio listener</a></li><li><a href="#creating_a_panner_node">Creating a panner node</a></li><li><a href="#moving_the_boombox">Moving the boombox</a></li><li><a href="#wiring_up_our_controls">Wiring up our controls</a></li><li><a href="#connecting_our_graph">Connecting Our Graph</a></li><li><a href="#summary">Summary</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="en-US"><h1>Web audio spatialization basics</h1><div><p>
  As if its extensive variety of sound processing (and other) options wasn't enough, the Web Audio API also includes facilities to allow you to emulate the difference in sound as a listener moves around a sound source, for example panning as you move around a sound source inside a 3D game.
  The official term for this is <strong>spatialization</strong>, and this article will cover the basics of how to implement such a system.
</p></div><h2 id="basics_of_spatialization"><a href="#basics_of_spatialization" title="Permalink to Basics of spatialization">Basics of spatialization</a></h2><div><p>
  In Web Audio, complex 3D spatializations are created using the <a href="/en-US/docs/Web/API/PannerNode"><code>PannerNode</code></a>, which in layman's terms is basically a whole lotta cool maths to make audio appear in 3D space.
  Think sounds flying over you, creeping up behind you, moving across in front of you.
  That sort of thing.
</p>
<p>
  It's really useful for WebXR and gaming.
  In 3D spaces, it's the only way to achieve realistic audio. Libraries like <a href="https://threejs.org/" class="external" rel=" noopener">three.js</a> and <a href="https://aframe.io/" class="external" rel=" noopener">A-frame</a> harness its potential when dealing with sound.
  It's worth noting that you don't <em>have</em> to move sound within a full 3D space either — you could stick with just a 2D plane, so if you were planning a 2D game, this would still be the node you were looking for.
</p>
<div class="notecard note" id="sect1">
  <p>
    <strong>Note:</strong> There's also a <a href="/en-US/docs/Web/API/StereoPannerNode"><code>StereoPannerNode</code></a> designed to deal with the common use case of creating simple left and right stereo panning effects.
    This is much simpler to use, but obviously nowhere near as versatile.
    If you just want a simple stereo panning effect, our <a href="https://mdn.github.io/webaudio-examples/stereo-panner-node/" class="external" rel=" noopener">StereoPannerNode example</a> (<a href="https://github.com/mdn/webaudio-examples/tree/master/stereo-panner-node" class="external" rel=" noopener">see source code</a>) should give you everything you need.
  </p>
</div></div><h2 id="3d_boombox_demo"><a href="#3d_boombox_demo" title="Permalink to 3D boombox demo">3D boombox demo</a></h2><div><p>
  To demonstrate 3D spatialization we've created a modified version of the boombox demo we created in our basic <a href="/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API">Using the Web Audio API</a> guide.
  See the <a href="https://mdn.github.io/webaudio-examples/spatialization/" class="external" rel=" noopener">3D spatialization demo live</a> (and see the <a href="https://github.com/mdn/webaudio-examples/tree/master/spatialization" class="external" rel=" noopener">source code</a> also).
</p>
<p>
  <img src="/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics/web-audio-spatialization.png" alt="A simple UI with a rotated boombox and controls to move it left and right and in and out, and rotate it." width="949" height="724" loading="lazy">
</p>
<p>
  The boombox sits inside a room (defined by the edges of the browser viewport), and in this demo, we can move and rotate it with the provided controls.
  When we move the boombox, the sound it produces changes accordingly, panning as it moves to the left or right of the room, or becoming quieter as it is moved away from the user or is rotated so the speakers are facing away from them, etc.
  This is done by setting the different properties of the <code>PannerNode</code> object instance in relation to that movement, to emulate spacialization.
</p>
<div class="notecard note" id="sect2">
  <p><strong>Note:</strong> The experience is much better if you use headphones, or have some kind of surround sound system to plug your computer into.</p>
</div></div><h2 id="creating_an_audio_listener"><a href="#creating_an_audio_listener" title="Permalink to Creating an audio listener">Creating an audio listener</a></h2><div><p>
  So let's begin! The <a href="/en-US/docs/Web/API/BaseAudioContext"><code>BaseAudioContext</code></a> (the interface the <a href="/en-US/docs/Web/API/AudioContext"><code>AudioContext</code></a> is extended from) has a <a href="/en-US/docs/Web/API/BaseAudioContext/listener"><code>listener</code></a> property that returns an <a href="/en-US/docs/Web/API/AudioListener"><code>AudioListener</code></a> object.
  This represents the listener of the scene, usually your user.
  You can define where they are in space and in which direction they are facing.
  They remain static. The <code>pannerNode</code> can then calculate its sound position relative to the position of the listener.
</p>
<p>Let's create our context and listener and set the listener's position to emulate a person looking into our room:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> AudioContext <span class="token operator">=</span> window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitAudioContext<span class="token punctuation">;</span>
<span class="token keyword">const</span> audioCtx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> listener <span class="token operator">=</span> audioCtx<span class="token punctuation">.</span>listener<span class="token punctuation">;</span>

<span class="token keyword">const</span> posX <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> posY <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> posZ <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>

listener<span class="token punctuation">.</span>positionX<span class="token punctuation">.</span>value <span class="token operator">=</span> posX<span class="token punctuation">;</span>
listener<span class="token punctuation">.</span>positionY<span class="token punctuation">.</span>value <span class="token operator">=</span> posY<span class="token punctuation">;</span>
listener<span class="token punctuation">.</span>positionZ<span class="token punctuation">.</span>value <span class="token operator">=</span> posZ<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div>
<p>We could move the listener left or right using <code>positionX</code>, up or down using <code>positionY</code>, or in or out of the room using <code>positionZ</code>. Here we are setting the listener to be in the middle of the viewport and slightly in front of our boombox. We can also set the direction the listener is facing. The default values for these work well:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>listener<span class="token punctuation">.</span>forwardX<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
listener<span class="token punctuation">.</span>forwardY<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
listener<span class="token punctuation">.</span>forwardZ<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
listener<span class="token punctuation">.</span>upX<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
listener<span class="token punctuation">.</span>upY<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
listener<span class="token punctuation">.</span>upZ<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  The forward properties represent the 3D coordinate position of the listener's forward direction (e.g. the direction they are facing in), while the up properties represent the 3D coordinate position of the top of the listener's head.
  These two together can nicely set the direction.
</p></div><h2 id="creating_a_panner_node"><a href="#creating_a_panner_node" title="Permalink to Creating a panner node">Creating a panner node</a></h2><div><p>Let's create our <a href="/en-US/docs/Web/API/PannerNode"><code>PannerNode</code></a>. This has a whole bunch of properties associated with it. Let's take a look at each of them:</p>
<p>
  To start we can set the <a href="/en-US/docs/Web/API/PannerNode/panningModel"><code>panningModel</code></a>.
  This is the spacialization algorithm that's used to position the audio in 3D space. We can set this to:
</p>
<p><code>equalpower</code> — The default and the general way panning is figured out</p>
<p><code>HRTF</code> — This stands for 'Head-related transfer function' and looks to take into account the human head when figuring out where the sound is.</p>
<p>Pretty clever stuff. Let's use the <code>HRTF</code> model!</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> panningModel <span class="token operator">=</span> <span class="token string">'HRTF'</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  The <a href="/en-US/docs/Web/API/PannerNode/coneInnerAngle"><code>coneInnerAngle</code></a> and <a href="/en-US/docs/Web/API/PannerNode/coneOuterAngle"><code>coneOuterAngle</code></a> properties specify where the volume emanates from.
  By default, both are 360 degrees.
  Our boombox speakers will have smaller cones, which we can define.
  The inner cone is where gain (volume) is always emulated at a maximum and the outer cone is where the gain starts to drop away.
  The gain is reduced by the value of the <a href="/en-US/docs/Web/API/PannerNode/coneOuterGain"><code>coneOuterGain</code></a>.
  Let's create constants that store the values we'll use for these parameters later on:
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> innerCone <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> outerCone <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> outerGain <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The next parameter is <a href="/en-US/docs/Web/API/PannerNode/distanceModel"><code>distanceModel</code></a> — this can only be set to <code>linear</code>, <code>inverse</code>, or <code>exponential</code>. These are different algorithms, which are used to reduce the volume of the audio source as it moves away from the listener. We'll use <code>linear</code>, as it is simple:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> distanceModel <span class="token operator">=</span> <span class="token string">'linear'</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  We can set a maximum distance (<a href="/en-US/docs/Web/API/PannerNode/maxDistance"><code>maxDistance</code></a>) between the source and the listener — the volume will not be reduced anymore if the source moves further away from this point.
  This can be useful, as you may find you want to emulate distance, but volume can drop out and that's actually not what you want.
  By default, it's 10,000 (a unitless relative value). We can keep it as this:
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> maxDistance <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  There's also a reference distance (<a href="/en-US/docs/Web/API/PannerNode/refDistance"><code>refDistance</code></a>), which is used by the distance models.
  We can keep that at the default value of <code>1</code> as well:
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> refDistance <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  Then there's the roll-off factor (<a href="/en-US/docs/Web/API/PannerNode/rolloffFactor"><code>rolloffFactor</code></a>) — how quickly does the volume reduce as the panner moves away from the listener.
  The default value is 1; let's make that a bit bigger to exaggerate our movements.
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> rollOff <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  Now we can start setting our position and orientation of our boombox.
  This is a lot like how we did it with our listener.
  These are also the parameters we're going to change when the controls on our interface are used.
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> positionX <span class="token operator">=</span> posX<span class="token punctuation">;</span>
<span class="token keyword">const</span> positionY <span class="token operator">=</span> posY<span class="token punctuation">;</span>
<span class="token keyword">const</span> positionZ <span class="token operator">=</span> posZ<span class="token punctuation">;</span>

<span class="token keyword">const</span> orientationX <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orientationY <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orientationZ <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  Note the minus value on our z orientation — this sets the boombox to face us.
  A positive value would set the sound source facing away from us.
</p>
<p>Let's use the relevant constructor for creating our panner node and pass in all those parameters we set above:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> panner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PannerNode</span><span class="token punctuation">(</span>audioCtx<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  panningModel<span class="token punctuation">,</span>
  distanceModel<span class="token punctuation">,</span>
  positionX<span class="token punctuation">,</span>
  positionY<span class="token punctuation">,</span>
  positionZ<span class="token punctuation">,</span>
  orientationX<span class="token punctuation">,</span>
  orientationY<span class="token punctuation">,</span>
  orientationZ<span class="token punctuation">,</span>
  refDistance<span class="token punctuation">,</span>
  maxDistance<span class="token punctuation">,</span>
  <span class="token literal-property property">rolloffFactor</span><span class="token operator">:</span> rollOff<span class="token punctuation">,</span>
  <span class="token literal-property property">coneInnerAngle</span><span class="token operator">:</span> innerCone<span class="token punctuation">,</span>
  <span class="token literal-property property">coneOuterAngle</span><span class="token operator">:</span> outerCone<span class="token punctuation">,</span>
  <span class="token literal-property property">coneOuterGain</span><span class="token operator">:</span> outerGain<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div><h2 id="moving_the_boombox"><a href="#moving_the_boombox" title="Permalink to Moving the boombox">Moving the boombox</a></h2><div><p>
  Now we're going to move our boombox around our 'room'. We've got some controls set up to do this.
  We can move it left and right, up and down, and back and forth; we can also rotate it.
  The sound direction is coming from the boombox speaker at the front, so when we rotate it, we can alter the sound's direction — i.e. make it project to the back when the boombox is rotated 180 degrees and facing away from us.
</p>
<p>
  We need to set up a few things for the interface.
  First, we'll get references to the elements we want to move, then we'll store references to the values we'll change when we set up <a href="/en-US/docs/Web/CSS/CSS_Transforms">CSS transforms</a> to actually do the movement.
  Finally, we'll set some bounds so our boombox doesn't move too far in any direction:
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> moveControls <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#move-controls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> boombox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.boombox-body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// the values for our CSS transforms</span>
<span class="token keyword">const</span> transform <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">xAxis</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">yAxis</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">zAxis</span><span class="token operator">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rotateX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rotateY</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">// set our bounds</span>
<span class="token keyword">const</span> topBound <span class="token operator">=</span> <span class="token operator">-</span>posY<span class="token punctuation">;</span>
<span class="token keyword">const</span> bottomBound <span class="token operator">=</span> posY<span class="token punctuation">;</span>
<span class="token keyword">const</span> rightBound <span class="token operator">=</span> posX<span class="token punctuation">;</span>
<span class="token keyword">const</span> leftBound <span class="token operator">=</span> <span class="token operator">-</span>posX<span class="token punctuation">;</span>
<span class="token keyword">const</span> innerBound <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> outerBound <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Let's create a function that takes the direction we want to move as a parameter, and both modifies the CSS transform and updates the position and orientation values of our panner node properties to change the sound as appropriate.</p>
<p>
  To start with let's take a look at our left, right, up and down values as these are pretty straightforward.
  We'll move the boombox along these axis and update the appropriate position.
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">moveBoombox</span><span class="token punctuation">(</span><span class="token parameter">direction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'left'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>xAxis <span class="token operator">&gt;</span> leftBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>xAxis <span class="token operator">-=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionX<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'up'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>yAxis <span class="token operator">&gt;</span> topBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>yAxis <span class="token operator">-=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionY<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'right'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>xAxis <span class="token operator">&lt;</span> rightBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>xAxis <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionX<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'down'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>yAxis <span class="token operator">&lt;</span> bottomBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>yAxis <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionY<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>It's a similar story for our move in and out values too:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">case</span> <span class="token string">'back'</span><span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>zAxis <span class="token operator">&gt;</span> innerBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transform<span class="token punctuation">.</span>zAxis <span class="token operator">-=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    panner<span class="token punctuation">.</span>positionZ<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string">'forward'</span><span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>zAxis <span class="token operator">&lt;</span> outerBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transform<span class="token punctuation">.</span>zAxis <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    panner<span class="token punctuation">.</span>positionZ<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  Our rotation values are a little more involved, however, as we need to move the sound <em>around</em>.
  Not only do we have to update two axis values (e.g. if you rotate an object around the x-axis, you update the y and z coordinates for that object), but we also need to do some more maths for this.
  The rotation is a circle and we need <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sin"><code>Math.sin</code></a> and <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/cos"><code>Math.cos</code></a> to help us draw that circle.
</p>
<p>Let's set up a rotation rate, which we'll convert into a radian range value for use in <code>Math.sin</code> and <code>Math.cos</code> later, when we want to figure out the new coordinates when we're rotating our boombox:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// set up rotation constants</span>
<span class="token keyword">const</span> rotationRate <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span> <span class="token comment">// bigger number equals slower sound rotation</span>

<span class="token keyword">const</span> q <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span>rotationRate<span class="token punctuation">;</span> <span class="token comment">//rotation increment in radians</span>
</code></pre></div>
<p>We can also use this to work out degrees rotated, which will help with the CSS transforms we will have to create (note we need both an x and y-axis for the CSS transforms):</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// get degrees for CSS</span>
<span class="token keyword">const</span> degreesX <span class="token operator">=</span> <span class="token punctuation">(</span>q <span class="token operator">*</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token operator">/</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> degreesY <span class="token operator">=</span> <span class="token punctuation">(</span>q <span class="token operator">*</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token operator">/</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Let's take a look at our left rotation as an example. We need to change the x orientation and the z orientation of the panner coordinates, to move around the y-axis for our left rotation:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">case</span> <span class="token string">'rotate-left'</span><span class="token operator">:</span>
  transform<span class="token punctuation">.</span>rotateY <span class="token operator">-=</span> degreesY<span class="token punctuation">;</span>

  <span class="token comment">// 'left' is rotation about y-axis with negative angle increment</span>
  z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token punctuation">;</span>

  panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre></div>
<p>This <em>is</em> a little confusing, but what we're doing is using sin and cos to help us work out the circular motion the coordinates need for the rotation of the boombox.</p>
<p>We can do this for all the axes. We just need to choose the right orientations to update and whether we want a positive or negative increment.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">case</span> <span class="token string">'rotate-right'</span><span class="token operator">:</span>
  transform<span class="token punctuation">.</span>rotateY <span class="token operator">+=</span> degreesY<span class="token punctuation">;</span>
  <span class="token comment">// 'right' is rotation about y-axis with positive angle increment</span>
  z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string">'rotate-up'</span><span class="token operator">:</span>
  transform<span class="token punctuation">.</span>rotateX <span class="token operator">+=</span> degreesX<span class="token punctuation">;</span>
  <span class="token comment">// 'up' is rotation about x-axis with negative angle increment</span>
  z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string">'rotate-down'</span><span class="token operator">:</span>
  transform<span class="token punctuation">.</span>rotateX <span class="token operator">-=</span> degreesX<span class="token punctuation">;</span>
  <span class="token comment">// 'down' is rotation about x-axis with positive angle increment</span>
  z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
  panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre></div>
<p>
  One last thing — we need to update the CSS and keep a reference of the last move for the mouse event.
  Here's the final <code>moveBoombox</code> function.
</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">moveBoombox</span><span class="token punctuation">(</span><span class="token parameter">direction<span class="token punctuation">,</span> prevMove</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'left'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>xAxis <span class="token operator">&gt;</span> leftBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>xAxis <span class="token operator">-=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionX<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'up'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>yAxis <span class="token operator">&gt;</span> topBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>yAxis <span class="token operator">-=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionY<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'right'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>xAxis <span class="token operator">&lt;</span> rightBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>xAxis <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionX<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'down'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>yAxis <span class="token operator">&lt;</span> bottomBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>yAxis <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionY<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'back'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>zAxis <span class="token operator">&gt;</span> innerBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>zAxis <span class="token operator">-=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionZ<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">40</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'forward'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>zAxis <span class="token operator">&lt;</span> outerBound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transform<span class="token punctuation">.</span>zAxis <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
        panner<span class="token punctuation">.</span>positionZ<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">40</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'rotate-left'</span><span class="token operator">:</span>
      transform<span class="token punctuation">.</span>rotateY <span class="token operator">-=</span> degreesY<span class="token punctuation">;</span>

      <span class="token comment">// 'left' is rotation about y-axis with negative angle increment</span>
      z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token punctuation">;</span>

      panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'rotate-right'</span><span class="token operator">:</span>
      transform<span class="token punctuation">.</span>rotateY <span class="token operator">+=</span> degreesY<span class="token punctuation">;</span>
      <span class="token comment">// 'right' is rotation about y-axis with positive angle increment</span>
      z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'rotate-up'</span><span class="token operator">:</span>
      transform<span class="token punctuation">.</span>rotateX <span class="token operator">+=</span> degreesX<span class="token punctuation">;</span>
      <span class="token comment">// 'up' is rotation about x-axis with negative angle increment</span>
      z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'rotate-down'</span><span class="token operator">:</span>
      transform<span class="token punctuation">.</span>rotateX <span class="token operator">-=</span> degreesX<span class="token punctuation">;</span>
      <span class="token comment">// 'down' is rotation about x-axis with positive angle increment</span>
      z <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">-</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      y <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">+</span> panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
      x <span class="token operator">=</span> panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationX<span class="token punctuation">.</span>value <span class="token operator">=</span> x<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationY<span class="token punctuation">.</span>value <span class="token operator">=</span> y<span class="token punctuation">;</span>
      panner<span class="token punctuation">.</span>orientationZ<span class="token punctuation">.</span>value <span class="token operator">=</span> z<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  boombox<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transform<span class="token punctuation">.</span>xAxis<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px) </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transform<span class="token punctuation">.</span>yAxis<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px) </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transform<span class="token punctuation">.</span>zAxis<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transform<span class="token punctuation">.</span>rotateY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg) </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transform<span class="token punctuation">.</span>rotateX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> move <span class="token operator">=</span> prevMove <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  move<span class="token punctuation">.</span>frameId <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">moveBoombox</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> move<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> move<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div><h2 id="wiring_up_our_controls"><a href="#wiring_up_our_controls" title="Permalink to Wiring up our controls">Wiring up our controls</a></h2><div><p>Wiring up out control buttons is comparatively simple — now we can listen for a mouse event on our controls and run this function, as well as stop it when the mouse is released:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// for each of our controls, move the boombox and change the position values</span>
moveControls<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> moving<span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> direction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>control<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moving <span class="token operator">&amp;&amp;</span> moving<span class="token punctuation">.</span>frameId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>moving<span class="token punctuation">.</span>frameId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        moving <span class="token operator">=</span> <span class="token function">moveBoombox</span><span class="token punctuation">(</span>direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moving <span class="token operator">&amp;&amp;</span> moving<span class="token punctuation">.</span>frameId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>moving<span class="token punctuation">.</span>frameId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div><h2 id="connecting_our_graph"><a href="#connecting_our_graph" title="Permalink to Connecting Our Graph">Connecting Our Graph</a></h2><div><p>Our HTML contains the audio element we want to be affected by the panner node.</p>
<div class="code-example"><pre class="brush: html notranslate"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>audio</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myCoolTrack.mp3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>audio</span><span class="token punctuation">&gt;</span></span>
</code></pre></div>
<p>We need to grab the source from that element and pipe it into the Web Audio API using the <a href="/en-US/docs/Web/API/AudioContext/createMediaElementSource"><code>AudioContext.createMediaElementSource</code></a>.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// get the audio element</span>
<span class="token keyword">const</span> audioElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'audio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// pass it into the audio context</span>
<span class="token keyword">const</span> track <span class="token operator">=</span> audioContext<span class="token punctuation">.</span><span class="token function">createMediaElementSource</span><span class="token punctuation">(</span>audioElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Next we have to connect our audio graph. We connect our input (the track) to our modification node (the panner) to our destination (in this case the speakers).</p>
<div class="code-example"><pre class="brush: js notranslate"><code>track<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>panner<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>audioCtx<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Let's create a play button, that when clicked will play or pause the audio depending on the current state.</p>
<div class="code-example"><pre class="brush: html notranslate"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">data-playing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Play/Pause<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// Select our play button</span>
<span class="token keyword">const</span> playButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

playButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Check if context is in suspended state (autoplay policy)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>audioContext<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'suspended'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    audioContext<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Play or pause track depending on state</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>playButton<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>playing <span class="token operator">===</span> <span class="token string">'false'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    audioElement<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    playButton<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>playing <span class="token operator">=</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>playButton<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>playing <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    audioElement<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    playButton<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>playing <span class="token operator">=</span> <span class="token string">'false'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>For a more in depth look at playing/controlling audio and audio graphs check out <a href="/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API">Using The Web Audio API.</a></p></div><h2 id="summary"><a href="#summary" title="Permalink to Summary">Summary</a></h2><div><p>
  Hopefully, this article has given you an insight into how Web Audio spatialization works, and what each of the <a href="/en-US/docs/Web/API/PannerNode"><code>PannerNode</code></a> properties do (there are quite a few of them).
  The values can be hard to manipulate sometimes and depending on your use case it can take some time to get them right.
</p>
<div class="notecard note" id="sect3">
  <p>
    <strong>Note:</strong> There are slight differences in the way the audio spatialization sounds across different browsers.
    The panner node does some very involved maths under the hood;
    there are a <a href="https://wpt.fyi/results/webaudio/the-audio-api/the-pannernode-interface?label=stable&amp;aligned=true" class="external" rel=" noopener">number of tests here</a> so you can keep track of the status of the inner workings of this node across different platforms.
  </p>
</div>
<p>
  Again, you can <a href="https://mdn.github.io/webaudio-examples/spatialization/" class="external" rel=" noopener">check out the final demo here</a>, and the <a href="https://github.com/mdn/webaudio-examples/tree/master/spatialization" class="external" rel=" noopener">final source code is here</a>.
  There is also a <a href="https://codepen.io/Rumyra/pen/MqayoK?editors=0100" class="external" rel=" noopener">Codepen demo too</a>.
</p>
<p>
  If you are working with 3D games and/or WebXR it's a good idea to harness a 3D library to create such functionality, rather than trying to do this all yourself from first principles.
  We rolled our own in this article to give you an idea of how it works, but you'll save a lot of time by taking advantage of work others have done before you.
</p></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/style/old/files/en-us/web/api/web_audio_api/web_audio_spatialization_basics/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/blob/style/old/files/en-us/web/api/web_audio_api/web_audio_spatialization_basics/index.md" title="Folder: en-us/web/api/web_audio_api/web_audio_spatialization_basics (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWeb_Audio_API%2FWeb_audio_spatialization_basics%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fweb_audio_api%2Fweb_audio_spatialization_basics%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWeb_Audio_API%2FWeb_audio_spatialization_basics%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fstyle%2Fold%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fweb_audio_api%2Fweb_audio_spatialization_basics%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2Ff7dae62645a2c735ed6f6ed63f664bf279fdfc4b%0A*+Document+last+modified%3A+2022-09-09T05%3A19%3A45.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22Web+audio+spatialization+basics%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2CContent%3AWebAPI" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-09-09T05:19:45.000Z">Sep 9, 2022</time>,<!-- --> <a href="/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics/contributors.txt">by MDN contributors</a></p><form class="language-menu"><fieldset id="select-language"><legend>Change your language</legend><label for="language-selector" class="visually-hidden">Select your preferred language</label> <select id="language-selector" name="language"><option selected="" value="en-US">English (US)</option><option value="fr">Français</option><option value="ko">한국어</option><option value="zh-CN">中文 (简体)</option></select> <button type="submit" class="button minimal">Change language</button></fieldset></form></div></aside></main><nav id="sidebar-quicklinks" class="sidebar"><h4>Related Topics</h4><div><ol><li><strong><a href="/en-US/docs/Web/API/Web_Audio_API">Web Audio API</a></strong></li><li class="toggle"><details open=""><summary>Guides</summary><ol><li><a href="/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API">Using the Web Audio API</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Basic_concepts_behind_Web_Audio_API">Basic concepts behind Web Audio API</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Best_practices">Web Audio API best practices</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Advanced_techniques">Advanced techniques: Creating and sequencing audio</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet">Background audio processing using AudioWorklet</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Controlling_multiple_parameters_with_ConstantSourceNode">Controlling multiple parameters with ConstantSourceNode</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Migrating_from_webkitAudioContext">Migrating from webkitAudioContext</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Simple_synth">Example and tutorial: Simple synth keyboard</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Tools">Tools for analyzing Web Audio usage</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Using_IIR_filters">Using IIR filters</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API">Visualizations with Web Audio API</a></li><li><a href="/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics">Web audio spatialization basics</a></li></ol></details></li><li class="toggle"><details open=""><summary>Interfaces</summary><ol><li><a href="/en-US/docs/Web/API/AnalyserNode"><code>AnalyserNode</code></a></li><li><a href="/en-US/docs/Web/API/AudioBuffer"><code>AudioBuffer</code></a></li><li><a href="/en-US/docs/Web/API/AudioBufferSourceNode"><code>AudioBufferSourceNode</code></a></li><li><a href="/en-US/docs/Web/API/AudioContext"><code>AudioContext</code></a></li><li><a href="/en-US/docs/Web/API/AudioDestinationNode"><code>AudioDestinationNode</code></a></li><li><a href="/en-US/docs/Web/API/AudioListener"><code>AudioListener</code></a></li><li><a href="/en-US/docs/Web/API/AudioNode"><code>AudioNode</code></a></li><li><a href="/en-US/docs/Web/API/AudioParam"><code>AudioParam</code></a></li><li><a href="/en-US/docs/Web/API/AudioProcessingEvent"><code>AudioProcessingEvent</code></a></li><li><a href="/en-US/docs/Web/API/AudioScheduledSourceNode"><code>AudioScheduledSourceNode</code></a></li><li><a href="/en-US/docs/Web/API/AudioWorklet"><code>AudioWorklet</code></a></li><li><a href="/en-US/docs/Web/API/AudioWorkletGlobalScope"><code>AudioWorkletGlobalScope</code></a></li><li><a href="/en-US/docs/Web/API/AudioWorkletNode"><code>AudioWorkletNode</code></a></li><li><a href="/en-US/docs/Web/API/AudioWorkletProcessor"><code>AudioWorkletProcessor</code></a></li><li><a href="/en-US/docs/Web/API/BaseAudioContext"><code>BaseAudioContext</code></a></li><li><a href="/en-US/docs/Web/API/BiquadFilterNode"><code>BiquadFilterNode</code></a></li><li><a href="/en-US/docs/Web/API/ChannelMergerNode"><code>ChannelMergerNode</code></a></li><li><a href="/en-US/docs/Web/API/ChannelSplitterNode"><code>ChannelSplitterNode</code></a></li><li><a href="/en-US/docs/Web/API/ConstantSourceNode"><code>ConstantSourceNode</code></a></li><li><a href="/en-US/docs/Web/API/ConvolverNode"><code>ConvolverNode</code></a></li><li><a href="/en-US/docs/Web/API/DelayNode"><code>DelayNode</code></a></li><li><a href="/en-US/docs/Web/API/DynamicsCompressorNode"><code>DynamicsCompressorNode</code></a></li><li><a href="/en-US/docs/Web/API/GainNode"><code>GainNode</code></a></li><li><a href="/en-US/docs/Web/API/IIRFilterNode"><code>IIRFilterNode</code></a></li><li><a href="/en-US/docs/Web/API/MediaElementAudioSourceNode"><code>MediaElementAudioSourceNode</code></a></li><li><a href="/en-US/docs/Web/API/MediaStreamAudioDestinationNode"><code>MediaStreamAudioDestinationNode</code></a></li><li><a href="/en-US/docs/Web/API/MediaStreamAudioSourceNode"><code>MediaStreamAudioSourceNode</code></a></li><li><a href="/en-US/docs/Web/API/OfflineAudioCompletionEvent"><code>OfflineAudioCompletionEvent</code></a></li><li><a href="/en-US/docs/Web/API/OfflineAudioContext"><code>OfflineAudioContext</code></a></li><li><a href="/en-US/docs/Web/API/OscillatorNode"><code>OscillatorNode</code></a></li><li><a href="/en-US/docs/Web/API/PannerNode"><code>PannerNode</code></a></li><li><a href="/en-US/docs/Web/API/PeriodicWave"><code>PeriodicWave</code></a></li><li><a href="/en-US/docs/Web/API/WaveShaperNode"><code>WaveShaperNode</code></a></li><li><a href="/en-US/docs/Web/API/StereoPannerNode"><code>StereoPannerNode</code></a></li></ol></details></li></ol></div></nav></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/en-US/docs/Web">Web Technologies</a></li><li><a href="/en-US/docs/Learn">Learn Web Development</a></li><li><a href="/en-US/docs/MDN/About">About MDN</a></li><li><a href="/en-US/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Web audio spatialization basics","mdn_url":"/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/Web_Audio_API\">Web Audio API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Guides</summary><ol><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API\">Using the Web Audio API</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Basic_concepts_behind_Web_Audio_API\">Basic concepts behind Web Audio API</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Best_practices\">Web Audio API best practices</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Advanced_techniques\">Advanced techniques: Creating and sequencing audio</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet\">Background audio processing using AudioWorklet</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Controlling_multiple_parameters_with_ConstantSourceNode\">Controlling multiple parameters with ConstantSourceNode</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Migrating_from_webkitAudioContext\">Migrating from webkitAudioContext</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Simple_synth\">Example and tutorial: Simple synth keyboard</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Tools\">Tools for analyzing Web Audio usage</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_IIR_filters\">Using IIR filters</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\">Visualizations with Web Audio API</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics\">Web audio spatialization basics</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/AnalyserNode\"><code>AnalyserNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioBuffer\"><code>AudioBuffer</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioBufferSourceNode\"><code>AudioBufferSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioContext\"><code>AudioContext</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioDestinationNode\"><code>AudioDestinationNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioListener\"><code>AudioListener</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioNode\"><code>AudioNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioParam\"><code>AudioParam</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioProcessingEvent\"><code>AudioProcessingEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioScheduledSourceNode\"><code>AudioScheduledSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorklet\"><code>AudioWorklet</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorkletGlobalScope\"><code>AudioWorkletGlobalScope</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a></li><li><a href=\"/en-US/docs/Web/API/BaseAudioContext\"><code>BaseAudioContext</code></a></li><li><a href=\"/en-US/docs/Web/API/BiquadFilterNode\"><code>BiquadFilterNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ChannelMergerNode\"><code>ChannelMergerNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ChannelSplitterNode\"><code>ChannelSplitterNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ConstantSourceNode\"><code>ConstantSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ConvolverNode\"><code>ConvolverNode</code></a></li><li><a href=\"/en-US/docs/Web/API/DelayNode\"><code>DelayNode</code></a></li><li><a href=\"/en-US/docs/Web/API/DynamicsCompressorNode\"><code>DynamicsCompressorNode</code></a></li><li><a href=\"/en-US/docs/Web/API/GainNode\"><code>GainNode</code></a></li><li><a href=\"/en-US/docs/Web/API/IIRFilterNode\"><code>IIRFilterNode</code></a></li><li><a href=\"/en-US/docs/Web/API/MediaElementAudioSourceNode\"><code>MediaElementAudioSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/MediaStreamAudioDestinationNode\"><code>MediaStreamAudioDestinationNode</code></a></li><li><a href=\"/en-US/docs/Web/API/MediaStreamAudioSourceNode\"><code>MediaStreamAudioSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/OfflineAudioCompletionEvent\"><code>OfflineAudioCompletionEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/OfflineAudioContext\"><code>OfflineAudioContext</code></a></li><li><a href=\"/en-US/docs/Web/API/OscillatorNode\"><code>OscillatorNode</code></a></li><li><a href=\"/en-US/docs/Web/API/PannerNode\"><code>PannerNode</code></a></li><li><a href=\"/en-US/docs/Web/API/PeriodicWave\"><code>PeriodicWave</code></a></li><li><a href=\"/en-US/docs/Web/API/WaveShaperNode\"><code>WaveShaperNode</code></a></li><li><a href=\"/en-US/docs/Web/API/StereoPannerNode\"><code>StereoPannerNode</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>\n  As if its extensive variety of sound processing (and other) options wasn't enough, the Web Audio API also includes facilities to allow you to emulate the difference in sound as a listener moves around a sound source, for example panning as you move around a sound source inside a 3D game.\n  The official term for this is <strong>spatialization</strong>, and this article will cover the basics of how to implement such a system.\n</p>"}},{"type":"prose","value":{"id":"basics_of_spatialization","title":"Basics of spatialization","isH3":false,"content":"<p>\n  In Web Audio, complex 3D spatializations are created using the <a href=\"/en-US/docs/Web/API/PannerNode\"><code>PannerNode</code></a>, which in layman's terms is basically a whole lotta cool maths to make audio appear in 3D space.\n  Think sounds flying over you, creeping up behind you, moving across in front of you.\n  That sort of thing.\n</p>\n<p>\n  It's really useful for WebXR and gaming.\n  In 3D spaces, it's the only way to achieve realistic audio. Libraries like <a href=\"https://threejs.org/\" class=\"external\" rel=\" noopener\">three.js</a> and <a href=\"https://aframe.io/\" class=\"external\" rel=\" noopener\">A-frame</a> harness its potential when dealing with sound.\n  It's worth noting that you don't <em>have</em> to move sound within a full 3D space either — you could stick with just a 2D plane, so if you were planning a 2D game, this would still be the node you were looking for.\n</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p>\n    <strong>Note:</strong> There's also a <a href=\"/en-US/docs/Web/API/StereoPannerNode\"><code>StereoPannerNode</code></a> designed to deal with the common use case of creating simple left and right stereo panning effects.\n    This is much simpler to use, but obviously nowhere near as versatile.\n    If you just want a simple stereo panning effect, our <a href=\"https://mdn.github.io/webaudio-examples/stereo-panner-node/\" class=\"external\" rel=\" noopener\">StereoPannerNode example</a> (<a href=\"https://github.com/mdn/webaudio-examples/tree/master/stereo-panner-node\" class=\"external\" rel=\" noopener\">see source code</a>) should give you everything you need.\n  </p>\n</div>"}},{"type":"prose","value":{"id":"3d_boombox_demo","title":"3D boombox demo","isH3":false,"content":"<p>\n  To demonstrate 3D spatialization we've created a modified version of the boombox demo we created in our basic <a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API\">Using the Web Audio API</a> guide.\n  See the <a href=\"https://mdn.github.io/webaudio-examples/spatialization/\" class=\"external\" rel=\" noopener\">3D spatialization demo live</a> (and see the <a href=\"https://github.com/mdn/webaudio-examples/tree/master/spatialization\" class=\"external\" rel=\" noopener\">source code</a> also).\n</p>\n<p>\n  <img src=\"/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics/web-audio-spatialization.png\" alt=\"A simple UI with a rotated boombox and controls to move it left and right and in and out, and rotate it.\" width=\"949\" height=\"724\" loading=\"lazy\">\n</p>\n<p>\n  The boombox sits inside a room (defined by the edges of the browser viewport), and in this demo, we can move and rotate it with the provided controls.\n  When we move the boombox, the sound it produces changes accordingly, panning as it moves to the left or right of the room, or becoming quieter as it is moved away from the user or is rotated so the speakers are facing away from them, etc.\n  This is done by setting the different properties of the <code>PannerNode</code> object instance in relation to that movement, to emulate spacialization.\n</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> The experience is much better if you use headphones, or have some kind of surround sound system to plug your computer into.</p>\n</div>"}},{"type":"prose","value":{"id":"creating_an_audio_listener","title":"Creating an audio listener","isH3":false,"content":"<p>\n  So let's begin! The <a href=\"/en-US/docs/Web/API/BaseAudioContext\"><code>BaseAudioContext</code></a> (the interface the <a href=\"/en-US/docs/Web/API/AudioContext\"><code>AudioContext</code></a> is extended from) has a <a href=\"/en-US/docs/Web/API/BaseAudioContext/listener\"><code>listener</code></a> property that returns an <a href=\"/en-US/docs/Web/API/AudioListener\"><code>AudioListener</code></a> object.\n  This represents the listener of the scene, usually your user.\n  You can define where they are in space and in which direction they are facing.\n  They remain static. The <code>pannerNode</code> can then calculate its sound position relative to the position of the listener.\n</p>\n<p>Let's create our context and listener and set the listener's position to emulate a person looking into our room:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> AudioContext <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>AudioContext <span class=\"token operator\">||</span> window<span class=\"token punctuation\">.</span>webkitAudioContext<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> audioCtx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> listener <span class=\"token operator\">=</span> audioCtx<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> posX <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> posY <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> posZ <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">;</span>\n\nlistener<span class=\"token punctuation\">.</span>positionX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> posX<span class=\"token punctuation\">;</span>\nlistener<span class=\"token punctuation\">.</span>positionY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> posY<span class=\"token punctuation\">;</span>\nlistener<span class=\"token punctuation\">.</span>positionZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> posZ<span class=\"token operator\">-</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>We could move the listener left or right using <code>positionX</code>, up or down using <code>positionY</code>, or in or out of the room using <code>positionZ</code>. Here we are setting the listener to be in the middle of the viewport and slightly in front of our boombox. We can also set the direction the listener is facing. The default values for these work well:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>listener<span class=\"token punctuation\">.</span>forwardX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nlistener<span class=\"token punctuation\">.</span>forwardY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nlistener<span class=\"token punctuation\">.</span>forwardZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nlistener<span class=\"token punctuation\">.</span>upX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nlistener<span class=\"token punctuation\">.</span>upY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nlistener<span class=\"token punctuation\">.</span>upZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  The forward properties represent the 3D coordinate position of the listener's forward direction (e.g. the direction they are facing in), while the up properties represent the 3D coordinate position of the top of the listener's head.\n  These two together can nicely set the direction.\n</p>"}},{"type":"prose","value":{"id":"creating_a_panner_node","title":"Creating a panner node","isH3":false,"content":"<p>Let's create our <a href=\"/en-US/docs/Web/API/PannerNode\"><code>PannerNode</code></a>. This has a whole bunch of properties associated with it. Let's take a look at each of them:</p>\n<p>\n  To start we can set the <a href=\"/en-US/docs/Web/API/PannerNode/panningModel\"><code>panningModel</code></a>.\n  This is the spacialization algorithm that's used to position the audio in 3D space. We can set this to:\n</p>\n<p><code>equalpower</code> — The default and the general way panning is figured out</p>\n<p><code>HRTF</code> — This stands for 'Head-related transfer function' and looks to take into account the human head when figuring out where the sound is.</p>\n<p>Pretty clever stuff. Let's use the <code>HRTF</code> model!</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> panningModel <span class=\"token operator\">=</span> <span class=\"token string\">'HRTF'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  The <a href=\"/en-US/docs/Web/API/PannerNode/coneInnerAngle\"><code>coneInnerAngle</code></a> and <a href=\"/en-US/docs/Web/API/PannerNode/coneOuterAngle\"><code>coneOuterAngle</code></a> properties specify where the volume emanates from.\n  By default, both are 360 degrees.\n  Our boombox speakers will have smaller cones, which we can define.\n  The inner cone is where gain (volume) is always emulated at a maximum and the outer cone is where the gain starts to drop away.\n  The gain is reduced by the value of the <a href=\"/en-US/docs/Web/API/PannerNode/coneOuterGain\"><code>coneOuterGain</code></a>.\n  Let's create constants that store the values we'll use for these parameters later on:\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> innerCone <span class=\"token operator\">=</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> outerCone <span class=\"token operator\">=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> outerGain <span class=\"token operator\">=</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The next parameter is <a href=\"/en-US/docs/Web/API/PannerNode/distanceModel\"><code>distanceModel</code></a> — this can only be set to <code>linear</code>, <code>inverse</code>, or <code>exponential</code>. These are different algorithms, which are used to reduce the volume of the audio source as it moves away from the listener. We'll use <code>linear</code>, as it is simple:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> distanceModel <span class=\"token operator\">=</span> <span class=\"token string\">'linear'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  We can set a maximum distance (<a href=\"/en-US/docs/Web/API/PannerNode/maxDistance\"><code>maxDistance</code></a>) between the source and the listener — the volume will not be reduced anymore if the source moves further away from this point.\n  This can be useful, as you may find you want to emulate distance, but volume can drop out and that's actually not what you want.\n  By default, it's 10,000 (a unitless relative value). We can keep it as this:\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> maxDistance <span class=\"token operator\">=</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  There's also a reference distance (<a href=\"/en-US/docs/Web/API/PannerNode/refDistance\"><code>refDistance</code></a>), which is used by the distance models.\n  We can keep that at the default value of <code>1</code> as well:\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> refDistance <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  Then there's the roll-off factor (<a href=\"/en-US/docs/Web/API/PannerNode/rolloffFactor\"><code>rolloffFactor</code></a>) — how quickly does the volume reduce as the panner moves away from the listener.\n  The default value is 1; let's make that a bit bigger to exaggerate our movements.\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> rollOff <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  Now we can start setting our position and orientation of our boombox.\n  This is a lot like how we did it with our listener.\n  These are also the parameters we're going to change when the controls on our interface are used.\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> positionX <span class=\"token operator\">=</span> posX<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> positionY <span class=\"token operator\">=</span> posY<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> positionZ <span class=\"token operator\">=</span> posZ<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> orientationX <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> orientationY <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> orientationZ <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  Note the minus value on our z orientation — this sets the boombox to face us.\n  A positive value would set the sound source facing away from us.\n</p>\n<p>Let's use the relevant constructor for creating our panner node and pass in all those parameters we set above:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> panner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PannerNode</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  panningModel<span class=\"token punctuation\">,</span>\n  distanceModel<span class=\"token punctuation\">,</span>\n  positionX<span class=\"token punctuation\">,</span>\n  positionY<span class=\"token punctuation\">,</span>\n  positionZ<span class=\"token punctuation\">,</span>\n  orientationX<span class=\"token punctuation\">,</span>\n  orientationY<span class=\"token punctuation\">,</span>\n  orientationZ<span class=\"token punctuation\">,</span>\n  refDistance<span class=\"token punctuation\">,</span>\n  maxDistance<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">rolloffFactor</span><span class=\"token operator\">:</span> rollOff<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">coneInnerAngle</span><span class=\"token operator\">:</span> innerCone<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">coneOuterAngle</span><span class=\"token operator\">:</span> outerCone<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">coneOuterGain</span><span class=\"token operator\">:</span> outerGain<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"moving_the_boombox","title":"Moving the boombox","isH3":false,"content":"<p>\n  Now we're going to move our boombox around our 'room'. We've got some controls set up to do this.\n  We can move it left and right, up and down, and back and forth; we can also rotate it.\n  The sound direction is coming from the boombox speaker at the front, so when we rotate it, we can alter the sound's direction — i.e. make it project to the back when the boombox is rotated 180 degrees and facing away from us.\n</p>\n<p>\n  We need to set up a few things for the interface.\n  First, we'll get references to the elements we want to move, then we'll store references to the values we'll change when we set up <a href=\"/en-US/docs/Web/CSS/CSS_Transforms\">CSS transforms</a> to actually do the movement.\n  Finally, we'll set some bounds so our boombox doesn't move too far in any direction:\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> moveControls <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#move-controls'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> boombox <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.boombox-body'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// the values for our CSS transforms</span>\n<span class=\"token keyword\">const</span> transform <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">xAxis</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">yAxis</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">zAxis</span><span class=\"token operator\">:</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">rotateX</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">rotateY</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// set our bounds</span>\n<span class=\"token keyword\">const</span> topBound <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>posY<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> bottomBound <span class=\"token operator\">=</span> posY<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> rightBound <span class=\"token operator\">=</span> posX<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> leftBound <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>posX<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> innerBound <span class=\"token operator\">=</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> outerBound <span class=\"token operator\">=</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Let's create a function that takes the direction we want to move as a parameter, and both modifies the CSS transform and updates the position and orientation values of our panner node properties to change the sound as appropriate.</p>\n<p>\n  To start with let's take a look at our left, right, up and down values as these are pretty straightforward.\n  We'll move the boombox along these axis and update the appropriate position.\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">moveBoombox</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">direction</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>direction<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'left'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">&gt;</span> leftBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">-=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">-=</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'up'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">&gt;</span> topBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">-=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">-=</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'right'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">&lt;</span> rightBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">+=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">+=</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'down'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">&lt;</span> bottomBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">+=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">+=</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>It's a similar story for our move in and out values too:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">case</span> <span class=\"token string\">'back'</span><span class=\"token operator\">:</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">&gt;</span> innerBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">-=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span>\n    panner<span class=\"token punctuation\">.</span>positionZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">+=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">case</span> <span class=\"token string\">'forward'</span><span class=\"token operator\">:</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">&lt;</span> outerBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">+=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span>\n    panner<span class=\"token punctuation\">.</span>positionZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">-=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  Our rotation values are a little more involved, however, as we need to move the sound <em>around</em>.\n  Not only do we have to update two axis values (e.g. if you rotate an object around the x-axis, you update the y and z coordinates for that object), but we also need to do some more maths for this.\n  The rotation is a circle and we need <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sin\"><code>Math.sin</code></a> and <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/cos\"><code>Math.cos</code></a> to help us draw that circle.\n</p>\n<p>Let's set up a rotation rate, which we'll convert into a radian range value for use in <code>Math.sin</code> and <code>Math.cos</code> later, when we want to figure out the new coordinates when we're rotating our boombox:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// set up rotation constants</span>\n<span class=\"token keyword\">const</span> rotationRate <span class=\"token operator\">=</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// bigger number equals slower sound rotation</span>\n\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token operator\">/</span>rotationRate<span class=\"token punctuation\">;</span> <span class=\"token comment\">//rotation increment in radians</span>\n</code></pre></div>\n<p>We can also use this to work out degrees rotated, which will help with the CSS transforms we will have to create (note we need both an x and y-axis for the CSS transforms):</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// get degrees for CSS</span>\n<span class=\"token keyword\">const</span> degreesX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">*</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> degreesY <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">*</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Let's take a look at our left rotation as an example. We need to change the x orientation and the z orientation of the panner coordinates, to move around the y-axis for our left rotation:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-left'</span><span class=\"token operator\">:</span>\n  transform<span class=\"token punctuation\">.</span>rotateY <span class=\"token operator\">-=</span> degreesY<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 'left' is rotation about y-axis with negative angle increment</span>\n  z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n\n  panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This <em>is</em> a little confusing, but what we're doing is using sin and cos to help us work out the circular motion the coordinates need for the rotation of the boombox.</p>\n<p>We can do this for all the axes. We just need to choose the right orientations to update and whether we want a positive or negative increment.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-right'</span><span class=\"token operator\">:</span>\n  transform<span class=\"token punctuation\">.</span>rotateY <span class=\"token operator\">+=</span> degreesY<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 'right' is rotation about y-axis with positive angle increment</span>\n  z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-up'</span><span class=\"token operator\">:</span>\n  transform<span class=\"token punctuation\">.</span>rotateX <span class=\"token operator\">+=</span> degreesX<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 'up' is rotation about x-axis with negative angle increment</span>\n  z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-down'</span><span class=\"token operator\">:</span>\n  transform<span class=\"token punctuation\">.</span>rotateX <span class=\"token operator\">-=</span> degreesX<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 'down' is rotation about x-axis with positive angle increment</span>\n  z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n  panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  One last thing — we need to update the CSS and keep a reference of the last move for the mouse event.\n  Here's the final <code>moveBoombox</code> function.\n</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">moveBoombox</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">direction<span class=\"token punctuation\">,</span> prevMove</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>direction<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'left'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">&gt;</span> leftBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">-=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">-=</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'up'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">&gt;</span> topBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">-=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">-=</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'right'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">&lt;</span> rightBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>xAxis <span class=\"token operator\">+=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">+=</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'down'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">&lt;</span> bottomBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>yAxis <span class=\"token operator\">+=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">+=</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'back'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">&gt;</span> innerBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">-=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">+=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'forward'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">&lt;</span> outerBound<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transform<span class=\"token punctuation\">.</span>zAxis <span class=\"token operator\">+=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span>\n        panner<span class=\"token punctuation\">.</span>positionZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">-=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-left'</span><span class=\"token operator\">:</span>\n      transform<span class=\"token punctuation\">.</span>rotateY <span class=\"token operator\">-=</span> degreesY<span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 'left' is rotation about y-axis with negative angle increment</span>\n      z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n\n      panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-right'</span><span class=\"token operator\">:</span>\n      transform<span class=\"token punctuation\">.</span>rotateY <span class=\"token operator\">+=</span> degreesY<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// 'right' is rotation about y-axis with positive angle increment</span>\n      z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-up'</span><span class=\"token operator\">:</span>\n      transform<span class=\"token punctuation\">.</span>rotateX <span class=\"token operator\">+=</span> degreesX<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// 'up' is rotation about x-axis with negative angle increment</span>\n      z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'rotate-down'</span><span class=\"token operator\">:</span>\n      transform<span class=\"token punctuation\">.</span>rotateX <span class=\"token operator\">-=</span> degreesX<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// 'down' is rotation about x-axis with positive angle increment</span>\n      z <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      y <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value<span class=\"token operator\">*</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      x <span class=\"token operator\">=</span> panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationX<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationY<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n      panner<span class=\"token punctuation\">.</span>orientationZ<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  boombox<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transform <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">translateX(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>transform<span class=\"token punctuation\">.</span>xAxis<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px) </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">translateY(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>transform<span class=\"token punctuation\">.</span>yAxis<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px) </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">scale(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>transform<span class=\"token punctuation\">.</span>zAxis<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">rotateY(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>transform<span class=\"token punctuation\">.</span>rotateY<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">deg) </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">rotateX(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>transform<span class=\"token punctuation\">.</span>rotateX<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">deg)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> move <span class=\"token operator\">=</span> prevMove <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  move<span class=\"token punctuation\">.</span>frameId <span class=\"token operator\">=</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">moveBoombox</span><span class=\"token punctuation\">(</span>direction<span class=\"token punctuation\">,</span> move<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> move<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"wiring_up_our_controls","title":"Wiring up our controls","isH3":false,"content":"<p>Wiring up out control buttons is comparatively simple — now we can listen for a mouse event on our controls and run this function, as well as stop it when the mouse is released:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// for each of our controls, move the boombox and change the position values</span>\nmoveControls<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">let</span> moving<span class=\"token punctuation\">;</span>\n    el<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mousedown'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> direction <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>control<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>moving <span class=\"token operator\">&amp;&amp;</span> moving<span class=\"token punctuation\">.</span>frameId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span>moving<span class=\"token punctuation\">.</span>frameId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        moving <span class=\"token operator\">=</span> <span class=\"token function\">moveBoombox</span><span class=\"token punctuation\">(</span>direction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mouseup'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>moving <span class=\"token operator\">&amp;&amp;</span> moving<span class=\"token punctuation\">.</span>frameId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span>moving<span class=\"token punctuation\">.</span>frameId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"connecting_our_graph","title":"Connecting Our Graph","isH3":false,"content":"<p>Our HTML contains the audio element we want to be affected by the panner node.</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>audio</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>myCoolTrack.mp3<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>audio</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>We need to grab the source from that element and pipe it into the Web Audio API using the <a href=\"/en-US/docs/Web/API/AudioContext/createMediaElementSource\"><code>AudioContext.createMediaElementSource</code></a>.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// get the audio element</span>\n<span class=\"token keyword\">const</span> audioElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'audio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// pass it into the audio context</span>\n<span class=\"token keyword\">const</span> track <span class=\"token operator\">=</span> audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">createMediaElementSource</span><span class=\"token punctuation\">(</span>audioElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Next we have to connect our audio graph. We connect our input (the track) to our modification node (the panner) to our destination (in this case the speakers).</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>track<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>panner<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>audioCtx<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Let's create a play button, that when clicked will play or pause the audio depending on the current state.</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">data-playing</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>switch<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Play/Pause<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Select our play button</span>\n<span class=\"token keyword\">const</span> playButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nplayButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Check if context is in suspended state (autoplay policy)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>audioContext<span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token string\">'suspended'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Play or pause track depending on state</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>playButton<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>playing <span class=\"token operator\">===</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    audioElement<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    playButton<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>playing <span class=\"token operator\">=</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>playButton<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>playing <span class=\"token operator\">===</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    audioElement<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    playButton<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>playing <span class=\"token operator\">=</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>For a more in depth look at playing/controlling audio and audio graphs check out <a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API\">Using The Web Audio API.</a></p>"}},{"type":"prose","value":{"id":"summary","title":"Summary","isH3":false,"content":"<p>\n  Hopefully, this article has given you an insight into how Web Audio spatialization works, and what each of the <a href=\"/en-US/docs/Web/API/PannerNode\"><code>PannerNode</code></a> properties do (there are quite a few of them).\n  The values can be hard to manipulate sometimes and depending on your use case it can take some time to get them right.\n</p>\n<div class=\"notecard note\" id=\"sect3\">\n  <p>\n    <strong>Note:</strong> There are slight differences in the way the audio spatialization sounds across different browsers.\n    The panner node does some very involved maths under the hood;\n    there are a <a href=\"https://wpt.fyi/results/webaudio/the-audio-api/the-pannernode-interface?label=stable&amp;aligned=true\" class=\"external\" rel=\" noopener\">number of tests here</a> so you can keep track of the status of the inner workings of this node across different platforms.\n  </p>\n</div>\n<p>\n  Again, you can <a href=\"https://mdn.github.io/webaudio-examples/spatialization/\" class=\"external\" rel=\" noopener\">check out the final demo here</a>, and the <a href=\"https://github.com/mdn/webaudio-examples/tree/master/spatialization\" class=\"external\" rel=\" noopener\">final source code is here</a>.\n  There is also a <a href=\"https://codepen.io/Rumyra/pen/MqayoK?editors=0100\" class=\"external\" rel=\" noopener\">Codepen demo too</a>.\n</p>\n<p>\n  If you are working with 3D games and/or WebXR it's a good idea to harness a 3D library to create such functionality, rather than trying to do this all yourself from first principles.\n  We rolled our own in this article to give you an idea of how it works, but you'll save a lot of time by taking advantage of work others have done before you.\n</p>"}}],"toc":[{"text":"Basics of spatialization","id":"basics_of_spatialization"},{"text":"3D boombox demo","id":"3d_boombox_demo"},{"text":"Creating an audio listener","id":"creating_an_audio_listener"},{"text":"Creating a panner node","id":"creating_a_panner_node"},{"text":"Moving the boombox","id":"moving_the_boombox"},{"text":"Wiring up our controls","id":"wiring_up_our_controls"},{"text":"Connecting Our Graph","id":"connecting_our_graph"},{"text":"Summary","id":"summary"}],"summary":"Hopefully, this article has given you an insight into how Web Audio spatialization works, and what each of the PannerNode properties do (there are quite a few of them).\n  The values can be hard to manipulate sometimes and depending on your use case it can take some time to get them right.","popularity":0.0006,"modified":"2022-09-09T05:19:45.000Z","other_translations":[{"title":"Web audio spatialization basics","locale":"fr","native":"Français"},{"title":"Web audio 공간화 기초","locale":"ko","native":"한국어"},{"title":"Web audio 空间化基础","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"en-us/web/api/web_audio_api/web_audio_spatialization_basics","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/web/api/web_audio_api/web_audio_spatialization_basics/index.md","last_commit_url":"https://github.com/mdn/content/commit/f7dae62645a2c735ed6f6ed63f664bf279fdfc4b","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Web","title":"Web technology for developers"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Web_Audio_API","title":"Web Audio API"},{"uri":"/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics","title":"Web audio spatialization basics"}],"pageTitle":"Web audio spatialization basics - Web APIs | MDN","noIndexing":false}}</script></body></html>