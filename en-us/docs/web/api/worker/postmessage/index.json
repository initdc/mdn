{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Worker.postMessage()","mdn_url":"/en-US/docs/Web/API/Worker/postMessage","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/Web_Workers_API\">Web Workers API</a></strong></li><li><strong><a href=\"/en-US/docs/Web/API/Worker\"><code>Worker</code></a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Constructor</summary><ol><li><a href=\"/en-US/docs/Web/API/Worker/Worker\"><code>Worker()</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Methods</summary><ol><li><em><code>postMessage()</code></em></li><li><a href=\"/en-US/docs/Web/API/Worker/terminate\"><code>terminate()</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Events</summary><ol><li><a href=\"/en-US/docs/Web/API/Worker/error_event\"><code>error</code></a></li><li><a href=\"/en-US/docs/Web/API/Worker/message_event\"><code>message</code></a></li><li><a href=\"/en-US/docs/Web/API/Worker/messageerror_event\"><code>messageerror</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Inheritance:</summary><ol><li><a href=\"/en-US/docs/Web/API/EventTarget\"><code>EventTarget</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Related pages for Web Workers API</summary><ol><li><a href=\"/en-US/docs/Web/API/DedicatedWorkerGlobalScope\"><code>DedicatedWorkerGlobalScope</code></a></li><li><a href=\"/en-US/docs/Web/API/ServiceWorker\"><code>ServiceWorker</code></a></li><li><a href=\"/en-US/docs/Web/API/SharedWorker\"><code>SharedWorker</code></a></li><li><a href=\"/en-US/docs/Web/API/SharedWorkerGlobalScope\"><code>SharedWorkerGlobalScope</code></a></li><li><a href=\"/en-US/docs/Web/API/WorkerGlobalScope\"><code>WorkerGlobalScope</code></a></li><li><a href=\"/en-US/docs/Web/API/WorkerLocation\"><code>WorkerLocation</code></a></li><li><a href=\"/en-US/docs/Web/API/WorkerNavigator\"><code>WorkerNavigator</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>The <strong><code>postMessage()</code></strong> method of the <a href=\"/en-US/docs/Web/API/Worker\"><code>Worker</code></a> interface sends a message to the worker's inner scope. This accepts a single parameter, which is the data to send to the worker. The data may be any value or JavaScript object handled by the <a href=\"/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\">structured clone</a> algorithm, which includes cyclical references.</p>\n<p>The <a href=\"/en-US/docs/Web/API/Worker\"><code>Worker</code></a> <code>postMessage()</code> method delegates to the <a href=\"/en-US/docs/Web/API/MessagePort\"><code>MessagePort</code></a> <a href=\"/en-US/docs/Web/API/MessagePort/postMessage\" title=\"postMessage()\"><code>postMessage()</code></a> method, which adds a task on the event loop corresponding to the receiving <a href=\"/en-US/docs/Web/API/MessagePort\"><code>MessagePort</code></a>.</p>\n<p>The <code>Worker</code> can send back information to the thread that spawned it using the <a href=\"/en-US/docs/Web/API/DedicatedWorkerGlobalScope/postMessage\"><code>DedicatedWorkerGlobalScope.postMessage</code></a> method.</p>"}},{"type":"prose","value":{"id":"syntax","title":"Syntax","isH3":false,"content":"<div class=\"code-example\"><pre class=\"brush: js-nolint notranslate\">postMessage(message)\npostMessage(message, transfer)\n</pre></div>"}},{"type":"prose","value":{"id":"parameters","title":"Parameters","isH3":true,"content":"<dl>\n  <dt id=\"message\"><code>message</code></dt>\n  <dd>\n    <p>The object to deliver to the worker; this will be in the <code>data</code> field in the event delivered to the <a href=\"/en-US/docs/Web/API/DedicatedWorkerGlobalScope/message_event\"><code>DedicatedWorkerGlobalScope.message_event</code></a> event. This may be any value or JavaScript object handled by the <a href=\"/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\">structured clone</a> algorithm, which includes cyclical references.</p>\n    <p>If the <code>message</code> parameter is <em>not</em> provided, a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/SyntaxError\"><code>SyntaxError</code></a> will be thrown by the parser. If the data to be passed to the worker is unimportant, <code>null</code> or <code>undefined</code> can be passed explicitly.</p>\n  </dd>\n  <dt id=\"transfer\"><code>transfer</code> <span class=\"badge inline optional\">Optional</span></dt>\n  <dd>\n    <p>An optional <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array\">array</a> of <a href=\"/en-US/docs/Glossary/Transferable_objects\">Transferable Objects</a> to transfer ownership of. If the ownership of an object is transferred, it becomes unusable in the context it was sent from and becomes available only to the worker it was sent to.</p>\n    <p>Transferable objects are instances of classes like <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\"><code>ArrayBuffer</code></a>, <a href=\"/en-US/docs/Web/API/MessagePort\"><code>MessagePort</code></a> or <a href=\"/en-US/docs/Web/API/ImageBitmap\"><code>ImageBitmap</code></a> objects that can be transferred. <code>null</code> is not an acceptable value for <code>transfer</code>.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"return_value","title":"Return value","isH3":true,"content":"<p>None (<a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined\"><code>undefined</code></a>).</p>"}},{"type":"prose","value":{"id":"examples","title":"Examples","isH3":false,"content":"<p>The following code snippet shows the creation of a <a href=\"/en-US/docs/Web/API/Worker\"><code>Worker</code></a> object using the <a href=\"/en-US/docs/Web/API/Worker/Worker\" title=\"Worker()\"><code>Worker()</code></a> constructor. When either of two form inputs (<code>first</code> and <code>second</code>) have their values changed, <a href=\"/en-US/docs/Web/API/HTMLElement/change_event\" title=\"change\"><code>change</code></a> events invoke <code>postMessage()</code> to send the value of both inputs to the current worker.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> myWorker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token string\">'worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfirst<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  myWorker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>first<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> second<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Message posted to worker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nsecond<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  myWorker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>first<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> second<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Message posted to worker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>For a full example, see our <a href=\"https://github.com/mdn/dom-examples/tree/main/web-workers/simple-web-worker\" class=\"external\" rel=\" noopener\">simple worker example</a> (<a href=\"https://mdn.github.io/dom-examples/web-workers/simple-web-worker/\" class=\"external\" rel=\" noopener\">run example</a>).</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> <code>postMessage()</code> can only send a single object at once. As seen above, if you want to pass multiple values you can send an array.</p>\n</div>"}},{"type":"prose","value":{"id":"transfer_example","title":"Transfer Example","isH3":true,"content":"<p>This minimum example has <code>main</code> create an <code>ArrayBuffer</code> and transfer it to <code>myWorker</code>, then has <code>myWorker</code> transfer it back to <code>main</code>, with the size logged at each step.</p>\n<h4 id=\"main.js_code\">main.js code</h4>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// create worker</span>\n<span class=\"token keyword\">const</span> myWorker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myWorker.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// listen for myWorker to transfer the buffer back to main</span>\nmyWorker<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handleMessageFromWorker</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message from worker received in main:\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> bufTransferredBackFromWorker <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"buf.byteLength in main AFTER transfer back from worker:\"</span><span class=\"token punctuation\">,</span>\n    bufTransferredBackFromWorker<span class=\"token punctuation\">.</span>byteLength\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// create the buffer</span>\n<span class=\"token keyword\">const</span> myBuf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"buf.byteLength in main BEFORE transfer to worker:\"</span><span class=\"token punctuation\">,</span>\n  myBuf<span class=\"token punctuation\">.</span>byteLength\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// send myBuf to myWorker and transfer the underlying ArrayBuffer</span>\nmyWorker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>myBuf<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>myBuf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"buf.byteLength in main AFTER transfer to worker:\"</span><span class=\"token punctuation\">,</span>\n  myBuf<span class=\"token punctuation\">.</span>byteLength\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"myworker.js_code\">myWorker.js code</h4>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// listen for main to transfer the buffer to myWorker</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handleMessageFromMain</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message from main received in worker:\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> bufTransferredFromMain <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"buf.byteLength in worker BEFORE transfer back to main:\"</span><span class=\"token punctuation\">,</span>\n    bufTransferredFromMain<span class=\"token punctuation\">.</span>byteLength\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// send buf back to main and transfer the underlying ArrayBuffer</span>\n  self<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>bufTransferredFromMain<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>bufTransferredFromMain<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"buf.byteLength in worker AFTER transfer back to main:\"</span><span class=\"token punctuation\">,</span>\n    bufTransferredFromMain<span class=\"token punctuation\">.</span>byteLength\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"output_logged\">Output logged</h4>\n<div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>buf.byteLength <span class=\"token keyword\">in</span> main BEFORE transfer to worker:        <span class=\"token number\">8</span>                     main.js:19\nbuf.byteLength <span class=\"token keyword\">in</span> main AFTER transfer to worker:         <span class=\"token number\">0</span>                     main.js:27\n\nmessage from main received <span class=\"token keyword\">in</span> worker:                    MessageEvent <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">}</span>  myWorker.js:3\nbuf.byteLength <span class=\"token keyword\">in</span> worker BEFORE transfer back to main:   <span class=\"token number\">8</span>                     myWorker.js:7\nbuf.byteLength <span class=\"token keyword\">in</span> worker AFTER transfer back to main:    <span class=\"token number\">0</span>                     myWorker.js:15\n\nmessage from worker received <span class=\"token keyword\">in</span> main:                    MessageEvent <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">}</span>  main.js:6\nbuf.byteLength <span class=\"token keyword\">in</span> main AFTER transfer back from worker:  <span class=\"token number\">8</span>                     main.js:10\n</code></pre></div>\n<p><code>byteLength</code> goes to 0 after the <code>ArrayBuffer</code> is transferred. For a more sophisticated full working example of <code>ArrayBuffer</code> transfer, see this Firefox demo add-on: <a href=\"https://github.com/Noitidart/ChromeWorker/tree/aca57d9cadc4e68af16201bdecbfb6f9a6f9ca6b\" class=\"external\" rel=\" noopener\">GitHub :: ChromeWorker - demo-transfer-arraybuffer</a></p>"}},{"type":"specifications","value":{"title":"Specifications","id":"specifications","isH3":false,"specifications":[{"bcdSpecificationURL":"https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage-dev","title":"HTML Standard"}],"query":"api.Worker.postMessage"}},{"type":"browser_compatibility","value":{"title":"Browser compatibility","id":"browser_compatibility","isH3":false,"query":"api.Worker.postMessage","dataURL":"/en-US/docs/Web/API/Worker/postMessage/bcd.json"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li>The <a href=\"/en-US/docs/Web/API/Worker\"><code>Worker</code></a> interface it belongs to.</li>\n</ul>"}}],"toc":[{"text":"Syntax","id":"syntax"},{"text":"Examples","id":"examples"},{"text":"Specifications","id":"specifications"},{"text":"Browser compatibility","id":"browser_compatibility"},{"text":"See also","id":"see_also"}],"summary":"The postMessage() method of the Worker interface sends a message to the worker's inner scope. This accepts a single parameter, which is the data to send to the worker. The data may be any value or JavaScript object handled by the structured clone algorithm, which includes cyclical references.","popularity":0.0024,"modified":"2022-09-23T02:33:16.000Z","other_translations":[{"title":"Worker.postMessage()","locale":"fr","native":"Français"},{"title":"Worker.postMessage()","locale":"ja","native":"日本語"},{"title":"Worker.postMessage()","locale":"ko","native":"한국어"},{"title":"Worker.postMessage()","locale":"ru","native":"Русский"},{"title":"Worker.postMessage()","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"en-us/web/api/worker/postmessage","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/web/api/worker/postmessage/index.md","last_commit_url":"https://github.com/mdn/content/commit/423bcae3e72a30248fdb446b0b036d4cb5df47b1","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Web","title":"Web technology for developers"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Worker","title":"Worker"},{"uri":"/en-US/docs/Web/API/Worker/postMessage","title":"Worker.postMessage()"}],"pageTitle":"Worker.postMessage() - Web APIs | MDN","noIndexing":false}}