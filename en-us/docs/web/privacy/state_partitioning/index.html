<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>State Partitioning - Privacy, permissions, and information security | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><meta name="description" content="State Partitioning is a broad effort to rework how Firefox manages client-side
  state (i.e., data stored in the browser) to mitigate the ability of websites
  to abuse state for cross-site tracking. This effort aims to
  achieve that by providing what is effectively a &quot;different&quot;, isolated storage
  location to every website a user visits. This article gives an overview of
  the mechanism, lists the affected APIs and explains how to debug affected
  sites."><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/Web/Privacy/State_Partitioning"><meta property="og:title" content="State Partitioning - Privacy, permissions, and information security | MDN"><meta property="og:description" content="State Partitioning is a broad effort to rework how Firefox manages client-side
  state (i.e., data stored in the browser) to mitigate the ability of websites
  to abuse state for cross-site tracking. This effort aims to
  achieve that by providing what is effectively a &quot;different&quot;, isolated storage
  location to every website a user visits. This article gives an overview of
  the mechanism, lists the affected APIs and explains how to debug affected
  sites."><meta property="og:locale" content="en-US"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/Web/Privacy/State_Partitioning"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> 🌐</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> 🌐</a></li></ul></li></ul></nav><div class="header-search"><form action="/en-US/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web"><span property="name">Web technology for developers</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/en-US/docs/Web/Privacy"><span property="name">Privacy, permissions, and information security</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/en-US/docs/Web/Privacy/State_Partitioning"><span property="name">State Partitioning</span></a><meta property="position" content="3"></li></ol></nav></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#motivation">Motivation</a></li><li><a href="#state_partitioning">State Partitioning</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="en-US"><h1>State Partitioning</h1><div><p>
  State Partitioning is a broad effort to rework how Firefox manages client-side
  state (i.e., data stored in the browser) to mitigate the ability of websites
  to abuse state for cross-site tracking. This effort aims to
  achieve that by providing what is effectively a "different", isolated storage
  location to every website a user visits. This article gives an overview of
  the mechanism, lists the affected APIs and explains how to debug affected
  sites.
</p>
<p>
  State Partitioning is currently turned on by default in the Firefox Nightly
  channel. A subset of the state partitioning efforts (namely <a href="#network_partitioning">network partitioning</a>) has been enabled by default in the release channel
  of Firefox since version 85.
</p></div><h2 id="motivation"><a href="#motivation" title="Permalink to Motivation">Motivation</a></h2><div></div><h3 id="cross-site_tracking_using_shared_state"><a href="#cross-site_tracking_using_shared_state" title="Permalink to Cross-site tracking using shared state">Cross-site tracking using shared state</a></h3><div><p>
  Browsers traditionally key client-side state by the origin (or sometimes
  registrable domain) of the location a resource was loaded from. For example,
  the cookies, localStorage objects, and caches available to an iframe loaded
  from <code>https://example.com/hello.html</code> will be keyed by
  <code>example.com</code>. This is true regardless of whether the browser
  is currently loading resources from that domain as a <em>first-party</em>
  resources or as an embedded <em>third party</em> resources. Trackers have taken
  advantage of this cross-site state to store user identifiers and access them
  across websites. The example below shows how <code>example.com</code> can use
  its cross-site state (in this instance, cookies) to track a user across its
  own site as well as <code>A.example</code> and <code>B.example</code>.
</p>
<p>
  <img src="/en-US/docs/Web/Privacy/State_Partitioning/example-cross-site-state.png" alt="An example of cross-site state" width="635" height="440" loading="lazy">
</p></div><h3 id="past_approaches_to_blocking_cross-site_tracking"><a href="#past_approaches_to_blocking_cross-site_tracking" title="Permalink to Past approaches to blocking cross-site tracking">Past approaches to blocking cross-site tracking</a></h3><div><p>
  Firefox's past cookie policies attempt to mitigate tracking by blocking
  access to some storage APIs (e.g., cookies and localStorage) for certain
  domains under certain conditions. For example, our "block all third-party
  cookies" policy will prevent all domains from accessing certain storage APIs
  when loaded in a third-party context. Our current
  <a href="/en-US/docs/Web/Privacy/Storage_Access_Policy">default cookie policy</a> blocks access in a third-party context only for domains classified as
  trackers.
</p></div><h2 id="state_partitioning"><a href="#state_partitioning" title="Permalink to State Partitioning">State Partitioning</a></h2><div><p>
  State Partitioning is a different approach to preventing cross-site tracking.
  Rather than block access to certain stateful APIs in a third-party context,
  Firefox provides embedded resources with a separate storage
  bucket for every top-level website. More specifically, Firefox double-keys
  all client-side state by the
  <em><a href="https://html.spec.whatwg.org/#origin" class="external" rel=" noopener">origin</a></em>
  of the resource being loaded and by the <em>top-level
<a href="https://html.spec.whatwg.org/multipage/origin.html#site" class="external" rel=" noopener">site</a></em>.
  In most instances, the top-level site is the scheme and eTLD+1 of the top-level
  page being visited by the user.
</p>
<p>
  In the example below <code>example.com</code> is embedded in
  <code>A.example</code> and <code>B.example</code>. However, since storage is
  partitioned, there are three distinct storage buckets (instead of one). The
  tracker can still access storage, but since every storage bucket is
  additionally keyed under the top-level site, the data it has access to on A
  will be different than the data on B. This will prevent a tracker from storing
  an identifier in their cookies when visited directly and then retrieving that
  identifier when embedded in other websites.
</p>
<p>
  <img src="/en-US/docs/Web/Privacy/State_Partitioning/example-state-partitioning.png" alt="An example of state partitioning" width="672" height="401" loading="lazy">
</p></div><h3 id="standardization"><a href="#standardization" title="Permalink to Standardization">Standardization</a></h3><div><p>
  The <a href="https://privacycg.github.io/" class="external" rel=" noopener">Privacy Community Group</a> has a Work Item for
  <a href="https://privacycg.github.io/storage-partitioning/" class="external" rel=" noopener">Client-Side Storage Partitioning</a>. This serves as an overview of the
  standardization efforts for storage partitioning in the individual standards
  affected. We intend to align our state partitioning implementation with these
  efforts as the Work Item is standardized.
</p></div><h3 id="status_of_partitioning_in_firefox"><a href="#status_of_partitioning_in_firefox" title="Permalink to Status of partitioning in Firefox">Status of partitioning in Firefox</a></h3><div><ul>
  <li><a href="#network_partitioning"><strong>Network Partitioning</strong></a>: Enabled by default for all users since Firefox 85.</li>
  <li><a href="#dynamic_state_partitioning"><strong>Dynamic State Partitioning</strong></a>:
    <ul>
      <li>
        Since Firefox 86: Enabled for users that have
        <a href="https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop#w_strict-enhanced-tracking-protection" class="external" rel=" noopener">"Strict" privacy protections</a> enabled.
      </li>
      <li>Since Firefox 90: Enabled in private browsing.</li>
    </ul>
  </li>
</ul></div><h3 id="network_partitioning"><a href="#network_partitioning" title="Permalink to Network Partitioning">Network Partitioning</a></h3><div><p>
  Networking-related APIs are not intended to be used for websites to store
  data, but they can be
  <a href="https://blog.mozilla.org/security/2021/01/26/supercookie-protections/" class="external" rel=" noopener">abused</a>
  for cross-site tracking. As such, the following network APIs and caches are
  <strong>permanently</strong> partitioned by the top-level site.
</p>
<div class="notecard note" id="sect1">
  <p>
    <strong>Note:</strong> Network Partitioning is permanent. Websites can't
    control or relax these restrictions.
  </p>
</div>
<h4 id="partitioned_apis">Partitioned APIs</h4>
<ul>
  <li><a href="/en-US/docs/Web/HTTP/Caching">HTTP Cache</a></li>
  <li>Image Cache</li>
  <li>Favicon Cache</li>
  <li>Connection Pooling</li>
  <li>Stylesheet Cache</li>
  <li><a href="/en-US/docs/Glossary/DNS">DNS</a></li>
  <li>HTTP Authentication</li>
  <li><a href="/en-US/docs/Web/HTTP/Headers/Alt-Svc">Alt-Svc</a></li>
  <li>Speculative Connections</li>
  <li>Fonts &amp; Font Cache</li>
  <li><a href="/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">HSTS</a></li>
  <li>OCSP</li>
  <li>Intermediate CA Cache</li>
  <li>TLS Client Certificates</li>
  <li>TLS Session Identifiers</li>
  <li>Prefetch</li>
  <li>Preconnect</li>
  <li><a href="/en-US/docs/Glossary/Preflight_request">CORS-preflight</a> Cache</li>
  <li>WebRTC deviceID</li>
</ul></div><h3 id="dynamic_partitioning"><a href="#dynamic_partitioning" title="Permalink to Dynamic Partitioning">Dynamic Partitioning</a></h3><div><p>
  To prevent JavaScript accessible storage APIs being used for cross-site
  tracking, Firefox partitions accessible storage by top-level site. This
  mechanism means that, generally, a third-party embedded in one top-level site
  cannot access data stored under another top-level site.
</p>
<p>
  However, unlike Network Partitioning, this boundary is dynamic and access
  to a third-party's unpartitioned storage can be granted:
</p>
<ul>
  <li>using the <a href="#storage_access_api">Storage Access API</a>.</li>
  <li>automatically, such as for third-parties providing federated login.</li>
</ul>
<p>
  Details about automatic grants are provided in the
  <a href="#storage_access_heuristics">Storage Access Heuristics</a> section.
</p>
<h4 id="partitioned_apis_2">Partitioned APIs</h4>
<ul>
  <li><a href="/en-US/docs/Web/API/Document/cookie">Cookies</a></li>
  <li><a href="/en-US/docs/Web/API/Window/localStorage">localStorage</a></li>
  <li><a href="/en-US/docs/Web/API/Window/sessionStorage">sessionStorage</a></li>
  <li><a href="/en-US/docs/Web/API/Cache">DOM Cache</a></li>
  <li><a href="/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a></li>
  <li><a href="/en-US/docs/Web/API/BroadcastChannel">Broadcast Channel</a></li>
  <li><a href="/en-US/docs/Web/API/SharedWorker">Shared Workers</a></li>
</ul>
<p>
  <a href="/en-US/docs/Web/API/Service_Worker_API">Service Workers</a>
  are currently disabled in partitioned contexts when dynamic partitioning is
  enabled. In <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1495241" class="external" rel=" noopener">Bug 1495241</a>
  we are exploring options to enable Service Workers in partitioned contexts.
</p>
<h4 id="storage_access_heuristics">Storage Access Heuristics</h4>
<p>
  To improve web compatibility, Firefox currently includes some heuristics to
  grant unpartitioned storage access automatically to third parties that
  receive user interaction. These heuristics are intended to allow some
  third-party integrations that are common on the web to continue to function.
</p>
<div class="notecard warning" id="sect2">
  <p>
    <strong>Warning:</strong> Storage access heuristics are a transitional
    feature meant to prevent website breakage. They should not be relied upon
    for current and future web development.
  </p>
</div>
<h5 id="opener_heuristics">Opener Heuristics</h5>
<ul>
  <li>
    When a partitioned third-party opens a pop-up window that has
    <a href="/en-US/docs/Web/API/Window/opener">opener access</a> to the
    originating document, the third-party is granted storage access to its
    embedder for 30 days.
  </li>
  <li>
    When a first-party <code>a.example</code> opens a third-party pop-up
    <code>b.example</code>, <code>b.example</code> is granted
    third-party storage access to <code>a.example</code> for 30 days.
  </li>
</ul>
<div class="notecard note" id="sect3">
  <p>
    <strong>Note:</strong> For third-parties which abuse these heuristic for
    tracking purposes, we may require user interaction with the popup before
    storage access is granted.
  </p>
</div>
<h5 id="redirect_heuristics">Redirect Heuristics</h5>
<ul>
  <li>
    If a site <code>b.example</code> redirects to <code>a.example</code>, then
    <code>b.example</code> receives storage access to its embedder
    <code>a.example</code> if both <code>a.example</code> and
    <code>b.example</code> have been visited and interacted with within the
    last 10 minutes. This storage access will be granted for 15 minutes.
  </li>
  <li>
    If a tracker <code>tracker.example</code> (as classified by the Enhanced
    Tracking Protection) redirects to a non-tracker
    <code>a.example</code> and <code>tracker.example</code> received user
    interaction as a first-party within the last 45 days,
    <code>tracker.example</code> is granted storage access to
    <code>a.example</code> for 15 minutes.
  </li>
</ul>
<h4 id="storage_access_api">Storage Access API</h4>
<p>
  Third-party frames may use
  <a href="/en-US/docs/Web/API/Document/requestStorageAccess">document.requestStorageAccess</a> to request unpartitioned storage access through the
  <a href="/en-US/docs/Web/API/Storage_Access_API">Storage Access API</a>. Once
  granted, the requesting third-party will gain access to its first-party
  storage bucket (i.e., the storage it would have access to if visited as a
  first-party). Any calls to <a href="#dynamically_partitioned_apis">dynamically partitioned APIs</a>, for
  example
  <a href="/en-US/docs/Web/API/Window/localStorage">localStorage</a>, will be
  made in context of the first-party bucket.
</p>
<div class="notecard warning" id="sect4">
  <p>
    <strong>Warning:</strong> When storage access is granted there may still
    be references to the partitioned storage. However, sites shouldn't rely on
    being able to use partitioned and unpartitioned storage at the same
    time.
  </p>
</div></div><h3 id="debugging"><a href="#debugging" title="Permalink to Debugging">Debugging</a></h3><div><p>
  We encourage site owners to test their sites, particularly those that rely on
  third-party content integrations. There are several features in Firefox to
  make testing easier.
</p>
<h4 id="logging">Logging</h4>
<p>
  Here is an overview of the messages logged to the web console when interacting
  with storage in a third-party context. In the following examples,
  <code>a.example</code> is the top-level site which embeds the third-party frame
  <code>b.example</code>.
</p>
<table>
  <thead>
    <tr>
      <th>Reason</th>
      <th>Console Message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Storage of a third-party frame is partitioned</td>
      <td>Partitioned cookie or storage access was provided to "b.example" because it is loaded in the third-party context and storage partitioning is enabled.</td>
    </tr>
    <tr>
      <td>Storage access is granted through a <strong>heuristic</strong></td>
      <td>Storage access automatically granted for First-Party isolation "b.example" on "a.example".</td>
    </tr>
    <tr>
      <td>Storage access is granted via the <a href="/en-US/docs/Web/API/Document/requestStorageAccess">StorageAccessAPI</a></td>
      <td>Storage access granted for origin "b.example" on "a.example".</td>
    </tr>
  </tbody>
</table>
<h4 id="clear_third-party_storage-access">Clear Third-Party Storage-Access</h4>
<p>
  If a third-party iframe is granted storage access to the parent context,
  Firefox sets a permission. To revoke access you can clear the permission via
  the <a href="https://support.mozilla.org/en-US/kb/site-information-panel" class="external" rel=" noopener">Site Information Panel</a> in the permissions section under "Cross-site Cookies".
</p>
<h4 id="test_preferences">Test Preferences</h4>
<div class="notecard warning" id="sect5">
  <p>
    <strong>Warning:</strong> Make sure to set these preferences in a separate
    Firefox profile or reset them after testing.
  </p>
</div>
<h5 id="disable_web_compatibility_features">Disable Web Compatibility Features</h5>
<p>
  Setting <code>privacy.antitracking.enableWebcompat</code> to <code>false</code> will <strong>disable</strong> all
  ETP and State Partitioning web-compatibility features. Disabling these features
  can be useful when testing, to ensure your website is fully compatible with the
  State Partitioning mechanism in Firefox and it does not rely on temporary
  heuristics.
</p>
<p>Features disabled by the pref include:</p>
<ul>
  <li>
    <a href="#storage_access_heuristics">Storage access heuristics</a>: Unpartitioned storage
    access can only be acquired via the Storage Access API.
  </li>
  <li>
    Automatic storage access grants:
    <a href="/en-US/docs/Web/API/Document/requestStorageAccess">document.requestStorageAccess</a>
    will always prompt the user.
  </li>
  <li>
    <a href="https://blog.mozilla.org/security/2021/07/13/smartblock-v2/" class="external" rel=" noopener">SmartBlock's "unblock on opt-in" feature</a>, which
    will allow certain trackers when users interact with them.
  </li>
  <li>
    Any temporary <a href="https://wiki.mozilla.org/Security/Anti_tracking_policy#Temporary_Web_Compatibility_Interventions" class="external" rel=" noopener">anti-tracking exceptions</a>
    granted to websites via the skip-listing mechanism.
  </li>
</ul>
<h5 id="disable_heuristics">Disable Heuristics</h5>
<p>
  The following preferences can be used to disable individual storage access
  heuristics via the
  <a href="https://support.mozilla.org/en-US/kb/about-config-editor-firefox" class="external" rel=" noopener">config editor</a>:
</p>
<ul>
  <li>
    Enable / disable the <a href="#storage_access_redirect_heuristics">redirect heuristics</a>:
    <code>privacy.restrict3rdpartystorage.heuristic.recently_visited</code>,
    <code>privacy.restrict3rdpartystorage.heuristic.redirect</code>
  </li>
  <li>
    Enable / disable the <a href="#storage_access_window_open_heuristics">window open heuristics</a>:
    <code>privacy.restrict3rdpartystorage.heuristic.window_open</code>,
    <code>privacy.restrict3rdpartystorage.heuristic.opened_window_after_interaction</code>
  </li>
</ul>
<h5 id="disable_network_partitioning">Disable Network Partitioning</h5>
<p>
  Network partitioning can be disabled with the
  <code>privacy.partition.network_state</code> pref.
</p>
<h5 id="disable_dynamic_state_partitioning">Disable Dynamic State Partitioning</h5>
<p>
  To disable dynamic storage partitioning for all sites you can use the
  <code>network.cookie.cookieBehavior</code> pref:
</p>
<table>
  <thead>
    <tr>
      <th>Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>5</td>
      <td>Reject (known) trackers and partition third-party storage.</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Only reject trackers (Storage partitioning disabled).</td>
    </tr>
    <tr>
      <td>0</td>
      <td>Allow all</td>
    </tr>
  </tbody>
</table>
<h5 id="exempt_specific_origins_from_partitioning">Exempt specific origins from partitioning</h5>
<p>
  Dynamic State Partitioning can also be disabled for specific
  origins with the <code>privacy.restrict3rdpartystorage.skip_list</code>
  preference. This pref holds a comma separated list of origins to exempt.
  The pref value should follow the following format
  <code>first-party_origin_1,third-party_origin_1;first-party_origin_2,third-party_origin_2;...</code>.
</p>
<p>
  For example, to disable partitioning for <code>tracker.example</code>
  on <code>example.com</code> and for <code>social.example</code> on
  <code>news.example</code>, you would set the pref to the following:
</p>
<pre class="notranslate">https://tracker.example,http://example.com;https://social.example,https://news.example
</pre></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/style/old/files/en-us/web/privacy/state_partitioning/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/blob/style/old/files/en-us/web/privacy/state_partitioning/index.md" title="Folder: en-us/web/privacy/state_partitioning (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FPrivacy%2FState_Partitioning%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fprivacy%2Fstate_partitioning%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FPrivacy%2FState_Partitioning%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fstyle%2Fold%2Ffiles%2Fen-us%2Fweb%2Fprivacy%2Fstate_partitioning%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2Ff4f8e2f18ccf19a0bee59e1fe78753e276b98232%0A*+Document+last+modified%3A+2022-09-09T07%3A06%3A10.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22State+Partitioning%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2CContent%3AOther" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-09-09T07:06:10.000Z">Sep 9, 2022</time>,<!-- --> <a href="/en-US/docs/Web/Privacy/State_Partitioning/contributors.txt">by MDN contributors</a></p></div></aside></main></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/en-US/docs/Web">Web Technologies</a></li><li><a href="/en-US/docs/Learn">Learn Web Development</a></li><li><a href="/en-US/docs/MDN/About">About MDN</a></li><li><a href="/en-US/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"State Partitioning","mdn_url":"/en-US/docs/Web/Privacy/State_Partitioning","locale":"en-US","native":"English (US)","sidebarHTML":"","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>\n  State Partitioning is a broad effort to rework how Firefox manages client-side\n  state (i.e., data stored in the browser) to mitigate the ability of websites\n  to abuse state for cross-site tracking. This effort aims to\n  achieve that by providing what is effectively a \"different\", isolated storage\n  location to every website a user visits. This article gives an overview of\n  the mechanism, lists the affected APIs and explains how to debug affected\n  sites.\n</p>\n<p>\n  State Partitioning is currently turned on by default in the Firefox Nightly\n  channel. A subset of the state partitioning efforts (namely <a href=\"#network_partitioning\">network partitioning</a>) has been enabled by default in the release channel\n  of Firefox since version 85.\n</p>"}},{"type":"prose","value":{"id":"motivation","title":"Motivation","isH3":false,"content":""}},{"type":"prose","value":{"id":"cross-site_tracking_using_shared_state","title":"Cross-site tracking using shared state","isH3":true,"content":"<p>\n  Browsers traditionally key client-side state by the origin (or sometimes\n  registrable domain) of the location a resource was loaded from. For example,\n  the cookies, localStorage objects, and caches available to an iframe loaded\n  from <code>https://example.com/hello.html</code> will be keyed by\n  <code>example.com</code>. This is true regardless of whether the browser\n  is currently loading resources from that domain as a <em>first-party</em>\n  resources or as an embedded <em>third party</em> resources. Trackers have taken\n  advantage of this cross-site state to store user identifiers and access them\n  across websites. The example below shows how <code>example.com</code> can use\n  its cross-site state (in this instance, cookies) to track a user across its\n  own site as well as <code>A.example</code> and <code>B.example</code>.\n</p>\n<p>\n  <img src=\"/en-US/docs/Web/Privacy/State_Partitioning/example-cross-site-state.png\" alt=\"An example of cross-site state\" width=\"635\" height=\"440\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"past_approaches_to_blocking_cross-site_tracking","title":"Past approaches to blocking cross-site tracking","isH3":true,"content":"<p>\n  Firefox's past cookie policies attempt to mitigate tracking by blocking\n  access to some storage APIs (e.g., cookies and localStorage) for certain\n  domains under certain conditions. For example, our \"block all third-party\n  cookies\" policy will prevent all domains from accessing certain storage APIs\n  when loaded in a third-party context. Our current\n  <a href=\"/en-US/docs/Web/Privacy/Storage_Access_Policy\">default cookie policy</a> blocks access in a third-party context only for domains classified as\n  trackers.\n</p>"}},{"type":"prose","value":{"id":"state_partitioning","title":"State Partitioning","isH3":false,"content":"<p>\n  State Partitioning is a different approach to preventing cross-site tracking.\n  Rather than block access to certain stateful APIs in a third-party context,\n  Firefox provides embedded resources with a separate storage\n  bucket for every top-level website. More specifically, Firefox double-keys\n  all client-side state by the\n  <em><a href=\"https://html.spec.whatwg.org/#origin\" class=\"external\" rel=\" noopener\">origin</a></em>\n  of the resource being loaded and by the <em>top-level\n<a href=\"https://html.spec.whatwg.org/multipage/origin.html#site\" class=\"external\" rel=\" noopener\">site</a></em>.\n  In most instances, the top-level site is the scheme and eTLD+1 of the top-level\n  page being visited by the user.\n</p>\n<p>\n  In the example below <code>example.com</code> is embedded in\n  <code>A.example</code> and <code>B.example</code>. However, since storage is\n  partitioned, there are three distinct storage buckets (instead of one). The\n  tracker can still access storage, but since every storage bucket is\n  additionally keyed under the top-level site, the data it has access to on A\n  will be different than the data on B. This will prevent a tracker from storing\n  an identifier in their cookies when visited directly and then retrieving that\n  identifier when embedded in other websites.\n</p>\n<p>\n  <img src=\"/en-US/docs/Web/Privacy/State_Partitioning/example-state-partitioning.png\" alt=\"An example of state partitioning\" width=\"672\" height=\"401\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"standardization","title":"Standardization","isH3":true,"content":"<p>\n  The <a href=\"https://privacycg.github.io/\" class=\"external\" rel=\" noopener\">Privacy Community Group</a> has a Work Item for\n  <a href=\"https://privacycg.github.io/storage-partitioning/\" class=\"external\" rel=\" noopener\">Client-Side Storage Partitioning</a>. This serves as an overview of the\n  standardization efforts for storage partitioning in the individual standards\n  affected. We intend to align our state partitioning implementation with these\n  efforts as the Work Item is standardized.\n</p>"}},{"type":"prose","value":{"id":"status_of_partitioning_in_firefox","title":"Status of partitioning in Firefox","isH3":true,"content":"<ul>\n  <li><a href=\"#network_partitioning\"><strong>Network Partitioning</strong></a>: Enabled by default for all users since Firefox 85.</li>\n  <li><a href=\"#dynamic_state_partitioning\"><strong>Dynamic State Partitioning</strong></a>:\n    <ul>\n      <li>\n        Since Firefox 86: Enabled for users that have\n        <a href=\"https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop#w_strict-enhanced-tracking-protection\" class=\"external\" rel=\" noopener\">\"Strict\" privacy protections</a> enabled.\n      </li>\n      <li>Since Firefox 90: Enabled in private browsing.</li>\n    </ul>\n  </li>\n</ul>"}},{"type":"prose","value":{"id":"network_partitioning","title":"Network Partitioning","isH3":true,"content":"<p>\n  Networking-related APIs are not intended to be used for websites to store\n  data, but they can be\n  <a href=\"https://blog.mozilla.org/security/2021/01/26/supercookie-protections/\" class=\"external\" rel=\" noopener\">abused</a>\n  for cross-site tracking. As such, the following network APIs and caches are\n  <strong>permanently</strong> partitioned by the top-level site.\n</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p>\n    <strong>Note:</strong> Network Partitioning is permanent. Websites can't\n    control or relax these restrictions.\n  </p>\n</div>\n<h4 id=\"partitioned_apis\">Partitioned APIs</h4>\n<ul>\n  <li><a href=\"/en-US/docs/Web/HTTP/Caching\">HTTP Cache</a></li>\n  <li>Image Cache</li>\n  <li>Favicon Cache</li>\n  <li>Connection Pooling</li>\n  <li>Stylesheet Cache</li>\n  <li><a href=\"/en-US/docs/Glossary/DNS\">DNS</a></li>\n  <li>HTTP Authentication</li>\n  <li><a href=\"/en-US/docs/Web/HTTP/Headers/Alt-Svc\">Alt-Svc</a></li>\n  <li>Speculative Connections</li>\n  <li>Fonts &amp; Font Cache</li>\n  <li><a href=\"/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security\">HSTS</a></li>\n  <li>OCSP</li>\n  <li>Intermediate CA Cache</li>\n  <li>TLS Client Certificates</li>\n  <li>TLS Session Identifiers</li>\n  <li>Prefetch</li>\n  <li>Preconnect</li>\n  <li><a href=\"/en-US/docs/Glossary/Preflight_request\">CORS-preflight</a> Cache</li>\n  <li>WebRTC deviceID</li>\n</ul>"}},{"type":"prose","value":{"id":"dynamic_partitioning","title":"Dynamic Partitioning","isH3":true,"content":"<p>\n  To prevent JavaScript accessible storage APIs being used for cross-site\n  tracking, Firefox partitions accessible storage by top-level site. This\n  mechanism means that, generally, a third-party embedded in one top-level site\n  cannot access data stored under another top-level site.\n</p>\n<p>\n  However, unlike Network Partitioning, this boundary is dynamic and access\n  to a third-party's unpartitioned storage can be granted:\n</p>\n<ul>\n  <li>using the <a href=\"#storage_access_api\">Storage Access API</a>.</li>\n  <li>automatically, such as for third-parties providing federated login.</li>\n</ul>\n<p>\n  Details about automatic grants are provided in the\n  <a href=\"#storage_access_heuristics\">Storage Access Heuristics</a> section.\n</p>\n<h4 id=\"partitioned_apis_2\">Partitioned APIs</h4>\n<ul>\n  <li><a href=\"/en-US/docs/Web/API/Document/cookie\">Cookies</a></li>\n  <li><a href=\"/en-US/docs/Web/API/Window/localStorage\">localStorage</a></li>\n  <li><a href=\"/en-US/docs/Web/API/Window/sessionStorage\">sessionStorage</a></li>\n  <li><a href=\"/en-US/docs/Web/API/Cache\">DOM Cache</a></li>\n  <li><a href=\"/en-US/docs/Web/API/IndexedDB_API\">IndexedDB</a></li>\n  <li><a href=\"/en-US/docs/Web/API/BroadcastChannel\">Broadcast Channel</a></li>\n  <li><a href=\"/en-US/docs/Web/API/SharedWorker\">Shared Workers</a></li>\n</ul>\n<p>\n  <a href=\"/en-US/docs/Web/API/Service_Worker_API\">Service Workers</a>\n  are currently disabled in partitioned contexts when dynamic partitioning is\n  enabled. In <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1495241\" class=\"external\" rel=\" noopener\">Bug 1495241</a>\n  we are exploring options to enable Service Workers in partitioned contexts.\n</p>\n<h4 id=\"storage_access_heuristics\">Storage Access Heuristics</h4>\n<p>\n  To improve web compatibility, Firefox currently includes some heuristics to\n  grant unpartitioned storage access automatically to third parties that\n  receive user interaction. These heuristics are intended to allow some\n  third-party integrations that are common on the web to continue to function.\n</p>\n<div class=\"notecard warning\" id=\"sect2\">\n  <p>\n    <strong>Warning:</strong> Storage access heuristics are a transitional\n    feature meant to prevent website breakage. They should not be relied upon\n    for current and future web development.\n  </p>\n</div>\n<h5 id=\"opener_heuristics\">Opener Heuristics</h5>\n<ul>\n  <li>\n    When a partitioned third-party opens a pop-up window that has\n    <a href=\"/en-US/docs/Web/API/Window/opener\">opener access</a> to the\n    originating document, the third-party is granted storage access to its\n    embedder for 30 days.\n  </li>\n  <li>\n    When a first-party <code>a.example</code> opens a third-party pop-up\n    <code>b.example</code>, <code>b.example</code> is granted\n    third-party storage access to <code>a.example</code> for 30 days.\n  </li>\n</ul>\n<div class=\"notecard note\" id=\"sect3\">\n  <p>\n    <strong>Note:</strong> For third-parties which abuse these heuristic for\n    tracking purposes, we may require user interaction with the popup before\n    storage access is granted.\n  </p>\n</div>\n<h5 id=\"redirect_heuristics\">Redirect Heuristics</h5>\n<ul>\n  <li>\n    If a site <code>b.example</code> redirects to <code>a.example</code>, then\n    <code>b.example</code> receives storage access to its embedder\n    <code>a.example</code> if both <code>a.example</code> and\n    <code>b.example</code> have been visited and interacted with within the\n    last 10 minutes. This storage access will be granted for 15 minutes.\n  </li>\n  <li>\n    If a tracker <code>tracker.example</code> (as classified by the Enhanced\n    Tracking Protection) redirects to a non-tracker\n    <code>a.example</code> and <code>tracker.example</code> received user\n    interaction as a first-party within the last 45 days,\n    <code>tracker.example</code> is granted storage access to\n    <code>a.example</code> for 15 minutes.\n  </li>\n</ul>\n<h4 id=\"storage_access_api\">Storage Access API</h4>\n<p>\n  Third-party frames may use\n  <a href=\"/en-US/docs/Web/API/Document/requestStorageAccess\">document.requestStorageAccess</a> to request unpartitioned storage access through the\n  <a href=\"/en-US/docs/Web/API/Storage_Access_API\">Storage Access API</a>. Once\n  granted, the requesting third-party will gain access to its first-party\n  storage bucket (i.e., the storage it would have access to if visited as a\n  first-party). Any calls to <a href=\"#dynamically_partitioned_apis\">dynamically partitioned APIs</a>, for\n  example\n  <a href=\"/en-US/docs/Web/API/Window/localStorage\">localStorage</a>, will be\n  made in context of the first-party bucket.\n</p>\n<div class=\"notecard warning\" id=\"sect4\">\n  <p>\n    <strong>Warning:</strong> When storage access is granted there may still\n    be references to the partitioned storage. However, sites shouldn't rely on\n    being able to use partitioned and unpartitioned storage at the same\n    time.\n  </p>\n</div>"}},{"type":"prose","value":{"id":"debugging","title":"Debugging","isH3":true,"content":"<p>\n  We encourage site owners to test their sites, particularly those that rely on\n  third-party content integrations. There are several features in Firefox to\n  make testing easier.\n</p>\n<h4 id=\"logging\">Logging</h4>\n<p>\n  Here is an overview of the messages logged to the web console when interacting\n  with storage in a third-party context. In the following examples,\n  <code>a.example</code> is the top-level site which embeds the third-party frame\n  <code>b.example</code>.\n</p>\n<table>\n  <thead>\n    <tr>\n      <th>Reason</th>\n      <th>Console Message</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Storage of a third-party frame is partitioned</td>\n      <td>Partitioned cookie or storage access was provided to \"b.example\" because it is loaded in the third-party context and storage partitioning is enabled.</td>\n    </tr>\n    <tr>\n      <td>Storage access is granted through a <strong>heuristic</strong></td>\n      <td>Storage access automatically granted for First-Party isolation \"b.example\" on \"a.example\".</td>\n    </tr>\n    <tr>\n      <td>Storage access is granted via the <a href=\"/en-US/docs/Web/API/Document/requestStorageAccess\">StorageAccessAPI</a></td>\n      <td>Storage access granted for origin \"b.example\" on \"a.example\".</td>\n    </tr>\n  </tbody>\n</table>\n<h4 id=\"clear_third-party_storage-access\">Clear Third-Party Storage-Access</h4>\n<p>\n  If a third-party iframe is granted storage access to the parent context,\n  Firefox sets a permission. To revoke access you can clear the permission via\n  the <a href=\"https://support.mozilla.org/en-US/kb/site-information-panel\" class=\"external\" rel=\" noopener\">Site Information Panel</a> in the permissions section under \"Cross-site Cookies\".\n</p>\n<h4 id=\"test_preferences\">Test Preferences</h4>\n<div class=\"notecard warning\" id=\"sect5\">\n  <p>\n    <strong>Warning:</strong> Make sure to set these preferences in a separate\n    Firefox profile or reset them after testing.\n  </p>\n</div>\n<h5 id=\"disable_web_compatibility_features\">Disable Web Compatibility Features</h5>\n<p>\n  Setting <code>privacy.antitracking.enableWebcompat</code> to <code>false</code> will <strong>disable</strong> all\n  ETP and State Partitioning web-compatibility features. Disabling these features\n  can be useful when testing, to ensure your website is fully compatible with the\n  State Partitioning mechanism in Firefox and it does not rely on temporary\n  heuristics.\n</p>\n<p>Features disabled by the pref include:</p>\n<ul>\n  <li>\n    <a href=\"#storage_access_heuristics\">Storage access heuristics</a>: Unpartitioned storage\n    access can only be acquired via the Storage Access API.\n  </li>\n  <li>\n    Automatic storage access grants:\n    <a href=\"/en-US/docs/Web/API/Document/requestStorageAccess\">document.requestStorageAccess</a>\n    will always prompt the user.\n  </li>\n  <li>\n    <a href=\"https://blog.mozilla.org/security/2021/07/13/smartblock-v2/\" class=\"external\" rel=\" noopener\">SmartBlock's \"unblock on opt-in\" feature</a>, which\n    will allow certain trackers when users interact with them.\n  </li>\n  <li>\n    Any temporary <a href=\"https://wiki.mozilla.org/Security/Anti_tracking_policy#Temporary_Web_Compatibility_Interventions\" class=\"external\" rel=\" noopener\">anti-tracking exceptions</a>\n    granted to websites via the skip-listing mechanism.\n  </li>\n</ul>\n<h5 id=\"disable_heuristics\">Disable Heuristics</h5>\n<p>\n  The following preferences can be used to disable individual storage access\n  heuristics via the\n  <a href=\"https://support.mozilla.org/en-US/kb/about-config-editor-firefox\" class=\"external\" rel=\" noopener\">config editor</a>:\n</p>\n<ul>\n  <li>\n    Enable / disable the <a href=\"#storage_access_redirect_heuristics\">redirect heuristics</a>:\n    <code>privacy.restrict3rdpartystorage.heuristic.recently_visited</code>,\n    <code>privacy.restrict3rdpartystorage.heuristic.redirect</code>\n  </li>\n  <li>\n    Enable / disable the <a href=\"#storage_access_window_open_heuristics\">window open heuristics</a>:\n    <code>privacy.restrict3rdpartystorage.heuristic.window_open</code>,\n    <code>privacy.restrict3rdpartystorage.heuristic.opened_window_after_interaction</code>\n  </li>\n</ul>\n<h5 id=\"disable_network_partitioning\">Disable Network Partitioning</h5>\n<p>\n  Network partitioning can be disabled with the\n  <code>privacy.partition.network_state</code> pref.\n</p>\n<h5 id=\"disable_dynamic_state_partitioning\">Disable Dynamic State Partitioning</h5>\n<p>\n  To disable dynamic storage partitioning for all sites you can use the\n  <code>network.cookie.cookieBehavior</code> pref:\n</p>\n<table>\n  <thead>\n    <tr>\n      <th>Value</th>\n      <th>Description</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>5</td>\n      <td>Reject (known) trackers and partition third-party storage.</td>\n    </tr>\n    <tr>\n      <td>4</td>\n      <td>Only reject trackers (Storage partitioning disabled).</td>\n    </tr>\n    <tr>\n      <td>0</td>\n      <td>Allow all</td>\n    </tr>\n  </tbody>\n</table>\n<h5 id=\"exempt_specific_origins_from_partitioning\">Exempt specific origins from partitioning</h5>\n<p>\n  Dynamic State Partitioning can also be disabled for specific\n  origins with the <code>privacy.restrict3rdpartystorage.skip_list</code>\n  preference. This pref holds a comma separated list of origins to exempt.\n  The pref value should follow the following format\n  <code>first-party_origin_1,third-party_origin_1;first-party_origin_2,third-party_origin_2;...</code>.\n</p>\n<p>\n  For example, to disable partitioning for <code>tracker.example</code>\n  on <code>example.com</code> and for <code>social.example</code> on\n  <code>news.example</code>, you would set the pref to the following:\n</p>\n<pre class=\"notranslate\">https://tracker.example,http://example.com;https://social.example,https://news.example\n</pre>"}}],"toc":[{"text":"Motivation","id":"motivation"},{"text":"State Partitioning","id":"state_partitioning"}],"summary":"State Partitioning is a broad effort to rework how Firefox manages client-side\n  state (i.e., data stored in the browser) to mitigate the ability of websites\n  to abuse state for cross-site tracking. This effort aims to\n  achieve that by providing what is effectively a \"different\", isolated storage\n  location to every website a user visits. This article gives an overview of\n  the mechanism, lists the affected APIs and explains how to debug affected\n  sites.","popularity":0.0018,"modified":"2022-09-09T07:06:10.000Z","source":{"folder":"en-us/web/privacy/state_partitioning","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/web/privacy/state_partitioning/index.md","last_commit_url":"https://github.com/mdn/content/commit/f4f8e2f18ccf19a0bee59e1fe78753e276b98232","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Web","title":"Web technology for developers"},{"uri":"/en-US/docs/Web/Privacy","title":"Privacy, permissions, and information security"},{"uri":"/en-US/docs/Web/Privacy/State_Partitioning","title":"State Partitioning"}],"pageTitle":"State Partitioning - Privacy, permissions, and information security | MDN","noIndexing":false}}</script></body></html>