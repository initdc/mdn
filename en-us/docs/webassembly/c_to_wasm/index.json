{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Compiling a New C/C++ Module to WebAssembly","mdn_url":"/en-US/docs/WebAssembly/C_to_wasm","locale":"en-US","native":"English (US)","sidebarHTML":"\n\n<ol>\n  <li data-default-state=\"open\"><a href=\"/en-US/docs/WebAssembly\"><strong>WebAssembly home page</strong></a>\n  </li><li class=\"toggle\">\n    <details open=\"\">\n      <summary>Tutorials</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/WebAssembly/Concepts\">WebAssembly concepts</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/C_to_wasm\">Compiling from C/C++ to WebAssembly</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Rust_to_wasm\">Compiling from Rust to WebAssembly</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Using_the_JavaScript_API\">Using the WebAssembly JavaScript API</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Understanding_the_text_format\">Understanding WebAssembly text format</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Text_format_to_wasm\">Converting WebAssembly text format to wasm</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Loading_and_running\">Loading and running WebAssembly code</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Caching_modules\">Caching compiled WebAssembly modules</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Exported_functions\">Exported WebAssembly functions</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>Object reference</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface\"><code>WebAssembly</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Module\"><code>WebAssembly.Module</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Global\"><code>WebAssembly.Global</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Instance\"><code>WebAssembly.Instance</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory\"><code>WebAssembly.Memory</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Table\"><code>WebAssembly.Table</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/CompileError\"><code>WebAssembly.CompileError</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/LinkError\"><code>WebAssembly.LinkError</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/RuntimeError\"><code>WebAssembly.RuntimeError</code></a></li>\n      </ol>\n    </details>\n  </li>\n</ol>\n\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>When you've written a new code module in a language like C/C++, you can compile it into WebAssembly using a tool like <a href=\"https://emscripten.org/\" class=\"external\" rel=\" noopener\">Emscripten</a>. Let's look at how it works.</p>"}},{"type":"prose","value":{"id":"emscripten_environment_setup","title":"Emscripten Environment Setup","isH3":false,"content":"<p>First, let's set up the required development environment.</p>"}},{"type":"prose","value":{"id":"prerequisites","title":"Prerequisites","isH3":true,"content":"<p>Get the Emscripten SDK, using these instructions: <a href=\"https://emscripten.org/docs/getting_started/downloads.html\" class=\"external\" rel=\" noopener\">https://emscripten.org/docs/getting_started/downloads.html</a></p>"}},{"type":"prose","value":{"id":"compiling_an_example","title":"Compiling an example","isH3":false,"content":"<p>With the environment set up, let's look at how to use it to compile a C example to Emscripten. There are a number of options available when compiling with Emscripten, but the main two scenarios we'll cover are:</p>\n<ul>\n  <li>Compiling to wasm and creating HTML to run our code in, plus all the JavaScript \"glue\" code needed to run the wasm in the web environment.</li>\n  <li>Compiling to wasm and just creating the JavaScript.</li>\n</ul>\n<p>We will look at both below.</p>"}},{"type":"prose","value":{"id":"creating_html_and_javascript","title":"Creating HTML and JavaScript","isH3":true,"content":"<p>This is the simplest case we'll look at, whereby you get emscripten to generate everything you need to run your code, as WebAssembly, in the browser.</p>\n<ol>\n  <li>First we need an example to compile. Take a copy of the following simple C example, and save it in a file called <code>hello.c</code> in a new directory on your local drive:\n    <div class=\"code-example\"><pre class=\"brush: cpp notranslate\"><code><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n  </li>\n  <li>Now, using the terminal window you used to enter the Emscripten compiler environment, navigate to the same directory as your <code>hello.c</code> file, and run the following command:\n    <div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>emcc hello.c -o hello.html\n</code></pre></div>\n  </li>\n</ol>\n<p>The options we've passed in with the command are as follows:</p>\n<ul>\n  <li><code>-o hello.html</code> — Specifies that we want Emscripten to generate an HTML page to run our code in (and a filename to use), as well as the wasm module and the JavaScript \"glue\" code to compile and instantiate the wasm so it can be used in the web environment.</li>\n</ul>\n<p>At this point in your source directory you should have:</p>\n<ul>\n  <li>The binary wasm module code (<code>hello.wasm</code>)</li>\n  <li>A JavaScript file containing glue code to translate between the native C functions, and JavaScript/wasm (<code>hello.js</code>)</li>\n  <li>An HTML file to load, compile, and instantiate your wasm code, and display its output in the browser (<code>hello.html</code>)</li>\n</ul>"}},{"type":"prose","value":{"id":"running_your_example","title":"Running your example","isH3":true,"content":"<p>Now all that remains is for you to load the resulting <code>hello.html</code> in a browser that supports WebAssembly. It is enabled by default from Firefox 52, Chrome 57, Edge 57, Opera 44.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> If you try to open generated HTML file (<code>hello.html</code>) directly from your local hard drive (e.g. <code>file://your_path/hello.html</code>), you will end up with an error message along the lines of <em><code>both async and sync fetching of the wasm failed</code>.</em> You need to run your HTML file through an HTTP server (<code>http://</code>) — see <a href=\"/en-US/docs/Learn/Common_questions/set_up_a_local_testing_server\">How do you set up a local testing server?</a> for more information.</p>\n</div>\n<p>\n  If everything has worked as planned, you should see \"Hello world\" output in the Emscripten console appearing on the web page, and your browser's JavaScript console. Congratulations, you've just compiled C to WebAssembly and run it in your browser!\n  \n  <img src=\"/en-US/docs/WebAssembly/C_to_wasm/helloworld.png\" alt=\"image\" width=\"1366\" height=\"676\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"using_a_custom_html_template","title":"Using a custom HTML template","isH3":true,"content":"<p>Sometimes you will want to use a custom HTML template. Let's look at how we can do this.</p>\n<ol>\n  <li>First of all, save the following C code in a file called <code>hello2.c</code>, in a new directory:\n    <div class=\"code-example\"><pre class=\"brush: cpp notranslate\"><code><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n  </li>\n  <li>Search for the file <code>shell_minimal.html</code> in your emsdk repo. Copy it into a subdirectory called <code>html_template</code> inside your previous new directory.</li>\n  <li>Now navigate into your new directory (again, in your Emscripten compiler environment terminal window), and run the following command:\n    <div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>emcc -o hello2.html hello2.c -O3 --shell-file html_template/shell_minimal.html\n</code></pre></div>The options we've passed are slightly different this time:\n    <ul>\n      <li>We've specified <code>-o hello2.html</code>, meaning that the compiler will still output the JavaScript glue code and <code>.html</code>.</li>\n      <li>We've also specified <code>--shell-file html_template/shell_minimal.html</code> — this provides the path to the HTML template you want to use to create the HTML you will run your example through.</li>\n    </ul>\n  </li>\n  <li>Now let's run this example. The above command will have generated <code>hello2.html</code>, which will have much the same content as the template with some glue code added into load the generated wasm, run it, etc. Open it in your browser and you'll see much the same output as the last example.</li>\n</ol>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> You could specify outputting just the JavaScript \"glue\" file* rather than the full HTML by specifying a .js file instead of an HTML file in the <code>-o</code> flag, e.g. <code>emcc -o hello2.js hello2.c -O3</code>. You could then build your custom HTML completely from scratch, although this is an advanced approach; it is usually easier to use the provided HTML template.</p>\n  <ul>\n    <li>Emscripten requires a large variety of JavaScript \"glue\" code to handle memory allocation, memory leaks, and a host of other problems</li>\n  </ul>\n</div>"}},{"type":"prose","value":{"id":"calling_a_custom_function_defined_in_c","title":"Calling a custom function defined in C","isH3":true,"content":"<p>If you have a function defined in your C code that you want to call as needed from JavaScript, you can do this using the Emscripten <code>ccall()</code> function, and the <code>EMSCRIPTEN_KEEPALIVE</code> declaration (which adds your functions to the exported functions list (see <a href=\"https://emscripten.org/docs/getting_started/FAQ.html#why-do-functions-in-my-c-c-source-code-vanish-when-i-compile-to-javascript-and-or-i-get-no-functions-to-process\" class=\"external\" rel=\" noopener\">Why do functions in my C/C++ source code vanish when I compile to JavaScript, and/or I get No functions to process?</a>)). Let's look at how this works.</p>\n<ol>\n  <li>To start with, save the following code as <code>hello3.c</code> in a new directory:\n    <div class=\"code-example\"><pre class=\"brush: cpp notranslate\"><code><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;emscripten/emscripten.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">__cplusplus</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">EXTERN</span> <span class=\"token expression\"><span class=\"token keyword\">extern</span> </span><span class=\"token string\">\"C\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">EXTERN</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n\nEXTERN EMSCRIPTEN_KEEPALIVE <span class=\"token keyword\">void</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyFunction Called\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>By default, Emscripten-generated code always just calls the <code>main()</code> function, and other functions are eliminated as dead code. Putting <code>EMSCRIPTEN_KEEPALIVE</code> before a function name stops this from happening. You also need to import the <code>emscripten.h</code> library to use <code>EMSCRIPTEN_KEEPALIVE</code>.\n    <div class=\"notecard note\" id=\"sect3\">\n      <p><strong>Note:</strong> We are including the <code>#ifdef</code> blocks so that if you are trying to include this in C++ code, the example will still work. Due to C versus C++ name mangling rules, this would otherwise break, but here we are setting it so that it treats it as an external C function if you are using C++.</p>\n    </div>\n  </li>\n  <li>Now add <code>html_template/shell_minimal.html</code> with <code>{{{ SCRIPT }}}</code> as content into this new directory too, just for convenience (you'd obviously put this in a central place in your real dev environment).</li>\n  <li>Now let's run the compilation step again. From inside your latest directory (and while inside your Emscripten compiler environment terminal window), compile your C code with the following command. (Note that we need to compile with <code>NO_EXIT_RUNTIME</code>, which is necessary as otherwise when <code>main()</code> exits the runtime would be shut down — necessary for proper C emulation, e.g., atexits are called — and it wouldn't be valid to call compiled code.)\n    <div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>emcc -o hello3.html hello3.c -O3 --shell-file html_template/shell_minimal.html -s <span class=\"token assign-left variable\">NO_EXIT_RUNTIME</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> -s <span class=\"token string\">\"EXPORTED_RUNTIME_METHODS=['ccall']\"</span>\n</code></pre></div>\n  </li>\n  <li>If you load the example in your browser again, you'll see the same thing as before!</li>\n  <li>Now we need to run our new <code>myFunction()</code> function from JavaScript. First of all, open up your hello3.html file in a text editor.</li>\n  <li>Add a <a href=\"/en-US/docs/Web/HTML/Element/button\"><code>&lt;button&gt;</code></a> element as shown below, just above the first opening <code>&lt;script type='text/javascript'&gt;</code> tag.\n    <div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mybutton<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Run myFunction<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n  </li>\n  <li>Now add the following code at the end of the first <a href=\"/en-US/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a> element:\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mybutton\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"check console\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> Module<span class=\"token punctuation\">.</span><span class=\"token function\">ccall</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"myFunction\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// name of C function</span>\n    <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// return type</span>\n    <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// argument types</span>\n    <span class=\"token keyword\">null</span> <span class=\"token comment\">// arguments</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n  </li>\n</ol>\n<p>This illustrates how <code>ccall()</code> is used to call the exported function.</p>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"https://emscripten.org/\" class=\"external\" rel=\" noopener\">emscripten.org</a> — learn more about Emscripten and its large variety of options.</li>\n  <li><a href=\"https://emscripten.org/docs/porting/connecting_cpp_and_javascript/Interacting-with-code.html#calling-compiled-c-functions-from-javascript-using-ccall-cwrap\" class=\"external\" rel=\" noopener\">Calling compiled C functions from JavaScript using ccall/cwrap</a></li>\n  <li><a href=\"https://emscripten.org/docs/getting_started/FAQ.html#why-do-functions-in-my-c-c-source-code-vanish-when-i-compile-to-javascript-and-or-i-get-no-functions-to-process\" class=\"external\" rel=\" noopener\">Why do functions in my C/C++ source code vanish when I compile to JavaScript, and/or I get No functions to process?</a></li>\n  <li><a href=\"https://research.mozilla.org/\" class=\"external\" rel=\" noopener\">WebAssembly on Mozilla Research</a></li>\n  <li><a href=\"/en-US/docs/WebAssembly/existing_C_to_wasm\">Compiling an Existing C Module to WebAssembly</a></li>\n</ul>"}}],"toc":[{"text":"Emscripten Environment Setup","id":"emscripten_environment_setup"},{"text":"Compiling an example","id":"compiling_an_example"},{"text":"See also","id":"see_also"}],"summary":"When you've written a new code module in a language like C/C++, you can compile it into WebAssembly using a tool like Emscripten. Let's look at how it works.","popularity":0.0074,"modified":"2022-09-10T06:49:35.000Z","other_translations":[{"title":"Compiler un nouveau module C/C++ en WebAssembly","locale":"fr","native":"Français"},{"title":"C/C++ から WebAssembly へのコンパイル","locale":"ja","native":"日本語"},{"title":"C/C++ 모듈을 웹어셈블리로 컴파일하기","locale":"ko","native":"한국어"},{"title":"Компиляция кода C/C++ в WebAssembly","locale":"ru","native":"Русский"},{"title":"编译 C/C++ 为 WebAssembly","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"en-us/webassembly/c_to_wasm","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/webassembly/c_to_wasm/index.md","last_commit_url":"https://github.com/mdn/content/commit/c18f91159d438c3f40b6d1f78a6ba7c04d2f1845","filename":"index.md"},"parents":[{"uri":"/en-US/docs/WebAssembly","title":"WebAssembly"},{"uri":"/en-US/docs/WebAssembly/C_to_wasm","title":"Compiling a New C/C++ Module to WebAssembly"}],"pageTitle":"Compiling a New C/C++ Module to WebAssembly - WebAssembly | MDN","noIndexing":false}}