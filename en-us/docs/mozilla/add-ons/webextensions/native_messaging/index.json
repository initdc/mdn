{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Native messaging","mdn_url":"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging","locale":"en-US","native":"English (US)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions\"><strong>Browser extensions</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Getting started</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">What are extensions?</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Your first extension</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Your second extension</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomy of an extension</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Examples\">Example extensions</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/What_next_\">What next?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Using the JavaScript APIs</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Match patterns</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Working with files</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalization</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Content Security Policy</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Native messaging</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome incompatibilities</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>User interface</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface\">User Interface</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Toolbar button</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Address bar button</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Sidebars</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Context menu items</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Options page</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Extension pages</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Address bar suggestions</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Developer tools panels</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>How to</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercept HTTP requests</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modify a web page</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insert external content</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Add a button to the toolbar</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Implement a settings page</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Work with the Tabs API</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Work with the Bookmarks API</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Work with the Cookies API</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Work with contextual identities</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/action\">action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings\">browserSettings</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browsingData\">browsingData</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/commands\">commands</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/devtools\">devtools</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/dns\">dns</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/events\">events</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension\">extension</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes\">extensionTypes</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/identity\">identity</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/management\">management</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notifications</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/omnibox\">omnibox</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/pageAction\">pageAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11\">pkcs11</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/privacy\">privacy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting\">scripting</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction\">sidebarAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/theme\">theme</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/topSites\">topSites</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/userScripts\">userScripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introduction</a></li>\n        </ol>\n      <ol><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/action\">action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">author</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides\">chrome_settings_overrides</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides\">chrome_url_overrides</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands\">commands</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page\">devtools_page</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/dictionaries\">dictionaries</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/externally_connectable\">externally_connectable</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/host_permissions\">host_permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito\">incognito</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/offline_enabled\">offline_enabled</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox\">omnibox</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional_permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_page\">options_page</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\">page_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers\">protocol_handlers</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">short_name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action\">sidebar_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/storage\">storage</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme\">theme</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme_experiment\">theme_experiment</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/user_scripts\">user_scripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name\">version_name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/en-US/docs/Mozilla/Add-ons/Contact_us\"><strong>Contact us</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Channels</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons blog</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons forum</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p><strong>Native messaging</strong> enables an extension to exchange messages with a native application, installed on the user's computer. The native messaging serves the extensions without additional accesses over the web.</p>\n<p>Password managers: The native application manages, stores, and encrypts passwords. Then the native application communicates with the extension to populate web forms.</p>\n<p>Native messaging also enables extensions to access resources that are not accessible through WebExtension APIs (e.g., particular hardware).</p>\n<p>The native application is not installed or managed by the browser. The native application is installed, using the underlying operating system's installation machinery. Create a JSON file called the \"host manifest\" or \"app manifest\". Install the JSON file in a defined location. The app manifest file will describe how the browser can connect to the native application.</p>\n<p>The extension must request the <code>\"nativeMessaging\"</code> <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a> or <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional permission</a> in the <code>manifest.json</code> file. Also, the native application must grant permission for the extension by including the ID in the <code>\"allowed_extensions\"</code> field of the app manifest.</p>\n<p>After installing, the extension can exchange JSON messages with the native application. Use a set of functions in the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime\"><code>runtime</code></a> API. On the native app side, messages are received using standard input (<code>stdin</code>) and sent using standard output (<code>stdout</code>).</p>\n<p>\n  <img src=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging/native-messaging.png\" alt=\"\" width=\"1344\" height=\"1096\" loading=\"lazy\">\n</p>\n<p>Support for native messaging in extensions is mostly compatible with Chrome, with two main differences:</p>\n<ul>\n  <li>The app manifest lists <code>allowed_extensions</code> as an array of app IDs, while Chrome lists <code>allowed_origins</code>, as an array of <code>\"chrome-extension\"</code> URLs.</li>\n  <li>The app manifest is stored in a different location <a href=\"https://developer.chrome.com/docs/apps/nativeMessaging/#native-messaging-host-location\" class=\"external\" rel=\" noopener\">compared to Chrome</a>.</li>\n</ul>\n<p>There's a complete example in the <a href=\"https://github.com/mdn/webextensions-examples/tree/master/native-messaging\" class=\"external\" rel=\" noopener\">\"<code>native-messaging</code>\" directory</a> of the <code>\"webextensions-examples\"</code> repository on GitHub. Most example code in this article is taken from that example.</p>"}},{"type":"prose","value":{"id":"setup","title":"Setup","isH3":false,"content":""}},{"type":"prose","value":{"id":"extension_manifest","title":"Extension manifest","isH3":true,"content":"<p>Extension communicating with a native application:</p>\n<ul>\n  <li>Set the <code>\"nativeMessaging\"</code> <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a> or <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional permission</a> in the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json\"><code>manifest.json</code></a> file.</li>\n  <li>Specify your add-on ID explicitly. Use the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\"><code>browser_specific_settings</code></a> manifest key. (The app's manifest will identify the set of extensions that allow connecting to the IDs).</li>\n</ul>\n<p>Example <code>manifest.json</code> file:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Native messaging example add-on\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Native messaging example\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"48\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/message.svg\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"browser_specific_settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"gecko\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ping_pong@example.org\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"strict_min_version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"50.0\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"browser_action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"default_icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icons/message.svg\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"nativeMessaging\"</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> Chrome does not support the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a> key. You will need to use another manifest without this key to install an equivalent WebExtension on Chrome. See <a href=\"#chrome_incompatibilities\">Chrome incompatibilities below</a>.</p>\n</div>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> When using optional permission, check that permission has been granted and, where necessary, request permission from the user with the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/permissions\"><code>permissions</code></a> API before communicating with the native application.</p>\n</div>"}},{"type":"prose","value":{"id":"app_manifest","title":"App manifest","isH3":true,"content":"<p>The app manifest describes to the browser how it can connect to the native application.</p>\n<p>The app manifest file must be installed along with the native application. The browser reads and validates app manifest files, but it does not install or manage them. The security model for when and how these files are installed and updated is much more like that for native applications than that for extensions using WebExtension APIs.</p>\n<p>For details of native app manifest syntax and location, see <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_manifests\">Native manifests</a>.</p>\n<p>For example, here's a manifest for the <code>\"ping_pong\"</code> native application:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Example host for native messaging\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/path/to/native-messaging/app/ping_pong.py\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"stdio\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"allowed_extensions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"ping_pong@example.org\"</span> <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This allows the extension whose ID is <code>\"ping_pong@example.org\"</code> to connect, by passing the name <code>\"ping_pong\"</code> into the relevant <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime\"><code>runtime</code></a> API function. The application itself is at <code>\"/path/to/native-messaging/app/ping_pong.py\"</code>.</p>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> Chrome identifies allowed extensions with another key: <code>allowed_origins</code>, using the ID of the WebExtension. Refer to <a href=\"https://developer.chrome.com/docs/apps/nativeMessaging/#native-messaging-host\" class=\"external\" rel=\" noopener\">Chrome documentation for more details</a> and see <a href=\"#chrome_incompatibilities\">Chrome incompatibilities below</a>.</p>\n</div>"}},{"type":"prose","value":{"id":"windows_setup","title":"Windows setup","isH3":true,"content":"<p>As an example, you can also refer to <a href=\"https://github.com/SphinxKnight/webextensions-examples/tree/master/native-messaging#windows-setup\" class=\"external\" rel=\" noopener\">the readme on the native messaging extension on GitHub</a>. If you want to check your local setup after having forked this repository on a Windows machine, you may run <code>check_config_win.py</code> to troubleshoot some issues.</p>\n<h4 id=\"app_manifest_2\">App manifest</h4>\n<p>In the example above, the native application is a Python script. It can be difficult to get Windows to run Python scripts reliably in this way, so an alternative is to provide a <code>.bat</code> file, and link to that from the application's manifest:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Example host for native messaging\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"c:\\\\path\\\\to\\\\native-messaging\\\\app\\\\ping_pong_win.bat\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"stdio\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"allowed_extensions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"ping_pong@example.org\"</span> <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>(See note above about <a href=\"#chrome_incompatibilities\">Chrome compatibility</a> regarding the <code>allowed_extensions</code> key and its counterpart in Chrome).</p>\n<p>The batch file then invokes the Python script:</p>\n<div class=\"code-example\"><pre class=\"brush: bash notranslate\"><code>@echo off\n\npython -u <span class=\"token string\">\"c:<span class=\"token entity\" title=\"\\\\\">\\\\</span>path<span class=\"token entity\" title=\"\\\\\">\\\\</span>to<span class=\"token entity\" title=\"\\\\\">\\\\</span>native-messaging<span class=\"token entity\" title=\"\\\\\">\\\\</span>app<span class=\"token entity\" title=\"\\\\\">\\\\</span>ping_pong.py\"</span>\n</code></pre></div>\n<h4 id=\"registry\">Registry</h4>\n<p>The browser finds the extension based on registry keys which are located in a specific location. You need to add them either programmatically with your final application or manually if you are using the example from GitHub. For more details, refer to <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_manifests#manifest_location\">Manifest location</a>.</p>\n<p>Following with the <code>ping_pong</code> example, if using Firefox (see <a href=\"https://developer.chrome.com/docs/apps/nativeMessaging/#native-messaging-host-location\" class=\"external\" rel=\" noopener\">this page for Chrome</a>), two registry entries should be created for the messaging to work:</p>\n<ul>\n  <li><code>HKEY_CURRENT_USER\\Software\\Mozilla\\NativeMessagingHosts\\ping_pong</code>\n    <ul>\n      <li>The default value for this key should be the path to the <em>application</em> manifest: ex. <code>C:\\Users\\&lt;myusername&gt;\\webextensions-examples\\native-messaging\\app\\ping_pong.json</code></li>\n    </ul>\n  </li>\n  <li><code>HKEY_LOCAL_MACHINE\\Software\\Mozilla\\NativeMessagingHosts\\ping_pong</code>\n    <ul>\n      <li>Idem, the default value for this key should be the path to the application manifest.</li>\n    </ul>\n  </li>\n</ul>\n<div class=\"notecard note\" id=\"sect4\">\n  <p><strong>Note:</strong> If you base your work on the example located on GitHub, please read <a href=\"https://github.com/SphinxKnight/webextensions-examples/tree/master/native-messaging#windows-setup\" class=\"external\" rel=\" noopener\">this part of the readme</a> and check the output of <code>check_config_win.py</code> before installing the WebExtension on your browser.</p>\n</div>"}},{"type":"prose","value":{"id":"exchanging_messages","title":"Exchanging messages","isH3":false,"content":"<p>Given the above setup, an extension can exchange JSON messages with a native application.</p>"}},{"type":"prose","value":{"id":"extension_side","title":"Extension side","isH3":true,"content":"<p>Native messaging cannot directly be used in content scripts. You must <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#communicating_with_background_scripts\">do it indirectly via background scripts</a>.</p>\n<p>There are two patterns to use here: <strong>connection-based messaging</strong> and <strong>connectionless messaging</strong>.</p>\n<h4 id=\"connection-based_messaging\">Connection-based messaging</h4>\n<p>With this pattern you call <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/connectNative\"><code>runtime.connectNative()</code></a>, passing the name of the application (the value of the <code>\"name\"</code> property in the app's manifest). This launches the application if it is not already running and returns a <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/Port\"><code>runtime.Port</code></a> object to the extension.</p>\n<p>Two arguments are passed to the native app when it starts:</p>\n<ul>\n  <li>The complete path to the app manifest.</li>\n  <li>(new in Firefox 55) the ID (as given in the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a> <code>manifest.json</code> key) of the add-on that started it.</li>\n</ul>\n<div class=\"notecard note\" id=\"sect5\">\n  <p><strong>Note:</strong> Chrome handles the passed arguments differently:</p>\n  <ul>\n    <li>On Linux and Mac, Chrome passes <em>one</em> argument: the origin of the extension that started it (in the form <code>chrome-extension://[extensionID]</code>). This enables the app to identify the extension.</li>\n    <li>On Windows, Chrome passes <em>two</em> arguments: the first is the origin of the extension, and the second is a handle to the Chrome native window that started the app.</li>\n  </ul>\n</div>\n<p>The application stays running until the extension calls <code>Port.disconnect()</code> or the page that connected to it is closed.</p>\n<p>To send messages using <code>Port</code>, call its <code>postMessage()</code> function, passing the JSON message to send. To listen for messages using <code>Port</code>, add the listener using its <code>onMessage.addListener()</code> function.</p>\n<p>Here's an example background script that establishes a connection with the <code>\"ping_pong\"</code> app, listens for messages from it, then sends it a <code>\"ping\"</code> message whenever the user clicks the browser action:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">/*\nOn startup, connect to the \"ping_pong\" app.\n*/</span>\n<span class=\"token keyword\">let</span> port <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">connectNative</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\nListen for messages from the app.\n*/</span>\nport<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Received: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>response<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\nOn a click on the browser action, send the app a message.\n*/</span>\nbrowser<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sending:  ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  port<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"connectionless_messaging\">Connectionless messaging</h4>\n<p>With this pattern you call <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendNativeMessage\"><code>runtime.sendNativeMessage()</code></a>, passing it:</p>\n<ul>\n  <li>the name of the application</li>\n  <li>the JSON message to send</li>\n  <li>optionally, a callback.</li>\n</ul>\n<p>A new instance of the app is created for each message. The app passes two arguments when starting:</p>\n<ul>\n  <li>the complete path to the app manifest</li>\n  <li>(new in Firefox 55) the ID (as given in the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a> manifest.json key) of the add-on that started it.</li>\n</ul>\n<p>The first message sent by the app is treated as a response to the <code>sendNativeMessage()</code> call, and will be passed into the callback.</p>\n<p>Here's the example above, rewritten to use <code>runtime.sendNativeMessage()</code>:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">onResponse</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Received </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>response<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/*\nOn a click on the browser action, send the app a message.\n*/</span>\nbrowser<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sending:  ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> sending <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">sendNativeMessage</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"ping_pong\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sending<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>onResponse<span class=\"token punctuation\">,</span> onError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"app_side","title":"App side","isH3":true,"content":"<p>On the application side, you use standard input to receive messages and standard output to send them.</p>\n<p>Each message is serialized using JSON, UTF-8 encoded and is preceded with an unsigned 32-bit value containing the message length in native byte order.</p>\n<p>The maximum size of a single message from the application is 1 MB. The maximum size of a message sent to the application is 4 GB.</p>\n<p>You can quickly get started sending and receiving messages with this NodeJS code:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token hashbang comment\">#!/usr/local/bin/node</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">let</span> payloadSize <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// A queue to store the chunks as we read them from stdin.</span>\n    <span class=\"token comment\">// This queue can be flushed when `payloadSize` data has been read</span>\n    <span class=\"token keyword\">let</span> chunks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Only read the size once for each payload</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sizeHasBeenRead</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span>payloadSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// All the data has been read, reset everything for the next message</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">flushChunksQueue</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        payloadSize <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        chunks<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">processData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Create one big buffer with all the chunks</span>\n        <span class=\"token keyword\">const</span> stringData <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>chunks<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// The browser will emit the size as a header of the payload,</span>\n        <span class=\"token comment\">// if it hasn't been read yet, do it.</span>\n        <span class=\"token comment\">// The next time we'll need to read the payload size is when all of the data</span>\n        <span class=\"token comment\">// of the current payload has been read (i.e. data.length &gt;= payloadSize + 4)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">sizeHasBeenRead</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            payloadSize <span class=\"token operator\">=</span> stringData<span class=\"token punctuation\">.</span><span class=\"token function\">readUInt32LE</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// If the data we have read so far is &gt;= to the size advertised in the header,</span>\n        <span class=\"token comment\">// it means we have all of the data sent.</span>\n        <span class=\"token comment\">// We add 4 here because that's the size of the bytes that old the payloadSize</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>stringData<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&gt;=</span> <span class=\"token punctuation\">(</span>payloadSize <span class=\"token operator\">+</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Remove the header</span>\n            <span class=\"token keyword\">const</span> contentWithoutSize <span class=\"token operator\">=</span> stringData<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>payloadSize <span class=\"token operator\">+</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Reset the read size and the queued chunks</span>\n            <span class=\"token function\">flushChunksQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">const</span> json <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>contentWithoutSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Do something with the dataâ€¦</span>\n         <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    process<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'readable'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// A temporary variable holding the nodejs.Buffer of each</span>\n        <span class=\"token comment\">// chunk of data read off stdin</span>\n        <span class=\"token keyword\">let</span> chunk <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Read all of the available data</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>chunk <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            chunks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">processData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Here's another example written in Python. It listens for messages from the extension. Note that the file has to be executable on Linux. If the message is <code>\"ping\"</code>, then it responds with a message <code>\"pong\"</code>.</p>\n<p>This is the Python 2 version:</p>\n<div class=\"code-example\"><pre class=\"brush: python notranslate\"><code><span class=\"token comment\">#!/usr/bin/python -u</span>\n\n<span class=\"token comment\"># Note that running python with the `-u` flag is required on Windows,</span>\n<span class=\"token comment\"># in order to ensure that stdin and stdout are opened in binary, rather</span>\n<span class=\"token comment\"># than text, mode.</span>\n\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> struct\n\n<span class=\"token comment\"># Read a message from stdin and decode it.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    raw_length <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> raw_length<span class=\"token punctuation\">:</span>\n        sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    message_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>unpack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> raw_length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    message <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span>message_length<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Encode a message for transmission, given its content.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">encode_message</span><span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    encoded_content <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span>\n    encoded_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">:</span> encoded_length<span class=\"token punctuation\">,</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">:</span> encoded_content<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Send an encoded message to stdout.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">send_message</span><span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>flush<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    message <span class=\"token operator\">=</span> get_message<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> message <span class=\"token operator\">==</span> <span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">:</span>\n        send_message<span class=\"token punctuation\">(</span>encode_message<span class=\"token punctuation\">(</span><span class=\"token string\">\"pong\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>In Python 3, the received binary data must be decoded into a string. The content to be sent back to the addon must be encoded into binary data using a struct:</p>\n<div class=\"code-example\"><pre class=\"brush: python notranslate\"><code><span class=\"token comment\">#!/usr/bin/python -u</span>\n\n<span class=\"token comment\"># Note that running python with the `-u` flag is required on Windows,</span>\n<span class=\"token comment\"># in order to ensure that stdin and stdout are opened in binary, rather</span>\n<span class=\"token comment\"># than text, mode.</span>\n\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> struct\n\n<span class=\"token comment\"># Read a message from stdin and decode it.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    raw_length <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> raw_length<span class=\"token punctuation\">:</span>\n        sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    message_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>unpack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> raw_length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    message <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span>message_length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Encode a message for transmission, given its content.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">encode_message</span><span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    encoded_content <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>message_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span>\n    encoded_length <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token string\">'=I'</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">#  use struct.pack(\"10s\", bytes), to pack a string of the length of 10 characters</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">:</span> encoded_length<span class=\"token punctuation\">,</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">:</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\"s\"</span><span class=\"token punctuation\">,</span>encoded_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Send an encoded message to stdout.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">send_message</span><span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'length'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>encoded_message<span class=\"token punctuation\">[</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token builtin\">buffer</span><span class=\"token punctuation\">.</span>flush<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    message <span class=\"token operator\">=</span> get_message<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> message <span class=\"token operator\">==</span> <span class=\"token string\">\"ping\"</span><span class=\"token punctuation\">:</span>\n        send_message<span class=\"token punctuation\">(</span>encode_message<span class=\"token punctuation\">(</span><span class=\"token string\">\"pong\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"closing_the_native_app","title":"Closing the native app","isH3":false,"content":"<p>If you connected to the native application using <code>runtime.connectNative()</code>, then it stays running until the extension calls <code>Port.disconnect()</code> or the page that connected to it is closed. If you started the native application by sending <code>runtime.sendNativeMessage()</code>, then it is closed after it has received the message and sent a response.</p>\n<p>To close the native application:</p>\n<ul>\n  <li>On *nix systems like macOS and Linux, the browser sends <code>SIGTERM</code> to the native application, then <code>SIGKILL</code> after the application has had a chance to exit gracefully. These signals propagate to any subprocesses unless they break away into a new process group.</li>\n  <li>On Windows, the browser puts the native application's process into a <a href=\"https://msdn.microsoft.com/library/windows/desktop/ms684161(v=vs.85).aspx\" class=\"external\" rel=\" noopener\">Job object</a> and kills the job. If the native application launches additional processes and wants them to remain open after the native application is killed, then the native application must launch the additional process with the <a href=\"https://msdn.microsoft.com/library/windows/desktop/ms684863(v=vs.85).aspx\" class=\"external\" rel=\" noopener\"><code>CREATE_BREAKAWAY_FROM_JOB</code></a> flag, such as by using <code>CreateProcess</code>.</li>\n</ul>"}},{"type":"prose","value":{"id":"troubleshooting","title":"Troubleshooting","isH3":false,"content":"<p>If something goes wrong, check the <a href=\"https://extensionworkshop.com/documentation/develop/debugging/#viewing_log_output\" class=\"external\" rel=\" noopener\">browser console</a>. If the native application sends any output to stderr, the browser will redirect it to the browser console. So if you've got as far as launching the native application, you will see any error messages it emits.</p>\n<p>If you haven't managed to run the application, you should see an error message giving you a clue about the problem.</p>\n<pre class=\"notranslate\">\"No such native application &lt;name&gt;\"\n</pre>\n<ul>\n  <li>Check that the name passed to <code>runtime.connectNative()</code> matches the name in the app manifest</li>\n  <li>macOS/Linux: check that name of the app manifest is <code>&lt;name&gt;.json</code>.</li>\n  <li>macOS/Linux: check the native application's manifest file location as mentioned <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_manifests#mac_os_x\">here</a>.</li>\n  <li>Windows: check that the registry key is in the correct place, and that its name matches the name in the app manifest.</li>\n  <li>Windows: check that the path given in the registry key points to the app manifest.\n    <pre class=\"notranslate\">\"Error: Invalid application &lt;name&gt;\"\n</pre>\n  </li>\n  <li>Check that the application's name contains no invalid characters.\n    <pre class=\"notranslate\">\"'python' is not recognized as an internal or external command, ...\"\n</pre>\n  </li>\n  <li>Windows: if your application is a Python script, check that you have Python installed and have your path set up for it.\n    <pre class=\"notranslate\">\"File at path &lt;path&gt; does not exist, or is not executable\"\n</pre>\n  </li>\n  <li>If you see this, then the app manifest has been found successfully.</li>\n  <li>Check that the \"path\" in the app's manifest is correct.</li>\n  <li>Windows: check that you've escaped the path separators (<code>\"c:\\\\path\\\\to\\\\file\"</code>).</li>\n  <li>Check that the app is at the location pointed to by the <code>\"path\"</code> property in the app's manifest.</li>\n  <li>Check that the app is executable.\n    <pre class=\"notranslate\">\"This extension does not have permission to use native application &lt;name&gt;\"\n</pre>\n  </li>\n  <li>Check that the <code>\"allowed_extensions\"</code> key in the app manifest contains the add-on's ID.\n    <pre class=\"notranslate\">    \"TypeError: browser.runtime.connectNative is not a function\"\n</pre>\n  </li>\n  <li>Check that the extension has the <code>\"nativeMessaging\"</code> permission.\n    <pre class=\"notranslate\">\"[object Object]       NativeMessaging.jsm:218\"\n</pre>\n  </li>\n  <li>There was a problem starting the application.</li>\n</ul>"}},{"type":"prose","value":{"id":"chrome_incompatibilities","title":"Chrome incompatibilities","isH3":false,"content":"<p>\n  There are a number of differences between browsers that affect native messaging in web extensions, including the arguments passed to the native app, location of the manifest file, etc.\n  These differences are discussed in <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities#native_messaging\">Chrome incompatibilities &gt; Native messaging</a>.\n</p>"}}],"toc":[{"text":"Setup","id":"setup"},{"text":"Exchanging messages","id":"exchanging_messages"},{"text":"Closing the native app","id":"closing_the_native_app"},{"text":"Troubleshooting","id":"troubleshooting"},{"text":"Chrome incompatibilities","id":"chrome_incompatibilities"}],"summary":"Native messaging enables an extension to exchange messages with a native application, installed on the user's computer. The native messaging serves the extensions without additional accesses over the web.","popularity":0.0021,"modified":"2022-09-11T05:58:43.000Z","other_translations":[{"title":"Native messaging","locale":"fr","native":"FranÃ§ais"},{"title":"ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°","locale":"ja","native":"æ—¥æœ¬èªž"},{"title":"ä¸Žæœ¬åœ°åº”ç”¨é€šä¿¡","locale":"zh-CN","native":"ä¸­æ–‡ (ç®€ä½“)"}],"source":{"folder":"en-us/mozilla/add-ons/webextensions/native_messaging","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/mozilla/add-ons/webextensions/native_messaging/index.md","last_commit_url":"https://github.com/mdn/content/commit/dd08ec8cf78926a7854d8f5f7793bf7ae199484e","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Mozilla","title":"Mozilla"},{"uri":"/en-US/docs/Mozilla/Add-ons","title":"Add-ons"},{"uri":"/en-US/docs/Mozilla/Add-ons/WebExtensions","title":"Browser Extensions"},{"uri":"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging","title":"Native messaging"}],"pageTitle":"Native messaging - Mozilla | MDN","noIndexing":false}}