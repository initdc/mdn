{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Safely inserting external content into a page","mdn_url":"/en-US/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page","locale":"en-US","native":"English (US)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions\"><strong>Browser extensions</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Getting started</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">What are extensions?</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Your first extension</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Your second extension</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomy of an extension</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Examples\">Example extensions</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/What_next_\">What next?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Using the JavaScript APIs</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Match patterns</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Working with files</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalization</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Content Security Policy</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Native messaging</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome incompatibilities</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>User interface</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface\">User Interface</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Toolbar button</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Address bar button</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Sidebars</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Context menu items</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Options page</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Extension pages</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Address bar suggestions</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Developer tools panels</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>How to</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercept HTTP requests</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modify a web page</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insert external content</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Add a button to the toolbar</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Implement a settings page</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Work with the Tabs API</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Work with the Bookmarks API</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Work with the Cookies API</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Work with contextual identities</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/action\">action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings\">browserSettings</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browsingData\">browsingData</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/commands\">commands</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/devtools\">devtools</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/dns\">dns</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/events\">events</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension\">extension</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes\">extensionTypes</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/identity\">identity</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/management\">management</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notifications</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/omnibox\">omnibox</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/pageAction\">pageAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11\">pkcs11</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/privacy\">privacy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting\">scripting</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction\">sidebarAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/theme\">theme</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/topSites\">topSites</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/userScripts\">userScripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introduction</a></li>\n        </ol>\n      <ol><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/action\">action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">author</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides\">chrome_settings_overrides</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides\">chrome_url_overrides</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands\">commands</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page\">devtools_page</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/dictionaries\">dictionaries</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/externally_connectable\">externally_connectable</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/host_permissions\">host_permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito\">incognito</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/offline_enabled\">offline_enabled</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox\">omnibox</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional_permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_page\">options_page</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\">page_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers\">protocol_handlers</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">short_name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action\">sidebar_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/storage\">storage</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme\">theme</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme_experiment\">theme_experiment</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/user_scripts\">user_scripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name\">version_name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/en-US/docs/Mozilla/Add-ons/Contact_us\"><strong>Contact us</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Channels</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons blog</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons forum</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>There are times when you might want or need to include content from an external source in your extension. But, there is the risk that the source may have malicious scripts embedded in it—added by either the developer of the source or by a malicious third-party.</p>\n<p>Take an RSS reader as an example. You don't know what RSS feeds your extension will open and have no control over the content of those RSS feeds. So, it's possible the user could subscribe to a feed where, for example, a feed item's title includes a script. This could be something as simple as including JavaScript code within <code>&lt;script&gt;&lt;/script&gt;</code> tags. If you were to extract the title, assume it was plain text, and add it to the DOM of a page created by your extension, your user now has an unknown script running in their browser. Therefore, care needs to be taken to avoid evaluating arbitrary text as HTML.</p>\n<p>You also need to remember that extensions have privileged contexts, for example in background scripts and content scripts. In the worst case, an embedded script could run in one of these contexts, a situation known as privilege escalation. This situation can leave a user's browser open to remote attack by enabling the website that injected the code to access critical user data, such as passwords, browser history, or browsing behavior.</p>\n<p>This article examines how to work safely with remote data and add it to a DOM.</p>"}},{"type":"prose","value":{"id":"working_with_arbitrary_strings","title":"Working with arbitrary strings","isH3":false,"content":"<p>When working with strings, there are a couple of recommended options to safely add them to a page: the standard DOM node creation methods or jQuery.</p>"}},{"type":"prose","value":{"id":"dom_node_creation_methods","title":"DOM node creation methods","isH3":true,"content":"<p>A lightweight approach to inserting strings into a page is to use the native DOM manipulation methods: <a href=\"/en-US/docs/Web/API/Document/createElement\"><code>document.createElement</code></a>, <a href=\"/en-US/docs/Web/API/Element/setAttribute\"><code>Element.setAttribute</code></a>, and <a href=\"/en-US/docs/Web/API/Node/textContent\"><code>Node.textContent</code></a>. The safe approach is to create the nodes separately and assign their content using textContent:</p>\n<div class=\"code-example\"><pre class=\"brush: js example-good notranslate\"><code><span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> div <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndiv<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">;</span>\ndiv<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Your favorite color is now </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token punctuation\">.</span>color<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\naddonElement<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>div<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This approach is safe because the use of <code>.textContent</code> automatically escapes any remote HTML in <code>data.color</code>.</p>\n<p>However, beware, you can use native methods that aren't safe. Take the following code:</p>\n<div class=\"code-example\"><pre class=\"brush: js example-bad notranslate\"><code><span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\naddonElement<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div class='</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token punctuation\">.</span>className<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'&gt;Your favorite color is now </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token punctuation\">.</span>color<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div&gt;</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Here, the contents of <code>data.className</code> or <code>data.color</code> could contain HTML that can close the tag early, insert arbitrary further HTML content, then open another tag.</p>"}},{"type":"prose","value":{"id":"jquery","title":"jQuery","isH3":true,"content":"<p>When using jQuery, functions such as <code>attr()</code> and <code>text()</code> escape content as it's added to a DOM. So, the \"favorite color\" example from above, implemented in jQuery, would look like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js example-good notranslate\"><code><span class=\"token keyword\">let</span> node <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;/div&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nnode<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nnode<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Your favorite color is now </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token punctuation\">.</span>color<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"working_with_html_content","title":"Working with HTML content","isH3":false,"content":"<p>When working with externally sourced content that you know is HTML, sanitizing the HTML is essential before it's added to a page. Best practice for sanitizing HTML is to use an HTML sanitization library or a template engine with HTML sanitization features. In this section, we look at some suitable tools and how to use them.</p>"}},{"type":"prose","value":{"id":"html_sanitization","title":"HTML sanitization","isH3":true,"content":"<p>An HTML sanitization library strips anything that could lead to script execution from HTML, so you can safely inject complete sets of HTML nodes from a remote source into your DOM. <a href=\"https://github.com/cure53/DOMPurify\" class=\"external\" rel=\" noopener\">DOMPurify</a>, which has been reviewed by various security experts, is a suitable library for this task in extensions.</p>\n<p>For production use, <a href=\"https://github.com/cure53/DOMPurify\" class=\"external\" rel=\" noopener\">DOMPurify</a> comes as a minified version: purify.min.js. You can use this script in the way that best suits your extension. For example, you could add it as a content script:</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"matches\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;all_urls&gt;\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"purify.min.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"myinjectionscript.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>Then, in myinjectionscript.js you can read the external HTML, sanitize it, and add it to a page's DOM:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> elem <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> cleanHTML <span class=\"token operator\">=</span> DOMPurify<span class=\"token punctuation\">.</span><span class=\"token function\">sanitize</span><span class=\"token punctuation\">(</span>externalHTML<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelem<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> cleanHTML<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>You can use any method to add the sanitized HTML to your DOM, for example jQuery's <code>.html()</code> function. Remember though that the <code>SAFE_FOR_JQUERY</code> flag needs to be used in this case:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> elem <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;div/&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> cleanHTML <span class=\"token operator\">=</span> DOMPurify<span class=\"token punctuation\">.</span><span class=\"token function\">sanitize</span><span class=\"token punctuation\">(</span>externalHTML<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SAFE_FOR_JQUERY</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelem<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span>cleanHTML<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"template_engines","title":"Template engines","isH3":true,"content":"<p>Another common pattern is to create a local HTML template for a page and use remote values to fill in the blanks. While this approach is generally acceptable, care should be taken to avoid use of constructs that would allow the insertion of executable code. This can happen when the templating engine uses constructs that insert raw HTML into the document. If the variable used to insert raw HTML is of a remote source, it is subject to the same security risk mentioned in the introduction.</p>\n<p>For example, when using <a href=\"https://mustache.github.io/\" class=\"external\" rel=\" noopener\">mustache templates</a> you must use the double mustache, <code>{{variable}}</code>, which escapes any HTML. Use of the triple mustache, <code>{{{variable}}}</code>, must be avoided as this injects a raw HTML string and could add executable code to your template. <a href=\"https://handlebarsjs.com/\" class=\"external\" rel=\" noopener\">Handlebars</a> works in a similar way, with variables in double handlebars, <code>{{variable}}</code>, being escaped. Whereas, variables in triple handlebars are left raw and must be avoided. Also, if you create a Handlebars helper using <code>Handlebars.SafeString</code> use <code>Handlebars.escapeExpression()</code> to escape any dynamic parameters passed to the helper. This is a requirement because the resulting variable from <code>Handlebars.SafeString</code> is considered safe and it isn't escaped when inserted with double handlebars.</p>\n<p>There are similar constructs in other templating systems that need to be approached with the same level of care.</p>"}},{"type":"prose","value":{"id":"additional_reading","title":"Additional reading","isH3":false,"content":"<p>For more information on this subject, see the following articles:</p>\n<ul>\n  <li><a href=\"https://owasp.org/www-community/xss-filter-evasion-cheatsheet\" class=\"external\" rel=\" noopener\">XSS (Cross Site Scripting) Prevention Cheat Sheet</a></li>\n</ul>"}}],"toc":[{"text":"Working with arbitrary strings","id":"working_with_arbitrary_strings"},{"text":"Working with HTML content","id":"working_with_html_content"},{"text":"Additional reading","id":"additional_reading"}],"summary":"There are times when you might want or need to include content from an external source in your extension. But, there is the risk that the source may have malicious scripts embedded in it—added by either the developer of the source or by a malicious third-party.","popularity":0.0012,"modified":"2022-09-09T05:03:45.000Z","other_translations":[{"title":"Insérer en toute sécurité du contenu externe dans une page","locale":"fr","native":"Français"},{"title":"Safely inserting external content into a page","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"en-us/mozilla/add-ons/webextensions/safely_inserting_external_content_into_a_page","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/mozilla/add-ons/webextensions/safely_inserting_external_content_into_a_page/index.md","last_commit_url":"https://github.com/mdn/content/commit/1ee49b729dc4cd02b862d910f279861f4b30e704","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Mozilla","title":"Mozilla"},{"uri":"/en-US/docs/Mozilla/Add-ons","title":"Add-ons"},{"uri":"/en-US/docs/Mozilla/Add-ons/WebExtensions","title":"Browser Extensions"},{"uri":"/en-US/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page","title":"Safely inserting external content into a page"}],"pageTitle":"Safely inserting external content into a page - Mozilla | MDN","noIndexing":false}}