<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>KumaScript - The MDN Web Docs project | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><link rel="alternate" title="KumaScript" href="https://developer.mozilla.org/en-US/docs/MDN/Tools/KumaScript" hreflang="en"><link rel="alternate" title="KumaScript" href="https://developer.mozilla.org/zh-TW/docs/MDN/Tools/KumaScript" hreflang="zh"><link rel="alternate" title="KumaScript" href="https://developer.mozilla.org/pt-BR/docs/MDN/Tools/KumaScript" hreflang="pt"><link rel="alternate" title="KumaScript" href="https://developer.mozilla.org/ja/docs/MDN/Tools/KumaScript" hreflang="ja"><link rel="alternate" title="Introducci√≥n a KumaScript" href="https://developer.mozilla.org/es/docs/MDN/Tools/KumaScript" hreflang="es"><meta name="description" content="On the Yari platform that powers MDN, we still have a legacy template/macro system available called KumaScript for automating certain aspects of content. We are hoping to stop using it some day, but until then MDN will still rely on it. This article provides basic information about using KumaScript."><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/MDN/Tools/KumaScript"><meta property="og:title" content="KumaScript - The MDN Web Docs project | MDN"><meta property="og:description" content="On the Yari platform that powers MDN, we still have a legacy template/macro system available called KumaScript for automating certain aspects of content. We are hoping to stop using it some day, but until then MDN will still rely on it. This article provides basic information about using KumaScript."><meta property="og:locale" content="en-US"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/MDN/Tools/KumaScript"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> üåê</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> üåê</a></li></ul></li></ul></nav><div class="header-search"><form action="/en-US/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/MDN"><span property="name">The MDN Web Docs project</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/en-US/docs/MDN/Tools"><span property="name">MDN tools</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/en-US/docs/MDN/Tools/KumaScript"><span property="name">KumaScript</span></a><meta property="position" content="3"></li></ol></nav><ul class="language-toggle single-option"><li><a href="#select-language" class="language-icon"><span class="show-desktop">Change language</span></a></li></ul></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#basics">Basics</a></li><li><a href="#advanced_features">Advanced Features</a></li><li><a href="#tips_and_caveats">Tips and caveats</a></li><li><a href="#cookbook">Cookbook</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="en-US"><h1>KumaScript</h1><div><p>On the <a href="/en-US/docs/MDN/Yari">Yari</a> platform that powers MDN, we still have a legacy template/macro system available called <a href="https://github.com/mdn/yari/tree/main/kumascript" class="external" rel=" noopener">KumaScript</a> for automating certain aspects of content. We are hoping to stop using it some day, but until then MDN will still rely on it. This article provides basic information about using KumaScript.</p></div><h3 id="what_is_kumascript"><a href="#what_is_kumascript" title="Permalink to What is KumaScript?">What is KumaScript?</a></h3><div><ul>
  <li>A way to reuse and localize content that appears repeatedly between documents (e.g., compatibility labels, section navigation, warning banners).</li>
  <li>A way to build documents out of content pulled from other documents.</li>
  <li>A way to fetch and include content from other websites and services (e.g., Bugzilla).</li>
</ul></div><h3 id="what_kumascript_is_not"><a href="#what_kumascript_is_not" title="Permalink to What KumaScript is not">What KumaScript is not</a></h3><div><p>KumaScript does not</p>
<ul>
  <li>support interactive scripting of the kind that can accept form submissions.</li>
  <li>have access to a database, files, or any other way to store information persistently.</li>
  <li>support site personalization based on the currently logged in user.</li>
  <li>have access to user information, only to the content and metadata of an MDN page being viewed.</li>
</ul></div><h2 id="basics"><a href="#basics" title="Permalink to Basics">Basics</a></h2><div><p>KumaScript is used on MDN via <a href="https://github.com/mde/ejs" class="external" rel=" noopener">embedded JavaScript templates</a>. These templates can be invoked in document content by any MDN author, through the use of macros.</p>
<p>A script in KumaScript is a <em>template</em>, and each template is a file in <a href="https://github.com/mdn/yari/tree/main/kumascript/macros" class="external" rel=" noopener">the macros directory</a> of the <code>mdn/yari</code> repository on GitHub. A sample template might look like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> $0<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
  Hello #<span class="token operator">&lt;</span><span class="token operator">%=</span> i <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>Invoking a template is done with a <em>macro</em>, which can be used anywhere in any page content. Invoking the above template would look like this (provided it was saved in the macros directory with a filename of <code>hello.ejs</code>):</p>
<div class="code-example"><pre class="brush: plain notranslate">{{hello(3)}}
</pre></div>
<p>The output of the macro would look like this:</p>
<pre class="notranslate">Hello #0
Hello #1
Hello #2
</pre></div><h3 id="macro_syntax"><a href="#macro_syntax" title="Permalink to Macro syntax">Macro syntax</a></h3><div><p>Macro syntax takes the following general form:</p>
<div class="code-example"><pre class="brush: plain notranslate">{{templateName("arg0", "arg1", /* ‚Ä¶, */ "argN")}}
</pre></div>
<p>Macro syntax follows these rules:</p>
<ul>
  <li>Macros start and end with <code>{{` and `}}</code> characters.</li>
  <li>The first part of the macro is the name of a template. The lowercase value of this name should match the lowercase value of one of the filenames under the macros directory.</li>
  <li>A template can accept parameters, and this parameter list starts and ends with parentheses.</li>
  <li>All non-numeric parameters must be in quotes. Numbers can be left unquoted.</li>
</ul>
<h4 id="using_json_as_a_macro_parameter">Using JSON as a macro parameter</h4>
<p>As a semi-experimental feature (not guaranteed to work), you can supply a JSON object for the first and only parameter, like so:</p>
<div class="code-example"><pre class="brush: plain notranslate">{{templateName({ "Alpha": "one", "Beta": ["a", "b", "c"], "Foo": "https:\/\/mozilla.org\/" })}}
</pre></div>
<p>The data from this macro is available in template code as an object in the <code>$0</code> argument (e.g., <code>$0.Alpha</code>, <code>$0.Beta</code>, <code>$0.Foo</code>). This also allows you to express complex data structures in macro parameters that are hard or impossible to do with a simple list of parameters.</p>
<p>Note that this parameter style is very picky ‚Äî it must adhere to <a href="https://json.org/" class="external" rel=" noopener">JSON syntax</a> exactly, which has some requirements about escaping characters that are easy to miss (e.g., all forward slashes are escaped). When in doubt, <a href="https://jsonlint.com/" class="external" rel=" noopener">try running your JSON through a validator</a>.</p>
<h4 id="how_to_write_in_text">How to write "{{" in text</h4>
<p>Since the character sequence "<code>{{</code>" is used to indicate the start of a macro, this can be troublesome if you actually just want to use "<code>{{</code>" and "<code>}}</code>" in a page. It will probably produce <code>DocumentParsingError</code> messages.</p>
<p>In this case, you can escape the first brace with a backslash, like so: <code>\{{</code>.</p></div><h3 id="template_syntax"><a href="#template_syntax" title="Permalink to Template syntax">Template syntax</a></h3><div><p>Each KumaScript template is a file under <a href="https://github.com/mdn/yari/tree/main/kumascript/macros" class="external" rel=" noopener">the macros directory</a> of the <code>mdn/yari</code> repository on GitHub. You create and edit these files as you would the files of any open-source project on GitHub.</p>
<p>KumaScript templates are processed by an <a href="https://ejs.co" class="external" rel=" noopener">embedded JavaScript template engine</a> with a few simple rules:</p>
<ul>
  <li>Within a template, the parameters passed in from the macro are available as the variables <code>$0</code>, <code>$1</code>, <code>$2</code>, and so on. The entire list of parameters is also available in a template as the variable <code>arguments</code>.</li>
  <li>Most text is treated as output and included in the output stream.</li>
  <li>JavaScript variables and expressions can be inserted into the output stream with these blocks:
    <ul>
      <li><code>&lt;%= expr %&gt;</code> ‚Äî the value of a JavaScript expression is escaped for HTML before being included in output (e.g., characters like <code>&lt;</code> and <code>&gt;</code> are turned into <code>&amp;lt;</code> and <code>&amp;gt;</code>).</li>
      <li><code>&lt;%- expr %&gt;</code> ‚Äî the value of a JavaScript expression is included in output without any escaping. (Use this if you want to dynamically build markup or use the results of another template that may include markup.)</li>
      <li>It is an error to include semicolons inside these blocks.</li>
    </ul>
  </li>
  <li>Anything inside a <code>&lt;% %&gt;</code> block is interpreted as JavaScript. This can include loops, conditionals, etc.</li>
  <li>Nothing inside a <code>&lt;% %&gt;</code> block can ever contribute to the output stream. But, you can transition from JS mode to output mode using <code>&lt;% %&gt;</code>‚Äîfor example:
    <div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> $0<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
  Hello #<span class="token operator">&lt;</span><span class="token operator">%=</span> i <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>Note how the JavaScript code is contained in <code>&lt;% ‚Ä¶ %&gt;</code>, and output happens in the space between <code>%&gt; ‚Ä¶ &lt;%</code>. The <code>for</code> loop in JS can begin with one <code>&lt;% %&gt;</code> block, transition to output mode, and finish up in a second <code>&lt;% %&gt;</code> JS block.
  </li>
  <li>For more details on EJS syntax, <a href="https://ejs.co" class="external" rel=" noopener">check out the upstream module documentation</a>.</li>
</ul></div><h2 id="advanced_features"><a href="#advanced_features" title="Permalink to Advanced Features">Advanced Features</a></h2><div><p>Beyond the basics, the KumaScript system offers some advanced features.</p></div><h3 id="environment_variables"><a href="#environment_variables" title="Permalink to Environment variables">Environment variables</a></h3><div><p>When the wiki makes a call to the KumaScript service, it passes along some context on the current document that KumaScript makes available to templates as variables:</p>
<dl>
  <dt id="env.path"><code>env.path</code></dt>
  <dd>
    <p>The path to the current MDN document</p>
  </dd>
  <dt id="env.url"><code>env.url</code></dt>
  <dd>
    <p>The full URL to the current MDN document</p>
  </dd>
  <dt id="env.id"><code>env.id</code></dt>
  <dd>
    <p>A short, unique ID for the current MDN document</p>
  </dd>
  <dt id="env.files"><code>env.files</code></dt>
  <dd>
    <p>An array of the files attached to the current MDN document; each object in the array is as described under <a href="#file_objects">File objects</a> below</p>
  </dd>
  <dt id="env.review_tags"><code>env.review_tags</code></dt>
  <dd>
    <p>An array of the review tags on the article ("technical", "editorial", etc.)</p>
  </dd>
  <dt id="env.locale"><code>env.locale</code></dt>
  <dd>
    <p>The locale of the current MDN document</p>
  </dd>
  <dt id="env.title"><code>env.title</code></dt>
  <dd>
    <p>The title of the current MDN document</p>
  </dd>
  <dt id="env.slug"><code>env.slug</code></dt>
  <dd>
    <p>The URL slug of the current MDN document</p>
  </dd>
  <dt id="env.tags"><code>env.tags</code></dt>
  <dd>
    <p>An array list of tag names for the current MDN document</p>
  </dd>
  <dt id="env.modified"><code>env.modified</code></dt>
  <dd>
    <p>Last modified timestamp for the current MDN document</p>
  </dd>
  <dt id="env.cache_control"><code>env.cache_control</code></dt>
  <dd>
    <p><code>Cache-Control</code> header sent in the request for the current MDN document, useful in deciding whether to invalidate caches</p>
  </dd>
</dl>
<h4 id="file_objects">File objects</h4>
<p>Each file object has the following fields:</p>
<dl>
  <dt id="title"><code>title</code></dt>
  <dd>
    <p>The attachment's title</p>
  </dd>
  <dt id="description"><code>description</code></dt>
  <dd>
    <p>A textual description of the current revision of the file</p>
  </dd>
  <dt id="filename"><code>filename</code></dt>
  <dd>
    <p>The file's name</p>
  </dd>
  <dt id="size"><code>size</code></dt>
  <dd>
    <p>The size of the file in bytes</p>
  </dd>
  <dt id="author"><code>author</code></dt>
  <dd>
    <p>The username of the person who uploaded the file</p>
  </dd>
  <dt id="mime"><code>mime</code></dt>
  <dd>
    <p>The MIME type of the file</p>
  </dd>
  <dt id="url"><code>url</code></dt>
  <dd>
    <p>The URL at which the file can be found</p>
  </dd>
</dl>
<h4 id="working_with_tag_lists">Working with tag lists</h4>
<p>The <code>env.tags</code> and <code>env.review_tags</code> variables return arrays of tags. You can work with these in many ways, of course, but here are a couple of suggestions.</p>
<h5 id="looking_to_see_if_a_specific_tag_is_set">Looking to see if a specific tag is set</h5>
<p>You can look to see if a specific tag exists on a page like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"tag"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> ‚àí<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// The page has the tag "tag"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h5 id="iterating_over_all_the_tags_on_a_page">Iterating over all the tags on a page</h5>
<p>You can also iterate over all the tags on a page, like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>env<span class="token punctuation">.</span>tag<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do whatever you need to do, such as:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tag<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this tag starts with "a" - woohoo!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h3 id="apis_and_modules"><a href="#apis_and_modules" title="Permalink to APIs and Modules">APIs and Modules</a></h3><div><p>KumaScript offers some built-in methods and APIs for KumaScript macros. Macros can also use <code>module.exports</code> to export new API methods.</p>
<h4 id="built-in_methods">Built-in methods</h4>
<p>This manually-maintained documentation is likely to fall out of date with the code. With that in mind, you can always check out the latest state of built-in APIs in the <a href="https://github.com/mdn/yari/tree/main/kumascript/src/api" class="external" rel=" noopener">KumaScript source</a>. But here is a selection of useful methods exposed to templates:</p>
<dl>
  <dt id="md5string"><code>md5(string)</code></dt>
  <dd>
    <p>Returns an MD5 hex digest of the given string.</p>
  </dd>
  <dt id="templatename_arg0_arg1_‚Ä¶_argn"><code>template("name", ["arg0", "arg1", ‚Ä¶, "argN"])</code></dt>
  <dd>
    <p>Executes and returns the result of the named template with the given list of parameters.</p>
    <p>Example: <code>&lt;%- template("warning", ["foo", "bar", "baz"]) %&gt;</code>.</p>
    <p>Example using the <code>DOMxRef</code> macro: <code>&lt;%- template("DOMxRef", ["Event.bubbles", "bubbles"]) %&gt;</code>.</p>
    <p>This is a JavaScript function. So, if one of the parameters is an arg variable like <code>$2</code>, do not put it in quotes. Like this: <code>&lt;%- template("warning", [$1, $2, "baz"]) %&gt;</code>. If you need to call another template from within a block of code, do not use <code>&lt;%</code> ‚Ä¶ <code>%&gt;</code>. Example: <code>myvar = "&lt;li&gt;" + template("LXRSearch", ["ident", "i", $1]) + "&lt;/li&gt;";</code></p>
  </dd>
  <dt id="requirename"><code>require(name)</code></dt>
  <dd>
    <p>Loads another template as a module; any output is ignored. Anything assigned to <code>module.exports</code> in the template is returned. Used in templates like so: <code>&lt;% const my_module = require('MyModule'); %&gt;</code>.</p>
  </dd>
  <dt id="cachefnkey_timeout_function_to_cache"><code>cacheFn(key, timeout, function_to_cache)</code></dt>
  <dd>
    <p>Using the given key and cache entry lifetime, cache the results of the given function. Honors the value of <code>env.cache_control</code> to invalidate cache on <code>no-cache</code>, which can be sent by a logged-in user hitting shift-refresh.</p>
  </dd>
  <dt id="request"><code>request</code></dt>
  <dd>
    <p>Access to <a href="https://github.com/request/request" class="external" rel=" noopener"><code>request/request</code></a>, a library for making HTTP requests. Using this module in KumaScript templates is not yet very friendly, so you may want to wrap usage in module APIs that simplify things.</p>
  </dd>
  <dt id="log.debugstring"><code>log.debug(string)</code></dt>
  <dd>
    <p>Outputs a debug message into the script log on the page (i.e. the big red box that usually displays errors).</p>
  </dd>
</dl>
<h4 id="built-in_api_modules">Built-in API modules</h4>
<p>There are a set of built-in APIs that are automatically loaded and made available to every template by the environment script, as well as providing some features from the ancient legacy DekiScript system that MDN relied on many years ago.</p>
<p>These are used to share common variables and methods between templates:</p>
<ul>
  <li><code>kuma.*</code> - <a href="https://github.com/mdn/yari/blob/main/kumascript/src/api/kuma.js" class="external" rel=" noopener">Kuma</a></li>
  <li><code>MDN.*</code> - <a href="https://github.com/mdn/yari/blob/main/kumascript/src/api/mdn.js" class="external" rel=" noopener">MDN:Common</a></li>
  <li><code>page.*</code> - <a href="https://github.com/mdn/yari/blob/main/kumascript/src/api/page.js" class="external" rel=" noopener">DekiScript:Page</a></li>
  <li><code>string.*</code> - <a href="https://github.com/mdn/yari/blob/main/kumascript/src/api/string.js" class="external" rel=" noopener">DekiScript:String</a></li>
  <li><code>web.*</code> - <a href="https://github.com/mdn/yari/blob/main/kumascript/src/api/web.js" class="external" rel=" noopener">DekiScript:Web</a></li>
  <li><code>wiki.*</code> - <a href="https://github.com/mdn/yari/blob/main/kumascript/src/api/wiki.js" class="external" rel=" noopener">DekiScript:Wiki</a></li>
</ul>
<p>Other available APIs include:</p>
<dl>
  <dt id="kuma.inspectobject"><code>kuma.inspect(object)</code></dt>
  <dd>
    <p>Renders any JS object as a string, handy for use with <code>log.debug()</code>. See also: <a href="https://nodejs.org/api/util.html#util_util_inspect_object_options" class="external" rel=" noopener">node.js <code>util.inspect()</code></a>.</p>
  </dd>
  <dt id="kuma.htmlescapestring"><code>kuma.htmlEscape(string)</code></dt>
  <dd>
    <p>Escapes the characters <code>&amp;, &lt;, &gt;, "</code> to <code>&amp;amp, &amp;lt;, &amp;gt;, &amp;quot;</code>, respectively.</p>
  </dd>
  <dt id="kuma.url"><code>kuma.url</code></dt>
  <dd>
    <p>See also: <a href="https://nodejs.org/api/url.html" class="external" rel=" noopener">node.js <code>url</code> module</a>.</p>
  </dd>
  <dt id="kuma.fetchfeedurl"><code>kuma.fetchFeed(url)</code></dt>
  <dd>
    <p>Fetch an RSS feed and parse it into a JS object.</p>
  </dd>
</dl>
<h4 id="creating_modules">Creating modules</h4>
<p>Using the built-in <code>require()</code> method, you can load a template as a module to share common variables and methods between templates. A module can be defined in a template like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>Assuming this template were saved in the macros directory as <code>MathLib.ejs</code>, you could use it in another template like so:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span>
<span class="token keyword">const</span> math_lib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"MathLib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
The result <span class="token keyword">of</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">%=</span> math_lib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>And, the output of this template would be:</p>
<pre class="notranslate">The result of 2 + 2 = 4
</pre></div><h2 id="tips_and_caveats"><a href="#tips_and_caveats" title="Permalink to Tips and caveats">Tips and caveats</a></h2><div></div><h3 id="debugging"><a href="#debugging" title="Permalink to Debugging">Debugging</a></h3><div><p>A useful tip when debugging. You can use the <code>log.debug()</code> method to output text to the scripting messages area at the top of the page that's running your template. Note that you need to be really sure to remove these when you're done debugging, as they're visible to all users! To use it, just do something like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Some text goes here"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>You can, of course, create more complex output using script code if it's helpful.</p></div><h3 id="caching"><a href="#caching" title="Permalink to Caching">Caching</a></h3><div><p>KumaScript templates are heavily cached to improve performance. For the most part, this works great to serve up content that doesn't change very often. But, as a logged-in user, you have two options to force a page to be regenerated, in case you notice issues with scripting:</p>
<ul>
  <li>Hit Refresh in your browser. This causes KumaScript to invalidate its cache for the content on the current page by issuing a request with a <code>Cache-Control: max-age=0</code> header.</li>
  <li>Hit Shift-Refresh in your browser. This causes KumaScript to invalidate cache for the current page, as well as for any templates or content used by the current page by issuing a request with a <code>Cache-Control: no-cache</code> header.</li>
</ul></div><h2 id="cookbook"><a href="#cookbook" title="Permalink to Cookbook">Cookbook</a></h2><div><p>This section will list examples of common patterns for templates used on MDN, including samples of legacy DekiScript templates and their new KumaScript equivalents.</p></div><h3 id="force_templates_used_on_a_page_to_be_reloaded"><a href="#force_templates_used_on_a_page_to_be_reloaded" title="Permalink to Force templates used on a page to be reloaded">Force templates used on a page to be reloaded</a></h3><div><p>It bears repeating: To force templates used on a page to be reloaded after editing, hit Shift-Reload. Just using Reload by itself will cause the page contents to be regenerated, but using cached templates and included content. A Shift-Reload is necessary to invalidate caches beyond just the content of the page itself.</p></div><h3 id="recovering_from_unknown_error"><a href="#recovering_from_unknown_error" title="Permalink to Recovering from &quot;Unknown Error&quot;">Recovering from "Unknown Error"</a></h3><div><p>Sometimes, you'll see a scripting message like this when you load a page:</p>
<div class="code-example"><pre class="brush: plain notranslate">Kumascript service failed unexpectedly: &lt;class 'httplib.BadStatusLine'&gt;
</pre></div>
<p>This is probably a temporary failure of the KumaScript service. If you Refresh the page, the error may disappear. If that doesn't work, try a Shift-Refresh. If, after a few tries, the error persists - <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=mozilla.org&amp;format=itrequest" class="external" rel=" noopener">file an IT bug</a> for Mozilla Developer Network to ask for an investigation.</p></div><h3 id="broken_wiki.languages_macros"><a href="#broken_wiki.languages_macros" title="Permalink to Broken wiki.languages() macros">Broken wiki.languages() macros</a></h3><div><p>On some pages, you'll see a scripting error like this:</p>
<div class="code-example"><pre class="brush: plain notranslate">Syntax error at line 436, column 461: Expected valid JSON object as the parameter of the preceding macro but‚Ä¶
</pre></div>
<p>If you edit the page, you'll probably see a macro like this at the bottom of the page:</p>
<div class="code-example"><pre class="brush: plain notranslate">{{ wiki.languages({ "zh-tw": "zh_tw/Core_JavaScript_1.5_ÊïôÂ≠∏/JavaScript_Ê¶ÇË¶Å", ‚Ä¶ }) }}
</pre></div>
<p>To fix the problem, just delete the macro. Or, replace the curly braces on either side with HTML comments <code>&lt;!-- --&gt;</code> to preserve the information, like so:</p>
<div class="code-example"><pre class="brush: html notranslate"><code><span class="token comment">&lt;!-- wiki.languages({ "zh-tw": "zh_tw/Core_JavaScript_1.5_ÊïôÂ≠∏/JavaScript_Ê¶ÇË¶Å", ... }) --&gt;</span>
</code></pre></div>
<p>Because Kuma supports localization differently, these macros aren't actually needed any more. But, they've been left intact in case we need to revisit the relationships between localized pages. Unfortunately, it seems like migration has failed to convert some of them properly.</p></div><h3 id="finding_the_current_pages_language"><a href="#finding_the_current_pages_language" title="Permalink to Finding the Current Page's Language">Finding the Current Page's Language</a></h3><div><p>In KumaScript, the locale of the current document is exposed as an environment variable:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> lang <span class="token operator">=</span> env<span class="token punctuation">.</span>locale<span class="token punctuation">;</span>
</code></pre></div>
<p>The <code>env.locale</code> variable should be reliable and defined for every document.</p></div><h3 id="reading_the_contents_of_a_page_attachment"><a href="#reading_the_contents_of_a_page_attachment" title="Permalink to Reading the contents of a page attachment">Reading the contents of a page attachment</a></h3><div><p>You can read the contents of an attached file by using the <code>mdn.getFileContent()</code> function, like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span>
  <span class="token keyword">let</span> contents <span class="token operator">=</span> mdn<span class="token punctuation">.</span><span class="token function">getFileContent</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// do stuff with the contents‚Ä¶</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>or</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> mdn<span class="token punctuation">.</span><span class="token function">getFileContent</span><span class="token punctuation">(</span>fileObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>In other words, you may specify either the URL of the file to read or as a file object. The file objects for a page can be accessed through the array <code>env.files</code>. So, for example, to embed the contents of the first file attached to the article, you can do this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> mdn<span class="token punctuation">.</span><span class="token function">getFileContent</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<div class="notecard note" id="sect1">
  <p><strong>Note:</strong> You probably don't want to try to embed the contents of a non-text file this way, as the raw contents would be injected as text. This is meant to let you access the contents of text attachments.</p>
</div>
<p>If the file isn't found, an empty string is returned. There is currently no way to tell the difference between an empty file and a nonexistent one. But if you're putting empty files on the wiki, you're doing it wrong.</p></div><h3 id="localizing_template_content"><a href="#localizing_template_content" title="Permalink to Localizing template content">Localizing template content</a></h3><div><p>Templates are not translated like wiki pages, rather any single template might be used for any number of locales.</p>
<p>Templates can be localized using the <code>mdn.localString()</code> method, which takes an object containing a mapping of locales to strings. For example:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span>
<span class="token keyword">const</span> text <span class="token operator">=</span> mdn<span class="token punctuation">.</span><span class="token function">localString</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">"en-US"</span><span class="token operator">:</span> <span class="token string">"Hello world!"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"es"</span><span class="token operator">:</span> <span class="token string">"¬°Hola mundo!"</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>Each locale may also take an object containing a mapping of keys to strings, for more than one string. For example;</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span>
<span class="token keyword">const</span> text <span class="token operator">=</span> mdn<span class="token punctuation">.</span><span class="token function">localStringMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">'en-US'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'Complete_beginners_start_here'</span><span class="token operator">:</span> <span class="token string">'Complete beginners start here!'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'Getting_started_with_the_web'</span><span class="token operator">:</span> <span class="token string">'Getting started with the web'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'de'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'Complete_beginners_start_here'</span><span class="token operator">:</span> <span class="token string">'Anf√§nger starten hier!'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'Getting_started_with_the_web'</span><span class="token operator">:</span> <span class="token string">'Lernen Sie das Internet kennen'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'fr'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'Complete_beginners_start_here'</span><span class="token operator">:</span> <span class="token string">'Bienvenue aux d√©butants !'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'Getting_started_with_the_web'</span><span class="token operator">:</span> <span class="token string">'Commencer avec le Web'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>The <code>mdn.localString()</code> function will automatically load strings for the appropriate locale. If a string is missing for a locale, it will fall back to <code>en-US</code> for that string. For example:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token operator">&lt;</span><span class="token operator">%</span>
<span class="token keyword">const</span> s_title <span class="token operator">=</span> mdn<span class="token punctuation">.</span><span class="token function">localString</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">"en-US"</span><span class="token operator">:</span> <span class="token string">"Firefox for Developers"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"de"</span><span class="token operator">:</span> <span class="token string">"Firefox f√ºr Entwickler"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"es"</span><span class="token operator">:</span> <span class="token string">"Firefox para desarrolladores"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> body <span class="token operator">=</span> mdn<span class="token punctuation">.</span><span class="token function">localString</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">"en-US"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"hello"</span><span class="token operator">:</span> <span class="token string">"Hello!"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"goodbye"</span><span class="token operator">:</span> <span class="token string">"Goodbye!"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"de"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"hello"</span><span class="token operator">:</span> <span class="token string">"Hallo!"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"goodbye"</span><span class="token operator">:</span> <span class="token string">"Auf Wiedersehen!"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"es"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"hello"</span><span class="token operator">:</span> <span class="token string">"¬°Hola!"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%=</span> s_title <span class="token operator">%</span><span class="token operator">&gt;</span> <span class="token operator">/</span> <span class="token operator">&lt;</span><span class="token operator">%=</span> body<span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">]</span> <span class="token operator">%</span><span class="token operator">&gt;</span> <span class="token operator">/</span> <span class="token operator">&lt;</span><span class="token operator">%=</span> body<span class="token punctuation">[</span><span class="token string">'goodbye'</span><span class="token punctuation">]</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre></div>
<p>Will render, for <code>de</code>:</p>
<pre class="notranslate">Firefox f√ºr Entwickler / Hallo! / Auf Wiedersehen!
</pre>
<p>...and for <code>es</code>:</p>
<pre class="notranslate">Firefox para desarrolladores / ¬°Hola! / Goodbye!
</pre>
<p>...and for <code>en-US</code> / <code>ko</code>:</p>
<pre class="notranslate">Firefox for Developers / Hello! / Goodbye!
</pre></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/style/old/files/en-us/mdn/tools/kumascript/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/blob/style/old/files/en-us/mdn/tools/kumascript/index.md" title="Folder: en-us/mdn/tools/kumascript (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FMDN%2FTools%2FKumaScript%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fmdn%2Ftools%2Fkumascript%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FMDN%2FTools%2FKumaScript%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fstyle%2Fold%2Ffiles%2Fen-us%2Fmdn%2Ftools%2Fkumascript%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2F5431dab904a383ca8dcf73dbd04d24915bae254c%0A*+Document+last+modified%3A+2022-09-28T15%3A51%3A09.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22KumaScript%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2CContent%3AOther" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-09-28T15:51:09.000Z">Sep 28, 2022</time>,<!-- --> <a href="/en-US/docs/MDN/Tools/KumaScript/contributors.txt">by MDN contributors</a></p><form class="language-menu"><fieldset id="select-language"><legend>Change your language</legend><label for="language-selector" class="visually-hidden">Select your preferred language</label> <select id="language-selector" name="language"><option selected="" value="en-US">English (US)</option><option value="es">Espa√±ol</option><option value="ja">Êó•Êú¨Ë™û</option><option value="pt-BR">Portugu√™s (do&nbsp;Brasil)</option><option value="zh-TW">Ê≠£È´î‰∏≠Êñá (ÁπÅÈ´î)</option></select> <button type="submit" class="button minimal">Change language</button></fieldset></form></div></aside></main><nav id="sidebar-quicklinks" class="sidebar"><h4>Related Topics</h4><div>
  <ol>
    <li><a href="/en-US/docs/MDN/About">About MDN</a></li>
    <li class="toggle">
        <details>
            <summary>Contributing to MDN</summary>
            <ol>
                <li><a href="/en-US/docs/MDN/Contribute/Getting_started">Get started on MDN</a></li>
                <li><a href="/en-US/docs/MDN/Contribute">Contributing to MDN</a></li>
                <li><a href="/en-US/docs/MDN/Contribute/Howto">Things you can do</a></li>
                <li><a href="/en-US/docs/MDN/Contribute/Localize">Localizing MDN</a></li>
                <li><a href="/en-US/docs/MDN/Guidelines">Guidelines</a></li>
                <li><a href="/en-US/docs/MDN/Structures">Content structures</a></li>
             </ol>
        </details>
    </li>
  </ol>
</div></nav></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/en-US/docs/Web">Web Technologies</a></li><li><a href="/en-US/docs/Learn">Learn Web Development</a></li><li><a href="/en-US/docs/MDN/About">About MDN</a></li><li><a href="/en-US/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">¬© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"KumaScript","mdn_url":"/en-US/docs/MDN/Tools/KumaScript","locale":"en-US","native":"English (US)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/en-US/docs/MDN/About\">About MDN</a></li>\n    <li class=\"toggle\">\n        <details>\n            <summary>Contributing to MDN</summary>\n            <ol>\n                <li><a href=\"/en-US/docs/MDN/Contribute/Getting_started\">Get started on MDN</a></li>\n                <li><a href=\"/en-US/docs/MDN/Contribute\">Contributing to MDN</a></li>\n                <li><a href=\"/en-US/docs/MDN/Contribute/Howto\">Things you can do</a></li>\n                <li><a href=\"/en-US/docs/MDN/Contribute/Localize\">Localizing MDN</a></li>\n                <li><a href=\"/en-US/docs/MDN/Guidelines\">Guidelines</a></li>\n                <li><a href=\"/en-US/docs/MDN/Structures\">Content structures</a></li>\n             </ol>\n        </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>On the <a href=\"/en-US/docs/MDN/Yari\">Yari</a> platform that powers MDN, we still have a legacy template/macro system available called <a href=\"https://github.com/mdn/yari/tree/main/kumascript\" class=\"external\" rel=\" noopener\">KumaScript</a> for automating certain aspects of content. We are hoping to stop using it some day, but until then MDN will still rely on it. This article provides basic information about using KumaScript.</p>"}},{"type":"prose","value":{"id":"what_is_kumascript","title":"What is KumaScript?","isH3":true,"content":"<ul>\n  <li>A way to reuse and localize content that appears repeatedly between documents (e.g., compatibility labels, section navigation, warning banners).</li>\n  <li>A way to build documents out of content pulled from other documents.</li>\n  <li>A way to fetch and include content from other websites and services (e.g., Bugzilla).</li>\n</ul>"}},{"type":"prose","value":{"id":"what_kumascript_is_not","title":"What KumaScript is not","isH3":true,"content":"<p>KumaScript does not</p>\n<ul>\n  <li>support interactive scripting of the kind that can accept form submissions.</li>\n  <li>have access to a database, files, or any other way to store information persistently.</li>\n  <li>support site personalization based on the currently logged in user.</li>\n  <li>have access to user information, only to the content and metadata of an MDN page being viewed.</li>\n</ul>"}},{"type":"prose","value":{"id":"basics","title":"Basics","isH3":false,"content":"<p>KumaScript is used on MDN via <a href=\"https://github.com/mde/ejs\" class=\"external\" rel=\" noopener\">embedded JavaScript templates</a>. These templates can be invoked in document content by any MDN author, through the use of macros.</p>\n<p>A script in KumaScript is a <em>template</em>, and each template is a file in <a href=\"https://github.com/mdn/yari/tree/main/kumascript/macros\" class=\"external\" rel=\" noopener\">the macros directory</a> of the <code>mdn/yari</code> repository on GitHub. A sample template might look like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> $0<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n  Hello #<span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> i <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>Invoking a template is done with a <em>macro</em>, which can be used anywhere in any page content. Invoking the above template would look like this (provided it was saved in the macros directory with a filename of <code>hello.ejs</code>):</p>\n<div class=\"code-example\"><pre class=\"brush: plain notranslate\">{{hello(3)}}\n</pre></div>\n<p>The output of the macro would look like this:</p>\n<pre class=\"notranslate\">Hello #0\nHello #1\nHello #2\n</pre>"}},{"type":"prose","value":{"id":"macro_syntax","title":"Macro syntax","isH3":true,"content":"<p>Macro syntax takes the following general form:</p>\n<div class=\"code-example\"><pre class=\"brush: plain notranslate\">{{templateName(\"arg0\", \"arg1\", /* ‚Ä¶, */ \"argN\")}}\n</pre></div>\n<p>Macro syntax follows these rules:</p>\n<ul>\n  <li>Macros start and end with <code>{{` and `}}</code> characters.</li>\n  <li>The first part of the macro is the name of a template. The lowercase value of this name should match the lowercase value of one of the filenames under the macros directory.</li>\n  <li>A template can accept parameters, and this parameter list starts and ends with parentheses.</li>\n  <li>All non-numeric parameters must be in quotes. Numbers can be left unquoted.</li>\n</ul>\n<h4 id=\"using_json_as_a_macro_parameter\">Using JSON as a macro parameter</h4>\n<p>As a semi-experimental feature (not guaranteed to work), you can supply a JSON object for the first and only parameter, like so:</p>\n<div class=\"code-example\"><pre class=\"brush: plain notranslate\">{{templateName({ \"Alpha\": \"one\", \"Beta\": [\"a\", \"b\", \"c\"], \"Foo\": \"https:\\/\\/mozilla.org\\/\" })}}\n</pre></div>\n<p>The data from this macro is available in template code as an object in the <code>$0</code> argument (e.g., <code>$0.Alpha</code>, <code>$0.Beta</code>, <code>$0.Foo</code>). This also allows you to express complex data structures in macro parameters that are hard or impossible to do with a simple list of parameters.</p>\n<p>Note that this parameter style is very picky ‚Äî it must adhere to <a href=\"https://json.org/\" class=\"external\" rel=\" noopener\">JSON syntax</a> exactly, which has some requirements about escaping characters that are easy to miss (e.g., all forward slashes are escaped). When in doubt, <a href=\"https://jsonlint.com/\" class=\"external\" rel=\" noopener\">try running your JSON through a validator</a>.</p>\n<h4 id=\"how_to_write_in_text\">How to write \"{{\" in text</h4>\n<p>Since the character sequence \"<code>{{</code>\" is used to indicate the start of a macro, this can be troublesome if you actually just want to use \"<code>{{</code>\" and \"<code>}}</code>\" in a page. It will probably produce <code>DocumentParsingError</code> messages.</p>\n<p>In this case, you can escape the first brace with a backslash, like so: <code>\\{{</code>.</p>"}},{"type":"prose","value":{"id":"template_syntax","title":"Template syntax","isH3":true,"content":"<p>Each KumaScript template is a file under <a href=\"https://github.com/mdn/yari/tree/main/kumascript/macros\" class=\"external\" rel=\" noopener\">the macros directory</a> of the <code>mdn/yari</code> repository on GitHub. You create and edit these files as you would the files of any open-source project on GitHub.</p>\n<p>KumaScript templates are processed by an <a href=\"https://ejs.co\" class=\"external\" rel=\" noopener\">embedded JavaScript template engine</a> with a few simple rules:</p>\n<ul>\n  <li>Within a template, the parameters passed in from the macro are available as the variables <code>$0</code>, <code>$1</code>, <code>$2</code>, and so on. The entire list of parameters is also available in a template as the variable <code>arguments</code>.</li>\n  <li>Most text is treated as output and included in the output stream.</li>\n  <li>JavaScript variables and expressions can be inserted into the output stream with these blocks:\n    <ul>\n      <li><code>&lt;%= expr %&gt;</code> ‚Äî the value of a JavaScript expression is escaped for HTML before being included in output (e.g., characters like <code>&lt;</code> and <code>&gt;</code> are turned into <code>&amp;lt;</code> and <code>&amp;gt;</code>).</li>\n      <li><code>&lt;%- expr %&gt;</code> ‚Äî the value of a JavaScript expression is included in output without any escaping. (Use this if you want to dynamically build markup or use the results of another template that may include markup.)</li>\n      <li>It is an error to include semicolons inside these blocks.</li>\n    </ul>\n  </li>\n  <li>Anything inside a <code>&lt;% %&gt;</code> block is interpreted as JavaScript. This can include loops, conditionals, etc.</li>\n  <li>Nothing inside a <code>&lt;% %&gt;</code> block can ever contribute to the output stream. But, you can transition from JS mode to output mode using <code>&lt;% %&gt;</code>‚Äîfor example:\n    <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> $0<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n  Hello #<span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> i <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>Note how the JavaScript code is contained in <code>&lt;% ‚Ä¶ %&gt;</code>, and output happens in the space between <code>%&gt; ‚Ä¶ &lt;%</code>. The <code>for</code> loop in JS can begin with one <code>&lt;% %&gt;</code> block, transition to output mode, and finish up in a second <code>&lt;% %&gt;</code> JS block.\n  </li>\n  <li>For more details on EJS syntax, <a href=\"https://ejs.co\" class=\"external\" rel=\" noopener\">check out the upstream module documentation</a>.</li>\n</ul>"}},{"type":"prose","value":{"id":"advanced_features","title":"Advanced Features","isH3":false,"content":"<p>Beyond the basics, the KumaScript system offers some advanced features.</p>"}},{"type":"prose","value":{"id":"environment_variables","title":"Environment variables","isH3":true,"content":"<p>When the wiki makes a call to the KumaScript service, it passes along some context on the current document that KumaScript makes available to templates as variables:</p>\n<dl>\n  <dt id=\"env.path\"><code>env.path</code></dt>\n  <dd>\n    <p>The path to the current MDN document</p>\n  </dd>\n  <dt id=\"env.url\"><code>env.url</code></dt>\n  <dd>\n    <p>The full URL to the current MDN document</p>\n  </dd>\n  <dt id=\"env.id\"><code>env.id</code></dt>\n  <dd>\n    <p>A short, unique ID for the current MDN document</p>\n  </dd>\n  <dt id=\"env.files\"><code>env.files</code></dt>\n  <dd>\n    <p>An array of the files attached to the current MDN document; each object in the array is as described under <a href=\"#file_objects\">File objects</a> below</p>\n  </dd>\n  <dt id=\"env.review_tags\"><code>env.review_tags</code></dt>\n  <dd>\n    <p>An array of the review tags on the article (\"technical\", \"editorial\", etc.)</p>\n  </dd>\n  <dt id=\"env.locale\"><code>env.locale</code></dt>\n  <dd>\n    <p>The locale of the current MDN document</p>\n  </dd>\n  <dt id=\"env.title\"><code>env.title</code></dt>\n  <dd>\n    <p>The title of the current MDN document</p>\n  </dd>\n  <dt id=\"env.slug\"><code>env.slug</code></dt>\n  <dd>\n    <p>The URL slug of the current MDN document</p>\n  </dd>\n  <dt id=\"env.tags\"><code>env.tags</code></dt>\n  <dd>\n    <p>An array list of tag names for the current MDN document</p>\n  </dd>\n  <dt id=\"env.modified\"><code>env.modified</code></dt>\n  <dd>\n    <p>Last modified timestamp for the current MDN document</p>\n  </dd>\n  <dt id=\"env.cache_control\"><code>env.cache_control</code></dt>\n  <dd>\n    <p><code>Cache-Control</code> header sent in the request for the current MDN document, useful in deciding whether to invalidate caches</p>\n  </dd>\n</dl>\n<h4 id=\"file_objects\">File objects</h4>\n<p>Each file object has the following fields:</p>\n<dl>\n  <dt id=\"title\"><code>title</code></dt>\n  <dd>\n    <p>The attachment's title</p>\n  </dd>\n  <dt id=\"description\"><code>description</code></dt>\n  <dd>\n    <p>A textual description of the current revision of the file</p>\n  </dd>\n  <dt id=\"filename\"><code>filename</code></dt>\n  <dd>\n    <p>The file's name</p>\n  </dd>\n  <dt id=\"size\"><code>size</code></dt>\n  <dd>\n    <p>The size of the file in bytes</p>\n  </dd>\n  <dt id=\"author\"><code>author</code></dt>\n  <dd>\n    <p>The username of the person who uploaded the file</p>\n  </dd>\n  <dt id=\"mime\"><code>mime</code></dt>\n  <dd>\n    <p>The MIME type of the file</p>\n  </dd>\n  <dt id=\"url\"><code>url</code></dt>\n  <dd>\n    <p>The URL at which the file can be found</p>\n  </dd>\n</dl>\n<h4 id=\"working_with_tag_lists\">Working with tag lists</h4>\n<p>The <code>env.tags</code> and <code>env.review_tags</code> variables return arrays of tags. You can work with these in many ways, of course, but here are a couple of suggestions.</p>\n<h5 id=\"looking_to_see_if_a_specific_tag_is_set\">Looking to see if a specific tag is set</h5>\n<p>You can look to see if a specific tag exists on a page like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tag\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> ‚àí<span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// The page has the tag \"tag\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h5 id=\"iterating_over_all_the_tags_on_a_page\">Iterating over all the tags on a page</h5>\n<p>You can also iterate over all the tags on a page, like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>env<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tag</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// do whatever you need to do, such as:</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// this tag starts with \"a\" - woohoo!</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"apis_and_modules","title":"APIs and Modules","isH3":true,"content":"<p>KumaScript offers some built-in methods and APIs for KumaScript macros. Macros can also use <code>module.exports</code> to export new API methods.</p>\n<h4 id=\"built-in_methods\">Built-in methods</h4>\n<p>This manually-maintained documentation is likely to fall out of date with the code. With that in mind, you can always check out the latest state of built-in APIs in the <a href=\"https://github.com/mdn/yari/tree/main/kumascript/src/api\" class=\"external\" rel=\" noopener\">KumaScript source</a>. But here is a selection of useful methods exposed to templates:</p>\n<dl>\n  <dt id=\"md5string\"><code>md5(string)</code></dt>\n  <dd>\n    <p>Returns an MD5 hex digest of the given string.</p>\n  </dd>\n  <dt id=\"templatename_arg0_arg1_‚Ä¶_argn\"><code>template(\"name\", [\"arg0\", \"arg1\", ‚Ä¶, \"argN\"])</code></dt>\n  <dd>\n    <p>Executes and returns the result of the named template with the given list of parameters.</p>\n    <p>Example: <code>&lt;%- template(\"warning\", [\"foo\", \"bar\", \"baz\"]) %&gt;</code>.</p>\n    <p>Example using the <code>DOMxRef</code> macro: <code>&lt;%- template(\"DOMxRef\", [\"Event.bubbles\", \"bubbles\"]) %&gt;</code>.</p>\n    <p>This is a JavaScript function. So, if one of the parameters is an arg variable like <code>$2</code>, do not put it in quotes. Like this: <code>&lt;%- template(\"warning\", [$1, $2, \"baz\"]) %&gt;</code>. If you need to call another template from within a block of code, do not use <code>&lt;%</code> ‚Ä¶ <code>%&gt;</code>. Example: <code>myvar = \"&lt;li&gt;\" + template(\"LXRSearch\", [\"ident\", \"i\", $1]) + \"&lt;/li&gt;\";</code></p>\n  </dd>\n  <dt id=\"requirename\"><code>require(name)</code></dt>\n  <dd>\n    <p>Loads another template as a module; any output is ignored. Anything assigned to <code>module.exports</code> in the template is returned. Used in templates like so: <code>&lt;% const my_module = require('MyModule'); %&gt;</code>.</p>\n  </dd>\n  <dt id=\"cachefnkey_timeout_function_to_cache\"><code>cacheFn(key, timeout, function_to_cache)</code></dt>\n  <dd>\n    <p>Using the given key and cache entry lifetime, cache the results of the given function. Honors the value of <code>env.cache_control</code> to invalidate cache on <code>no-cache</code>, which can be sent by a logged-in user hitting shift-refresh.</p>\n  </dd>\n  <dt id=\"request\"><code>request</code></dt>\n  <dd>\n    <p>Access to <a href=\"https://github.com/request/request\" class=\"external\" rel=\" noopener\"><code>request/request</code></a>, a library for making HTTP requests. Using this module in KumaScript templates is not yet very friendly, so you may want to wrap usage in module APIs that simplify things.</p>\n  </dd>\n  <dt id=\"log.debugstring\"><code>log.debug(string)</code></dt>\n  <dd>\n    <p>Outputs a debug message into the script log on the page (i.e. the big red box that usually displays errors).</p>\n  </dd>\n</dl>\n<h4 id=\"built-in_api_modules\">Built-in API modules</h4>\n<p>There are a set of built-in APIs that are automatically loaded and made available to every template by the environment script, as well as providing some features from the ancient legacy DekiScript system that MDN relied on many years ago.</p>\n<p>These are used to share common variables and methods between templates:</p>\n<ul>\n  <li><code>kuma.*</code> - <a href=\"https://github.com/mdn/yari/blob/main/kumascript/src/api/kuma.js\" class=\"external\" rel=\" noopener\">Kuma</a></li>\n  <li><code>MDN.*</code> - <a href=\"https://github.com/mdn/yari/blob/main/kumascript/src/api/mdn.js\" class=\"external\" rel=\" noopener\">MDN:Common</a></li>\n  <li><code>page.*</code> - <a href=\"https://github.com/mdn/yari/blob/main/kumascript/src/api/page.js\" class=\"external\" rel=\" noopener\">DekiScript:Page</a></li>\n  <li><code>string.*</code> - <a href=\"https://github.com/mdn/yari/blob/main/kumascript/src/api/string.js\" class=\"external\" rel=\" noopener\">DekiScript:String</a></li>\n  <li><code>web.*</code> - <a href=\"https://github.com/mdn/yari/blob/main/kumascript/src/api/web.js\" class=\"external\" rel=\" noopener\">DekiScript:Web</a></li>\n  <li><code>wiki.*</code> - <a href=\"https://github.com/mdn/yari/blob/main/kumascript/src/api/wiki.js\" class=\"external\" rel=\" noopener\">DekiScript:Wiki</a></li>\n</ul>\n<p>Other available APIs include:</p>\n<dl>\n  <dt id=\"kuma.inspectobject\"><code>kuma.inspect(object)</code></dt>\n  <dd>\n    <p>Renders any JS object as a string, handy for use with <code>log.debug()</code>. See also: <a href=\"https://nodejs.org/api/util.html#util_util_inspect_object_options\" class=\"external\" rel=\" noopener\">node.js <code>util.inspect()</code></a>.</p>\n  </dd>\n  <dt id=\"kuma.htmlescapestring\"><code>kuma.htmlEscape(string)</code></dt>\n  <dd>\n    <p>Escapes the characters <code>&amp;, &lt;, &gt;, \"</code> to <code>&amp;amp, &amp;lt;, &amp;gt;, &amp;quot;</code>, respectively.</p>\n  </dd>\n  <dt id=\"kuma.url\"><code>kuma.url</code></dt>\n  <dd>\n    <p>See also: <a href=\"https://nodejs.org/api/url.html\" class=\"external\" rel=\" noopener\">node.js <code>url</code> module</a>.</p>\n  </dd>\n  <dt id=\"kuma.fetchfeedurl\"><code>kuma.fetchFeed(url)</code></dt>\n  <dd>\n    <p>Fetch an RSS feed and parse it into a JS object.</p>\n  </dd>\n</dl>\n<h4 id=\"creating_modules\">Creating modules</h4>\n<p>Using the built-in <code>require()</code> method, you can load a template as a module to share common variables and methods between templates. A module can be defined in a template like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>Assuming this template were saved in the macros directory as <code>MathLib.ejs</code>, you could use it in another template like so:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>\n<span class=\"token keyword\">const</span> math_lib <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MathLib\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\nThe result <span class=\"token keyword\">of</span> <span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> math_lib<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>And, the output of this template would be:</p>\n<pre class=\"notranslate\">The result of 2 + 2 = 4\n</pre>"}},{"type":"prose","value":{"id":"tips_and_caveats","title":"Tips and caveats","isH3":false,"content":""}},{"type":"prose","value":{"id":"debugging","title":"Debugging","isH3":true,"content":"<p>A useful tip when debugging. You can use the <code>log.debug()</code> method to output text to the scripting messages area at the top of the page that's running your template. Note that you need to be really sure to remove these when you're done debugging, as they're visible to all users! To use it, just do something like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Some text goes here\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>You can, of course, create more complex output using script code if it's helpful.</p>"}},{"type":"prose","value":{"id":"caching","title":"Caching","isH3":true,"content":"<p>KumaScript templates are heavily cached to improve performance. For the most part, this works great to serve up content that doesn't change very often. But, as a logged-in user, you have two options to force a page to be regenerated, in case you notice issues with scripting:</p>\n<ul>\n  <li>Hit Refresh in your browser. This causes KumaScript to invalidate its cache for the content on the current page by issuing a request with a <code>Cache-Control: max-age=0</code> header.</li>\n  <li>Hit Shift-Refresh in your browser. This causes KumaScript to invalidate cache for the current page, as well as for any templates or content used by the current page by issuing a request with a <code>Cache-Control: no-cache</code> header.</li>\n</ul>"}},{"type":"prose","value":{"id":"cookbook","title":"Cookbook","isH3":false,"content":"<p>This section will list examples of common patterns for templates used on MDN, including samples of legacy DekiScript templates and their new KumaScript equivalents.</p>"}},{"type":"prose","value":{"id":"force_templates_used_on_a_page_to_be_reloaded","title":"Force templates used on a page to be reloaded","isH3":true,"content":"<p>It bears repeating: To force templates used on a page to be reloaded after editing, hit Shift-Reload. Just using Reload by itself will cause the page contents to be regenerated, but using cached templates and included content. A Shift-Reload is necessary to invalidate caches beyond just the content of the page itself.</p>"}},{"type":"prose","value":{"id":"recovering_from_unknown_error","title":"Recovering from \"Unknown Error\"","isH3":true,"content":"<p>Sometimes, you'll see a scripting message like this when you load a page:</p>\n<div class=\"code-example\"><pre class=\"brush: plain notranslate\">Kumascript service failed unexpectedly: &lt;class 'httplib.BadStatusLine'&gt;\n</pre></div>\n<p>This is probably a temporary failure of the KumaScript service. If you Refresh the page, the error may disappear. If that doesn't work, try a Shift-Refresh. If, after a few tries, the error persists - <a href=\"https://bugzilla.mozilla.org/enter_bug.cgi?product=mozilla.org&amp;format=itrequest\" class=\"external\" rel=\" noopener\">file an IT bug</a> for Mozilla Developer Network to ask for an investigation.</p>"}},{"type":"prose","value":{"id":"broken_wiki.languages_macros","title":"Broken wiki.languages() macros","isH3":true,"content":"<p>On some pages, you'll see a scripting error like this:</p>\n<div class=\"code-example\"><pre class=\"brush: plain notranslate\">Syntax error at line 436, column 461: Expected valid JSON object as the parameter of the preceding macro but‚Ä¶\n</pre></div>\n<p>If you edit the page, you'll probably see a macro like this at the bottom of the page:</p>\n<div class=\"code-example\"><pre class=\"brush: plain notranslate\">{{ wiki.languages({ \"zh-tw\": \"zh_tw/Core_JavaScript_1.5_ÊïôÂ≠∏/JavaScript_Ê¶ÇË¶Å\", ‚Ä¶ }) }}\n</pre></div>\n<p>To fix the problem, just delete the macro. Or, replace the curly braces on either side with HTML comments <code>&lt;!-- --&gt;</code> to preserve the information, like so:</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token comment\">&lt;!-- wiki.languages({ \"zh-tw\": \"zh_tw/Core_JavaScript_1.5_ÊïôÂ≠∏/JavaScript_Ê¶ÇË¶Å\", ... }) --&gt;</span>\n</code></pre></div>\n<p>Because Kuma supports localization differently, these macros aren't actually needed any more. But, they've been left intact in case we need to revisit the relationships between localized pages. Unfortunately, it seems like migration has failed to convert some of them properly.</p>"}},{"type":"prose","value":{"id":"finding_the_current_pages_language","title":"Finding the Current Page's Language","isH3":true,"content":"<p>In KumaScript, the locale of the current document is exposed as an environment variable:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> lang <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span>locale<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The <code>env.locale</code> variable should be reliable and defined for every document.</p>"}},{"type":"prose","value":{"id":"reading_the_contents_of_a_page_attachment","title":"Reading the contents of a page attachment","isH3":true,"content":"<p>You can read the contents of an attached file by using the <code>mdn.getFileContent()</code> function, like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>\n  <span class=\"token keyword\">let</span> contents <span class=\"token operator\">=</span> mdn<span class=\"token punctuation\">.</span><span class=\"token function\">getFileContent</span><span class=\"token punctuation\">(</span>fileUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// do stuff with the contents‚Ä¶</span>\n<span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> mdn<span class=\"token punctuation\">.</span><span class=\"token function\">getFileContent</span><span class=\"token punctuation\">(</span>fileObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>In other words, you may specify either the URL of the file to read or as a file object. The file objects for a page can be accessed through the array <code>env.files</code>. So, for example, to embed the contents of the first file attached to the article, you can do this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> mdn<span class=\"token punctuation\">.</span><span class=\"token function\">getFileContent</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> You probably don't want to try to embed the contents of a non-text file this way, as the raw contents would be injected as text. This is meant to let you access the contents of text attachments.</p>\n</div>\n<p>If the file isn't found, an empty string is returned. There is currently no way to tell the difference between an empty file and a nonexistent one. But if you're putting empty files on the wiki, you're doing it wrong.</p>"}},{"type":"prose","value":{"id":"localizing_template_content","title":"Localizing template content","isH3":true,"content":"<p>Templates are not translated like wiki pages, rather any single template might be used for any number of locales.</p>\n<p>Templates can be localized using the <code>mdn.localString()</code> method, which takes an object containing a mapping of locales to strings. For example:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>\n<span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> mdn<span class=\"token punctuation\">.</span><span class=\"token function\">localString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"en-US\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello world!\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"es\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"¬°Hola mundo!\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>Each locale may also take an object containing a mapping of keys to strings, for more than one string. For example;</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>\n<span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> mdn<span class=\"token punctuation\">.</span><span class=\"token function\">localStringMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">'en-US'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'Complete_beginners_start_here'</span><span class=\"token operator\">:</span> <span class=\"token string\">'Complete beginners start here!'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'Getting_started_with_the_web'</span><span class=\"token operator\">:</span> <span class=\"token string\">'Getting started with the web'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">'de'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'Complete_beginners_start_here'</span><span class=\"token operator\">:</span> <span class=\"token string\">'Anf√§nger starten hier!'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'Getting_started_with_the_web'</span><span class=\"token operator\">:</span> <span class=\"token string\">'Lernen Sie das Internet kennen'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">'fr'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'Complete_beginners_start_here'</span><span class=\"token operator\">:</span> <span class=\"token string\">'Bienvenue aux d√©butants !'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'Getting_started_with_the_web'</span><span class=\"token operator\">:</span> <span class=\"token string\">'Commencer avec le Web'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>The <code>mdn.localString()</code> function will automatically load strings for the appropriate locale. If a string is missing for a locale, it will fall back to <code>en-US</code> for that string. For example:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>\n<span class=\"token keyword\">const</span> s_title <span class=\"token operator\">=</span> mdn<span class=\"token punctuation\">.</span><span class=\"token function\">localString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"en-US\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Firefox for Developers\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"de\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Firefox f√ºr Entwickler\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"es\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Firefox para desarrolladores\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> mdn<span class=\"token punctuation\">.</span><span class=\"token function\">localString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"en-US\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"hello\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello!\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"goodbye\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Goodbye!\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"de\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"hello\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hallo!\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"goodbye\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Auf Wiedersehen!\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"es\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"hello\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"¬°Hola!\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> s_title <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span> <span class=\"token operator\">/</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span> <span class=\"token operator\">/</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'goodbye'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<p>Will render, for <code>de</code>:</p>\n<pre class=\"notranslate\">Firefox f√ºr Entwickler / Hallo! / Auf Wiedersehen!\n</pre>\n<p>...and for <code>es</code>:</p>\n<pre class=\"notranslate\">Firefox para desarrolladores / ¬°Hola! / Goodbye!\n</pre>\n<p>...and for <code>en-US</code> / <code>ko</code>:</p>\n<pre class=\"notranslate\">Firefox for Developers / Hello! / Goodbye!\n</pre>"}}],"toc":[{"text":"Basics","id":"basics"},{"text":"Advanced Features","id":"advanced_features"},{"text":"Tips and caveats","id":"tips_and_caveats"},{"text":"Cookbook","id":"cookbook"}],"summary":"On the Yari platform that powers MDN, we still have a legacy template/macro system available called KumaScript for automating certain aspects of content. We are hoping to stop using it some day, but until then MDN will still rely on it. This article provides basic information about using KumaScript.","popularity":0,"modified":"2022-09-28T15:51:09.000Z","other_translations":[{"title":"Introducci√≥n a KumaScript","locale":"es","native":"Espa√±ol"},{"title":"KumaScript","locale":"ja","native":"Êó•Êú¨Ë™û"},{"title":"KumaScript","locale":"pt-BR","native":"Portugu√™s (do¬†Brasil)"},{"title":"KumaScript","locale":"zh-TW","native":"Ê≠£È´î‰∏≠Êñá (ÁπÅÈ´î)"}],"source":{"folder":"en-us/mdn/tools/kumascript","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/mdn/tools/kumascript/index.md","last_commit_url":"https://github.com/mdn/content/commit/5431dab904a383ca8dcf73dbd04d24915bae254c","filename":"index.md"},"parents":[{"uri":"/en-US/docs/MDN","title":"The MDN Web Docs project"},{"uri":"/en-US/docs/MDN/Tools","title":"MDN tools"},{"uri":"/en-US/docs/MDN/Tools/KumaScript","title":"KumaScript"}],"pageTitle":"KumaScript - The MDN Web Docs project | MDN","noIndexing":false}}</script></body></html>