{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"書本清單頁面","mdn_url":"/zh-TW/docs/Learn/Server-side/Express_Nodejs/Displaying_data/Book_list_page","locale":"zh-TW","native":"正體中文 (繁體)","sidebarHTML":"","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>接下做我們將實作書本列表頁面。這個頁面需要呈現數據庫中所有書本的列表，包含每本書的作者、標題，標題將成為一個超連結，連到書本詳細內容頁面。</p>"}},{"type":"prose","value":{"id":"控制器","title":"控制器","isH3":false,"content":"<p>書本列表控制器函數，需要獲取數據庫中所有 <code>Book</code>對象的列表，然後將這些對像傳給模板進行呈現。</p>\n<p>打開 <strong>/controllers/bookController.js</strong>. 找到導出的 <code>book_list()</code>控制器方法，並替換為下面的代碼。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Display list of all Books.</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">book_list</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  Book<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'title author'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">populate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'author'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> list_books</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">//Successful, so render</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'book_list'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">'Book List'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">book_list</span><span class=\"token operator\">:</span> list_books <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>該方法使用模型的<code>find()</code>函數，返回所有 <code>Book</code> 對象，選擇僅返回標題 <code>title</code> 和作者 <code>author</code>，因為我們不需要其他字段（它也會返回 <code>_id</code> 和虛擬欄位字段）。這裡我們還調用 <code>Book</code> 上的 <code>populate()</code>，指定作者 <code>author</code>欄位字段 — 這將用完整的作者信息，替換儲存的書本作者 id。</p>\n<p>成功時，傳遞給查詢的回調，將呈現 <strong>book_list</strong>(.pug) 模板，將標題 <code>title</code> 和<code>book_list</code>（包含作者的書本列表）作為變量傳遞。</p>"}},{"type":"prose","value":{"id":"view_視圖","title":"View 視圖","isH3":false,"content":"<p>創建 <strong>/views/book_list.pug</strong> 並複制底下的文字。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">extends</span> <span class=\"token class-name\">layout</span>\n\nblock content\n  h1<span class=\"token operator\">=</span> title\n\n  ul\n    each book <span class=\"token keyword\">in</span> book_list\n      li\n        <span class=\"token function\">a</span><span class=\"token punctuation\">(</span>href<span class=\"token operator\">=</span>book<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span> #<span class=\"token punctuation\">{</span>book<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">|</span>  <span class=\"token punctuation\">(</span>#<span class=\"token punctuation\">{</span>book<span class=\"token punctuation\">.</span>author<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">else</span>\n      li There are no books<span class=\"token punctuation\">.</span>\n</code></pre></div>\n<p>這個視圖擴展了 <strong>layout.pug</strong> 基本模板，並覆蓋了名為 '<strong>content</strong>' 的 <code>block</code> 區塊 。它顯示我們從控制器傳入的標題 <code>title</code>（通過 <code>render()</code>方法），然後使用 <code>each</code>-<code>in</code>-<code>else</code> 語法，遍歷 <code>book_list</code>變量。為每本圖書創建一個列表項，以顯示書名，並作為書的詳細信息頁面的鏈接，後面跟著作者姓名。如果 <code>book_list</code>中沒有書，則執行 <code>else</code> 子句，並顯示文字 “沒有書本” 'There are no books'。</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>備註：</strong> 我們使用 <code>book.url</code>，為每本書提供詳細記錄鏈接（我們已經實現了此路由，但尚未實現此頁面）。這是 <code>Book</code> 模型的一個虛擬屬性，它使用模型實例的 <code>_id</code> 字段，生成唯一的 URL 路徑。</p>\n</div>\n<p>在這裡，我們感興趣的是，每本書被定義為兩行，第二行使用管道（上面高亮顯示）。這種方法是必要的，因為如果作者姓名位於上一行，那麼它將成為超鏈接的一部分。</p>"}},{"type":"prose","value":{"id":"它看起來像是","title":"它看起來像是?","isH3":false,"content":"<p>運行本應用 (參見 <a href=\"/zh-TW/docs/Learn/Server-side/Express_Nodejs/routes#testing_the_routes\">測試路由</a> 有相關的命令) ，並打開你的瀏覽器，訪問 <a href=\"http://localhost:3000/\" class=\"external\" rel=\" noopener\">http://localhost:3000/</a>。然後選擇所有書本連結 <em>All books</em>。如果每樣東西都設定正確了，你的網站看起來應該像底下的截圖。</p>\n<p>\n  <img src=\"/en-US/docs/Learn/Server-side/Express_Nodejs/Displaying_data/Book_list_page/new_book_list.png\" alt=\"Book List Page - Express Local Library site\" width=\"752\" height=\"257\" loading=\"lazy\">\n</p>"}},{"type":"prose","value":{"id":"下一步","title":"下一步","isH3":false,"content":"<ul>\n  <li>回到 <a href=\"/zh-TW/docs/Learn/Server-side/Express_Nodejs/Displaying_data\">Express 教學 5: 呈現圖書館資料</a></li>\n  <li>繼續教學 5 下個部分: <a href=\"/zh-TW/docs/Learn/Server-side/Express_Nodejs/Displaying_data/BookInstance_list_page\">書本實例清單頁面</a></li>\n</ul>"}}],"toc":[{"text":"控制器","id":"控制器"},{"text":"View 視圖","id":"view_視圖"},{"text":"它看起來像是?","id":"它看起來像是"},{"text":"下一步","id":"下一步"}],"summary":"接下做我們將實作書本列表頁面。這個頁面需要呈現數據庫中所有書本的列表，包含每本書的作者、標題，標題將成為一個超連結，連到書本詳細內容頁面。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Book list page","locale":"en-US","native":"English (US)"},{"title":"ブックリストページ","locale":"ja","native":"日本語"},{"title":"Страница списка книг","locale":"ru","native":"Русский"},{"title":"书本列表页面","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"zh-tw/learn/server-side/express_nodejs/displaying_data/book_list_page","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-tw/learn/server-side/express_nodejs/displaying_data/book_list_page/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-TW/docs/Learn","title":"學習該如何開發 Web"},{"uri":"/zh-TW/docs/Learn/Server-side","title":"伺服端網站程式設計"},{"uri":"/zh-TW/docs/Learn/Server-side/Express_Nodejs","title":"Express web framework (Node.js/JavaScript)"},{"uri":"/zh-TW/docs/Learn/Server-side/Express_Nodejs/Displaying_data","title":"Express 教程 5: 呈現圖書館數據"},{"uri":"/zh-TW/docs/Learn/Server-side/Express_Nodejs/Displaying_data/Book_list_page","title":"書本清單頁面"}],"pageTitle":"書本清單頁面 - 學習該如何開發 Web | MDN","noIndexing":false}}