{"doc":{"isMarkdown":true,"isTranslated":true,"isActive":true,"flaws":{},"title":"內容腳本","mdn_url":"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Content_scripts","locale":"zh-TW","native":"正體中文 (繁體)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions\"><strong>Browser extensions</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Getting started</summary>\n        <ol>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">What are extensions?</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Your first extension</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Your second extension</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomy of an extension</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Examples\">Example extensions</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/What_next_\">What next?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs\">Using the JavaScript APIs</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Match patterns</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Working with files</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalization</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Content Security Policy</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Native messaging</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome incompatibilities</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>User interface</summary>\n        <ol>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface\">User Interface</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Toolbar button</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Address bar button</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Sidebars</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Context menu items</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Options page</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Extension pages</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Address bar suggestions</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">Developer tools panels</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>How to</summary>\n        <ol>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercept HTTP requests</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modify a web page</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insert external content</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Add a button to the toolbar</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Implement a settings page</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Work with the Tabs API</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Work with the Bookmarks API</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Work with the Cookies API</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\">Work with contextual identities</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators\">Firefox differentiators</a></summary>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li></ol>\n      </details>\n    </li>\n    <li class=\"toggle\">\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">Introduction</a></li>\n        </ol>\n      <ol><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">applications</a></li><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">作者</a></li></ol>\n      </details>\n    </li>\n     <li class=\"toggle\">\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/Contact_us\"><strong>Contact us</strong></a></li>\n    <li class=\"toggle\">\n      <details>\n        <summary>Channels</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons blog</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons forum</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p></p>內容腳本（content script）是擴充套件的一部分，它會在在特定的網頁執行（與之相對的則是同樣屬於套件的後端腳本（background scripts）或者網站本身的腳本，像是那些那些透過 <a href=\"/zh-TW/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a> 標籤讀取的內容）<p></p>\n<p><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Background_scripts\">後端腳本</a>可以使用所有的 <a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API\">擴充套件 JavaScript APIs</a>，但它們無法直接使用網頁中的內容。所以如果你的套件必須要透過 content scripts 才能使用它們。</p>\n<p>就像一般網頁裡的 scripts 一樣，content scripts 可以透過 standard DOM APIs 存取並修改頁面內容。</p>\n<p>Content scripts 只能使用 can only access <a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#webextension_apis\">一小部分的擴充套件 APIs</a>，但它們可以透過一個訊息系統<a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#communicating_with_background_scripts\">來與後端腳本溝通</a>，從而間接地使用擴充套件 APIs。</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>備註：</strong> 留意到 content scripts 目前會在 addons.mozilla.org 和 testpilot.firefox.com 中被阻擋。如果你嘗試在這些網域下的頁面注入一段 content script 會失敗並且在日誌裡記下一個 <a href=\"/en-US/docs/Web/HTTP/CSP\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">CSP (en-US)</a> 錯誤。</p>\n</div>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>備註：</strong> 由於錯誤 <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1408996\" class=\"external\" rel=\" noopener\">1408996</a>，透過 <code>var foo</code> or <code>window.foo = \"bar\"</code> 加入 content script 的 global 作用域的值可能會消失。</p>\n</div>"}},{"type":"prose","value":{"id":"讀入內容腳本","title":"讀入內容腳本","isH3":false,"content":"<p>你可以透過下列三種方式將內容腳本讀入頁面：</p>\n<ol>\n  <li>**在安裝時讀入至符合 URL 模式的頁面：**透過你的 manifest.json 中的 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">content_scripts (en-US)</a> 鍵，你可以要求瀏覽器在每次讀取 URL<a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">符合給定模式</a>的頁面時讀入內容腳本。</li>\n  <li>**在執行時讀入至符合 URL 模式的頁面：**透過 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">content_scripts (en-US)</a> API，你可以要求瀏覽器在每次讀取 URL<a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">符合給定模式</a>的頁面時讀入內容腳本。這就像第一種方法，不同的是你可以在執行時增加或移除內容腳本。</li>\n  <li><strong>在執行時讀入至特定的頁籤：透過</strong> <a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/Tabs/executeScript\"><code>tabs.executeScript()</code></a> API，你可以在任何時候將內容腳本讀入特定的頁籤：舉例來說可以在使用者點擊<a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">工具列按鈕 (en-US)</a>時給予回應。</li>\n</ol>\n<p>每個套件的每個架構裡都只有一個全局作用域，所以一個內容腳本的變數可以直接被其他內容腳本使用，不管那個內容腳本是怎麼被讀入的。</p>\n<p>透過方法（1）和方法（2）你只能把內容腳本讀入至 URL 可以用<a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">匹配模式 (en-US)</a>來呈現的頁面中。而透過方法 3 可以把腳本讀入與套件打包在一起的頁面之中，但是你不能在像是 \"about:debugging\" 或 \"about:addons\" 這類特別的瀏覽器頁面讀入腳本。</p>"}},{"type":"prose","value":{"id":"內容腳本環境","title":"內容腳本環境","isH3":false,"content":""}},{"type":"prose","value":{"id":"使用_dom","title":"使用 DOM","isH3":true,"content":"<p>內容腳本可以像一般頁面的腳本一樣使用並修改頁面的 DOM。它們也可以偵測到所有頁面 script 對 DOM 做的更動。</p>\n<p>然而，內容腳本看到的是「乾淨的 DOM」。這表示：</p>\n<ul>\n  <li>內容腳本看不見頁面腳本的 Javascript 變數</li>\n  <li>如果頁面腳本修改了原有 DOM 的屬性，內容腳本會看見原來的屬性而非被修改過的。</li>\n</ul>\n<p>在 Gecko 裡，這種行爲稱爲 <a href=\"https://firefox-source-docs.mozilla.org/dom/scriptSecurity/xray_vision.html\" class=\"only-in-en-us external\" title=\"Currently only available in English (US)\" rel=\" noopener\">X 光視野 (en-US)</a>。</p>\n<p>舉例來說，有這樣一個網頁：</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>content-type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>page-scripts/page-script.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>\"page-script.js\" 做了這件事：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// page-script.js</span>\n\n<span class=\"token comment\">// 替DOM新增一個元素</span>\n<span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\np<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"This paragraph was added by a page script.\"</span><span class=\"token punctuation\">;</span>\np<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"page-script-para\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 替 window 定義一個新的屬性</span>\nwindow<span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> <span class=\"token string\">\"This global variable was added by a page script\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 重新定義內建的 window.confirm 函數</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">confirm</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"The page script has also redefined 'confirm'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>接著、一個套件把 content script 插入頁面：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\n<span class=\"token comment\">// 可以使用與修改DOM</span>\n<span class=\"token keyword\">var</span> pageScriptPara <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"page-script-para\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\npageScriptPara<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 看不見 page-script 增加的屬性</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// undefined</span>\n\n<span class=\"token comment\">// 看見的是原有的形式</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Are you sure?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 呼叫原本的 window.confirm()</span>\n</code></pre></div>\n<p>反過來也是一樣，頁面腳本無法看到內容腳本增加的 Javascript 屬性。</p>\n<p>這表示我們可以預期內容腳本依賴著 DOM 屬性，不需要擔心它的變數與頁面腳本中所定義的變數衝突。</p>\n<p>這實際的影響就是內容腳本無法使用所有頁面腳本讀入的函式庫。所以，舉例來說，如果頁面包含了 JQuery，內容腳本將無法看到它。</p>\n<p>如果內容腳本真的想要使用 javascript 函式庫，那麼函式庫本身必須要與要使用它的內容腳本一同插入：</p>\n<div class=\"code-example\"><pre class=\"brush: json notranslate\"><code><span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"matches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*://*.mozilla.org/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"jquery.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content-script.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>注意到 Firefox 提供了一些 API 來使用被頁面腳本產生的 Javascript 物件以及對頁面腳本公開自己的 Javascript 物件。詳閱<a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">與頁面腳本共用物件 (en-US)</a>。</p>"}},{"type":"prose","value":{"id":"擴充套件_apis","title":"擴充套件 APIs","isH3":true,"content":"<p>除標準 DOM APIs 之外，內容腳本可以使用下列 擴充套件 APIs：</p>\n<p>來自 <a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/extension\"><code>extension</code></a>:</p>\n<ul>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension/getURL\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">getURL() (en-US)</a></li>\n  <li><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/extension#inincognitocontext\"><code>inIncognitoContext</code></a></li>\n</ul>\n<p>來自 <a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/runtime\"><code>runtime</code></a>:</p>\n<ul>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/connect\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">connect() (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/getManifest\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">getManifest() (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/getURL\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">getURL() (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onConnect\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">onConnect (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">onMessage (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">sendMessage() (en-US)</a></li>\n</ul>\n<p>來自 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">i18n (en-US)</a>:</p>\n<ul>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n/getMessage\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">getMessage() (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n/getAcceptLanguages\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">getAcceptLanguages() (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n/getUILanguage\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">getUILanguage() (en-US)</a></li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n/detectLanguage\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">detectLanguage() (en-US)</a></li>\n</ul>\n<p>來自 <a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/storage\"><code>storage</code></a> 的全部。</p>"}},{"type":"prose","value":{"id":"xhr_與_fetch","title":"XHR 與 Fetch","isH3":true,"content":"<p>內容腳本可以透過一般的 <a href=\"/zh-TW/docs/Web/API/XMLHttpRequest\"><code>window.XMLHttpRequest</code></a> 與 <a href=\"/zh-TW/docs/Web/API/Fetch_API\"><code>window.fetch()</code></a> APIs 來發出請求。</p>\n<p>內容腳本跟套件的其他部分擁有相同的跨網域權限： 所以如果套件在 manifest.json 中透過 <a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\"><code>permissions</code></a> 鍵要求了某一網域的使用，那麼它的內容腳本也能使用同樣的網域。</p>\n<p>這是透過公開更多內容腳本中授權的 XHR 以及 fetch 實例來達成的。這件事情會導致標頭中不會設置 <a href=\"/en-US/docs/Web/HTTP/Headers/Origin\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">Origin (en-US)</a> 與 <a href=\"/en-US/docs/Web/HTTP/Headers/Referer\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">Referer (en-US)</a>的副作用，就像頁面請求自己一樣，一般會避免請求將跨來源泄露出去。從 58 版本號以後套件要傳送一些彷彿是頁面內容自己傳送的請求時可以改用 <code>content.XMLHttpRequest</code> 與 <code>content.fetch()</code>。對跨瀏覽器套件來說，這些事情的存在必須要能被做特徵檢測。</p>"}},{"type":"prose","value":{"id":"與後端腳本溝通","title":"與後端腳本溝通","isH3":false,"content":"<p>雖然內容腳本不能直接使用大部分的 擴充套件 APIs，但是透過使用訊息 APIs 與後端腳本溝通，它們能夠間接地使用與後端腳本一樣的 APIs。</p>\n<p>後端腳本與內容腳本的溝通模式有兩種： 你可以傳送選擇性夾帶回應的一次性訊息，也可以在兩者之間建立一個長存的連線來交換訊息。</p>"}},{"type":"prose","value":{"id":"一次性訊息","title":"一次性訊息","isH3":true,"content":"<p>要傳送選擇性夾帶回應的一次性訊息，你可以使用下列 APIs：</p>\n<table class=\"fullwidth-table standard-table\">\n  <thead>\n    <tr>\n      <th scope=\"row\"></th>\n      <th scope=\"col\">在內容腳本處</th>\n      <th scope=\"col\">在後端腳本處</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th scope=\"row\">傳訊息</th>\n      <td><code><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage\">browser.runtime.sendMessage()</a></code></td>\n      <td><code><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/Tabs/sendMessage\">browser.tabs.sendMessage()</a></code></td>\n    </tr>\n    <tr>\n      <th scope=\"row\">收訊息</th>\n      <td><code><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\">browser.runtime.onMessage</a></code></td>\n      <td><code><a href=\"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage\">browser.runtime.onMessage</a></code></td>\n    </tr>\n  </tbody>\n</table>\n<p>舉例來說，有個監聽著頁面點擊事件的內容腳本。如果點擊對象是連結，它會傳送目標的 URL 給後端腳本：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> notifyExtension<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">notifyExtension</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">!=</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"url\"</span><span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>後端腳本監聽這些訊息並且透過 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/notifications\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">notifications (en-US)</a> API 顯示通知：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// background-script.js</span>\n\nbrowser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>notify<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  browser<span class=\"token punctuation\">.</span>notifications<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"basic\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"iconUrl\"</span><span class=\"token operator\">:</span> browser<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">.</span><span class=\"token function\">getURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link.png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"你點了個按鈕喲！\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"message\"</span><span class=\"token operator\">:</span> message<span class=\"token punctuation\">.</span>url\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>這個範例來自 GitHub 上的 <a href=\"https://github.com/mdn/webextensions-examples/tree/master/notify-link-clicks-i18n\" class=\"external\" rel=\" noopener\">notify-link-clicks-i18n</a>，稍微經過修改。</p>"}},{"type":"prose","value":{"id":"基於連線的訊息","title":"基於連線的訊息","isH3":true,"content":"<p>當你在後端腳本與內容腳本間交換大量訊息時，使用一次性連線顯得沒效率。所以另一個替代方案是是在兩者間建立一個長存的連線，透過這個連線交換訊息。</p>\n<p>兩邊都有一個 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/Port\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">runtime.Port (en-US)</a> 物件可以用來交換訊息。</p>\n<p>建立連線你需要：</p>\n<ul>\n  <li>一邊透過 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onConnect\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">runtime.onConnect (en-US)</a> 監聽連線</li>\n  <li>另一邊呼叫 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/connect\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">tabs.connect() (en-US)</a> （對內容腳本建立連線時）或 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/connect\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">runtime.connect() (en-US)</a> （對後端腳本建立連線時）。這會回傳一個 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/Port\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">runtime.Port (en-US)</a> 物件。</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onConnect\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">runtime.onConnect (en-US)</a> 監聽器傳送自己的 <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/Port\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">runtime.Port (en-US)</a> 物件。</li>\n</ul>\n<p>當兩邊都有端口後，可以透過 <code>runtime.Port.postMessage()</code> 來傳送訊息，用 <code>runtime.Port.onMessage</code> 接收訊息。</p>\n<p>舉例來說，當這讀取完成，這個內容腳本會：</p>\n<ul>\n  <li>連線至後端腳本，並將 <code>Port</code> 儲存在一個 <code>myPort</code> 變數</li>\n  <li>監聽並記錄 <code>myPort</code> 的訊息</li>\n  <li>當使用者點擊文件時，透過 <code>myPort</code> 傳送訊息給後端腳本</li>\n</ul>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\n<span class=\"token keyword\">var</span> myPort <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"port-from-cs\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyPort<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">greeting</span><span class=\"token operator\">:</span> <span class=\"token string\">\"內容腳本傳喜訊\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmyPort<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">m</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"內容腳本收到來自後端腳本的訊息： \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">.</span>greeting<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  myPort<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">greeting</span><span class=\"token operator\">:</span> <span class=\"token string\">\"它們點了網頁！\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>同樣地，後端腳本會：</p>\n<ul>\n  <li>監聽來自內容腳本的連線請求</li>\n  <li>當它收到連線請求：\n    <ul>\n      <li>將端口儲存在 <code>portFromCS 這個變數</code></li>\n      <li>透過端口傳送訊息給內容腳本</li>\n      <li>開始監聽並記錄端口上的訊息</li>\n    </ul>\n  </li>\n  <li>當使用者點擊套件的工具列按鈕時，透過 <code>portFromCS</code> 傳送訊息給內容腳本</li>\n</ul>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// background-script.js</span>\n\n<span class=\"token keyword\">var</span> portFromCS<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">connected</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  portFromCS <span class=\"token operator\">=</span> p<span class=\"token punctuation\">;</span>\n  portFromCS<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">greeting</span><span class=\"token operator\">:</span> <span class=\"token string\">\"嘿！內容腳本！\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  portFromCS<span class=\"token punctuation\">.</span>onMessage<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">m</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"後端腳本收到來自內容腳本的訊息：\"</span><span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">.</span>greeting<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onConnect<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>connected<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nbrowser<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  portFromCS<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">greeting</span><span class=\"token operator\">:</span> <span class=\"token string\">\"它們按了按鈕！\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"複數內容腳本\">複數內容腳本</h4>\n<p>如果你有多個內容腳本同時在溝通，你可能會想把這些連線儲存在陣列裡面。</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// background-script.js</span>\n\n<span class=\"token keyword\">var</span> ports <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">connected</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ports<span class=\"token punctuation\">[</span>p<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>tab<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span>    <span class=\"token operator\">=</span> p\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span>\n\nbrowser<span class=\"token punctuation\">.</span>runtime<span class=\"token punctuation\">.</span>onConnect<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>connected<span class=\"token punctuation\">)</span>\n\nbrowser<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ports<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        p<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">greeting</span><span class=\"token operator\">:</span> <span class=\"token string\">\"它們按了按鈕！\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"與網頁溝通","title":"與網頁溝通","isH3":false,"content":"<p>雖說內容腳本預設不能存取頁面腳本產生的物件，但它們可以透過 DOM <a href=\"/en-US/docs/Web/API/Window/postMessage\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">window.postMessage (en-US)</a> 和 <a href=\"/zh-TW/docs/Web/API/EventTarget/addEventListener\"><code>window.addEventListener</code></a> APIs 與頁面腳本溝通。</p>\n<p>例如：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// page-script.js</span>\n\n<span class=\"token keyword\">var</span> messenger <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"from-page-script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmessenger<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> messageContentScript<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">messageContentScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">direction</span><span class=\"token operator\">:</span> <span class=\"token string\">\"from-page-script\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Message from the page\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>source <span class=\"token operator\">==</span> window <span class=\"token operator\">&amp;&amp;</span>\n      event<span class=\"token punctuation\">.</span>data <span class=\"token operator\">&amp;&amp;</span>\n      event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>direction <span class=\"token operator\">==</span> <span class=\"token string\">\"from-page-script\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"內容腳本收到訊息： \\\"\"</span> <span class=\"token operator\">+</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>message <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>完全版的範例請<a href=\"https://mdn.github.io/webextensions-examples/content-script-page-script-messaging.html\" class=\"external\" rel=\" noopener\">查看 GitHub 上的示範頁面</a>並按照教學做。</p>\n<div class=\"notecard warning\" id=\"sect3\">\n  <p><strong>警告：</strong> 注意到當你透過這個方式跟不被信任的內容腳本互動時要非常小心。套件有很強的權限，惡意網頁可以輕易地騙出這些權限。</p>\n  <p>舉個簡單的例子，假設一接收訊息的內容腳本長這樣：</p>\n  <div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>source <span class=\"token operator\">==</span> window <span class=\"token operator\">&amp;&amp;</span>\n      event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>direction <span class=\"token operator\">&amp;&amp;</span>\n      event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>direction <span class=\"token operator\">==</span> <span class=\"token string\">\"from-page-script\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n  <p>如此一來頁面腳本可以使用包含內容腳本全部權限的程式碼。</p>\n</div>"}},{"type":"prose","value":{"id":"在內容腳本中使用_eval","title":"在內容腳本中使用 eval()","isH3":false,"content":"<p>在 Chrome 裡， <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">eval() (en-US)</a> 只會在內容腳本而不會在頁面腳本裡執行。</p>\n<p>在 Firefox 裡：</p>\n<ul>\n  <li>如果你呼叫 <code>eval()</code>，它會在內容腳本中執行</li>\n  <li>如果你呼叫 <code>window.eval()</code>，它會在頁面腳本中執行</li>\n</ul>\n<p>例如，試想有一個內容腳本長這樣：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'window.x = 1;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'window.y = 2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">In content script, window.x: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>window<span class=\"token punctuation\">.</span>x<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">In content script, window.y: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>window<span class=\"token punctuation\">.</span>y<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> <span class=\"token string\">\"check\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>這段程式碼透過 <code>window.eval()</code> 和 <code>eval()</code> 建立了些變數 x 和 y 、記錄下它們的值並且傳訊息給頁面。</p>\n<p>接收訊息這邊，頁面腳本記錄下一樣的值：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>source <span class=\"token operator\">===</span> window <span class=\"token operator\">&amp;&amp;</span> event<span class=\"token punctuation\">.</span>data <span class=\"token operator\">&amp;&amp;</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>message <span class=\"token operator\">===</span> <span class=\"token string\">\"check\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">In page script, window.x: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>window<span class=\"token punctuation\">.</span>x<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">In page script, window.y: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>window<span class=\"token punctuation\">.</span>y<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>在 Chrome 裡，這會產出這樣的結果：</p>\n<pre class=\"notranslate\">In content script, window.x: 1\nIn content script, window.y: 2\nIn page script, window.x: undefined\nIn page script, window.y: undefined\n</pre>\n<p>而在 Firefox 裡會產生這些：</p>\n<pre class=\"notranslate\">In content script, window.x: undefined\nIn content script, window.y: 2\nIn page script, window.x: 1\nIn page script, window.y: undefined\n</pre>\n<p>這些也適用於 <a href=\"/en-US/docs/Web/API/setTimeout\" class=\"only-in-en-us\" title=\"Currently only available in English (US)\">setTimeout() (en-US)</a>、<a href=\"/zh-TW/docs/Web/API/setInterval\"><code>setInterval()</code></a>、與 <a href=\"/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Function\"><code>Function()</code></a>。</p>\n<p>當在頁面執行程式碼時一定要小一萬個心，頁面的環境有可能被惡意的網頁所控制，它們可以重新定義與你互動的物件來作出一些出乎意料的行爲：</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// page.js 重新定義 console.log</span>\n\n<span class=\"token keyword\">var</span> original <span class=\"token operator\">=</span> console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">log</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">original</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// content-script.js 呼叫被重新定義的版本</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'console.log(false)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}}],"toc":[{"text":"讀入內容腳本","id":"讀入內容腳本"},{"text":"內容腳本環境","id":"內容腳本環境"},{"text":"與後端腳本溝通","id":"與後端腳本溝通"},{"text":"與網頁溝通","id":"與網頁溝通"},{"text":"在內容腳本中使用 eval()","id":"在內容腳本中使用_eval"}],"summary":"後端腳本可以使用所有的 擴充套件 JavaScript APIs，但它們無法直接使用網頁中的內容。所以如果你的套件必須要透過 content scripts 才能使用它們。","popularity":0,"modified":"2022-10-01T03:41:16.000Z","other_translations":[{"title":"Content scripts","locale":"en-US","native":"English (US)"},{"title":"Scripts de contenu","locale":"fr","native":"Français"},{"title":"コンテンツスクリプト","locale":"ja","native":"日本語"},{"title":"Content scripts","locale":"ko","native":"한국어"},{"title":"Встраиваемый скрипт","locale":"ru","native":"Русский"},{"title":"Content scripts","locale":"zh-CN","native":"中文 (简体)"}],"source":{"folder":"zh-tw/mozilla/add-ons/webextensions/content_scripts","github_url":"https://github.com/mdn/translated-content/blob/main/files/zh-tw/mozilla/add-ons/webextensions/content_scripts/index.md","last_commit_url":"https://github.com/mdn/translated-content/commit/921c46a374ab0a9f4cc809af0370f8c412e54701","filename":"index.md"},"parents":[{"uri":"/zh-TW/docs/Mozilla","title":"Mozilla"},{"uri":"/zh-TW/docs/Mozilla/Add-ons","title":"附加元件"},{"uri":"/zh-TW/docs/Mozilla/Add-ons/WebExtensions","title":"瀏覽器擴充功能"},{"uri":"/zh-TW/docs/Mozilla/Add-ons/WebExtensions/Content_scripts","title":"內容腳本"}],"pageTitle":"內容腳本 - Mozilla | MDN","noIndexing":false}}